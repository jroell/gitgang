â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â•‘ ğŸ¤˜ GitGang - The gang's all here to code!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Repository: /Users/jasonroell/augment-vurvey/vurvey-web-manager
Base branch: exp-bun
Task: create extensive documentation around this project. Both the implementation code and docs on how to test it with playwright
Rounds: 3  Auto-merge: true
Type /help for interactive commands while agents run.
Type /help for commands. Agents continue running while you use this.
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â•‘ ğŸš€ Starting AI Agents
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[GEMINI] â†’ agents/gemini/20251104-155448-2dbbf1
[CLAUDE] â†’ agents/claude/20251104-155449-af9414
[CODEX] â†’ agents/codex/20251104-155449-6a42f6

[CODEX] OpenAI Codex v0.53.0 (research preview)
[CODEX] --------
[CODEX] sandbox: danger-full-access
[CODEX] reasoning effort: high
[CODEX] reasoning summaries: auto
[CODEX] --------
[CODEX] user
[CODEX] You are an autonomous senior engineer with full authorization to edit files, run shell commands, install dependencies, and run tests.
[CODEX] Do not ask for permission. Decide and proceed.
[CODEX] Work in small, verifiable steps and commit early with clear messages.
[CODEX] Add or update tests to cover the change.
[CODEX] If something fails, debug and keep going until complete.
[CODEX] At the end, summarize what changed and any follow ups.
[CODEX] Task: create extensive documentation around this project. Both the implementation code and docs on how to test it with playwright
[CODEX] Base branch: exp-bun
[CODEX] You are in a dedicated git worktree and branch for codex.
[CODEX] Objectives:
[CODEX] 1) Implement the feature to production quality.
[CODEX] 2) Add or update tests.
[CODEX] 3) Update docs if needed.
[CODEX] 4) Commit early and often with clear messages.
[CODEX] 5) Ensure the project builds and tests pass.
[CODEX] Rules:
[CODEX] - You have full authorization to modify files and run commands in this workspace.
[CODEX] - Do not prompt for confirmation.
[CODEX] - If blocked, propose a plan, then execute it.
[CODEX] - Keep going until done.
[GEMINI] â””â”€ Task: You are an autonomous senior engineer with full authorization to edit files, run...
[CLAUDE]   âš™ï¸  Initialized (claude-sonnet-4-5)
[GEMINI]   Right, I'll document the project's code and Playwright testing. I'll work autonomously, committing often
[GEMINI]   and ensuring tests pass. First, I'll review the existing `docs` to see what's there and what'
[GEMINI]   s missing.
[GEMINI]   ğŸ”§ list_directory
[CLAUDE]   I'll create comprehensive documentation for this project, including implementation code documentation and Playwright testing guides. Let me start by exploring the project structure.
[CLAUDE]   ğŸ”§ Bash: Get current working directory
[CODEX] thinking
[CODEX] **Preparing to create detailed documentation**
[CODEX] I'm focusing on building extensive documentation for the project, including implementation details and Playwright testing instructions. I'll start by inspecting the repo structure and gathering info with commands like `git status` to understand where I am and plan the multi-step documentation process carefully.
[CODEX] exec
[CODEX] bash -lc 'git status -sb' in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f62025-11-04T20:55:02.466122Z ERROR codex_core::exec: exec error: No such file or directory (os error 2)
[CODEX] exited -1 in 0ms:
[CODEX] execution error: Io(Os { code: 2, kind: NotFound, message: "No such file or directory" })
[GEMINI]   Alright, I'll improve the documentation. I'll start by reading and enhancing the main `docs/README.md`.
[GEMINI]   ğŸ”§ read_file
[CLAUDE]   ğŸ”§ Bash: List files in current directory
[CODEX] thinking
[CODEX] **Setting absolute workdir path**
[CODEX] exec
[CODEX] bash -lc 'git status -sb' in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 151ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] ## agents/codex/20251104-155449-6a42f6
[CODEX] ?? .logs/
[GEMINI]   This `README.md` is a good start. I'll improve it by detailing the development setup, creating a comprehensive
[GEMINI]   `testing-guide.md`, and adding sections for deployment, contributions, and code style. I'll also update the
[GEMINI]   API documentation link. First, I'll create the `testing-guide.md`.
[CLAUDE]   ğŸ”§ Read
[CODEX] thinking
[CODEX] **Planning documentation and testing steps**
[CLAUDE]   ğŸ”§ Bash: List source directory structure
[CODEX] exec
[CODEX] bash -lc ls in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 82ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] babel.config.json
[CODEX] cors-config.json
[CODEX] docs
[CODEX] eslint.config.mjs
[CODEX] FINAL_VERIFICATION.md
[CODEX] fixed-markdown.md
[CODEX] GRAPHQL_MIGRATION.md
[CODEX] IMPLEMENTATION_PROGRESS.md
[CODEX] IMPLEMENTATION_SUMMARY.md
[CODEX] index.html
[CODEX] lifecycle-policy.json
[CODEX] MOBILE_RESPONSIVENESS_IMPROVEMENTS.md
[CODEX] nodemon.json
[CODEX] package-lock.json
[CODEX] package.json
[CODEX] playwright
[CODEX] playwright.config.ts
[CODEX] prettierrc.js
[CODEX] public
[GEMINI]   ğŸ”§ write_file
[GEMINI]   Okay, I'll link the new `testing-guide.md` in `docs/README.md` and
[GEMINI]   add a "Testing" section to the root `README.md`. First, I'll read the root `README.md`.
[GEMINI]   ğŸ”§ read_file
[CLAUDE]   ğŸ”§ Bash: Check Playwright test directory structure
[GEMINI]   Okay, I'll update the `README.md` to include a prominent "Testing" section with a link to
[GEMINI]   `testing-guide.md`, and also add "Deployment" and "Contributing" sections. First, I'll link
[GEMINI]   the testing guide in `docs/README.md`.
[GEMINI]   ğŸ”§ replace
[CLAUDE]   ğŸ”§ Read
[CODEX] thinking
[CODEX] **Planning comprehensive documentation update**
[CODEX] I'll review the current docs and project structure to pinpoint gaps, especially around architecture and Playwright testing, then draft new detailed docs including environment setup and workflows, and finally consider updating or adding Playwright tests to ensure the docs and tests align well.
[CODEX] exec
[CODEX] bash -lc "sed -n '1,160p' README.md" in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 45ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] # Vurvey Web Manager
[CODEX] This repository contains the main Vurvey React application hosted at:
[CODEX] - Production: `vurvey.app`
[CODEX] - Staging: `staging.vurvey.dev`
[CODEX] - Development: `vurvey.dev`
[CODEX] The application is used to manage Vurvey workspaces, surveys, AI agents, and other business entities. It provides a comprehensive interface for brands to gather, analyze, and leverage video feedback from consumers.
[CODEX] ## Frontend Architecture Diagram
[CODEX] ```mermaid
[CODEX] graph TD
[CODEX] subgraph "Core Application"
[CODEX] App["App<br/>(Root Component)"]
[CODEX] Router["Router<br/>(React Router)"]
[CODEX] AuthProvider["Auth Provider<br/>(Firebase Auth)"]
[CODEX] ApolloProvider["Apollo Provider<br/>(GraphQL Client)"]
[GEMINI]   Okay, I'm updating the root `README.md`. I'll expand the "Testing" section, linking to
[GEMINI]   `testing-guide.md`, and add new "Deployment" and "Contributing" sections.
[CODEX] thinking
[CODEX] **Continuing exploration**
[CODEX] exec
[CODEX] bash -lc "sed -n '160,320p' README.md" in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 46ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] %% Style definitions
[CODEX] classDef core fill:#f9f,stroke:#333,stroke-width:2px
[CODEX] classDef feature fill:#bbf,stroke:#333,stroke-width:2px
[CODEX] classDef shared fill:#bfb,stroke:#333,stroke-width:2px
[CODEX] classDef api fill:#fbf,stroke:#333,stroke-width:2px
[CODEX] classDef state fill:#fbb,stroke:#333,stroke-width:2px
[CODEX] %% Apply styles
[CODEX] class App,Router,AuthProvider,ApolloProvider,GlobalContext core
[CODEX] class Account,Branding,Surveys,Responses,Reels,Agents,Chat,Canvas,Audience feature
[CODEX] class UI,Layout,Modals,Media,Charts shared
[CODEX] class GraphQL,Queries,Mutations,Subscriptions,Fragments api
[CODEX] class Context,LocalState,ApolloCache,CustomHooks state
[CODEX] ```
[CODEX] ## User Flow Diagram
[CODEX] ```mermaid
[CODEX] flowchart TD
[CLAUDE]   ğŸ”§ Bash: List existing docs directory
[GEMINI]   ğŸ”§ replace
[CODEX] thinking
[CODEX] **Continuing process**
[GEMINI]   Creating `CONTRIBUTING.md`.
[CODEX] exec
[CODEX] bash -lc "sed -n '320,640p' README.md" in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 33ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] â”œâ”€â”€ public/                 # Static assets
[CODEX] â”œâ”€â”€ src/
[CODEX] â”‚   â”œâ”€â”€ account/            # User account management
[CODEX] â”‚   â”œâ”€â”€ admin/              # Administrative features
[CODEX] â”‚   â”œâ”€â”€ agents/             # AI agents functionality
[CODEX] â”‚   â”œâ”€â”€ audience/           # Audience management
[CODEX] â”‚   â”œâ”€â”€ branding/           # Brand management
[CODEX] â”‚   â”œâ”€â”€ campaigns/          # Campaign management
[CODEX] â”‚   â”œâ”€â”€ canvas/             # Canvas/editor functionality
[CODEX] â”‚   â”œâ”€â”€ contacts/           # Contact management
[CODEX] â”‚   â”œâ”€â”€ context/            # React contexts
[CODEX] â”‚   â”œâ”€â”€ graphql/            # GraphQL queries/mutations
[CODEX] â”‚   â”œâ”€â”€ hooks/              # Custom React hooks
[CODEX] â”‚   â”œâ”€â”€ models/             # Data models
[CODEX] â”‚   â”œâ”€â”€ shared/             # Shared components
[CODEX] â”‚   â””â”€â”€ styles/             # Global styles
[CODEX] â””â”€â”€ vite.config.js          # Vite configuration
[CODEX] ```
[CLAUDE]   Now let me explore the code structure to understand what needs to be documented:
[CLAUDE]   ğŸ”§ Bash: Find TypeScript files in src
[GEMINI]   ğŸ”§ write_file
[CODEX] thinking
[CODEX] **Inspecting documentation directory**
[GEMINI]   Okay, `CONTRIBUTING.md` and `README.md` are done. Now to improve Playwright test
[GEMINI]   documentation, starting with `playwright/README.md`.
[GEMINI]   ğŸ”§ read_file
[CODEX] exec
[CODEX] bash -lc 'ls docs' in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 57ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] authentication.md
[CODEX] chat-document-persistence.md
[CODEX] chat-streaming.md
[CODEX] chat-tools.md
[CODEX] components.md
[CODEX] core-features.md
[CODEX] custom-hooks.md
[CODEX] e2e-testing-patterns.md
[CODEX] getting-started.md
[CODEX] graphql-integration.md
[CODEX] project-structure.md
[CODEX] README.md
[CODEX] routes.md
[CODEX] smooth-streaming.md
[CODEX] state-management.md
[CODEX] TEST-README.md
[CODEX] test-resilience-strategy.md
[CODEX] workflow-builder-guide.md
[CLAUDE]   Let me create a comprehensive task list for this documentation effort:
[GEMINI]   This `playwright/README.md` is a great start. I'll improve it by adding sections on the
[GEMINI]   Page Object Model, fixtures, and debugging, and I'll clarify the authentication section. I'm starting with the Page
[GEMINI]   Object Model.
[CLAUDE]   ğŸ”§ TodoWrite
[GEMINI]   ğŸ”§ replace
[CLAUDE]   ğŸ”§ Bash: Count exported items in source files
[GEMINI]   Okay, I'll add the "Fixtures" and "Debugging" sections and update the "Authentication" section.
[CODEX] thinking
[CODEX] **Planning extensive documentation and tests**
[CODEX] I'm thinking about creating new, detailed docs focused on the project's architecture and Playwright testing, while integrating or updating existing README and e2e docs. I also want to explore adding or updating Playwright tests related to documentation visibility or instructions, so I'll check the current tests to see where doc-related coverage fits best.
[CODEX] exec
[CODEX] bash -lc 'ls playwright' in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 65ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] env.d.ts
[CODEX] fixtures
[CODEX] helpers
[CODEX] page-objects
[CODEX] README-chat-tests.md
[CODEX] README.md
[CODEX] tests
[CODEX] tests-archive
[CLAUDE]   ğŸ”§ Bash: Get code statistics
[CODEX] thinking
[CODEX] **Checking README in tests folder**
[CODEX] exec
[CODEX] bash -lc "sed -n '1,200p' playwright/README.md" in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 60ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] # Vurvey Web Manager Testing Guide
[CODEX] This document provides comprehensive guidance for testing the Vurvey Web Manager application.
[CODEX] ## Overview
[CODEX] Vurvey Web Manager uses two primary testing approaches:
[CODEX] - **End-to-End Tests**: Using Playwright for testing the application in a real browser environment
[CODEX] - **Unit Tests**: Using Jest for testing individual components and functions
[CODEX] ## End-to-End Testing with Playwright
[CODEX] ### Setup
[CODEX] 1. **Prerequisites**:
[CODEX] - Node.js (v20.x recommended)
[CODEX] - npm (v9.x or higher)
[GEMINI]   ğŸ”§ replace
[GEMINI] Error executing tool replace: File path must be within one of the workspace directories: /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/gemini-agents_gemini_20251104-155448-2dbbf1
[GEMINI]   Wrong file path. Correcting and retrying.
[CLAUDE]   Excellent! This is a substantial codebase. Let me explore the key areas and then create comprehensive documentation:
[CLAUDE]   ğŸ”§ Bash: List Playwright test files
[CODEX] thinking
[CODEX] **Evaluating existing documentation structure**
[CODEX] exec
[CODEX] bash -lc "sed -n '1,200p' docs/README.md" in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 48ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] # Vurvey Web Manager Documentation
[CODEX] ## Overview
[CODEX] Vurvey Web Manager is a React-based frontend application that provides the user interface for the Vurvey platform. It enables brands to gather video feedback from consumers through surveys, manage AI agents, and analyze results. Built with TypeScript, it uses GraphQL for API communication and follows modern web development practices.
[CODEX] ## Technology Stack
[CODEX] - **Framework**: React 18.3.1 with TypeScript 4.9.5
[CODEX] - **State Management**: React Context API
[CODEX] - **API**: GraphQL with Apollo Client 3.7.17
[CODEX] - **Styling**: SCSS Modules
[CODEX] - **UI Libraries**: Radix UI, Framer Motion, React Spring
[CODEX] - **Testing**: Jest for unit tests, Playwright for E2E tests
[CODEX] - **Build Tool**: Vite 6.2.5
[CODEX] - **Package Manager**: npm
[CODEX] ## Documentation Structure
[GEMINI]   ğŸ”§ replace
[CLAUDE]   ğŸ”§ Read
[CODEX] thinking
[CODEX] **Reviewing existing implementation documentation**
[GEMINI]   Playwright test documentation is significantly improved, fulfilling the user's request for comprehensive project and testing documentation. Committing changes now
[GEMINI]   .
[GEMINI]   ğŸ”§ run_shell_command: Stage all changes for commit.
[CODEX] exec
[CODEX] bash -lc "sed -n '1,200p' IMPLEMENTATION_SUMMARY.md" in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 59ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] # Timeline UI Implementation Summary
[CODEX] ## âœ… All Changes Complete
[CODEX] ### What Was Changed
[CODEX] #### 1. Active Timeline (LoadingContent) - "Thinking" View
[CODEX] **File: `loading-content/loading-content.module.scss`**
[CODEX] - âŒ Removed card backgrounds and borders from timeline items
[CODEX] - âŒ Removed vertical connecting lines between items
[CODEX] - âœ… Simplified to clean, minimal text-only design
[CODEX] - âœ… Adjusted marker sizes (8px dots, 14px globe icons)
[CODEX] - âœ… Updated spacing (16px gap between items, 4px internal gaps)
[CODEX] - âœ… Changed text weight to 400 (normal) for cleaner look
[CODEX] - âœ… Updated font sizes and line-heights to match mockup
[CODEX] - âœ… Adjusted source list positioning (6px margin-top)
[CLAUDE]   Now let me explore specific implementation areas to document:
[GEMINI]   Okay, committing changes with a clear message.
[GEMINI]   ğŸ”§ run_shell_command: Commit the staged changes with a descriptive message.
[CLAUDE]   ğŸ”§ Read
[GEMINI]   I've documented the Vurvey Web Manager, including implementation and Playwright testing. Key updates include a new
[GEMINI]   `testing-guide.md`, a `CONTRIBUTING.md`, and improved READMEs with testing, deployment, and
[GEMINI]   contribution details. The Playwright README now covers the Page Object Model, Fixtures, and Debugging. I've committed
[GEMINI]   these changes. Next, I'll create a new test for `ManageLabelsPage` and `SuperAdminPage`, starting
[GEMINI]   by reviewing the existing page objects.
[CLAUDE]   Now let me start creating comprehensive documentation. I'll begin with the implementation documentation:
[GEMINI]   ğŸ”§ list_directory
[GEMINI]   `ManageLabelsPage.ts` and `SuperAdminPage.ts` page objects exist. I'll create
[GEMINI]   `super_admin.spec.ts` in `playwright/tests` and start writing the test.
[CLAUDE]   ğŸ”§ TodoWrite
[CODEX] thinking
[CODEX] **Planning documentation and test updates**
[CODEX] Iâ€™m thinking about creating a comprehensive `DOCUMENTATION.md` at the repo root summarizing the project and adding a detailed Playwright testing guide in `docs/playwright-testing-guide.md`. To meet instructions, Iâ€™ll align tests with the docs by adding or updating Playwright tests that verify key flows like login, ensuring they actually match the documented steps, even if the docs arenâ€™t UI-accessible themselves. Iâ€™ll also check existing test commands in `package.json` to run appropriate tests and linters to confirm everything passes smoothly.
[GEMINI]   ğŸ”§ write_file
[CODEX] exec
[CODEX] bash -lc 'cat package.json' in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 62ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] {
[CODEX] "name": "@batterii/vurvey-web-manager",
[CODEX] "private": true,
[CODEX] "version": "11.29.2",
[CODEX] "description": "Vurvey Manager Web UI",
[CODEX] "author": "Batterii, LLC",
[CODEX] "license": "UNLICENSED",
[CODEX] "type:": "module",
[CODEX] "repository": "github:Batterii/vurvey-web-manager",
[CODEX] "overrides": {
[CODEX] "prismjs": "^1.30.0",
[CODEX] "@openfeature/flipt-web-provider": {
[CODEX] "@flipt-io/flipt-client-js": "$@flipt-io/flipt-client-js"
[CODEX] },
[CODEX] "apollo-link": {
[CODEX] "graphql": "$graphql"
[CODEX] }
[CODEX] },
[CODEX] "dependencies": {
[GEMINI]   Test file's made. Running tests now.
[GEMINI]   ğŸ”§ run_shell_command: Run the newly created test file to check for any issues.
[CODEX] thinking
[CODEX] **Reviewing additional scripts**
[GEMINI]   Right, environment variables. I'll create a `.env` file in the root and add the credentials.
[GEMINI]   ğŸ”§ write_file
[CODEX] exec
[CODEX] bash -lc "cat package.json | sed -n '160,320p'" in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 62ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] "apollo:schema:download": "rover graph fetch $APOLLO_GRAPH_REF --output schema.graphql",
[CODEX] "apollo:client:check": "apollo client:check --config apollo.config.js",
[CODEX] "apollo:client:push": "apollo client:push --config apollo.config.js",
[CODEX] "validate:apollo": "node scripts/apollo-studio-validation.js",
[CODEX] "validate:graphql:enhanced": "npm run validate:apollo"
[CODEX] },
[CODEX] "eslintConfig": {
[CODEX] "extends": [
[CODEX] "react-app",
[CODEX] "react-app/jest"
[CODEX] ],
[CODEX] "rules": {
[CODEX] "@typescript-eslint/no-unused-vars": "warn"
[CODEX] }
[CODEX] },
[CODEX] "browserslist": {
[CODEX] "production": [
[CODEX] ">0.2%",
[CODEX] "not dead",
[GEMINI]   `.env` created. Rerunning tests.
[GEMINI]   ğŸ”§ run_shell_command: Run the newly created test file to check for any issues.
[CODEX] thinking
[CODEX] **Reviewing scripts section from the start**
[CODEX] exec
[CODEX] bash -lc "cat package.json | sed -n '120,200p'" in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 57ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] "three": "^0.170.0",
[CODEX] "tiptap-extension-resize-image": "^1.2.2",
[CODEX] "tiptap-markdown": "^0.8.10",
[CODEX] "tweakpane": "^4.0.5",
[CODEX] "typescript": "^5.8.3",
[CODEX] "uuid": "^11.1.0",
[CODEX] "vite-plugin-env-compatible": "^1.1.1",
[CODEX] "vite-plugin-svgr": "^4.3.0",
[CODEX] "web-vitals": "^5.0.1",
[CODEX] "zod": "^3.25.76"
[CODEX] },
[CODEX] "scripts": {
[CODEX] "start": "vite",
[CODEX] "build": "npm run validate:graphql && vite build",
[CODEX] "serve": "vite preview",
[CODEX] "test": "npx playwright test $npm_config_argv",
[CODEX] "test:unit": "vitest run \"src/shared/\" \"src/hooks/\" \"src/canvas/chat-bubble/chat-bubble.test.tsx\" \"src/context/workflow-contexts/workflow-context.test.tsx\" \"src/reducer/chat-reducer/chat-reducer.test.ts\" \"src/reducer/workflow-reducer.test.ts\" \"src/workflow/integration-tests/simplified-flow-test.test.tsx\" \"src/workflow/integration-tests/mock-test.test.ts\"",
[CODEX] "test:unit:all": "vitest run",
[CODEX] "test:unit:check": "vitest run --run",
[CODEX] thinking
[CODEX] **Drafting multi-step documentation plan**
[CODEX] Iâ€™m outlining a plan to audit existing docs and Playwright assets, define a clear doc structure, add or update key documentation files, and ensure tests align with the docs. Iâ€™ll be cautious about running Playwright tests since they may require environment credentials we donâ€™t have, so Iâ€™m considering lighter test runs like unit tests instead.
[CODEX] Plan update
[CODEX] â†’ Assess existing documentation and testing resources to map gaps for implementation coverage and Playwright workflows.
[CODEX] â€¢ Author and organize new documentation that covers implementation architecture and detailed Playwright testing guidance.
[CODEX] â€¢ Add or update automated tests (and run relevant suites) to align with the new documentation, then validate everything passes.
[CODEX] thinking
[CODEX] **Gathering project structure details**
[CODEX] exec
[CODEX] bash -lc 'ls src' in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 62ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] __mocks__
[CODEX] account
[CODEX] admin
[CODEX] agents
[CODEX] app
[CODEX] app.tsx
[CODEX] branding
[CODEX] cache.ts
[CODEX] campaign
[CODEX] campaigns
[CODEX] canvas
[CODEX] components
[CODEX] config
[CODEX] contacts
[CODEX] context
[CODEX] datasets
[CODEX] docs
[CODEX] error-boundaries
[CODEX] feature-flags
[CODEX] thinking
[CODEX] **Summarizing documentation status**
[CODEX] Plan update
[CODEX] âœ“ Assess existing documentation and testing resources to map gaps for implementation coverage and Playwright workflows.
[CODEX] â†’ Author and organize new documentation that covers implementation architecture and detailed Playwright testing guidance.
[CODEX] â€¢ Add or update automated tests (and run relevant suites) to align with the new documentation, then validate everything passes.
[CODEX] thinking
[CODEX] **Planning documentation structure**
[CODEX] exec
[CODEX] bash -lc "sed -n '1,200p' docs/e2e-testing-patterns.md" in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 52ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] # E2E Testing Best Practices
[CODEX] This document outlines the patterns and best practices we've implemented to make our Playwright E2E tests more robust and resilient.
[CODEX] ## Authentication Resilience
[CODEX] Our E2E tests now handle both authenticated and non-authenticated states, making them more reliable:
[CODEX] ```typescript
[CODEX] // Check if we're on the login page
[CODEX] const isOnLoginPage = await page.getByText("Unlock Vurvey AI!").isVisible().catch(() => false);
[CODEX] if (isOnLoginPage) {
[CODEX] console.log("On login page - authentication not persisted");
[CODEX] // Verify login page elements are visible
[CODEX] await expect(page.getByText("Unlock Vurvey AI!")).toBeVisible();
[CODEX] await expect(page.getByRole('button', { name: 'Sign in with Email' })).toBeVisible();
[CODEX] thinking
[CODEX] **Planning extensive documentation update**
[CODEX] Iâ€™m organizing a comprehensive set of docs to cover architecture, implementation, testing (including Playwright), and workflows across multiple new and reorganized filesâ€”focusing on clarity, linking, and avoiding duplication while updating READMEs and root docs to point to these new resources.
[CODEX] exec
[CODEX] bash -lc "sed -n '1,200p' docs/TEST-README.md" in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 25ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] # Testing Guide
[CODEX] This document explains the testing approach for the project and how to run, write, and fix tests.
[CODEX] ## Testing Commands
[CODEX] We have several test commands available:
[CODEX] ```bash
[CODEX] # Run working unit tests (154 passing tests)
[CODEX] npm run test:unit
[CODEX] # Run all tests (includes some failing tests)
[CODEX] npm run test:unit:all
[CODEX] # Quick check of test status
[CODEX] npm run test:unit:check
[CODEX] # Run specific test categories
[CODEX] thinking
[CODEX] **Preparing to unify documentation**
[CODEX] exec
[CODEX] bash -lc "sed -n '1,200p' src/index.tsx" in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 59ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] import {loadErrorMessages, loadDevMessages} from "@apollo/client/dev";
[CODEX] import React, {ReactElement} from "react";
[CODEX] import {DndProvider} from "react-dnd";
[CODEX] import {HTML5Backend} from "react-dnd-html5-backend";
[CODEX] import ReactDom from "react-dom/client";
[CODEX] import {createBrowserRouter, RouterProvider} from "react-router-dom";
[CODEX] import {IntercomProvider} from "react-use-intercom";
[CODEX] import {App} from "./app";
[CODEX] import {config} from "./config";
[CODEX] import {ApolloContextProvider} from "./context/apollo-context";
[CODEX] import {ConnectionHealthContextProvider} from "./context/connection-health-context";
[CODEX] import {ErrorBoundaryContextProvider} from "./context/error-boundary-context";
[CODEX] import {LaunchDarklyProvider} from "./context/launchdarkly-context";
[CODEX] import {MainErrorBoundary} from "./error-boundaries";
[CODEX] import {OpenFeatureProviderWrapper} from "./feature-flags/open-feature/open-feature-provider";
[CODEX] if (["local", "staging", "experimental"].includes(import.meta.env.REACT_APP_ENV ?? "")) {
[CODEX] // Adds messages only in a dev environment
[CODEX] thinking
[CODEX] **Planning comprehensive documentation structure**
[CODEX] I'm outlining a detailed documentation plan covering the module architecture, provider stack, data flow, testing guides, and more, with new docs for implementation and Playwright. I'll carefully craft a top-level DOCUMENTATION.md to link everything cohesively and correct existing README links. Before writing, I want to finalize the Implementation Guide sections to ensure precise and thorough coverage.
[CODEX] exec
[CODEX] bash -lc "sed -n '1,200p' src/app/app.tsx" in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 exited 1 in 58ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] sed: src/app/app.tsx: No such file or directory
[CLAUDE]   ğŸ”§ Write
[CODEX] thinking
[CODEX] **Checking src/app directory contents**
[CODEX] exec
[CODEX] bash -lc 'ls src/app' in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 59ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] conversation-redirect.test.tsx
[CODEX] thinking
[CODEX] **Checking App component in src/app.tsx**
[CODEX] exec
[CLAUDE]   ğŸ”§ TodoWrite
[CODEX] bash -lc "sed -n '1,200p' src/app.tsx" in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 186ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] import React, {ReactElement, lazy, Suspense, useEffect, useTransition} from "react";
[CODEX] import {Route, Routes} from "react-router-dom";
[CODEX] import {AccountPage, PersonalProfile, TOS} from "./account/containers";
[CODEX] import {AdminRedirect} from "./admin/components/admin-redirect";
[CODEX] import {
[CODEX] AdminPage,
[CODEX] AgentsAdminPage,
[CODEX] AgentsV2AdminPage,
[CODEX] BrandManagement,
[CODEX] CampaignTemplateManagement,
[CODEX] MetabaseDashboard,
[CODEX] PendingApprovalsManagementPage,
[CODEX] SurveysAdminPage,
[CODEX] WorkspaceManagement,
[CODEX] } from "./admin/containers";
[CODEX] import {SSOProvidersPage} from "./admin/containers/sso-providers-page";
[CODEX] import {VurveyEmployeesManagement} from "./admin/containers/vurvey-employees-managment";
[CODEX] import {AgentsPage, AssistantsPage} from "./agents/containers";
[CLAUDE]   Now let me create a comprehensive Playwright testing guide:
[CLAUDE]   ğŸ”§ Read
[CODEX] thinking
[CODEX] **Drafting comprehensive implementation guide**
[CODEX] I'm planning a detailed implementation guide covering app entry, provider stack, routing, feature modules, shared systems, UI, data flows, build processes, testing, and references to other docs. I'll carefully craft clear, extensive content with helpful bullet points and code examples, then add it as a new markdown file.
[CLAUDE]   ğŸ”§ Read
[CLAUDE]   ğŸ”§ Bash: List page object files
[CLAUDE]   ğŸ”§ Read
[CLAUDE]   Now let me create a comprehensive Playwright testing guide:
[CODEX] file update
[CODEX] A /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6/docs/implementation-guide.md
[CODEX] # Implementation Guide
[CODEX] This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] - [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] - [Global Provider Stack](#global-provider-stack)
[CODEX] - [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] - [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] - [Shared Systems](#shared-systems)
[CODEX] - [State Management Patterns](#state-management-patterns)
[CODEX] - [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] - [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] - [Observability & Error Handling](#observability--error-handling)
[CODEX] - [Testing Expectations](#testing-expectations)
[CODEX] - [Additional References](#additional-references)
[CODEX] ## Application Entry & Boot Sequence
[CODEX] The application is bootstrapped in `src/index.tsx`:
[CODEX] 1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] 2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] 3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] ```tsx
[CODEX] const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] root.render(
[CODEX] <React.StrictMode>
[CODEX] <Setup />
[CODEX] </React.StrictMode>
[CODEX] );
[CODEX] ```
[CODEX] The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] ## Global Provider Stack
[CODEX] The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] | Provider | Location | Responsibility |
[CODEX] | --- | --- | --- |
[CODEX] | `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] | `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] | `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] | `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] | `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] | `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] | `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] | `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] | `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] ## Routing, Layout, and Navigation
[CODEX] All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] - The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] - Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] - `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] - Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] - Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] - Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] When introducing new routes:
[CODEX] 1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] 2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] 3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] ## Feature Module Responsibilities
[CODEX] The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] | Directory | Focus | Notable Contents |
[CODEX] | --- | --- | --- |
[CODEX] | `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] | `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] | `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] | `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] | `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] | `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] | `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] | `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] | `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] | `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] | `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] | `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] | `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] Shared infrastructure lives in supporting folders:
[CODEX] - `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] - `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] - `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] - `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] - `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] ## Shared Systems
[CODEX] ### GraphQL
[CODEX] - `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] - GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] - Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] - Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] ### Feature Flags
[CODEX] - LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] - Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] - Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] ### Authentication
[CODEX] - Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] - `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] - Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] ### Notifications & Portals
[CODEX] - Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] - Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] ## State Management Patterns
[CODEX] Most state lives in three layers, depending on scope:
[CODEX] 1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] 2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] 3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] Guidelines:
[CODEX] - Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] - Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] - Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] ## Styling, Theming, and Accessibility
[CODEX] - Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] - Design tokens and theme variables live in `src/styles`.
[CODEX] - Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] - The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] - When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] ## Build Pipeline & Tooling
[CODEX] - Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] - Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] - ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] - GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] - Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] ## Observability & Error Handling
[CODEX] - Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] - Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] - `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] - Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] ## Testing Expectations
[CODEX] - Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] - Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] - End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] - See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] ## Additional References
[CODEX] - [Project Documentation Index](./README.md)
[CODEX] - [GraphQL Integration](./graphql-integration.md)
[CODEX] - [State Management](./state-management.md)
[CODEX] - [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] - [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] - [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] apply_patch(auto_approved=true) exited 0 in 39ms:
[CODEX] Success. Updated the following files:
[CODEX] A docs/implementation-guide.md
[CODEX] file update:
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] file update:
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] thinking
[CODEX] **Outlining Playwright guide structure**
[CODEX] exec
[CODEX] bash -lc "sed -n '1,200p' playwright.config.ts" in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 41ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] import path from "node:path";
[CODEX] import {defineConfig, devices} from "@playwright/test";
[CODEX] import dotenv from "dotenv";
[CODEX] dotenv.config();
[CODEX] dotenv.config({path: path.resolve(__dirname, "./playwright", ".env")});
[CODEX] export default defineConfig({
[CODEX] reporter: [["html", {outputFolder: "test-results"}]],
[CODEX] testDir: "./playwright/tests",
[CODEX] workers: 1,
[CODEX] expect: {
[CODEX] timeout: 30000,
[CODEX] },
[CODEX] timeout: 30000,
[CODEX] use: {
[CODEX] browserName: "chromium",
[CODEX] file update:
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] thinking
[CODEX] **Documenting baseURL environment variable**
[CODEX] exec
[CODEX] bash -lc 'ls playwright/tests' in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 43ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] agents_builder.spec.ts
[CODEX] audience.spec.ts
[CODEX] auth.setup.ts
[CODEX] branding.spec.ts
[CODEX] campaign_answers.spec.ts
[CODEX] campaigns.spec.ts
[CODEX] chat.spec.ts
[CODEX] datasets.spec.ts
[CODEX] legal_pages.spec.ts
[CODEX] login_page.spec.ts
[CODEX] manage_labels.spec.ts
[CODEX] manage_users.spec.ts
[CODEX] navigation.spec.ts
[CODEX] password_reset.spec.ts
[CODEX] personal_profile.spec.ts
[CODEX] file update:
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] thinking
[CODEX] **Reviewing auth setup and documentation needs**
[CODEX] exec
[CODEX] bash -lc "sed -n '1,200p' playwright/tests/auth.setup.ts" in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 44ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] import {test as setup, expect} from "@playwright/test";
[CODEX] import {saveFirebaseAuthData} from "../helpers/authentication/save-firebase-auth-data";
[CODEX] const authFile = "playwright/.auth/user.json";
[CODEX] const loginUsername = process.env.LOGIN_USERNAME;
[CODEX] const loginPassword = process.env.LOGIN_PASSWORD;
[CODEX] if (!loginUsername || !loginPassword) {
[CODEX] throw new Error("LOGIN_USERNAME and LOGIN_PASSWORD environment variables must be set");
[CODEX] }
[CODEX] setup("authenticate", async ({page}) => {
[CODEX] await page.goto("/");
[CODEX] await expect(page.getByText("Unlock Vurvey AI!")).toBeVisible();
[CODEX] await expect(page.getByRole("button", {name: "Sign in with email"})).toBeVisible();
[CODEX] await page.getByRole("button", {name: "Sign in with email"}).click();
[CODEX] await page.getByPlaceholder("Email").fill(loginUsername);
[CODEX] await page.getByRole("button", {name: "Next"}).click();
[CODEX] file update:
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] thinking
[CODEX] **Examining authentication helper**
[CODEX] exec
[CODEX] bash -lc "sed -n '1,160p' playwright/helpers/authentication/save-firebase-auth-data.ts" in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 46ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] export async function saveFirebaseAuthData() {
[CODEX] return new Promise((resolve, reject) => {
[CODEX] const indexedDB = window.indexedDB;
[CODEX] const request = indexedDB.open("firebaseLocalStorageDb");
[CODEX] // eslint-disable-next-line @typescript-eslint/no-explicit-any
[CODEX] request.onsuccess = function (event: any) {
[CODEX] const db = event.target.result;
[CODEX] const transaction = db.transaction(["firebaseLocalStorage"], "readonly");
[CODEX] const objectStore = transaction.objectStore("firebaseLocalStorage");
[CODEX] const getAllKeysRequest = objectStore.getAllKeys();
[CODEX] const getAllValuesRequest = objectStore.getAll();
[CODEX] const data: Array<{key: string; value: unknown}> = [];
[CODEX] // eslint-disable-next-line @typescript-eslint/no-explicit-any
[CODEX] getAllKeysRequest.onsuccess = function (event: any) {
[CODEX] file update:
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] thinking
[CODEX] **Noting related authentication helper**
[CODEX] exec
[CODEX] bash -lc "sed -n '1,160p' playwright/helpers/authentication/restore-firebase-auth-data.ts" in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 46ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] export async function restoreFirebaseAuthData() {
[CODEX] return new Promise((resolve, reject) => {
[CODEX] const indexedDB = window.indexedDB;
[CODEX] const request = indexedDB.open("firebaseLocalStorageDb");
[CODEX] const dataFromLocalStorage = localStorage.getItem("playwright-auth-data");
[CODEX] if (!dataFromLocalStorage) {
[CODEX] throw new Error("No auth data found in localStorage - make sure auth.setup.ts was run");
[CODEX] }
[CODEX] const dataToInsert: Array<Record<string, object>> = JSON.parse(dataFromLocalStorage);
[CODEX] // eslint-disable-next-line @typescript-eslint/no-explicit-any
[CODEX] request.onsuccess = function (event: any) {
[CODEX] const db = event.target.result;
[CODEX] const transaction = db.transaction(["firebaseLocalStorage"], "readwrite");
[CODEX] file update:
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] thinking
[CODEX] **Preparing documentation updates**
[CODEX] file update
[CODEX] A /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6/docs/playwright-testing-guide.md
[CODEX] # Playwright Testing Guide
[CODEX] This guide explains how to configure, run, and extend the Playwright end-to-end test suite for Vurvey Web Manager.
[CODEX] - [Overview](#overview)
[CODEX] - [Directory Layout](#directory-layout)
[CODEX] - [Environment Setup](#environment-setup)
[CODEX] - [Running Tests](#running-tests)
[CODEX] - [Authentication Workflow](#authentication-workflow)
[CODEX] - [Writing & Organizing Tests](#writing--organizing-tests)
[CODEX] - [Debugging & Diagnostics](#debugging--diagnostics)
[CODEX] - [Continuous Integration](#continuous-integration)
[CODEX] - [Reference Material](#reference-material)
[CODEX] ## Overview
[CODEX] Playwright exercises the full React application in a Chromium browser using the configuration defined in `playwright.config.ts`. Tests rely on Firebase authentication, Apollo GraphQL, and feature flags, so a stable backend environment and test credentials are required.
[CODEX] Key characteristics:
[CODEX] - Tests live in `playwright/tests/*.spec.ts`.
[CODEX] - A dedicated `setup` project seeds authentication (`auth.setup.ts`) and persists storage state to `playwright/.auth/user.json`.
[CODEX] - Default executions run headless Chromium with `slowMo: 50` to reduce flakiness; override these options when debugging.
[CODEX] ## Directory Layout
[CODEX] ```
[CODEX] playwright/
[CODEX] â”œâ”€â”€ fixtures/                 # Test data assets (clips, csv, pdf, images)
[CODEX] â”œâ”€â”€ helpers/                  # Utility helpers (authentication, navigation)
[CODEX] â”œâ”€â”€ page-objects/             # Page object abstractions for complex flows
[CODEX] â”œâ”€â”€ tests/                    # Spec files + global setup (auth.setup.ts)
[CODEX] â”œâ”€â”€ env.d.ts                  # Type declarations for Playwright globals
[CODEX] â””â”€â”€ README.md                 # High-level summary (links back to this guide)
[CODEX] ```
[CODEX] Keep common logic in helpers or page objects instead of duplicating it inside specs. Fixtures should hold deterministic assets that can be reused across scenarios.
[CODEX] ## Environment Setup
[CODEX] 1. **Install dependencies**
[CODEX] ```bash
[CODEX] npm ci
[CODEX] npx playwright install
[CODEX] ```
[CODEX] 2. **Configure environment variables**
[CODEX] - Create `./playwright/.env` with the fields referenced in tests:
[CODEX] ```ini
[CODEX] URL=http://localhost:5050
[CODEX] LOGIN_USERNAME=tester@example.com
[CODEX] LOGIN_PASSWORD=super-secret
[CODEX] ```
[CODEX] - Variables defined in the repository root `.env` are also loaded. `URL` must match the origin where the web manager is running.
[CODEX] 3. **Launch the application backend**
[CODEX] - Ensure the Vurvey API and any dependent services are running; Playwright interacts with the live stack.
[CODEX] - Start the web manager locally with `npm start` or point `URL` at a staging environment.
[CODEX] 4. **Seed authentication state**
[CODEX] - The first test run invokes `auth.setup.ts`, which stores Firebase credentials in IndexedDB and writes a Playwright storage file (`playwright/.auth/user.json`).
[CODEX] - This file is reused by dependent projects so subsequent tests start in an authenticated session.
[CODEX] ## Running Tests
[CODEX] Common commands:
[CODEX] ```bash
[CODEX] # Run the full E2E suite
[CODEX] npx playwright test
[CODEX] # Run a specific spec
[CODEX] npx playwright test playwright/tests/navigation.spec.ts
[CODEX] # Filter by title
[CODEX] npx playwright test --grep "@smoke"
[CODEX] # Headed (visible) mode
[CODEX] npx playwright test --headed
[CODEX] # Debug mode with inspector
[CODEX] npx playwright test --debug
[CODEX] # Use the Playwright UI
[CODEX] npx playwright test --ui
[CODEX] ```
[CODEX] Project configuration (browser, base URL, reporters) lives in `playwright.config.ts`. Edit that file to add new projects (e.g., Firefox coverage) or alternative reporters.
[CODEX] ## Authentication Workflow
[CODEX] Authentication uses Firebase persistence inside IndexedDB:
[CODEX] 1. `auth.setup.ts` logs in through the UI using `LOGIN_USERNAME` and `LOGIN_PASSWORD`.
[CODEX] 2. The helper `saveFirebaseAuthData` captures Firebase data from IndexedDB and writes it to `localStorage`.
[CODEX] 3. The storage state is exported to `playwright/.auth/user.json`.
[CODEX] 4. Individual specs call `restoreFirebaseAuthData` via helper utilities before navigating, ensuring a valid session without re-running the login flow.
[CODEX] If you see `No auth data found in localStorage`, run the setup project again (`npx playwright test --project setup`). When credentials rotate, delete `playwright/.auth/user.json` and re-run the suite.
[CODEX] ## Writing & Organizing Tests
[CODEX] - **Use fixtures**: Import reusable flows (e.g., `authenticate`) from `playwright/helpers`. Define domain-specific fixtures when a scenario needs shared setup and teardown.
[CODEX] - **Prefer page objects**: Complex interactions such as the workflow builder or agent editor should be encapsulated in `playwright/page-objects` classes. Create methods that describe user intent (`workflowBuilder.publishFlow()`), not DOM mechanics.
[CODEX] - **Selectors**: Lean on accessible selectors (`getByRole`, `getByLabel`, `getByTestId`). Fall back to data attributes when elements lack semantic handles. Avoid brittle CSS selectors.
[CODEX] - **Organization**: Group related specs in `test.describe`. Tag critical smoke tests with `@smoke` for quick feedback loops.
[CODEX] - **Time-sensitive flows**: Use `await expect(...).toBeVisible({ timeout: 30_000 })` for network-heavy screens. The global `expect` timeout already defaults to 30 seconds; override locally when necessary.
[CODEX] - **Artifacts**: Use `test.info().attach` to capture domain-specific logs. Screenshots happen automatically on failure, but explicit captures help with mid-test diagnostics.
[CODEX] Example skeleton:
[CODEX] ```ts
[CODEX] import {test, expect} from "@playwright/test";
[CODEX] import {authenticate} from "../helpers/authentication";
[CODEX] import {DashboardPage} from "../page-objects/dashboard-page";
[CODEX] test.describe("Dashboard", () => {
[CODEX] test.beforeEach(async ({page}) => {
[CODEX] await authenticate(page);
[CODEX] });
[CODEX] test("shows the active workspace summary @smoke", async ({page}) => {
[CODEX] const dashboard = new DashboardPage(page);
[CODEX] await dashboard.goto();
[CODEX] await expect(dashboard.header).toContainText("Workspace Overview");
[CODEX] });
[CODEX] });
[CODEX] ```
[CODEX] ## Debugging & Diagnostics
[CODEX] - **Trace Viewer**: Re-run failing tests with `npx playwright test --trace on-first-retry` to collect DOM snapshots, network logs, and console output.
[CODEX] - **Video & screenshots**: Enable via `use: { video: "retain-on-failure", screenshot: "only-on-failure" }` either per test or globally in `playwright.config.ts`.
[CODEX] - **Console logging**: Place strategic `console.log` statements in specs or helpers when investigating flaky behavior. Remove them once resolved to keep logs clean.
[CODEX] - **Network mocking**: Stub GraphQL or REST endpoints with `page.route` for deterministic results when backend data is unavailable. Maintain mocks under `playwright/helpers/network`.
[CODEX] When a test flakes, capture the trace, verify selectors still match the rendered UI, and ensure required feature flags are enabled for the environment.
[CODEX] ## Continuous Integration
[CODEX] - CI pipelines call `npx playwright test` with the same configuration. Ensure new specs respect the single-worker execution configuration (`workers: 1`) unless you explicitly parallelize them.
[CODEX] - Store credentials (username, password, URL) in the CI secret store. The setup project fails fast if they are missing.
[CODEX] - Upload `test-results/` (HTML reporter output) as an artifact for post-run inspection.
[CODEX] Before merging, run the suite locally or in a dry-run environment to catch environment-specific regressions early.
[CODEX] ## Reference Material
[CODEX] - [Playwright Configuration](../playwright.config.ts)
[CODEX] - [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] - [Testing Guide (unit + integration)](./TEST-README.md)
[CODEX] - [Implementation Guide](./implementation-guide.md)
[CODEX] - [Official Playwright Docs](https://playwright.dev/docs/intro)
[CODEX] Keep this guide up to date whenever the test harness, authentication strategy, or project layout changes. New contributors should be able to set up Playwright using only this document.
[CODEX] apply_patch(auto_approved=true) exited 0 in 33ms:
[CODEX] Success. Updated the following files:
[CODEX] A docs/playwright-testing-guide.md
[CODEX] file update:
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] diff --git a/docs/playwright-testing-guide.md b/docs/playwright-testing-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..acbab280a49d446cc89ce7ea1e6de422380736ca
[CODEX] --- /dev/null
[CODEX] +++ b/docs/playwright-testing-guide.md
[CODEX] @@ -0,0 +1,161 @@
[CODEX] +# Playwright Testing Guide
[CODEX] +
[CODEX] +This guide explains how to configure, run, and extend the Playwright end-to-end test suite for Vurvey Web Manager.
[CODEX] +
[CODEX] +- [Overview](#overview)
[CODEX] +- [Directory Layout](#directory-layout)
[CODEX] +- [Environment Setup](#environment-setup)
[CODEX] +- [Running Tests](#running-tests)
[CODEX] +- [Authentication Workflow](#authentication-workflow)
[CODEX] +- [Writing & Organizing Tests](#writing--organizing-tests)
[CODEX] +- [Debugging & Diagnostics](#debugging--diagnostics)
[CODEX] +- [Continuous Integration](#continuous-integration)
[CODEX] +- [Reference Material](#reference-material)
[CODEX] +
[CODEX] +## Overview
[CODEX] +
[CODEX] +Playwright exercises the full React application in a Chromium browser using the configuration defined in `playwright.config.ts`. Tests rely on Firebase authentication, Apollo GraphQL, and feature flags, so a stable backend environment and test credentials are required.
[CODEX] +
[CODEX] +Key characteristics:
[CODEX] +
[CODEX] +- Tests live in `playwright/tests/*.spec.ts`.
[CODEX] +- A dedicated `setup` project seeds authentication (`auth.setup.ts`) and persists storage state to `playwright/.auth/user.json`.
[CODEX] +- Default executions run headless Chromium with `slowMo: 50` to reduce flakiness; override these options when debugging.
[CODEX] +
[CODEX] +## Directory Layout
[CODEX] +
[CODEX] +```
[CODEX] +playwright/
[CODEX] +â”œâ”€â”€ fixtures/                 # Test data assets (clips, csv, pdf, images)
[CODEX] +â”œâ”€â”€ helpers/                  # Utility helpers (authentication, navigation)
[CODEX] +â”œâ”€â”€ page-objects/             # Page object abstractions for complex flows
[CODEX] +â”œâ”€â”€ tests/                    # Spec files + global setup (auth.setup.ts)
[CODEX] +â”œâ”€â”€ env.d.ts                  # Type declarations for Playwright globals
[CODEX] +â””â”€â”€ README.md                 # High-level summary (links back to this guide)
[CODEX] +```
[CODEX] +
[CODEX] +Keep common logic in helpers or page objects instead of duplicating it inside specs. Fixtures should hold deterministic assets that can be reused across scenarios.
[CODEX] +
[CODEX] +## Environment Setup
[CODEX] +
[CODEX] +1. **Install dependencies**
[CODEX] +
[CODEX] +   ```bash
[CODEX] +   npm ci
[CODEX] +   npx playwright install
[CODEX] +   ```
[CODEX] +
[CODEX] +2. **Configure environment variables**
[CODEX] +
[CODEX] +   - Create `./playwright/.env` with the fields referenced in tests:
[CODEX] +
[CODEX] +     ```ini
[CODEX] +     URL=http://localhost:5050
[CODEX] +     LOGIN_USERNAME=tester@example.com
[CODEX] +     LOGIN_PASSWORD=super-secret
[CODEX] +     ```
[CODEX] +
[CODEX] +   - Variables defined in the repository root `.env` are also loaded. `URL` must match the origin where the web manager is running.
[CODEX] +
[CODEX] +3. **Launch the application backend**
[CODEX] +
[CODEX] +   - Ensure the Vurvey API and any dependent services are running; Playwright interacts with the live stack.
[CODEX] +   - Start the web manager locally with `npm start` or point `URL` at a staging environment.
[CODEX] +
[CODEX] +4. **Seed authentication state**
[CODEX] +
[CODEX] +   - The first test run invokes `auth.setup.ts`, which stores Firebase credentials in IndexedDB and writes a Playwright storage file (`playwright/.auth/user.json`).
[CODEX] +   - This file is reused by dependent projects so subsequent tests start in an authenticated session.
[CODEX] +
[CODEX] +## Running Tests
[CODEX] +
[CODEX] +Common commands:
[CODEX] +
[CODEX] +```bash
[CODEX] +# Run the full E2E suite
[CODEX] +npx playwright test
[CODEX] +
[CODEX] +# Run a specific spec
[CODEX] +npx playwright test playwright/tests/navigation.spec.ts
[CODEX] +
[CODEX] +# Filter by title
[CODEX] +npx playwright test --grep "@smoke"
[CODEX] +
[CODEX] +# Headed (visible) mode
[CODEX] +npx playwright test --headed
[CODEX] +
[CODEX] +# Debug mode with inspector
[CODEX] +npx playwright test --debug
[CODEX] +
[CODEX] +# Use the Playwright UI
[CODEX] +npx playwright test --ui
[CODEX] +```
[CODEX] +
[CODEX] +Project configuration (browser, base URL, reporters) lives in `playwright.config.ts`. Edit that file to add new projects (e.g., Firefox coverage) or alternative reporters.
[CODEX] +
[CODEX] +## Authentication Workflow
[CODEX] +
[CODEX] +Authentication uses Firebase persistence inside IndexedDB:
[CODEX] +
[CODEX] +1. `auth.setup.ts` logs in through the UI using `LOGIN_USERNAME` and `LOGIN_PASSWORD`.
[CODEX] +2. The helper `saveFirebaseAuthData` captures Firebase data from IndexedDB and writes it to `localStorage`.
[CODEX] +3. The storage state is exported to `playwright/.auth/user.json`.
[CODEX] +4. Individual specs call `restoreFirebaseAuthData` via helper utilities before navigating, ensuring a valid session without re-running the login flow.
[CODEX] +
[CODEX] +If you see `No auth data found in localStorage`, run the setup project again (`npx playwright test --project setup`). When credentials rotate, delete `playwright/.auth/user.json` and re-run the suite.
[CODEX] +
[CODEX] +## Writing & Organizing Tests
[CODEX] +
[CODEX] +- **Use fixtures**: Import reusable flows (e.g., `authenticate`) from `playwright/helpers`. Define domain-specific fixtures when a scenario needs shared setup and teardown.
[CODEX] +- **Prefer page objects**: Complex interactions such as the workflow builder or agent editor should be encapsulated in `playwright/page-objects` classes. Create methods that describe user intent (`workflowBuilder.publishFlow()`), not DOM mechanics.
[CODEX] +- **Selectors**: Lean on accessible selectors (`getByRole`, `getByLabel`, `getByTestId`). Fall back to data attributes when elements lack semantic handles. Avoid brittle CSS selectors.
[CODEX] +- **Organization**: Group related specs in `test.describe`. Tag critical smoke tests with `@smoke` for quick feedback loops.
[CODEX] +- **Time-sensitive flows**: Use `await expect(...).toBeVisible({ timeout: 30_000 })` for network-heavy screens. The global `expect` timeout already defaults to 30 seconds; override locally when necessary.
[CODEX] +- **Artifacts**: Use `test.info().attach` to capture domain-specific logs. Screenshots happen automatically on failure, but explicit captures help with mid-test diagnostics.
[CODEX] +
[CODEX] +Example skeleton:
[CODEX] +
[CODEX] +```ts
[CODEX] +import {test, expect} from "@playwright/test";
[CODEX] +import {authenticate} from "../helpers/authentication";
[CODEX] +import {DashboardPage} from "../page-objects/dashboard-page";
[CODEX] +
[CODEX] +test.describe("Dashboard", () => {
[CODEX] +  test.beforeEach(async ({page}) => {
[CODEX] +    await authenticate(page);
[CODEX] +  });
[CODEX] +
[CODEX] +  test("shows the active workspace summary @smoke", async ({page}) => {
[CODEX] +    const dashboard = new DashboardPage(page);
[CODEX] +    await dashboard.goto();
[CODEX] +    await expect(dashboard.header).toContainText("Workspace Overview");
[CODEX] +  });
[CODEX] +});
[CODEX] +```
[CODEX] +
[CODEX] +## Debugging & Diagnostics
[CODEX] +
[CODEX] +- **Trace Viewer**: Re-run failing tests with `npx playwright test --trace on-first-retry` to collect DOM snapshots, network logs, and console output.
[CODEX] +- **Video & screenshots**: Enable via `use: { video: "retain-on-failure", screenshot: "only-on-failure" }` either per test or globally in `playwright.config.ts`.
[CODEX] +- **Console logging**: Place strategic `console.log` statements in specs or helpers when investigating flaky behavior. Remove them once resolved to keep logs clean.
[CODEX] +- **Network mocking**: Stub GraphQL or REST endpoints with `page.route` for deterministic results when backend data is unavailable. Maintain mocks under `playwright/helpers/network`.
[CODEX] +
[CODEX] +When a test flakes, capture the trace, verify selectors still match the rendered UI, and ensure required feature flags are enabled for the environment.
[CODEX] +
[CODEX] +## Continuous Integration
[CODEX] +
[CODEX] +- CI pipelines call `npx playwright test` with the same configuration. Ensure new specs respect the single-worker execution configuration (`workers: 1`) unless you explicitly parallelize them.
[CODEX] +- Store credentials (username, password, URL) in the CI secret store. The setup project fails fast if they are missing.
[CODEX] +- Upload `test-results/` (HTML reporter output) as an artifact for post-run inspection.
[CODEX] +
[CODEX] +Before merging, run the suite locally or in a dry-run environment to catch environment-specific regressions early.
[CODEX] +
[CODEX] +## Reference Material
[CODEX] +
[CODEX] +- [Playwright Configuration](../playwright.config.ts)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +- [Testing Guide (unit + integration)](./TEST-README.md)
[CODEX] +- [Implementation Guide](./implementation-guide.md)
[CODEX] +- [Official Playwright Docs](https://playwright.dev/docs/intro)
[CODEX] +
[CODEX] +Keep this guide up to date whenever the test harness, authentication strategy, or project layout changes. New contributors should be able to set up Playwright using only this document.
[CODEX] file update:
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] diff --git a/docs/playwright-testing-guide.md b/docs/playwright-testing-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..acbab280a49d446cc89ce7ea1e6de422380736ca
[CODEX] --- /dev/null
[CODEX] +++ b/docs/playwright-testing-guide.md
[CODEX] @@ -0,0 +1,161 @@
[CODEX] +# Playwright Testing Guide
[CODEX] +
[CODEX] +This guide explains how to configure, run, and extend the Playwright end-to-end test suite for Vurvey Web Manager.
[CODEX] +
[CODEX] +- [Overview](#overview)
[CODEX] +- [Directory Layout](#directory-layout)
[CODEX] +- [Environment Setup](#environment-setup)
[CODEX] +- [Running Tests](#running-tests)
[CODEX] +- [Authentication Workflow](#authentication-workflow)
[CODEX] +- [Writing & Organizing Tests](#writing--organizing-tests)
[CODEX] +- [Debugging & Diagnostics](#debugging--diagnostics)
[CODEX] +- [Continuous Integration](#continuous-integration)
[CODEX] +- [Reference Material](#reference-material)
[CODEX] +
[CODEX] +## Overview
[CODEX] +
[CODEX] +Playwright exercises the full React application in a Chromium browser using the configuration defined in `playwright.config.ts`. Tests rely on Firebase authentication, Apollo GraphQL, and feature flags, so a stable backend environment and test credentials are required.
[CODEX] +
[CODEX] +Key characteristics:
[CODEX] +
[CODEX] +- Tests live in `playwright/tests/*.spec.ts`.
[CODEX] +- A dedicated `setup` project seeds authentication (`auth.setup.ts`) and persists storage state to `playwright/.auth/user.json`.
[CODEX] +- Default executions run headless Chromium with `slowMo: 50` to reduce flakiness; override these options when debugging.
[CODEX] +
[CODEX] +## Directory Layout
[CODEX] +
[CODEX] +```
[CODEX] +playwright/
[CODEX] +â”œâ”€â”€ fixtures/                 # Test data assets (clips, csv, pdf, images)
[CODEX] +â”œâ”€â”€ helpers/                  # Utility helpers (authentication, navigation)
[CODEX] +â”œâ”€â”€ page-objects/             # Page object abstractions for complex flows
[CODEX] +â”œâ”€â”€ tests/                    # Spec files + global setup (auth.setup.ts)
[CODEX] +â”œâ”€â”€ env.d.ts                  # Type declarations for Playwright globals
[CODEX] +â””â”€â”€ README.md                 # High-level summary (links back to this guide)
[CODEX] +```
[CODEX] +
[CODEX] +Keep common logic in helpers or page objects instead of duplicating it inside specs. Fixtures should hold deterministic assets that can be reused across scenarios.
[CODEX] +
[CODEX] +## Environment Setup
[CODEX] +
[CODEX] +1. **Install dependencies**
[CODEX] +
[CODEX] +   ```bash
[CODEX] +   npm ci
[CODEX] +   npx playwright install
[CODEX] +   ```
[CODEX] +
[CODEX] +2. **Configure environment variables**
[CODEX] +
[CODEX] +   - Create `./playwright/.env` with the fields referenced in tests:
[CODEX] +
[CODEX] +     ```ini
[CODEX] +     URL=http://localhost:5050
[CODEX] +     LOGIN_USERNAME=tester@example.com
[CODEX] +     LOGIN_PASSWORD=super-secret
[CODEX] +     ```
[CODEX] +
[CODEX] +   - Variables defined in the repository root `.env` are also loaded. `URL` must match the origin where the web manager is running.
[CODEX] +
[CODEX] +3. **Launch the application backend**
[CODEX] +
[CODEX] +   - Ensure the Vurvey API and any dependent services are running; Playwright interacts with the live stack.
[CODEX] +   - Start the web manager locally with `npm start` or point `URL` at a staging environment.
[CODEX] +
[CODEX] +4. **Seed authentication state**
[CODEX] +
[CODEX] +   - The first test run invokes `auth.setup.ts`, which stores Firebase credentials in IndexedDB and writes a Playwright storage file (`playwright/.auth/user.json`).
[CODEX] +   - This file is reused by dependent projects so subsequent tests start in an authenticated session.
[CODEX] +
[CODEX] +## Running Tests
[CODEX] +
[CODEX] +Common commands:
[CODEX] +
[CODEX] +```bash
[CODEX] +# Run the full E2E suite
[CODEX] +npx playwright test
[CODEX] +
[CODEX] +# Run a specific spec
[CODEX] +npx playwright test playwright/tests/navigation.spec.ts
[CODEX] +
[CODEX] +# Filter by title
[CODEX] +npx playwright test --grep "@smoke"
[CODEX] +
[CODEX] +# Headed (visible) mode
[CODEX] +npx playwright test --headed
[CODEX] +
[CODEX] +# Debug mode with inspector
[CODEX] +npx playwright test --debug
[CODEX] +
[CODEX] +# Use the Playwright UI
[CODEX] +npx playwright test --ui
[CODEX] +```
[CODEX] +
[CODEX] +Project configuration (browser, base URL, reporters) lives in `playwright.config.ts`. Edit that file to add new projects (e.g., Firefox coverage) or alternative reporters.
[CODEX] +
[CODEX] +## Authentication Workflow
[CODEX] +
[CODEX] +Authentication uses Firebase persistence inside IndexedDB:
[CODEX] +
[CODEX] +1. `auth.setup.ts` logs in through the UI using `LOGIN_USERNAME` and `LOGIN_PASSWORD`.
[CODEX] +2. The helper `saveFirebaseAuthData` captures Firebase data from IndexedDB and writes it to `localStorage`.
[CODEX] +3. The storage state is exported to `playwright/.auth/user.json`.
[CODEX] +4. Individual specs call `restoreFirebaseAuthData` via helper utilities before navigating, ensuring a valid session without re-running the login flow.
[CODEX] +
[CODEX] +If you see `No auth data found in localStorage`, run the setup project again (`npx playwright test --project setup`). When credentials rotate, delete `playwright/.auth/user.json` and re-run the suite.
[CODEX] +
[CODEX] +## Writing & Organizing Tests
[CODEX] +
[CODEX] +- **Use fixtures**: Import reusable flows (e.g., `authenticate`) from `playwright/helpers`. Define domain-specific fixtures when a scenario needs shared setup and teardown.
[CODEX] +- **Prefer page objects**: Complex interactions such as the workflow builder or agent editor should be encapsulated in `playwright/page-objects` classes. Create methods that describe user intent (`workflowBuilder.publishFlow()`), not DOM mechanics.
[CODEX] +- **Selectors**: Lean on accessible selectors (`getByRole`, `getByLabel`, `getByTestId`). Fall back to data attributes when elements lack semantic handles. Avoid brittle CSS selectors.
[CODEX] +- **Organization**: Group related specs in `test.describe`. Tag critical smoke tests with `@smoke` for quick feedback loops.
[CODEX] +- **Time-sensitive flows**: Use `await expect(...).toBeVisible({ timeout: 30_000 })` for network-heavy screens. The global `expect` timeout already defaults to 30 seconds; override locally when necessary.
[CODEX] +- **Artifacts**: Use `test.info().attach` to capture domain-specific logs. Screenshots happen automatically on failure, but explicit captures help with mid-test diagnostics.
[CODEX] +
[CODEX] +Example skeleton:
[CODEX] +
[CODEX] +```ts
[CODEX] +import {test, expect} from "@playwright/test";
[CODEX] +import {authenticate} from "../helpers/authentication";
[CODEX] +import {DashboardPage} from "../page-objects/dashboard-page";
[CODEX] +
[CODEX] +test.describe("Dashboard", () => {
[CODEX] +  test.beforeEach(async ({page}) => {
[CODEX] +    await authenticate(page);
[CODEX] +  });
[CODEX] +
[CODEX] +  test("shows the active workspace summary @smoke", async ({page}) => {
[CODEX] +    const dashboard = new DashboardPage(page);
[CODEX] +    await dashboard.goto();
[CODEX] +    await expect(dashboard.header).toContainText("Workspace Overview");
[CODEX] +  });
[CODEX] +});
[CODEX] +```
[CODEX] +
[CODEX] +## Debugging & Diagnostics
[CODEX] +
[CODEX] +- **Trace Viewer**: Re-run failing tests with `npx playwright test --trace on-first-retry` to collect DOM snapshots, network logs, and console output.
[CODEX] +- **Video & screenshots**: Enable via `use: { video: "retain-on-failure", screenshot: "only-on-failure" }` either per test or globally in `playwright.config.ts`.
[CODEX] +- **Console logging**: Place strategic `console.log` statements in specs or helpers when investigating flaky behavior. Remove them once resolved to keep logs clean.
[CODEX] +- **Network mocking**: Stub GraphQL or REST endpoints with `page.route` for deterministic results when backend data is unavailable. Maintain mocks under `playwright/helpers/network`.
[CODEX] +
[CODEX] +When a test flakes, capture the trace, verify selectors still match the rendered UI, and ensure required feature flags are enabled for the environment.
[CODEX] +
[CODEX] +## Continuous Integration
[CODEX] +
[CODEX] +- CI pipelines call `npx playwright test` with the same configuration. Ensure new specs respect the single-worker execution configuration (`workers: 1`) unless you explicitly parallelize them.
[CODEX] +- Store credentials (username, password, URL) in the CI secret store. The setup project fails fast if they are missing.
[CODEX] +- Upload `test-results/` (HTML reporter output) as an artifact for post-run inspection.
[CODEX] +
[CODEX] +Before merging, run the suite locally or in a dry-run environment to catch environment-specific regressions early.
[CODEX] +
[CODEX] +## Reference Material
[CODEX] +
[CODEX] +- [Playwright Configuration](../playwright.config.ts)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +- [Testing Guide (unit + integration)](./TEST-README.md)
[CODEX] +- [Implementation Guide](./implementation-guide.md)
[CODEX] +- [Official Playwright Docs](https://playwright.dev/docs/intro)
[CODEX] +
[CODEX] +Keep this guide up to date whenever the test harness, authentication strategy, or project layout changes. New contributors should be able to set up Playwright using only this document.
[CLAUDE]   ğŸ”§ Write
[CODEX] thinking
[CODEX] **Creating root documentation file**
[CLAUDE]   ğŸ”§ TodoWrite
[CLAUDE]   Now let me create comprehensive component documentation:
[CODEX] file update
[CODEX] A /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6/DOCUMENTATION.md
[CODEX] # Vurvey Web Manager Documentation Hub
[CODEX] This hub ties together the architecture, development workflows, and testing resources for the Vurvey Web Manager. Start here for a narrated overview, then dive into the linked guides for deeper detail.
[CODEX] - [Quick Start](#quick-start)
[CODEX] - [Architecture at a Glance](#architecture-at-a-glance)
[CODEX] - [Implementation Deep Dive](#implementation-deep-dive)
[CODEX] - [Testing & Quality Assurance](#testing--quality-assurance)
[CODEX] - [Operational Playbooks](#operational-playbooks)
[CODEX] - [Documentation Index](#documentation-index)
[CODEX] ## Quick Start
[CODEX] | Task | Command / Resource |
[CODEX] | --- | --- |
[CODEX] | Install dependencies | `npm ci` |
[CODEX] | Run the dev server | `npm start` (defaults to `http://localhost:5050`) |
[CODEX] | Type-check | `npm run type-check` |
[CODEX] | Validate GraphQL documents | `npm run validate:graphql` |
[CODEX] | Run unit/integration tests | `npm run test:unit` |
[CODEX] | Run Playwright E2E tests | `npm run test:e2e` |
[CODEX] | Lint source + tests | `npm run lint` |
[CODEX] Environment variables (Firebase, GraphQL endpoint, feature flags) are defined in `.env`. See `docs/README.md#environment-variables` for the full list.
[CODEX] ## Architecture at a Glance
[CODEX] - React 18 + TypeScript rendered through Vite.
[CODEX] - Routing handled via `react-router-dom` with workspace-aware helpers.
[CODEX] - GraphQL powered by Apollo Client (HTTP + WebSocket links) and LaunchDarkly/OpenFeature feature flag providers.
[CODEX] - State spans React Contexts, Apollo cache, and reducer-driven component state.
[CODEX] - Styling leverages SCSS modules and a shared component library under `src/shared`.
[CODEX] Review the [Implementation Guide](docs/implementation-guide.md) for a walkthrough of providers, feature modules, and architectural conventions.
[CODEX] ## Implementation Deep Dive
[CODEX] | Topic | Summary |
[CODEX] | --- | --- |
[CODEX] | [Implementation Guide](docs/implementation-guide.md) | Entry points, provider stack, routing, feature ownership, build tooling. |
[CODEX] | [Project Structure](docs/project-structure.md) | Directory breakdown and best practices for adding new files. |
[CODEX] | [State Management](docs/state-management.md) | Contexts, reducers, and caching strategies. |
[CODEX] | [GraphQL Integration](docs/graphql-integration.md) | Query organization, code generation, and cache policies. |
[CODEX] | [Custom Hooks](docs/custom-hooks.md) | Reusable hooks available across features. |
[CODEX] | [Workflow Builder Guide](docs/workflow-builder-guide.md) | Deep dive into the workflow module architecture. |
[CODEX] When implementing new features, align with the patterns documented in these guides and update them if responsibilities shift.
[CODEX] ## Testing & Quality Assurance
[CODEX] - [Playwright Testing Guide](docs/playwright-testing-guide.md) â€“ Environment setup, authentication strategy, authoring conventions, and debugging tips.
[CODEX] - [E2E Testing Patterns](docs/e2e-testing-patterns.md) â€“ Hard-won lessons for resilient selectors and flows.
[CODEX] - [Testing Guide](docs/TEST-README.md) â€“ Vitest commands, coverage expectations, and mocking strategies.
[CODEX] - Unit tests live beside implementation files. E2E specs live under `playwright/tests/`. Follow the documented fixtures/page-object approach for consistency.
[CODEX] ## Operational Playbooks
[CODEX] - [Authentication](docs/authentication.md) â€“ Firebase sign-in flows and session persistence.
[CODEX] - [Core Features](docs/core-features.md) â€“ Feature overviews for stakeholders and QA.
[CODEX] - [Routes](docs/routes.md) â€“ Navigation map with workspace/context rules.
[CODEX] - [Smooth Streaming](docs/smooth-streaming.md) & [Chat Streaming](docs/chat-streaming.md) â€“ Real-time infrastructure details.
[CODEX] - [Test Resilience Strategy](docs/test-resilience-strategy.md) â€“ Stabilization techniques for automated suites.
[CODEX] These playbooks help new engineers and QA members ramp up quickly on specific domains.
[CODEX] ## Documentation Index
[CODEX] All documentation lives under the `docs/` directory:
[CODEX] - [docs/README.md](docs/README.md) â€“ Entry point with setup instructions.
[CODEX] - [docs/components.md](docs/components.md) â€“ Shared component catalogue.
[CODEX] - [docs/routes.md](docs/routes.md) â€“ Application routing map.
[CODEX] - [docs/core-features.md](docs/core-features.md) â€“ High-level feature descriptions.
[CODEX] - [docs/workflow-builder-guide.md](docs/workflow-builder-guide.md) â€“ Workflow builder architecture.
[CODEX] - [docs/playwright-testing-guide.md](docs/playwright-testing-guide.md) â€“ Comprehensive Playwright usage.
[CODEX] - [docs/implementation-guide.md](docs/implementation-guide.md) â€“ Frontend implementation detail.
[CODEX] - [docs/authentication.md](docs/authentication.md) â€“ Auth flows and state storage.
[CODEX] - [docs/e2e-testing-patterns.md](docs/e2e-testing-patterns.md) â€“ Resilient test strategies.
[CODEX] - [docs/TEST-README.md](docs/TEST-README.md) â€“ Unit and integration testing commands.
[CODEX] Keep this hub updated as we introduce new docs or migrate content. If a guide becomes outdated, link directly to its successor or fold it into a more relevant document.
[CODEX] apply_patch(auto_approved=true) exited 0 in 49ms:
[CODEX] Success. Updated the following files:
[CODEX] A DOCUMENTATION.md
[CODEX] file update:
[CODEX] diff --git a/DOCUMENTATION.md b/DOCUMENTATION.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e08ed0b3ff8c2fbb63dc3ee675405d59841b6a10
[CODEX] --- /dev/null
[CODEX] +++ b/DOCUMENTATION.md
[CODEX] @@ -0,0 +1,81 @@
[CODEX] +# Vurvey Web Manager Documentation Hub
[CODEX] +
[CODEX] +This hub ties together the architecture, development workflows, and testing resources for the Vurvey Web Manager. Start here for a narrated overview, then dive into the linked guides for deeper detail.
[CODEX] +
[CODEX] +- [Quick Start](#quick-start)
[CODEX] +- [Architecture at a Glance](#architecture-at-a-glance)
[CODEX] +- [Implementation Deep Dive](#implementation-deep-dive)
[CODEX] +- [Testing & Quality Assurance](#testing--quality-assurance)
[CODEX] +- [Operational Playbooks](#operational-playbooks)
[CODEX] +- [Documentation Index](#documentation-index)
[CODEX] +
[CODEX] +## Quick Start
[CODEX] +
[CODEX] +| Task | Command / Resource |
[CODEX] +| --- | --- |
[CODEX] +| Install dependencies | `npm ci` |
[CODEX] +| Run the dev server | `npm start` (defaults to `http://localhost:5050`) |
[CODEX] +| Type-check | `npm run type-check` |
[CODEX] +| Validate GraphQL documents | `npm run validate:graphql` |
[CODEX] +| Run unit/integration tests | `npm run test:unit` |
[CODEX] +| Run Playwright E2E tests | `npm run test:e2e` |
[CODEX] +| Lint source + tests | `npm run lint` |
[CODEX] +
[CODEX] +Environment variables (Firebase, GraphQL endpoint, feature flags) are defined in `.env`. See `docs/README.md#environment-variables` for the full list.
[CODEX] +
[CODEX] +## Architecture at a Glance
[CODEX] +
[CODEX] +- React 18 + TypeScript rendered through Vite.
[CODEX] +- Routing handled via `react-router-dom` with workspace-aware helpers.
[CODEX] +- GraphQL powered by Apollo Client (HTTP + WebSocket links) and LaunchDarkly/OpenFeature feature flag providers.
[CODEX] +- State spans React Contexts, Apollo cache, and reducer-driven component state.
[CODEX] +- Styling leverages SCSS modules and a shared component library under `src/shared`.
[CODEX] +
[CODEX] +Review the [Implementation Guide](docs/implementation-guide.md) for a walkthrough of providers, feature modules, and architectural conventions.
[CODEX] +
[CODEX] +## Implementation Deep Dive
[CODEX] +
[CODEX] +| Topic | Summary |
[CODEX] +| --- | --- |
[CODEX] +| [Implementation Guide](docs/implementation-guide.md) | Entry points, provider stack, routing, feature ownership, build tooling. |
[CODEX] +| [Project Structure](docs/project-structure.md) | Directory breakdown and best practices for adding new files. |
[CODEX] +| [State Management](docs/state-management.md) | Contexts, reducers, and caching strategies. |
[CODEX] +| [GraphQL Integration](docs/graphql-integration.md) | Query organization, code generation, and cache policies. |
[CODEX] +| [Custom Hooks](docs/custom-hooks.md) | Reusable hooks available across features. |
[CODEX] +| [Workflow Builder Guide](docs/workflow-builder-guide.md) | Deep dive into the workflow module architecture. |
[CODEX] +
[CODEX] +When implementing new features, align with the patterns documented in these guides and update them if responsibilities shift.
[CODEX] +
[CODEX] +## Testing & Quality Assurance
[CODEX] +
[CODEX] +- [Playwright Testing Guide](docs/playwright-testing-guide.md) â€“ Environment setup, authentication strategy, authoring conventions, and debugging tips.
[CODEX] +- [E2E Testing Patterns](docs/e2e-testing-patterns.md) â€“ Hard-won lessons for resilient selectors and flows.
[CODEX] +- [Testing Guide](docs/TEST-README.md) â€“ Vitest commands, coverage expectations, and mocking strategies.
[CODEX] +- Unit tests live beside implementation files. E2E specs live under `playwright/tests/`. Follow the documented fixtures/page-object approach for consistency.
[CODEX] +
[CODEX] +## Operational Playbooks
[CODEX] +
[CODEX] +- [Authentication](docs/authentication.md) â€“ Firebase sign-in flows and session persistence.
[CODEX] +- [Core Features](docs/core-features.md) â€“ Feature overviews for stakeholders and QA.
[CODEX] +- [Routes](docs/routes.md) â€“ Navigation map with workspace/context rules.
[CODEX] +- [Smooth Streaming](docs/smooth-streaming.md) & [Chat Streaming](docs/chat-streaming.md) â€“ Real-time infrastructure details.
[CODEX] +- [Test Resilience Strategy](docs/test-resilience-strategy.md) â€“ Stabilization techniques for automated suites.
[CODEX] +
[CODEX] +These playbooks help new engineers and QA members ramp up quickly on specific domains.
[CODEX] +
[CODEX] +## Documentation Index
[CODEX] +
[CODEX] +All documentation lives under the `docs/` directory:
[CODEX] +
[CODEX] +- [docs/README.md](docs/README.md) â€“ Entry point with setup instructions.
[CODEX] +- [docs/components.md](docs/components.md) â€“ Shared component catalogue.
[CODEX] +- [docs/routes.md](docs/routes.md) â€“ Application routing map.
[CODEX] +- [docs/core-features.md](docs/core-features.md) â€“ High-level feature descriptions.
[CODEX] +- [docs/workflow-builder-guide.md](docs/workflow-builder-guide.md) â€“ Workflow builder architecture.
[CODEX] +- [docs/playwright-testing-guide.md](docs/playwright-testing-guide.md) â€“ Comprehensive Playwright usage.
[CODEX] +- [docs/implementation-guide.md](docs/implementation-guide.md) â€“ Frontend implementation detail.
[CODEX] +- [docs/authentication.md](docs/authentication.md) â€“ Auth flows and state storage.
[CODEX] +- [docs/e2e-testing-patterns.md](docs/e2e-testing-patterns.md) â€“ Resilient test strategies.
[CODEX] +- [docs/TEST-README.md](docs/TEST-README.md) â€“ Unit and integration testing commands.
[CODEX] +
[CODEX] +Keep this hub updated as we introduce new docs or migrate content. If a guide becomes outdated, link directly to its successor or fold it into a more relevant document.
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] diff --git a/docs/playwright-testing-guide.md b/docs/playwright-testing-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..acbab280a49d446cc89ce7ea1e6de422380736ca
[CODEX] --- /dev/null
[CODEX] +++ b/docs/playwright-testing-guide.md
[CODEX] @@ -0,0 +1,161 @@
[CODEX] +# Playwright Testing Guide
[CODEX] +
[CODEX] +This guide explains how to configure, run, and extend the Playwright end-to-end test suite for Vurvey Web Manager.
[CODEX] +
[CODEX] +- [Overview](#overview)
[CODEX] +- [Directory Layout](#directory-layout)
[CODEX] +- [Environment Setup](#environment-setup)
[CODEX] +- [Running Tests](#running-tests)
[CODEX] +- [Authentication Workflow](#authentication-workflow)
[CODEX] +- [Writing & Organizing Tests](#writing--organizing-tests)
[CODEX] +- [Debugging & Diagnostics](#debugging--diagnostics)
[CODEX] +- [Continuous Integration](#continuous-integration)
[CODEX] +- [Reference Material](#reference-material)
[CODEX] +
[CODEX] +## Overview
[CODEX] +
[CODEX] +Playwright exercises the full React application in a Chromium browser using the configuration defined in `playwright.config.ts`. Tests rely on Firebase authentication, Apollo GraphQL, and feature flags, so a stable backend environment and test credentials are required.
[CODEX] +
[CODEX] +Key characteristics:
[CODEX] +
[CODEX] +- Tests live in `playwright/tests/*.spec.ts`.
[CODEX] +- A dedicated `setup` project seeds authentication (`auth.setup.ts`) and persists storage state to `playwright/.auth/user.json`.
[CODEX] +- Default executions run headless Chromium with `slowMo: 50` to reduce flakiness; override these options when debugging.
[CODEX] +
[CODEX] +## Directory Layout
[CODEX] +
[CODEX] +```
[CODEX] +playwright/
[CODEX] +â”œâ”€â”€ fixtures/                 # Test data assets (clips, csv, pdf, images)
[CODEX] +â”œâ”€â”€ helpers/                  # Utility helpers (authentication, navigation)
[CODEX] +â”œâ”€â”€ page-objects/             # Page object abstractions for complex flows
[CODEX] +â”œâ”€â”€ tests/                    # Spec files + global setup (auth.setup.ts)
[CODEX] +â”œâ”€â”€ env.d.ts                  # Type declarations for Playwright globals
[CODEX] +â””â”€â”€ README.md                 # High-level summary (links back to this guide)
[CODEX] +```
[CODEX] +
[CODEX] +Keep common logic in helpers or page objects instead of duplicating it inside specs. Fixtures should hold deterministic assets that can be reused across scenarios.
[CODEX] +
[CODEX] +## Environment Setup
[CODEX] +
[CODEX] +1. **Install dependencies**
[CODEX] +
[CODEX] +   ```bash
[CODEX] +   npm ci
[CODEX] +   npx playwright install
[CODEX] +   ```
[CODEX] +
[CODEX] +2. **Configure environment variables**
[CODEX] +
[CODEX] +   - Create `./playwright/.env` with the fields referenced in tests:
[CODEX] +
[CODEX] +     ```ini
[CODEX] +     URL=http://localhost:5050
[CODEX] +     LOGIN_USERNAME=tester@example.com
[CODEX] +     LOGIN_PASSWORD=super-secret
[CODEX] +     ```
[CODEX] +
[CODEX] +   - Variables defined in the repository root `.env` are also loaded. `URL` must match the origin where the web manager is running.
[CODEX] +
[CODEX] +3. **Launch the application backend**
[CODEX] +
[CODEX] +   - Ensure the Vurvey API and any dependent services are running; Playwright interacts with the live stack.
[CODEX] +   - Start the web manager locally with `npm start` or point `URL` at a staging environment.
[CODEX] +
[CODEX] +4. **Seed authentication state**
[CODEX] +
[CODEX] +   - The first test run invokes `auth.setup.ts`, which stores Firebase credentials in IndexedDB and writes a Playwright storage file (`playwright/.auth/user.json`).
[CODEX] +   - This file is reused by dependent projects so subsequent tests start in an authenticated session.
[CODEX] +
[CODEX] +## Running Tests
[CODEX] +
[CODEX] +Common commands:
[CODEX] +
[CODEX] +```bash
[CODEX] +# Run the full E2E suite
[CODEX] +npx playwright test
[CODEX] +
[CODEX] +# Run a specific spec
[CODEX] +npx playwright test playwright/tests/navigation.spec.ts
[CODEX] +
[CODEX] +# Filter by title
[CODEX] +npx playwright test --grep "@smoke"
[CODEX] +
[CODEX] +# Headed (visible) mode
[CODEX] +npx playwright test --headed
[CODEX] +
[CODEX] +# Debug mode with inspector
[CODEX] +npx playwright test --debug
[CODEX] +
[CODEX] +# Use the Playwright UI
[CODEX] +npx playwright test --ui
[CODEX] +```
[CODEX] +
[CODEX] +Project configuration (browser, base URL, reporters) lives in `playwright.config.ts`. Edit that file to add new projects (e.g., Firefox coverage) or alternative reporters.
[CODEX] +
[CODEX] +## Authentication Workflow
[CODEX] +
[CODEX] +Authentication uses Firebase persistence inside IndexedDB:
[CODEX] +
[CODEX] +1. `auth.setup.ts` logs in through the UI using `LOGIN_USERNAME` and `LOGIN_PASSWORD`.
[CODEX] +2. The helper `saveFirebaseAuthData` captures Firebase data from IndexedDB and writes it to `localStorage`.
[CODEX] +3. The storage state is exported to `playwright/.auth/user.json`.
[CODEX] +4. Individual specs call `restoreFirebaseAuthData` via helper utilities before navigating, ensuring a valid session without re-running the login flow.
[CODEX] +
[CODEX] +If you see `No auth data found in localStorage`, run the setup project again (`npx playwright test --project setup`). When credentials rotate, delete `playwright/.auth/user.json` and re-run the suite.
[CODEX] +
[CODEX] +## Writing & Organizing Tests
[CODEX] +
[CODEX] +- **Use fixtures**: Import reusable flows (e.g., `authenticate`) from `playwright/helpers`. Define domain-specific fixtures when a scenario needs shared setup and teardown.
[CODEX] +- **Prefer page objects**: Complex interactions such as the workflow builder or agent editor should be encapsulated in `playwright/page-objects` classes. Create methods that describe user intent (`workflowBuilder.publishFlow()`), not DOM mechanics.
[CODEX] +- **Selectors**: Lean on accessible selectors (`getByRole`, `getByLabel`, `getByTestId`). Fall back to data attributes when elements lack semantic handles. Avoid brittle CSS selectors.
[CODEX] +- **Organization**: Group related specs in `test.describe`. Tag critical smoke tests with `@smoke` for quick feedback loops.
[CODEX] +- **Time-sensitive flows**: Use `await expect(...).toBeVisible({ timeout: 30_000 })` for network-heavy screens. The global `expect` timeout already defaults to 30 seconds; override locally when necessary.
[CODEX] +- **Artifacts**: Use `test.info().attach` to capture domain-specific logs. Screenshots happen automatically on failure, but explicit captures help with mid-test diagnostics.
[CODEX] +
[CODEX] +Example skeleton:
[CODEX] +
[CODEX] +```ts
[CODEX] +import {test, expect} from "@playwright/test";
[CODEX] +import {authenticate} from "../helpers/authentication";
[CODEX] +import {DashboardPage} from "../page-objects/dashboard-page";
[CODEX] +
[CODEX] +test.describe("Dashboard", () => {
[CODEX] +  test.beforeEach(async ({page}) => {
[CODEX] +    await authenticate(page);
[CODEX] +  });
[CODEX] +
[CODEX] +  test("shows the active workspace summary @smoke", async ({page}) => {
[CODEX] +    const dashboard = new DashboardPage(page);
[CODEX] +    await dashboard.goto();
[CODEX] +    await expect(dashboard.header).toContainText("Workspace Overview");
[CODEX] +  });
[CODEX] +});
[CODEX] +```
[CODEX] +
[CODEX] +## Debugging & Diagnostics
[CODEX] +
[CODEX] +- **Trace Viewer**: Re-run failing tests with `npx playwright test --trace on-first-retry` to collect DOM snapshots, network logs, and console output.
[CODEX] +- **Video & screenshots**: Enable via `use: { video: "retain-on-failure", screenshot: "only-on-failure" }` either per test or globally in `playwright.config.ts`.
[CODEX] +- **Console logging**: Place strategic `console.log` statements in specs or helpers when investigating flaky behavior. Remove them once resolved to keep logs clean.
[CODEX] +- **Network mocking**: Stub GraphQL or REST endpoints with `page.route` for deterministic results when backend data is unavailable. Maintain mocks under `playwright/helpers/network`.
[CODEX] +
[CODEX] +When a test flakes, capture the trace, verify selectors still match the rendered UI, and ensure required feature flags are enabled for the environment.
[CODEX] +
[CODEX] +## Continuous Integration
[CODEX] +
[CODEX] +- CI pipelines call `npx playwright test` with the same configuration. Ensure new specs respect the single-worker execution configuration (`workers: 1`) unless you explicitly parallelize them.
[CODEX] +- Store credentials (username, password, URL) in the CI secret store. The setup project fails fast if they are missing.
[CODEX] +- Upload `test-results/` (HTML reporter output) as an artifact for post-run inspection.
[CODEX] +
[CODEX] +Before merging, run the suite locally or in a dry-run environment to catch environment-specific regressions early.
[CODEX] +
[CODEX] +## Reference Material
[CODEX] +
[CODEX] +- [Playwright Configuration](../playwright.config.ts)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +- [Testing Guide (unit + integration)](./TEST-README.md)
[CODEX] +- [Implementation Guide](./implementation-guide.md)
[CODEX] +- [Official Playwright Docs](https://playwright.dev/docs/intro)
[CODEX] +
[CODEX] +Keep this guide up to date whenever the test harness, authentication strategy, or project layout changes. New contributors should be able to set up Playwright using only this document.
[CODEX] file update:
[CODEX] diff --git a/DOCUMENTATION.md b/DOCUMENTATION.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e08ed0b3ff8c2fbb63dc3ee675405d59841b6a10
[CODEX] --- /dev/null
[CODEX] +++ b/DOCUMENTATION.md
[CODEX] @@ -0,0 +1,81 @@
[CODEX] +# Vurvey Web Manager Documentation Hub
[CODEX] +
[CODEX] +This hub ties together the architecture, development workflows, and testing resources for the Vurvey Web Manager. Start here for a narrated overview, then dive into the linked guides for deeper detail.
[CODEX] +
[CODEX] +- [Quick Start](#quick-start)
[CODEX] +- [Architecture at a Glance](#architecture-at-a-glance)
[CODEX] +- [Implementation Deep Dive](#implementation-deep-dive)
[CODEX] +- [Testing & Quality Assurance](#testing--quality-assurance)
[CODEX] +- [Operational Playbooks](#operational-playbooks)
[CODEX] +- [Documentation Index](#documentation-index)
[CODEX] +
[CODEX] +## Quick Start
[CODEX] +
[CODEX] +| Task | Command / Resource |
[CODEX] +| --- | --- |
[CODEX] +| Install dependencies | `npm ci` |
[CODEX] +| Run the dev server | `npm start` (defaults to `http://localhost:5050`) |
[CODEX] +| Type-check | `npm run type-check` |
[CODEX] +| Validate GraphQL documents | `npm run validate:graphql` |
[CODEX] +| Run unit/integration tests | `npm run test:unit` |
[CODEX] +| Run Playwright E2E tests | `npm run test:e2e` |
[CODEX] +| Lint source + tests | `npm run lint` |
[CODEX] +
[CODEX] +Environment variables (Firebase, GraphQL endpoint, feature flags) are defined in `.env`. See `docs/README.md#environment-variables` for the full list.
[CODEX] +
[CODEX] +## Architecture at a Glance
[CODEX] +
[CODEX] +- React 18 + TypeScript rendered through Vite.
[CODEX] +- Routing handled via `react-router-dom` with workspace-aware helpers.
[CODEX] +- GraphQL powered by Apollo Client (HTTP + WebSocket links) and LaunchDarkly/OpenFeature feature flag providers.
[CODEX] +- State spans React Contexts, Apollo cache, and reducer-driven component state.
[CODEX] +- Styling leverages SCSS modules and a shared component library under `src/shared`.
[CODEX] +
[CODEX] +Review the [Implementation Guide](docs/implementation-guide.md) for a walkthrough of providers, feature modules, and architectural conventions.
[CODEX] +
[CODEX] +## Implementation Deep Dive
[CODEX] +
[CODEX] +| Topic | Summary |
[CODEX] +| --- | --- |
[CODEX] +| [Implementation Guide](docs/implementation-guide.md) | Entry points, provider stack, routing, feature ownership, build tooling. |
[CODEX] +| [Project Structure](docs/project-structure.md) | Directory breakdown and best practices for adding new files. |
[CODEX] +| [State Management](docs/state-management.md) | Contexts, reducers, and caching strategies. |
[CODEX] +| [GraphQL Integration](docs/graphql-integration.md) | Query organization, code generation, and cache policies. |
[CODEX] +| [Custom Hooks](docs/custom-hooks.md) | Reusable hooks available across features. |
[CODEX] +| [Workflow Builder Guide](docs/workflow-builder-guide.md) | Deep dive into the workflow module architecture. |
[CODEX] +
[CODEX] +When implementing new features, align with the patterns documented in these guides and update them if responsibilities shift.
[CODEX] +
[CODEX] +## Testing & Quality Assurance
[CODEX] +
[CODEX] +- [Playwright Testing Guide](docs/playwright-testing-guide.md) â€“ Environment setup, authentication strategy, authoring conventions, and debugging tips.
[CODEX] +- [E2E Testing Patterns](docs/e2e-testing-patterns.md) â€“ Hard-won lessons for resilient selectors and flows.
[CODEX] +- [Testing Guide](docs/TEST-README.md) â€“ Vitest commands, coverage expectations, and mocking strategies.
[CODEX] +- Unit tests live beside implementation files. E2E specs live under `playwright/tests/`. Follow the documented fixtures/page-object approach for consistency.
[CODEX] +
[CODEX] +## Operational Playbooks
[CODEX] +
[CODEX] +- [Authentication](docs/authentication.md) â€“ Firebase sign-in flows and session persistence.
[CODEX] +- [Core Features](docs/core-features.md) â€“ Feature overviews for stakeholders and QA.
[CODEX] +- [Routes](docs/routes.md) â€“ Navigation map with workspace/context rules.
[CODEX] +- [Smooth Streaming](docs/smooth-streaming.md) & [Chat Streaming](docs/chat-streaming.md) â€“ Real-time infrastructure details.
[CODEX] +- [Test Resilience Strategy](docs/test-resilience-strategy.md) â€“ Stabilization techniques for automated suites.
[CODEX] +
[CODEX] +These playbooks help new engineers and QA members ramp up quickly on specific domains.
[CODEX] +
[CODEX] +## Documentation Index
[CODEX] +
[CODEX] +All documentation lives under the `docs/` directory:
[CODEX] +
[CODEX] +- [docs/README.md](docs/README.md) â€“ Entry point with setup instructions.
[CODEX] +- [docs/components.md](docs/components.md) â€“ Shared component catalogue.
[CODEX] +- [docs/routes.md](docs/routes.md) â€“ Application routing map.
[CODEX] +- [docs/core-features.md](docs/core-features.md) â€“ High-level feature descriptions.
[CODEX] +- [docs/workflow-builder-guide.md](docs/workflow-builder-guide.md) â€“ Workflow builder architecture.
[CODEX] +- [docs/playwright-testing-guide.md](docs/playwright-testing-guide.md) â€“ Comprehensive Playwright usage.
[CODEX] +- [docs/implementation-guide.md](docs/implementation-guide.md) â€“ Frontend implementation detail.
[CODEX] +- [docs/authentication.md](docs/authentication.md) â€“ Auth flows and state storage.
[CODEX] +- [docs/e2e-testing-patterns.md](docs/e2e-testing-patterns.md) â€“ Resilient test strategies.
[CODEX] +- [docs/TEST-README.md](docs/TEST-README.md) â€“ Unit and integration testing commands.
[CODEX] +
[CODEX] +Keep this hub updated as we introduce new docs or migrate content. If a guide becomes outdated, link directly to its successor or fold it into a more relevant document.
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] diff --git a/docs/playwright-testing-guide.md b/docs/playwright-testing-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..acbab280a49d446cc89ce7ea1e6de422380736ca
[CODEX] --- /dev/null
[CODEX] +++ b/docs/playwright-testing-guide.md
[CODEX] @@ -0,0 +1,161 @@
[CODEX] +# Playwright Testing Guide
[CODEX] +
[CODEX] +This guide explains how to configure, run, and extend the Playwright end-to-end test suite for Vurvey Web Manager.
[CODEX] +
[CODEX] +- [Overview](#overview)
[CODEX] +- [Directory Layout](#directory-layout)
[CODEX] +- [Environment Setup](#environment-setup)
[CODEX] +- [Running Tests](#running-tests)
[CODEX] +- [Authentication Workflow](#authentication-workflow)
[CODEX] +- [Writing & Organizing Tests](#writing--organizing-tests)
[CODEX] +- [Debugging & Diagnostics](#debugging--diagnostics)
[CODEX] +- [Continuous Integration](#continuous-integration)
[CODEX] +- [Reference Material](#reference-material)
[CODEX] +
[CODEX] +## Overview
[CODEX] +
[CODEX] +Playwright exercises the full React application in a Chromium browser using the configuration defined in `playwright.config.ts`. Tests rely on Firebase authentication, Apollo GraphQL, and feature flags, so a stable backend environment and test credentials are required.
[CODEX] +
[CODEX] +Key characteristics:
[CODEX] +
[CODEX] +- Tests live in `playwright/tests/*.spec.ts`.
[CODEX] +- A dedicated `setup` project seeds authentication (`auth.setup.ts`) and persists storage state to `playwright/.auth/user.json`.
[CODEX] +- Default executions run headless Chromium with `slowMo: 50` to reduce flakiness; override these options when debugging.
[CODEX] +
[CODEX] +## Directory Layout
[CODEX] +
[CODEX] +```
[CODEX] +playwright/
[CODEX] +â”œâ”€â”€ fixtures/                 # Test data assets (clips, csv, pdf, images)
[CODEX] +â”œâ”€â”€ helpers/                  # Utility helpers (authentication, navigation)
[CODEX] +â”œâ”€â”€ page-objects/             # Page object abstractions for complex flows
[CODEX] +â”œâ”€â”€ tests/                    # Spec files + global setup (auth.setup.ts)
[CODEX] +â”œâ”€â”€ env.d.ts                  # Type declarations for Playwright globals
[CODEX] +â””â”€â”€ README.md                 # High-level summary (links back to this guide)
[CODEX] +```
[CODEX] +
[CODEX] +Keep common logic in helpers or page objects instead of duplicating it inside specs. Fixtures should hold deterministic assets that can be reused across scenarios.
[CODEX] +
[CODEX] +## Environment Setup
[CODEX] +
[CODEX] +1. **Install dependencies**
[CODEX] +
[CODEX] +   ```bash
[CODEX] +   npm ci
[CODEX] +   npx playwright install
[CODEX] +   ```
[CODEX] +
[CODEX] +2. **Configure environment variables**
[CODEX] +
[CODEX] +   - Create `./playwright/.env` with the fields referenced in tests:
[CODEX] +
[CODEX] +     ```ini
[CODEX] +     URL=http://localhost:5050
[CODEX] +     LOGIN_USERNAME=tester@example.com
[CODEX] +     LOGIN_PASSWORD=super-secret
[CODEX] +     ```
[CODEX] +
[CODEX] +   - Variables defined in the repository root `.env` are also loaded. `URL` must match the origin where the web manager is running.
[CODEX] +
[CODEX] +3. **Launch the application backend**
[CODEX] +
[CODEX] +   - Ensure the Vurvey API and any dependent services are running; Playwright interacts with the live stack.
[CODEX] +   - Start the web manager locally with `npm start` or point `URL` at a staging environment.
[CODEX] +
[CODEX] +4. **Seed authentication state**
[CODEX] +
[CODEX] +   - The first test run invokes `auth.setup.ts`, which stores Firebase credentials in IndexedDB and writes a Playwright storage file (`playwright/.auth/user.json`).
[CODEX] +   - This file is reused by dependent projects so subsequent tests start in an authenticated session.
[CODEX] +
[CODEX] +## Running Tests
[CODEX] +
[CODEX] +Common commands:
[CODEX] +
[CODEX] +```bash
[CODEX] +# Run the full E2E suite
[CODEX] +npx playwright test
[CODEX] +
[CODEX] +# Run a specific spec
[CODEX] +npx playwright test playwright/tests/navigation.spec.ts
[CODEX] +
[CODEX] +# Filter by title
[CODEX] +npx playwright test --grep "@smoke"
[CODEX] +
[CODEX] +# Headed (visible) mode
[CODEX] +npx playwright test --headed
[CODEX] +
[CODEX] +# Debug mode with inspector
[CODEX] +npx playwright test --debug
[CODEX] +
[CODEX] +# Use the Playwright UI
[CODEX] +npx playwright test --ui
[CODEX] +```
[CODEX] +
[CODEX] +Project configuration (browser, base URL, reporters) lives in `playwright.config.ts`. Edit that file to add new projects (e.g., Firefox coverage) or alternative reporters.
[CODEX] +
[CODEX] +## Authentication Workflow
[CODEX] +
[CODEX] +Authentication uses Firebase persistence inside IndexedDB:
[CODEX] +
[CODEX] +1. `auth.setup.ts` logs in through the UI using `LOGIN_USERNAME` and `LOGIN_PASSWORD`.
[CODEX] +2. The helper `saveFirebaseAuthData` captures Firebase data from IndexedDB and writes it to `localStorage`.
[CODEX] +3. The storage state is exported to `playwright/.auth/user.json`.
[CODEX] +4. Individual specs call `restoreFirebaseAuthData` via helper utilities before navigating, ensuring a valid session without re-running the login flow.
[CODEX] +
[CODEX] +If you see `No auth data found in localStorage`, run the setup project again (`npx playwright test --project setup`). When credentials rotate, delete `playwright/.auth/user.json` and re-run the suite.
[CODEX] +
[CODEX] +## Writing & Organizing Tests
[CODEX] +
[CODEX] +- **Use fixtures**: Import reusable flows (e.g., `authenticate`) from `playwright/helpers`. Define domain-specific fixtures when a scenario needs shared setup and teardown.
[CODEX] +- **Prefer page objects**: Complex interactions such as the workflow builder or agent editor should be encapsulated in `playwright/page-objects` classes. Create methods that describe user intent (`workflowBuilder.publishFlow()`), not DOM mechanics.
[CODEX] +- **Selectors**: Lean on accessible selectors (`getByRole`, `getByLabel`, `getByTestId`). Fall back to data attributes when elements lack semantic handles. Avoid brittle CSS selectors.
[CODEX] +- **Organization**: Group related specs in `test.describe`. Tag critical smoke tests with `@smoke` for quick feedback loops.
[CODEX] +- **Time-sensitive flows**: Use `await expect(...).toBeVisible({ timeout: 30_000 })` for network-heavy screens. The global `expect` timeout already defaults to 30 seconds; override locally when necessary.
[CODEX] +- **Artifacts**: Use `test.info().attach` to capture domain-specific logs. Screenshots happen automatically on failure, but explicit captures help with mid-test diagnostics.
[CODEX] +
[CODEX] +Example skeleton:
[CODEX] +
[CODEX] +```ts
[CODEX] +import {test, expect} from "@playwright/test";
[CODEX] +import {authenticate} from "../helpers/authentication";
[CODEX] +import {DashboardPage} from "../page-objects/dashboard-page";
[CODEX] +
[CODEX] +test.describe("Dashboard", () => {
[CODEX] +  test.beforeEach(async ({page}) => {
[CODEX] +    await authenticate(page);
[CODEX] +  });
[CODEX] +
[CODEX] +  test("shows the active workspace summary @smoke", async ({page}) => {
[CODEX] +    const dashboard = new DashboardPage(page);
[CODEX] +    await dashboard.goto();
[CODEX] +    await expect(dashboard.header).toContainText("Workspace Overview");
[CODEX] +  });
[CODEX] +});
[CODEX] +```
[CODEX] +
[CODEX] +## Debugging & Diagnostics
[CODEX] +
[CODEX] +- **Trace Viewer**: Re-run failing tests with `npx playwright test --trace on-first-retry` to collect DOM snapshots, network logs, and console output.
[CODEX] +- **Video & screenshots**: Enable via `use: { video: "retain-on-failure", screenshot: "only-on-failure" }` either per test or globally in `playwright.config.ts`.
[CODEX] +- **Console logging**: Place strategic `console.log` statements in specs or helpers when investigating flaky behavior. Remove them once resolved to keep logs clean.
[CODEX] +- **Network mocking**: Stub GraphQL or REST endpoints with `page.route` for deterministic results when backend data is unavailable. Maintain mocks under `playwright/helpers/network`.
[CODEX] +
[CODEX] +When a test flakes, capture the trace, verify selectors still match the rendered UI, and ensure required feature flags are enabled for the environment.
[CODEX] +
[CODEX] +## Continuous Integration
[CODEX] +
[CODEX] +- CI pipelines call `npx playwright test` with the same configuration. Ensure new specs respect the single-worker execution configuration (`workers: 1`) unless you explicitly parallelize them.
[CODEX] +- Store credentials (username, password, URL) in the CI secret store. The setup project fails fast if they are missing.
[CODEX] +- Upload `test-results/` (HTML reporter output) as an artifact for post-run inspection.
[CODEX] +
[CODEX] +Before merging, run the suite locally or in a dry-run environment to catch environment-specific regressions early.
[CODEX] +
[CODEX] +## Reference Material
[CODEX] +
[CODEX] +- [Playwright Configuration](../playwright.config.ts)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +- [Testing Guide (unit + integration)](./TEST-README.md)
[CODEX] +- [Implementation Guide](./implementation-guide.md)
[CODEX] +- [Official Playwright Docs](https://playwright.dev/docs/intro)
[CODEX] +
[CODEX] +Keep this guide up to date whenever the test harness, authentication strategy, or project layout changes. New contributors should be able to set up Playwright using only this document.
[CODEX] thinking
[CODEX] **Updating README with new docs**
[CODEX] file update
[CODEX] M /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6/docs/README.md
[CODEX] @@ -21,2 +21,3 @@
[CODEX] +- [Implementation Guide](./implementation-guide.md) - How the application is assembled end-to-end
[CODEX] - [Project Structure](./project-structure.md) - Codebase organization
[CODEX] @@ -26,2 +27,3 @@
[CODEX] - [Components](./components.md) - Component library and patterns
[CODEX] +- [Playwright Testing Guide](./playwright-testing-guide.md) - Full Playwright setup and authoring guide
[CODEX] @@ -149,2 +151,3 @@
[CODEX] LOGIN_PASSWORD="your_test_password"
[CODEX] +URL="http://localhost:5050"
[CODEX] ```
[CODEX] @@ -183 +186,2 @@
[CODEX] - [React Documentation](https://react.dev)
[CODEX] +- [Documentation Hub](../DOCUMENTATION.md) for an index of project guides
[CODEX] apply_patch(auto_approved=true) exited 0 in 30ms:
[CODEX] Success. Updated the following files:
[CODEX] M docs/README.md
[CODEX] file update:
[CODEX] diff --git a/DOCUMENTATION.md b/DOCUMENTATION.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e08ed0b3ff8c2fbb63dc3ee675405d59841b6a10
[CODEX] --- /dev/null
[CODEX] +++ b/DOCUMENTATION.md
[CODEX] @@ -0,0 +1,81 @@
[CODEX] +# Vurvey Web Manager Documentation Hub
[CODEX] +
[CODEX] +This hub ties together the architecture, development workflows, and testing resources for the Vurvey Web Manager. Start here for a narrated overview, then dive into the linked guides for deeper detail.
[CODEX] +
[CODEX] +- [Quick Start](#quick-start)
[CODEX] +- [Architecture at a Glance](#architecture-at-a-glance)
[CODEX] +- [Implementation Deep Dive](#implementation-deep-dive)
[CODEX] +- [Testing & Quality Assurance](#testing--quality-assurance)
[CODEX] +- [Operational Playbooks](#operational-playbooks)
[CODEX] +- [Documentation Index](#documentation-index)
[CODEX] +
[CODEX] +## Quick Start
[CODEX] +
[CODEX] +| Task | Command / Resource |
[CODEX] +| --- | --- |
[CODEX] +| Install dependencies | `npm ci` |
[CODEX] +| Run the dev server | `npm start` (defaults to `http://localhost:5050`) |
[CODEX] +| Type-check | `npm run type-check` |
[CODEX] +| Validate GraphQL documents | `npm run validate:graphql` |
[CODEX] +| Run unit/integration tests | `npm run test:unit` |
[CODEX] +| Run Playwright E2E tests | `npm run test:e2e` |
[CODEX] +| Lint source + tests | `npm run lint` |
[CODEX] +
[CODEX] +Environment variables (Firebase, GraphQL endpoint, feature flags) are defined in `.env`. See `docs/README.md#environment-variables` for the full list.
[CODEX] +
[CODEX] +## Architecture at a Glance
[CODEX] +
[CODEX] +- React 18 + TypeScript rendered through Vite.
[CODEX] +- Routing handled via `react-router-dom` with workspace-aware helpers.
[CODEX] +- GraphQL powered by Apollo Client (HTTP + WebSocket links) and LaunchDarkly/OpenFeature feature flag providers.
[CODEX] +- State spans React Contexts, Apollo cache, and reducer-driven component state.
[CODEX] +- Styling leverages SCSS modules and a shared component library under `src/shared`.
[CODEX] +
[CODEX] +Review the [Implementation Guide](docs/implementation-guide.md) for a walkthrough of providers, feature modules, and architectural conventions.
[CODEX] +
[CODEX] +## Implementation Deep Dive
[CODEX] +
[CODEX] +| Topic | Summary |
[CODEX] +| --- | --- |
[CODEX] +| [Implementation Guide](docs/implementation-guide.md) | Entry points, provider stack, routing, feature ownership, build tooling. |
[CODEX] +| [Project Structure](docs/project-structure.md) | Directory breakdown and best practices for adding new files. |
[CODEX] +| [State Management](docs/state-management.md) | Contexts, reducers, and caching strategies. |
[CODEX] +| [GraphQL Integration](docs/graphql-integration.md) | Query organization, code generation, and cache policies. |
[CODEX] +| [Custom Hooks](docs/custom-hooks.md) | Reusable hooks available across features. |
[CODEX] +| [Workflow Builder Guide](docs/workflow-builder-guide.md) | Deep dive into the workflow module architecture. |
[CODEX] +
[CODEX] +When implementing new features, align with the patterns documented in these guides and update them if responsibilities shift.
[CODEX] +
[CODEX] +## Testing & Quality Assurance
[CODEX] +
[CODEX] +- [Playwright Testing Guide](docs/playwright-testing-guide.md) â€“ Environment setup, authentication strategy, authoring conventions, and debugging tips.
[CODEX] +- [E2E Testing Patterns](docs/e2e-testing-patterns.md) â€“ Hard-won lessons for resilient selectors and flows.
[CODEX] +- [Testing Guide](docs/TEST-README.md) â€“ Vitest commands, coverage expectations, and mocking strategies.
[CODEX] +- Unit tests live beside implementation files. E2E specs live under `playwright/tests/`. Follow the documented fixtures/page-object approach for consistency.
[CODEX] +
[CODEX] +## Operational Playbooks
[CODEX] +
[CODEX] +- [Authentication](docs/authentication.md) â€“ Firebase sign-in flows and session persistence.
[CODEX] +- [Core Features](docs/core-features.md) â€“ Feature overviews for stakeholders and QA.
[CODEX] +- [Routes](docs/routes.md) â€“ Navigation map with workspace/context rules.
[CODEX] +- [Smooth Streaming](docs/smooth-streaming.md) & [Chat Streaming](docs/chat-streaming.md) â€“ Real-time infrastructure details.
[CODEX] +- [Test Resilience Strategy](docs/test-resilience-strategy.md) â€“ Stabilization techniques for automated suites.
[CODEX] +
[CODEX] +These playbooks help new engineers and QA members ramp up quickly on specific domains.
[CODEX] +
[CODEX] +## Documentation Index
[CODEX] +
[CODEX] +All documentation lives under the `docs/` directory:
[CODEX] +
[CODEX] +- [docs/README.md](docs/README.md) â€“ Entry point with setup instructions.
[CODEX] +- [docs/components.md](docs/components.md) â€“ Shared component catalogue.
[CODEX] +- [docs/routes.md](docs/routes.md) â€“ Application routing map.
[CODEX] +- [docs/core-features.md](docs/core-features.md) â€“ High-level feature descriptions.
[CODEX] +- [docs/workflow-builder-guide.md](docs/workflow-builder-guide.md) â€“ Workflow builder architecture.
[CODEX] +- [docs/playwright-testing-guide.md](docs/playwright-testing-guide.md) â€“ Comprehensive Playwright usage.
[CODEX] +- [docs/implementation-guide.md](docs/implementation-guide.md) â€“ Frontend implementation detail.
[CODEX] +- [docs/authentication.md](docs/authentication.md) â€“ Auth flows and state storage.
[CODEX] +- [docs/e2e-testing-patterns.md](docs/e2e-testing-patterns.md) â€“ Resilient test strategies.
[CODEX] +- [docs/TEST-README.md](docs/TEST-README.md) â€“ Unit and integration testing commands.
[CODEX] +
[CODEX] +Keep this hub updated as we introduce new docs or migrate content. If a guide becomes outdated, link directly to its successor or fold it into a more relevant document.
[CODEX] diff --git a/docs/README.md b/docs/README.md
[CODEX] index 174c521a012dbbb5ef957dfc29360c9b697c7b6e..5a56517cd1e90833bbcb9dad65d7cb3d620b14c8
[CODEX] --- a/docs/README.md
[CODEX] +++ b/docs/README.md
[CODEX] @@ -19,11 +19,13 @@
[CODEX] ### Getting Started
[CODEX] +- [Implementation Guide](./implementation-guide.md) - How the application is assembled end-to-end
[CODEX] - [Project Structure](./project-structure.md) - Codebase organization
[CODEX] - [Authentication](./authentication.md) - Auth system and user management
[CODEX] - [State Management](./state-management.md) - Context and data flow
[CODEX] - [Routes](./routes.md) - Routing structure and navigation
[CODEX] - [Components](./components.md) - Component library and patterns
[CODEX] +- [Playwright Testing Guide](./playwright-testing-guide.md) - Full Playwright setup and authoring guide
[CODEX] ### Features
[CODEX] @@ -147,6 +149,7 @@
[CODEX] ```
[CODEX] LOGIN_USERNAME="your_test_email"
[CODEX] LOGIN_PASSWORD="your_test_password"
[CODEX] +URL="http://localhost:5050"
[CODEX] ```
[CODEX] ## Best Practices
[CODEX] @@ -181,3 +184,4 @@
[CODEX] - [Playwright Documentation](https://playwright.dev)
[CODEX] - [Apollo Client Documentation](https://www.apollographql.com/docs/react)
[CODEX] - [React Documentation](https://react.dev)
[CODEX] +- [Documentation Hub](../DOCUMENTATION.md) for an index of project guides
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] diff --git a/docs/playwright-testing-guide.md b/docs/playwright-testing-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..acbab280a49d446cc89ce7ea1e6de422380736ca
[CODEX] --- /dev/null
[CODEX] +++ b/docs/playwright-testing-guide.md
[CODEX] @@ -0,0 +1,161 @@
[CODEX] +# Playwright Testing Guide
[CODEX] +
[CODEX] +This guide explains how to configure, run, and extend the Playwright end-to-end test suite for Vurvey Web Manager.
[CODEX] +
[CODEX] +- [Overview](#overview)
[CODEX] +- [Directory Layout](#directory-layout)
[CODEX] +- [Environment Setup](#environment-setup)
[CODEX] +- [Running Tests](#running-tests)
[CODEX] +- [Authentication Workflow](#authentication-workflow)
[CODEX] +- [Writing & Organizing Tests](#writing--organizing-tests)
[CODEX] +- [Debugging & Diagnostics](#debugging--diagnostics)
[CODEX] +- [Continuous Integration](#continuous-integration)
[CODEX] +- [Reference Material](#reference-material)
[CODEX] +
[CODEX] +## Overview
[CODEX] +
[CODEX] +Playwright exercises the full React application in a Chromium browser using the configuration defined in `playwright.config.ts`. Tests rely on Firebase authentication, Apollo GraphQL, and feature flags, so a stable backend environment and test credentials are required.
[CODEX] +
[CODEX] +Key characteristics:
[CODEX] +
[CODEX] +- Tests live in `playwright/tests/*.spec.ts`.
[CODEX] +- A dedicated `setup` project seeds authentication (`auth.setup.ts`) and persists storage state to `playwright/.auth/user.json`.
[CODEX] +- Default executions run headless Chromium with `slowMo: 50` to reduce flakiness; override these options when debugging.
[CODEX] +
[CODEX] +## Directory Layout
[CODEX] +
[CODEX] +```
[CODEX] +playwright/
[CODEX] +â”œâ”€â”€ fixtures/                 # Test data assets (clips, csv, pdf, images)
[CODEX] +â”œâ”€â”€ helpers/                  # Utility helpers (authentication, navigation)
[CODEX] +â”œâ”€â”€ page-objects/             # Page object abstractions for complex flows
[CODEX] +â”œâ”€â”€ tests/                    # Spec files + global setup (auth.setup.ts)
[CODEX] +â”œâ”€â”€ env.d.ts                  # Type declarations for Playwright globals
[CODEX] +â””â”€â”€ README.md                 # High-level summary (links back to this guide)
[CODEX] +```
[CODEX] +
[CODEX] +Keep common logic in helpers or page objects instead of duplicating it inside specs. Fixtures should hold deterministic assets that can be reused across scenarios.
[CODEX] +
[CODEX] +## Environment Setup
[CODEX] +
[CODEX] +1. **Install dependencies**
[CODEX] +
[CODEX] +   ```bash
[CODEX] +   npm ci
[CODEX] +   npx playwright install
[CODEX] +   ```
[CODEX] +
[CODEX] +2. **Configure environment variables**
[CODEX] +
[CODEX] +   - Create `./playwright/.env` with the fields referenced in tests:
[CODEX] +
[CODEX] +     ```ini
[CODEX] +     URL=http://localhost:5050
[CODEX] +     LOGIN_USERNAME=tester@example.com
[CODEX] +     LOGIN_PASSWORD=super-secret
[CODEX] +     ```
[CODEX] +
[CODEX] +   - Variables defined in the repository root `.env` are also loaded. `URL` must match the origin where the web manager is running.
[CODEX] +
[CODEX] +3. **Launch the application backend**
[CODEX] +
[CODEX] +   - Ensure the Vurvey API and any dependent services are running; Playwright interacts with the live stack.
[CODEX] +   - Start the web manager locally with `npm start` or point `URL` at a staging environment.
[CODEX] +
[CODEX] +4. **Seed authentication state**
[CODEX] +
[CODEX] +   - The first test run invokes `auth.setup.ts`, which stores Firebase credentials in IndexedDB and writes a Playwright storage file (`playwright/.auth/user.json`).
[CODEX] +   - This file is reused by dependent projects so subsequent tests start in an authenticated session.
[CODEX] +
[CODEX] +## Running Tests
[CODEX] +
[CODEX] +Common commands:
[CODEX] +
[CODEX] +```bash
[CODEX] +# Run the full E2E suite
[CODEX] +npx playwright test
[CODEX] +
[CODEX] +# Run a specific spec
[CODEX] +npx playwright test playwright/tests/navigation.spec.ts
[CODEX] +
[CODEX] +# Filter by title
[CODEX] +npx playwright test --grep "@smoke"
[CODEX] +
[CODEX] +# Headed (visible) mode
[CODEX] +npx playwright test --headed
[CODEX] +
[CODEX] +# Debug mode with inspector
[CODEX] +npx playwright test --debug
[CODEX] +
[CODEX] +# Use the Playwright UI
[CODEX] +npx playwright test --ui
[CODEX] +```
[CODEX] +
[CODEX] +Project configuration (browser, base URL, reporters) lives in `playwright.config.ts`. Edit that file to add new projects (e.g., Firefox coverage) or alternative reporters.
[CODEX] +
[CODEX] +## Authentication Workflow
[CODEX] +
[CODEX] +Authentication uses Firebase persistence inside IndexedDB:
[CODEX] +
[CODEX] +1. `auth.setup.ts` logs in through the UI using `LOGIN_USERNAME` and `LOGIN_PASSWORD`.
[CODEX] +2. The helper `saveFirebaseAuthData` captures Firebase data from IndexedDB and writes it to `localStorage`.
[CODEX] +3. The storage state is exported to `playwright/.auth/user.json`.
[CODEX] +4. Individual specs call `restoreFirebaseAuthData` via helper utilities before navigating, ensuring a valid session without re-running the login flow.
[CODEX] +
[CODEX] +If you see `No auth data found in localStorage`, run the setup project again (`npx playwright test --project setup`). When credentials rotate, delete `playwright/.auth/user.json` and re-run the suite.
[CODEX] +
[CODEX] +## Writing & Organizing Tests
[CODEX] +
[CODEX] +- **Use fixtures**: Import reusable flows (e.g., `authenticate`) from `playwright/helpers`. Define domain-specific fixtures when a scenario needs shared setup and teardown.
[CODEX] +- **Prefer page objects**: Complex interactions such as the workflow builder or agent editor should be encapsulated in `playwright/page-objects` classes. Create methods that describe user intent (`workflowBuilder.publishFlow()`), not DOM mechanics.
[CODEX] +- **Selectors**: Lean on accessible selectors (`getByRole`, `getByLabel`, `getByTestId`). Fall back to data attributes when elements lack semantic handles. Avoid brittle CSS selectors.
[CODEX] +- **Organization**: Group related specs in `test.describe`. Tag critical smoke tests with `@smoke` for quick feedback loops.
[CODEX] +- **Time-sensitive flows**: Use `await expect(...).toBeVisible({ timeout: 30_000 })` for network-heavy screens. The global `expect` timeout already defaults to 30 seconds; override locally when necessary.
[CODEX] +- **Artifacts**: Use `test.info().attach` to capture domain-specific logs. Screenshots happen automatically on failure, but explicit captures help with mid-test diagnostics.
[CODEX] +
[CODEX] +Example skeleton:
[CODEX] +
[CODEX] +```ts
[CODEX] +import {test, expect} from "@playwright/test";
[CODEX] +import {authenticate} from "../helpers/authentication";
[CODEX] +import {DashboardPage} from "../page-objects/dashboard-page";
[CODEX] +
[CODEX] +test.describe("Dashboard", () => {
[CODEX] +  test.beforeEach(async ({page}) => {
[CODEX] +    await authenticate(page);
[CODEX] +  });
[CODEX] +
[CODEX] +  test("shows the active workspace summary @smoke", async ({page}) => {
[CODEX] +    const dashboard = new DashboardPage(page);
[CODEX] +    await dashboard.goto();
[CODEX] +    await expect(dashboard.header).toContainText("Workspace Overview");
[CODEX] +  });
[CODEX] +});
[CODEX] +```
[CODEX] +
[CODEX] +## Debugging & Diagnostics
[CODEX] +
[CODEX] +- **Trace Viewer**: Re-run failing tests with `npx playwright test --trace on-first-retry` to collect DOM snapshots, network logs, and console output.
[CODEX] +- **Video & screenshots**: Enable via `use: { video: "retain-on-failure", screenshot: "only-on-failure" }` either per test or globally in `playwright.config.ts`.
[CODEX] +- **Console logging**: Place strategic `console.log` statements in specs or helpers when investigating flaky behavior. Remove them once resolved to keep logs clean.
[CODEX] +- **Network mocking**: Stub GraphQL or REST endpoints with `page.route` for deterministic results when backend data is unavailable. Maintain mocks under `playwright/helpers/network`.
[CODEX] +
[CODEX] +When a test flakes, capture the trace, verify selectors still match the rendered UI, and ensure required feature flags are enabled for the environment.
[CODEX] +
[CODEX] +## Continuous Integration
[CODEX] +
[CODEX] +- CI pipelines call `npx playwright test` with the same configuration. Ensure new specs respect the single-worker execution configuration (`workers: 1`) unless you explicitly parallelize them.
[CODEX] +- Store credentials (username, password, URL) in the CI secret store. The setup project fails fast if they are missing.
[CODEX] +- Upload `test-results/` (HTML reporter output) as an artifact for post-run inspection.
[CODEX] +
[CODEX] +Before merging, run the suite locally or in a dry-run environment to catch environment-specific regressions early.
[CODEX] +
[CODEX] +## Reference Material
[CODEX] +
[CODEX] +- [Playwright Configuration](../playwright.config.ts)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +- [Testing Guide (unit + integration)](./TEST-README.md)
[CODEX] +- [Implementation Guide](./implementation-guide.md)
[CODEX] +- [Official Playwright Docs](https://playwright.dev/docs/intro)
[CODEX] +
[CODEX] +Keep this guide up to date whenever the test harness, authentication strategy, or project layout changes. New contributors should be able to set up Playwright using only this document.
[CODEX] file update:
[CODEX] diff --git a/DOCUMENTATION.md b/DOCUMENTATION.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e08ed0b3ff8c2fbb63dc3ee675405d59841b6a10
[CODEX] --- /dev/null
[CODEX] +++ b/DOCUMENTATION.md
[CODEX] @@ -0,0 +1,81 @@
[CODEX] +# Vurvey Web Manager Documentation Hub
[CODEX] +
[CODEX] +This hub ties together the architecture, development workflows, and testing resources for the Vurvey Web Manager. Start here for a narrated overview, then dive into the linked guides for deeper detail.
[CODEX] +
[CODEX] +- [Quick Start](#quick-start)
[CODEX] +- [Architecture at a Glance](#architecture-at-a-glance)
[CODEX] +- [Implementation Deep Dive](#implementation-deep-dive)
[CODEX] +- [Testing & Quality Assurance](#testing--quality-assurance)
[CODEX] +- [Operational Playbooks](#operational-playbooks)
[CODEX] +- [Documentation Index](#documentation-index)
[CODEX] +
[CODEX] +## Quick Start
[CODEX] +
[CODEX] +| Task | Command / Resource |
[CODEX] +| --- | --- |
[CODEX] +| Install dependencies | `npm ci` |
[CODEX] +| Run the dev server | `npm start` (defaults to `http://localhost:5050`) |
[CODEX] +| Type-check | `npm run type-check` |
[CODEX] +| Validate GraphQL documents | `npm run validate:graphql` |
[CODEX] +| Run unit/integration tests | `npm run test:unit` |
[CODEX] +| Run Playwright E2E tests | `npm run test:e2e` |
[CODEX] +| Lint source + tests | `npm run lint` |
[CODEX] +
[CODEX] +Environment variables (Firebase, GraphQL endpoint, feature flags) are defined in `.env`. See `docs/README.md#environment-variables` for the full list.
[CODEX] +
[CODEX] +## Architecture at a Glance
[CODEX] +
[CODEX] +- React 18 + TypeScript rendered through Vite.
[CODEX] +- Routing handled via `react-router-dom` with workspace-aware helpers.
[CODEX] +- GraphQL powered by Apollo Client (HTTP + WebSocket links) and LaunchDarkly/OpenFeature feature flag providers.
[CODEX] +- State spans React Contexts, Apollo cache, and reducer-driven component state.
[CODEX] +- Styling leverages SCSS modules and a shared component library under `src/shared`.
[CODEX] +
[CODEX] +Review the [Implementation Guide](docs/implementation-guide.md) for a walkthrough of providers, feature modules, and architectural conventions.
[CODEX] +
[CODEX] +## Implementation Deep Dive
[CODEX] +
[CODEX] +| Topic | Summary |
[CODEX] +| --- | --- |
[CODEX] +| [Implementation Guide](docs/implementation-guide.md) | Entry points, provider stack, routing, feature ownership, build tooling. |
[CODEX] +| [Project Structure](docs/project-structure.md) | Directory breakdown and best practices for adding new files. |
[CODEX] +| [State Management](docs/state-management.md) | Contexts, reducers, and caching strategies. |
[CODEX] +| [GraphQL Integration](docs/graphql-integration.md) | Query organization, code generation, and cache policies. |
[CODEX] +| [Custom Hooks](docs/custom-hooks.md) | Reusable hooks available across features. |
[CODEX] +| [Workflow Builder Guide](docs/workflow-builder-guide.md) | Deep dive into the workflow module architecture. |
[CODEX] +
[CODEX] +When implementing new features, align with the patterns documented in these guides and update them if responsibilities shift.
[CODEX] +
[CODEX] +## Testing & Quality Assurance
[CODEX] +
[CODEX] +- [Playwright Testing Guide](docs/playwright-testing-guide.md) â€“ Environment setup, authentication strategy, authoring conventions, and debugging tips.
[CODEX] +- [E2E Testing Patterns](docs/e2e-testing-patterns.md) â€“ Hard-won lessons for resilient selectors and flows.
[CODEX] +- [Testing Guide](docs/TEST-README.md) â€“ Vitest commands, coverage expectations, and mocking strategies.
[CODEX] +- Unit tests live beside implementation files. E2E specs live under `playwright/tests/`. Follow the documented fixtures/page-object approach for consistency.
[CODEX] +
[CODEX] +## Operational Playbooks
[CODEX] +
[CODEX] +- [Authentication](docs/authentication.md) â€“ Firebase sign-in flows and session persistence.
[CODEX] +- [Core Features](docs/core-features.md) â€“ Feature overviews for stakeholders and QA.
[CODEX] +- [Routes](docs/routes.md) â€“ Navigation map with workspace/context rules.
[CODEX] +- [Smooth Streaming](docs/smooth-streaming.md) & [Chat Streaming](docs/chat-streaming.md) â€“ Real-time infrastructure details.
[CODEX] +- [Test Resilience Strategy](docs/test-resilience-strategy.md) â€“ Stabilization techniques for automated suites.
[CODEX] +
[CODEX] +These playbooks help new engineers and QA members ramp up quickly on specific domains.
[CODEX] +
[CODEX] +## Documentation Index
[CODEX] +
[CODEX] +All documentation lives under the `docs/` directory:
[CODEX] +
[CODEX] +- [docs/README.md](docs/README.md) â€“ Entry point with setup instructions.
[CODEX] +- [docs/components.md](docs/components.md) â€“ Shared component catalogue.
[CODEX] +- [docs/routes.md](docs/routes.md) â€“ Application routing map.
[CODEX] +- [docs/core-features.md](docs/core-features.md) â€“ High-level feature descriptions.
[CODEX] +- [docs/workflow-builder-guide.md](docs/workflow-builder-guide.md) â€“ Workflow builder architecture.
[CODEX] +- [docs/playwright-testing-guide.md](docs/playwright-testing-guide.md) â€“ Comprehensive Playwright usage.
[CODEX] +- [docs/implementation-guide.md](docs/implementation-guide.md) â€“ Frontend implementation detail.
[CODEX] +- [docs/authentication.md](docs/authentication.md) â€“ Auth flows and state storage.
[CODEX] +- [docs/e2e-testing-patterns.md](docs/e2e-testing-patterns.md) â€“ Resilient test strategies.
[CODEX] +- [docs/TEST-README.md](docs/TEST-README.md) â€“ Unit and integration testing commands.
[CODEX] +
[CODEX] +Keep this hub updated as we introduce new docs or migrate content. If a guide becomes outdated, link directly to its successor or fold it into a more relevant document.
[CODEX] diff --git a/docs/README.md b/docs/README.md
[CODEX] index 174c521a012dbbb5ef957dfc29360c9b697c7b6e..5a56517cd1e90833bbcb9dad65d7cb3d620b14c8
[CODEX] --- a/docs/README.md
[CODEX] +++ b/docs/README.md
[CODEX] @@ -19,11 +19,13 @@
[CODEX] ### Getting Started
[CODEX] +- [Implementation Guide](./implementation-guide.md) - How the application is assembled end-to-end
[CODEX] - [Project Structure](./project-structure.md) - Codebase organization
[CODEX] - [Authentication](./authentication.md) - Auth system and user management
[CODEX] - [State Management](./state-management.md) - Context and data flow
[CODEX] - [Routes](./routes.md) - Routing structure and navigation
[CODEX] - [Components](./components.md) - Component library and patterns
[CODEX] +- [Playwright Testing Guide](./playwright-testing-guide.md) - Full Playwright setup and authoring guide
[CODEX] ### Features
[CODEX] @@ -147,6 +149,7 @@
[CODEX] ```
[CODEX] LOGIN_USERNAME="your_test_email"
[CODEX] LOGIN_PASSWORD="your_test_password"
[CODEX] +URL="http://localhost:5050"
[CODEX] ```
[CODEX] ## Best Practices
[CODEX] @@ -181,3 +184,4 @@
[CODEX] - [Playwright Documentation](https://playwright.dev)
[CODEX] - [Apollo Client Documentation](https://www.apollographql.com/docs/react)
[CODEX] - [React Documentation](https://react.dev)
[CODEX] +- [Documentation Hub](../DOCUMENTATION.md) for an index of project guides
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] diff --git a/docs/playwright-testing-guide.md b/docs/playwright-testing-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..acbab280a49d446cc89ce7ea1e6de422380736ca
[CODEX] --- /dev/null
[CODEX] +++ b/docs/playwright-testing-guide.md
[CODEX] @@ -0,0 +1,161 @@
[CODEX] +# Playwright Testing Guide
[CODEX] +
[CODEX] +This guide explains how to configure, run, and extend the Playwright end-to-end test suite for Vurvey Web Manager.
[CODEX] +
[CODEX] +- [Overview](#overview)
[CODEX] +- [Directory Layout](#directory-layout)
[CODEX] +- [Environment Setup](#environment-setup)
[CODEX] +- [Running Tests](#running-tests)
[CODEX] +- [Authentication Workflow](#authentication-workflow)
[CODEX] +- [Writing & Organizing Tests](#writing--organizing-tests)
[CODEX] +- [Debugging & Diagnostics](#debugging--diagnostics)
[CODEX] +- [Continuous Integration](#continuous-integration)
[CODEX] +- [Reference Material](#reference-material)
[CODEX] +
[CODEX] +## Overview
[CODEX] +
[CODEX] +Playwright exercises the full React application in a Chromium browser using the configuration defined in `playwright.config.ts`. Tests rely on Firebase authentication, Apollo GraphQL, and feature flags, so a stable backend environment and test credentials are required.
[CODEX] +
[CODEX] +Key characteristics:
[CODEX] +
[CODEX] +- Tests live in `playwright/tests/*.spec.ts`.
[CODEX] +- A dedicated `setup` project seeds authentication (`auth.setup.ts`) and persists storage state to `playwright/.auth/user.json`.
[CODEX] +- Default executions run headless Chromium with `slowMo: 50` to reduce flakiness; override these options when debugging.
[CODEX] +
[CODEX] +## Directory Layout
[CODEX] +
[CODEX] +```
[CODEX] +playwright/
[CODEX] +â”œâ”€â”€ fixtures/                 # Test data assets (clips, csv, pdf, images)
[CODEX] +â”œâ”€â”€ helpers/                  # Utility helpers (authentication, navigation)
[CODEX] +â”œâ”€â”€ page-objects/             # Page object abstractions for complex flows
[CODEX] +â”œâ”€â”€ tests/                    # Spec files + global setup (auth.setup.ts)
[CODEX] +â”œâ”€â”€ env.d.ts                  # Type declarations for Playwright globals
[CODEX] +â””â”€â”€ README.md                 # High-level summary (links back to this guide)
[CODEX] +```
[CODEX] +
[CODEX] +Keep common logic in helpers or page objects instead of duplicating it inside specs. Fixtures should hold deterministic assets that can be reused across scenarios.
[CODEX] +
[CODEX] +## Environment Setup
[CODEX] +
[CODEX] +1. **Install dependencies**
[CODEX] +
[CODEX] +   ```bash
[CODEX] +   npm ci
[CODEX] +   npx playwright install
[CODEX] +   ```
[CODEX] +
[CODEX] +2. **Configure environment variables**
[CODEX] +
[CODEX] +   - Create `./playwright/.env` with the fields referenced in tests:
[CODEX] +
[CODEX] +     ```ini
[CODEX] +     URL=http://localhost:5050
[CODEX] +     LOGIN_USERNAME=tester@example.com
[CODEX] +     LOGIN_PASSWORD=super-secret
[CODEX] +     ```
[CODEX] +
[CODEX] +   - Variables defined in the repository root `.env` are also loaded. `URL` must match the origin where the web manager is running.
[CODEX] +
[CODEX] +3. **Launch the application backend**
[CODEX] +
[CODEX] +   - Ensure the Vurvey API and any dependent services are running; Playwright interacts with the live stack.
[CODEX] +   - Start the web manager locally with `npm start` or point `URL` at a staging environment.
[CODEX] +
[CODEX] +4. **Seed authentication state**
[CODEX] +
[CODEX] +   - The first test run invokes `auth.setup.ts`, which stores Firebase credentials in IndexedDB and writes a Playwright storage file (`playwright/.auth/user.json`).
[CODEX] +   - This file is reused by dependent projects so subsequent tests start in an authenticated session.
[CODEX] +
[CODEX] +## Running Tests
[CODEX] +
[CODEX] +Common commands:
[CODEX] +
[CODEX] +```bash
[CODEX] +# Run the full E2E suite
[CODEX] +npx playwright test
[CODEX] +
[CODEX] +# Run a specific spec
[CODEX] +npx playwright test playwright/tests/navigation.spec.ts
[CODEX] +
[CODEX] +# Filter by title
[CODEX] +npx playwright test --grep "@smoke"
[CODEX] +
[CODEX] +# Headed (visible) mode
[CODEX] +npx playwright test --headed
[CODEX] +
[CODEX] +# Debug mode with inspector
[CODEX] +npx playwright test --debug
[CODEX] +
[CODEX] +# Use the Playwright UI
[CODEX] +npx playwright test --ui
[CODEX] +```
[CODEX] +
[CODEX] +Project configuration (browser, base URL, reporters) lives in `playwright.config.ts`. Edit that file to add new projects (e.g., Firefox coverage) or alternative reporters.
[CODEX] +
[CODEX] +## Authentication Workflow
[CODEX] +
[CODEX] +Authentication uses Firebase persistence inside IndexedDB:
[CODEX] +
[CODEX] +1. `auth.setup.ts` logs in through the UI using `LOGIN_USERNAME` and `LOGIN_PASSWORD`.
[CODEX] +2. The helper `saveFirebaseAuthData` captures Firebase data from IndexedDB and writes it to `localStorage`.
[CODEX] +3. The storage state is exported to `playwright/.auth/user.json`.
[CODEX] +4. Individual specs call `restoreFirebaseAuthData` via helper utilities before navigating, ensuring a valid session without re-running the login flow.
[CODEX] +
[CODEX] +If you see `No auth data found in localStorage`, run the setup project again (`npx playwright test --project setup`). When credentials rotate, delete `playwright/.auth/user.json` and re-run the suite.
[CODEX] +
[CODEX] +## Writing & Organizing Tests
[CODEX] +
[CODEX] +- **Use fixtures**: Import reusable flows (e.g., `authenticate`) from `playwright/helpers`. Define domain-specific fixtures when a scenario needs shared setup and teardown.
[CODEX] +- **Prefer page objects**: Complex interactions such as the workflow builder or agent editor should be encapsulated in `playwright/page-objects` classes. Create methods that describe user intent (`workflowBuilder.publishFlow()`), not DOM mechanics.
[CODEX] +- **Selectors**: Lean on accessible selectors (`getByRole`, `getByLabel`, `getByTestId`). Fall back to data attributes when elements lack semantic handles. Avoid brittle CSS selectors.
[CODEX] +- **Organization**: Group related specs in `test.describe`. Tag critical smoke tests with `@smoke` for quick feedback loops.
[CODEX] +- **Time-sensitive flows**: Use `await expect(...).toBeVisible({ timeout: 30_000 })` for network-heavy screens. The global `expect` timeout already defaults to 30 seconds; override locally when necessary.
[CODEX] +- **Artifacts**: Use `test.info().attach` to capture domain-specific logs. Screenshots happen automatically on failure, but explicit captures help with mid-test diagnostics.
[CODEX] +
[CODEX] +Example skeleton:
[CODEX] +
[CODEX] +```ts
[CODEX] +import {test, expect} from "@playwright/test";
[CODEX] +import {authenticate} from "../helpers/authentication";
[CODEX] +import {DashboardPage} from "../page-objects/dashboard-page";
[CODEX] +
[CODEX] +test.describe("Dashboard", () => {
[CODEX] +  test.beforeEach(async ({page}) => {
[CODEX] +    await authenticate(page);
[CODEX] +  });
[CODEX] +
[CODEX] +  test("shows the active workspace summary @smoke", async ({page}) => {
[CODEX] +    const dashboard = new DashboardPage(page);
[CODEX] +    await dashboard.goto();
[CODEX] +    await expect(dashboard.header).toContainText("Workspace Overview");
[CODEX] +  });
[CODEX] +});
[CODEX] +```
[CODEX] +
[CODEX] +## Debugging & Diagnostics
[CODEX] +
[CODEX] +- **Trace Viewer**: Re-run failing tests with `npx playwright test --trace on-first-retry` to collect DOM snapshots, network logs, and console output.
[CODEX] +- **Video & screenshots**: Enable via `use: { video: "retain-on-failure", screenshot: "only-on-failure" }` either per test or globally in `playwright.config.ts`.
[CODEX] +- **Console logging**: Place strategic `console.log` statements in specs or helpers when investigating flaky behavior. Remove them once resolved to keep logs clean.
[CODEX] +- **Network mocking**: Stub GraphQL or REST endpoints with `page.route` for deterministic results when backend data is unavailable. Maintain mocks under `playwright/helpers/network`.
[CODEX] +
[CODEX] +When a test flakes, capture the trace, verify selectors still match the rendered UI, and ensure required feature flags are enabled for the environment.
[CODEX] +
[CODEX] +## Continuous Integration
[CODEX] +
[CODEX] +- CI pipelines call `npx playwright test` with the same configuration. Ensure new specs respect the single-worker execution configuration (`workers: 1`) unless you explicitly parallelize them.
[CODEX] +- Store credentials (username, password, URL) in the CI secret store. The setup project fails fast if they are missing.
[CODEX] +- Upload `test-results/` (HTML reporter output) as an artifact for post-run inspection.
[CODEX] +
[CODEX] +Before merging, run the suite locally or in a dry-run environment to catch environment-specific regressions early.
[CODEX] +
[CODEX] +## Reference Material
[CODEX] +
[CODEX] +- [Playwright Configuration](../playwright.config.ts)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +- [Testing Guide (unit + integration)](./TEST-README.md)
[CODEX] +- [Implementation Guide](./implementation-guide.md)
[CODEX] +- [Official Playwright Docs](https://playwright.dev/docs/intro)
[CODEX] +
[CODEX] +Keep this guide up to date whenever the test harness, authentication strategy, or project layout changes. New contributors should be able to set up Playwright using only this document.
[CODEX] thinking
[CODEX] **Updating README.md documentation link**
[CODEX] file update
[CODEX] M /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6/README.md
[CODEX] @@ -241,4 +241,4 @@
[CODEX] -[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] -[Link to Comprehensive Documentation](../DOCUMENTATION.md)
[CODEX] +[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] +[Documentation Hub](./DOCUMENTATION.md)
[CODEX] apply_patch(auto_approved=true) exited 0 in 48ms:
[CODEX] Success. Updated the following files:
[CODEX] M README.md
[CODEX] file update:
[CODEX] diff --git a/DOCUMENTATION.md b/DOCUMENTATION.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e08ed0b3ff8c2fbb63dc3ee675405d59841b6a10
[CODEX] --- /dev/null
[CODEX] +++ b/DOCUMENTATION.md
[CODEX] @@ -0,0 +1,81 @@
[CODEX] +# Vurvey Web Manager Documentation Hub
[CODEX] +
[CODEX] +This hub ties together the architecture, development workflows, and testing resources for the Vurvey Web Manager. Start here for a narrated overview, then dive into the linked guides for deeper detail.
[CODEX] +
[CODEX] +- [Quick Start](#quick-start)
[CODEX] +- [Architecture at a Glance](#architecture-at-a-glance)
[CODEX] +- [Implementation Deep Dive](#implementation-deep-dive)
[CODEX] +- [Testing & Quality Assurance](#testing--quality-assurance)
[CODEX] +- [Operational Playbooks](#operational-playbooks)
[CODEX] +- [Documentation Index](#documentation-index)
[CODEX] +
[CODEX] +## Quick Start
[CODEX] +
[CODEX] +| Task | Command / Resource |
[CODEX] +| --- | --- |
[CODEX] +| Install dependencies | `npm ci` |
[CODEX] +| Run the dev server | `npm start` (defaults to `http://localhost:5050`) |
[CODEX] +| Type-check | `npm run type-check` |
[CODEX] +| Validate GraphQL documents | `npm run validate:graphql` |
[CODEX] +| Run unit/integration tests | `npm run test:unit` |
[CODEX] +| Run Playwright E2E tests | `npm run test:e2e` |
[CODEX] +| Lint source + tests | `npm run lint` |
[CODEX] +
[CODEX] +Environment variables (Firebase, GraphQL endpoint, feature flags) are defined in `.env`. See `docs/README.md#environment-variables` for the full list.
[CODEX] +
[CODEX] +## Architecture at a Glance
[CODEX] +
[CODEX] +- React 18 + TypeScript rendered through Vite.
[CODEX] +- Routing handled via `react-router-dom` with workspace-aware helpers.
[CODEX] +- GraphQL powered by Apollo Client (HTTP + WebSocket links) and LaunchDarkly/OpenFeature feature flag providers.
[CODEX] +- State spans React Contexts, Apollo cache, and reducer-driven component state.
[CODEX] +- Styling leverages SCSS modules and a shared component library under `src/shared`.
[CODEX] +
[CODEX] +Review the [Implementation Guide](docs/implementation-guide.md) for a walkthrough of providers, feature modules, and architectural conventions.
[CODEX] +
[CODEX] +## Implementation Deep Dive
[CODEX] +
[CODEX] +| Topic | Summary |
[CODEX] +| --- | --- |
[CODEX] +| [Implementation Guide](docs/implementation-guide.md) | Entry points, provider stack, routing, feature ownership, build tooling. |
[CODEX] +| [Project Structure](docs/project-structure.md) | Directory breakdown and best practices for adding new files. |
[CODEX] +| [State Management](docs/state-management.md) | Contexts, reducers, and caching strategies. |
[CODEX] +| [GraphQL Integration](docs/graphql-integration.md) | Query organization, code generation, and cache policies. |
[CODEX] +| [Custom Hooks](docs/custom-hooks.md) | Reusable hooks available across features. |
[CODEX] +| [Workflow Builder Guide](docs/workflow-builder-guide.md) | Deep dive into the workflow module architecture. |
[CODEX] +
[CODEX] +When implementing new features, align with the patterns documented in these guides and update them if responsibilities shift.
[CODEX] +
[CODEX] +## Testing & Quality Assurance
[CODEX] +
[CODEX] +- [Playwright Testing Guide](docs/playwright-testing-guide.md) â€“ Environment setup, authentication strategy, authoring conventions, and debugging tips.
[CODEX] +- [E2E Testing Patterns](docs/e2e-testing-patterns.md) â€“ Hard-won lessons for resilient selectors and flows.
[CODEX] +- [Testing Guide](docs/TEST-README.md) â€“ Vitest commands, coverage expectations, and mocking strategies.
[CODEX] +- Unit tests live beside implementation files. E2E specs live under `playwright/tests/`. Follow the documented fixtures/page-object approach for consistency.
[CODEX] +
[CODEX] +## Operational Playbooks
[CODEX] +
[CODEX] +- [Authentication](docs/authentication.md) â€“ Firebase sign-in flows and session persistence.
[CODEX] +- [Core Features](docs/core-features.md) â€“ Feature overviews for stakeholders and QA.
[CODEX] +- [Routes](docs/routes.md) â€“ Navigation map with workspace/context rules.
[CODEX] +- [Smooth Streaming](docs/smooth-streaming.md) & [Chat Streaming](docs/chat-streaming.md) â€“ Real-time infrastructure details.
[CODEX] +- [Test Resilience Strategy](docs/test-resilience-strategy.md) â€“ Stabilization techniques for automated suites.
[CODEX] +
[CODEX] +These playbooks help new engineers and QA members ramp up quickly on specific domains.
[CODEX] +
[CODEX] +## Documentation Index
[CODEX] +
[CODEX] +All documentation lives under the `docs/` directory:
[CODEX] +
[CODEX] +- [docs/README.md](docs/README.md) â€“ Entry point with setup instructions.
[CODEX] +- [docs/components.md](docs/components.md) â€“ Shared component catalogue.
[CODEX] +- [docs/routes.md](docs/routes.md) â€“ Application routing map.
[CODEX] +- [docs/core-features.md](docs/core-features.md) â€“ High-level feature descriptions.
[CODEX] +- [docs/workflow-builder-guide.md](docs/workflow-builder-guide.md) â€“ Workflow builder architecture.
[CODEX] +- [docs/playwright-testing-guide.md](docs/playwright-testing-guide.md) â€“ Comprehensive Playwright usage.
[CODEX] +- [docs/implementation-guide.md](docs/implementation-guide.md) â€“ Frontend implementation detail.
[CODEX] +- [docs/authentication.md](docs/authentication.md) â€“ Auth flows and state storage.
[CODEX] +- [docs/e2e-testing-patterns.md](docs/e2e-testing-patterns.md) â€“ Resilient test strategies.
[CODEX] +- [docs/TEST-README.md](docs/TEST-README.md) â€“ Unit and integration testing commands.
[CODEX] +
[CODEX] +Keep this hub updated as we introduce new docs or migrate content. If a guide becomes outdated, link directly to its successor or fold it into a more relevant document.
[CODEX] diff --git a/README.md b/README.md
[CODEX] index fecb22bce7791f926108dab947b93e75eaa022c7..09e58074104c565a3b4c29c33b94cf57fba373aa
[CODEX] --- a/README.md
[CODEX] +++ b/README.md
[CODEX] @@ -239,8 +239,8 @@
[CODEX] Vurvey Web Manager is the frontend component of the Vurvey platform. It works in conjunction with the Vurvey API backend to provide a complete solution for video-based consumer feedback.
[CODEX] -[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] -[Link to Comprehensive Documentation](../DOCUMENTATION.md)
[CODEX] +[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] +[Documentation Hub](./DOCUMENTATION.md)
[CODEX] ## Setup
[CODEX] diff --git a/docs/README.md b/docs/README.md
[CODEX] index 174c521a012dbbb5ef957dfc29360c9b697c7b6e..5a56517cd1e90833bbcb9dad65d7cb3d620b14c8
[CODEX] --- a/docs/README.md
[CODEX] +++ b/docs/README.md
[CODEX] @@ -19,11 +19,13 @@
[CODEX] ### Getting Started
[CODEX] +- [Implementation Guide](./implementation-guide.md) - How the application is assembled end-to-end
[CODEX] - [Project Structure](./project-structure.md) - Codebase organization
[CODEX] - [Authentication](./authentication.md) - Auth system and user management
[CODEX] - [State Management](./state-management.md) - Context and data flow
[CODEX] - [Routes](./routes.md) - Routing structure and navigation
[CODEX] - [Components](./components.md) - Component library and patterns
[CODEX] +- [Playwright Testing Guide](./playwright-testing-guide.md) - Full Playwright setup and authoring guide
[CODEX] ### Features
[CODEX] @@ -147,6 +149,7 @@
[CODEX] ```
[CODEX] LOGIN_USERNAME="your_test_email"
[CODEX] LOGIN_PASSWORD="your_test_password"
[CODEX] +URL="http://localhost:5050"
[CODEX] ```
[CODEX] ## Best Practices
[CODEX] @@ -181,3 +184,4 @@
[CODEX] - [Playwright Documentation](https://playwright.dev)
[CODEX] - [Apollo Client Documentation](https://www.apollographql.com/docs/react)
[CODEX] - [React Documentation](https://react.dev)
[CODEX] +- [Documentation Hub](../DOCUMENTATION.md) for an index of project guides
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] diff --git a/docs/playwright-testing-guide.md b/docs/playwright-testing-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..acbab280a49d446cc89ce7ea1e6de422380736ca
[CODEX] --- /dev/null
[CODEX] +++ b/docs/playwright-testing-guide.md
[CODEX] @@ -0,0 +1,161 @@
[CODEX] +# Playwright Testing Guide
[CODEX] +
[CODEX] +This guide explains how to configure, run, and extend the Playwright end-to-end test suite for Vurvey Web Manager.
[CODEX] +
[CODEX] +- [Overview](#overview)
[CODEX] +- [Directory Layout](#directory-layout)
[CODEX] +- [Environment Setup](#environment-setup)
[CODEX] +- [Running Tests](#running-tests)
[CODEX] +- [Authentication Workflow](#authentication-workflow)
[CODEX] +- [Writing & Organizing Tests](#writing--organizing-tests)
[CODEX] +- [Debugging & Diagnostics](#debugging--diagnostics)
[CODEX] +- [Continuous Integration](#continuous-integration)
[CODEX] +- [Reference Material](#reference-material)
[CODEX] +
[CODEX] +## Overview
[CODEX] +
[CODEX] +Playwright exercises the full React application in a Chromium browser using the configuration defined in `playwright.config.ts`. Tests rely on Firebase authentication, Apollo GraphQL, and feature flags, so a stable backend environment and test credentials are required.
[CODEX] +
[CODEX] +Key characteristics:
[CODEX] +
[CODEX] +- Tests live in `playwright/tests/*.spec.ts`.
[CODEX] +- A dedicated `setup` project seeds authentication (`auth.setup.ts`) and persists storage state to `playwright/.auth/user.json`.
[CODEX] +- Default executions run headless Chromium with `slowMo: 50` to reduce flakiness; override these options when debugging.
[CODEX] +
[CODEX] +## Directory Layout
[CODEX] +
[CODEX] +```
[CODEX] +playwright/
[CODEX] +â”œâ”€â”€ fixtures/                 # Test data assets (clips, csv, pdf, images)
[CODEX] +â”œâ”€â”€ helpers/                  # Utility helpers (authentication, navigation)
[CODEX] +â”œâ”€â”€ page-objects/             # Page object abstractions for complex flows
[CODEX] +â”œâ”€â”€ tests/                    # Spec files + global setup (auth.setup.ts)
[CODEX] +â”œâ”€â”€ env.d.ts                  # Type declarations for Playwright globals
[CODEX] +â””â”€â”€ README.md                 # High-level summary (links back to this guide)
[CODEX] +```
[CODEX] +
[CODEX] +Keep common logic in helpers or page objects instead of duplicating it inside specs. Fixtures should hold deterministic assets that can be reused across scenarios.
[CODEX] +
[CODEX] +## Environment Setup
[CODEX] +
[CODEX] +1. **Install dependencies**
[CODEX] +
[CODEX] +   ```bash
[CODEX] +   npm ci
[CODEX] +   npx playwright install
[CODEX] +   ```
[CODEX] +
[CODEX] +2. **Configure environment variables**
[CODEX] +
[CODEX] +   - Create `./playwright/.env` with the fields referenced in tests:
[CODEX] +
[CODEX] +     ```ini
[CODEX] +     URL=http://localhost:5050
[CODEX] +     LOGIN_USERNAME=tester@example.com
[CODEX] +     LOGIN_PASSWORD=super-secret
[CODEX] +     ```
[CODEX] +
[CODEX] +   - Variables defined in the repository root `.env` are also loaded. `URL` must match the origin where the web manager is running.
[CODEX] +
[CODEX] +3. **Launch the application backend**
[CODEX] +
[CODEX] +   - Ensure the Vurvey API and any dependent services are running; Playwright interacts with the live stack.
[CODEX] +   - Start the web manager locally with `npm start` or point `URL` at a staging environment.
[CODEX] +
[CODEX] +4. **Seed authentication state**
[CODEX] +
[CODEX] +   - The first test run invokes `auth.setup.ts`, which stores Firebase credentials in IndexedDB and writes a Playwright storage file (`playwright/.auth/user.json`).
[CODEX] +   - This file is reused by dependent projects so subsequent tests start in an authenticated session.
[CODEX] +
[CODEX] +## Running Tests
[CODEX] +
[CODEX] +Common commands:
[CODEX] +
[CODEX] +```bash
[CODEX] +# Run the full E2E suite
[CODEX] +npx playwright test
[CODEX] +
[CODEX] +# Run a specific spec
[CODEX] +npx playwright test playwright/tests/navigation.spec.ts
[CODEX] +
[CODEX] +# Filter by title
[CODEX] +npx playwright test --grep "@smoke"
[CODEX] +
[CODEX] +# Headed (visible) mode
[CODEX] +npx playwright test --headed
[CODEX] +
[CODEX] +# Debug mode with inspector
[CODEX] +npx playwright test --debug
[CODEX] +
[CODEX] +# Use the Playwright UI
[CODEX] +npx playwright test --ui
[CODEX] +```
[CODEX] +
[CODEX] +Project configuration (browser, base URL, reporters) lives in `playwright.config.ts`. Edit that file to add new projects (e.g., Firefox coverage) or alternative reporters.
[CODEX] +
[CODEX] +## Authentication Workflow
[CODEX] +
[CODEX] +Authentication uses Firebase persistence inside IndexedDB:
[CODEX] +
[CODEX] +1. `auth.setup.ts` logs in through the UI using `LOGIN_USERNAME` and `LOGIN_PASSWORD`.
[CODEX] +2. The helper `saveFirebaseAuthData` captures Firebase data from IndexedDB and writes it to `localStorage`.
[CODEX] +3. The storage state is exported to `playwright/.auth/user.json`.
[CODEX] +4. Individual specs call `restoreFirebaseAuthData` via helper utilities before navigating, ensuring a valid session without re-running the login flow.
[CODEX] +
[CODEX] +If you see `No auth data found in localStorage`, run the setup project again (`npx playwright test --project setup`). When credentials rotate, delete `playwright/.auth/user.json` and re-run the suite.
[CODEX] +
[CODEX] +## Writing & Organizing Tests
[CODEX] +
[CODEX] +- **Use fixtures**: Import reusable flows (e.g., `authenticate`) from `playwright/helpers`. Define domain-specific fixtures when a scenario needs shared setup and teardown.
[CODEX] +- **Prefer page objects**: Complex interactions such as the workflow builder or agent editor should be encapsulated in `playwright/page-objects` classes. Create methods that describe user intent (`workflowBuilder.publishFlow()`), not DOM mechanics.
[CODEX] +- **Selectors**: Lean on accessible selectors (`getByRole`, `getByLabel`, `getByTestId`). Fall back to data attributes when elements lack semantic handles. Avoid brittle CSS selectors.
[CODEX] +- **Organization**: Group related specs in `test.describe`. Tag critical smoke tests with `@smoke` for quick feedback loops.
[CODEX] +- **Time-sensitive flows**: Use `await expect(...).toBeVisible({ timeout: 30_000 })` for network-heavy screens. The global `expect` timeout already defaults to 30 seconds; override locally when necessary.
[CODEX] +- **Artifacts**: Use `test.info().attach` to capture domain-specific logs. Screenshots happen automatically on failure, but explicit captures help with mid-test diagnostics.
[CODEX] +
[CODEX] +Example skeleton:
[CODEX] +
[CODEX] +```ts
[CODEX] +import {test, expect} from "@playwright/test";
[CODEX] +import {authenticate} from "../helpers/authentication";
[CODEX] +import {DashboardPage} from "../page-objects/dashboard-page";
[CODEX] +
[CODEX] +test.describe("Dashboard", () => {
[CODEX] +  test.beforeEach(async ({page}) => {
[CODEX] +    await authenticate(page);
[CODEX] +  });
[CODEX] +
[CODEX] +  test("shows the active workspace summary @smoke", async ({page}) => {
[CODEX] +    const dashboard = new DashboardPage(page);
[CODEX] +    await dashboard.goto();
[CODEX] +    await expect(dashboard.header).toContainText("Workspace Overview");
[CODEX] +  });
[CODEX] +});
[CODEX] +```
[CODEX] +
[CODEX] +## Debugging & Diagnostics
[CODEX] +
[CODEX] +- **Trace Viewer**: Re-run failing tests with `npx playwright test --trace on-first-retry` to collect DOM snapshots, network logs, and console output.
[CODEX] +- **Video & screenshots**: Enable via `use: { video: "retain-on-failure", screenshot: "only-on-failure" }` either per test or globally in `playwright.config.ts`.
[CODEX] +- **Console logging**: Place strategic `console.log` statements in specs or helpers when investigating flaky behavior. Remove them once resolved to keep logs clean.
[CODEX] +- **Network mocking**: Stub GraphQL or REST endpoints with `page.route` for deterministic results when backend data is unavailable. Maintain mocks under `playwright/helpers/network`.
[CODEX] +
[CODEX] +When a test flakes, capture the trace, verify selectors still match the rendered UI, and ensure required feature flags are enabled for the environment.
[CODEX] +
[CODEX] +## Continuous Integration
[CODEX] +
[CODEX] +- CI pipelines call `npx playwright test` with the same configuration. Ensure new specs respect the single-worker execution configuration (`workers: 1`) unless you explicitly parallelize them.
[CODEX] +- Store credentials (username, password, URL) in the CI secret store. The setup project fails fast if they are missing.
[CODEX] +- Upload `test-results/` (HTML reporter output) as an artifact for post-run inspection.
[CODEX] +
[CODEX] +Before merging, run the suite locally or in a dry-run environment to catch environment-specific regressions early.
[CODEX] +
[CODEX] +## Reference Material
[CODEX] +
[CODEX] +- [Playwright Configuration](../playwright.config.ts)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +- [Testing Guide (unit + integration)](./TEST-README.md)
[CODEX] +- [Implementation Guide](./implementation-guide.md)
[CODEX] +- [Official Playwright Docs](https://playwright.dev/docs/intro)
[CODEX] +
[CODEX] +Keep this guide up to date whenever the test harness, authentication strategy, or project layout changes. New contributors should be able to set up Playwright using only this document.
[CODEX] file update:
[CODEX] diff --git a/DOCUMENTATION.md b/DOCUMENTATION.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e08ed0b3ff8c2fbb63dc3ee675405d59841b6a10
[CODEX] --- /dev/null
[CODEX] +++ b/DOCUMENTATION.md
[CODEX] @@ -0,0 +1,81 @@
[CODEX] +# Vurvey Web Manager Documentation Hub
[CODEX] +
[CODEX] +This hub ties together the architecture, development workflows, and testing resources for the Vurvey Web Manager. Start here for a narrated overview, then dive into the linked guides for deeper detail.
[CODEX] +
[CODEX] +- [Quick Start](#quick-start)
[CODEX] +- [Architecture at a Glance](#architecture-at-a-glance)
[CODEX] +- [Implementation Deep Dive](#implementation-deep-dive)
[CODEX] +- [Testing & Quality Assurance](#testing--quality-assurance)
[CODEX] +- [Operational Playbooks](#operational-playbooks)
[CODEX] +- [Documentation Index](#documentation-index)
[CODEX] +
[CODEX] +## Quick Start
[CODEX] +
[CODEX] +| Task | Command / Resource |
[CODEX] +| --- | --- |
[CODEX] +| Install dependencies | `npm ci` |
[CODEX] +| Run the dev server | `npm start` (defaults to `http://localhost:5050`) |
[CODEX] +| Type-check | `npm run type-check` |
[CODEX] +| Validate GraphQL documents | `npm run validate:graphql` |
[CODEX] +| Run unit/integration tests | `npm run test:unit` |
[CODEX] +| Run Playwright E2E tests | `npm run test:e2e` |
[CODEX] +| Lint source + tests | `npm run lint` |
[CODEX] +
[CODEX] +Environment variables (Firebase, GraphQL endpoint, feature flags) are defined in `.env`. See `docs/README.md#environment-variables` for the full list.
[CODEX] +
[CODEX] +## Architecture at a Glance
[CODEX] +
[CODEX] +- React 18 + TypeScript rendered through Vite.
[CODEX] +- Routing handled via `react-router-dom` with workspace-aware helpers.
[CODEX] +- GraphQL powered by Apollo Client (HTTP + WebSocket links) and LaunchDarkly/OpenFeature feature flag providers.
[CODEX] +- State spans React Contexts, Apollo cache, and reducer-driven component state.
[CODEX] +- Styling leverages SCSS modules and a shared component library under `src/shared`.
[CODEX] +
[CODEX] +Review the [Implementation Guide](docs/implementation-guide.md) for a walkthrough of providers, feature modules, and architectural conventions.
[CODEX] +
[CODEX] +## Implementation Deep Dive
[CODEX] +
[CODEX] +| Topic | Summary |
[CODEX] +| --- | --- |
[CODEX] +| [Implementation Guide](docs/implementation-guide.md) | Entry points, provider stack, routing, feature ownership, build tooling. |
[CODEX] +| [Project Structure](docs/project-structure.md) | Directory breakdown and best practices for adding new files. |
[CODEX] +| [State Management](docs/state-management.md) | Contexts, reducers, and caching strategies. |
[CODEX] +| [GraphQL Integration](docs/graphql-integration.md) | Query organization, code generation, and cache policies. |
[CODEX] +| [Custom Hooks](docs/custom-hooks.md) | Reusable hooks available across features. |
[CODEX] +| [Workflow Builder Guide](docs/workflow-builder-guide.md) | Deep dive into the workflow module architecture. |
[CODEX] +
[CODEX] +When implementing new features, align with the patterns documented in these guides and update them if responsibilities shift.
[CODEX] +
[CODEX] +## Testing & Quality Assurance
[CODEX] +
[CODEX] +- [Playwright Testing Guide](docs/playwright-testing-guide.md) â€“ Environment setup, authentication strategy, authoring conventions, and debugging tips.
[CODEX] +- [E2E Testing Patterns](docs/e2e-testing-patterns.md) â€“ Hard-won lessons for resilient selectors and flows.
[CODEX] +- [Testing Guide](docs/TEST-README.md) â€“ Vitest commands, coverage expectations, and mocking strategies.
[CODEX] +- Unit tests live beside implementation files. E2E specs live under `playwright/tests/`. Follow the documented fixtures/page-object approach for consistency.
[CODEX] +
[CODEX] +## Operational Playbooks
[CODEX] +
[CODEX] +- [Authentication](docs/authentication.md) â€“ Firebase sign-in flows and session persistence.
[CODEX] +- [Core Features](docs/core-features.md) â€“ Feature overviews for stakeholders and QA.
[CODEX] +- [Routes](docs/routes.md) â€“ Navigation map with workspace/context rules.
[CODEX] +- [Smooth Streaming](docs/smooth-streaming.md) & [Chat Streaming](docs/chat-streaming.md) â€“ Real-time infrastructure details.
[CODEX] +- [Test Resilience Strategy](docs/test-resilience-strategy.md) â€“ Stabilization techniques for automated suites.
[CODEX] +
[CODEX] +These playbooks help new engineers and QA members ramp up quickly on specific domains.
[CODEX] +
[CODEX] +## Documentation Index
[CODEX] +
[CODEX] +All documentation lives under the `docs/` directory:
[CODEX] +
[CODEX] +- [docs/README.md](docs/README.md) â€“ Entry point with setup instructions.
[CODEX] +- [docs/components.md](docs/components.md) â€“ Shared component catalogue.
[CODEX] +- [docs/routes.md](docs/routes.md) â€“ Application routing map.
[CODEX] +- [docs/core-features.md](docs/core-features.md) â€“ High-level feature descriptions.
[CODEX] +- [docs/workflow-builder-guide.md](docs/workflow-builder-guide.md) â€“ Workflow builder architecture.
[CODEX] +- [docs/playwright-testing-guide.md](docs/playwright-testing-guide.md) â€“ Comprehensive Playwright usage.
[CODEX] +- [docs/implementation-guide.md](docs/implementation-guide.md) â€“ Frontend implementation detail.
[CODEX] +- [docs/authentication.md](docs/authentication.md) â€“ Auth flows and state storage.
[CODEX] +- [docs/e2e-testing-patterns.md](docs/e2e-testing-patterns.md) â€“ Resilient test strategies.
[CODEX] +- [docs/TEST-README.md](docs/TEST-README.md) â€“ Unit and integration testing commands.
[CODEX] +
[CODEX] +Keep this hub updated as we introduce new docs or migrate content. If a guide becomes outdated, link directly to its successor or fold it into a more relevant document.
[CODEX] diff --git a/README.md b/README.md
[CODEX] index fecb22bce7791f926108dab947b93e75eaa022c7..09e58074104c565a3b4c29c33b94cf57fba373aa
[CODEX] --- a/README.md
[CODEX] +++ b/README.md
[CODEX] @@ -239,8 +239,8 @@
[CODEX] Vurvey Web Manager is the frontend component of the Vurvey platform. It works in conjunction with the Vurvey API backend to provide a complete solution for video-based consumer feedback.
[CODEX] -[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] -[Link to Comprehensive Documentation](../DOCUMENTATION.md)
[CODEX] +[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] +[Documentation Hub](./DOCUMENTATION.md)
[CODEX] ## Setup
[CODEX] diff --git a/docs/README.md b/docs/README.md
[CODEX] index 174c521a012dbbb5ef957dfc29360c9b697c7b6e..5a56517cd1e90833bbcb9dad65d7cb3d620b14c8
[CODEX] --- a/docs/README.md
[CODEX] +++ b/docs/README.md
[CODEX] @@ -19,11 +19,13 @@
[CODEX] ### Getting Started
[CODEX] +- [Implementation Guide](./implementation-guide.md) - How the application is assembled end-to-end
[CODEX] - [Project Structure](./project-structure.md) - Codebase organization
[CODEX] - [Authentication](./authentication.md) - Auth system and user management
[CODEX] - [State Management](./state-management.md) - Context and data flow
[CODEX] - [Routes](./routes.md) - Routing structure and navigation
[CODEX] - [Components](./components.md) - Component library and patterns
[CODEX] +- [Playwright Testing Guide](./playwright-testing-guide.md) - Full Playwright setup and authoring guide
[CODEX] ### Features
[CODEX] @@ -147,6 +149,7 @@
[CODEX] ```
[CODEX] LOGIN_USERNAME="your_test_email"
[CODEX] LOGIN_PASSWORD="your_test_password"
[CODEX] +URL="http://localhost:5050"
[CODEX] ```
[CODEX] ## Best Practices
[CODEX] @@ -181,3 +184,4 @@
[CODEX] - [Playwright Documentation](https://playwright.dev)
[CODEX] - [Apollo Client Documentation](https://www.apollographql.com/docs/react)
[CODEX] - [React Documentation](https://react.dev)
[CODEX] +- [Documentation Hub](../DOCUMENTATION.md) for an index of project guides
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] diff --git a/docs/playwright-testing-guide.md b/docs/playwright-testing-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..acbab280a49d446cc89ce7ea1e6de422380736ca
[CODEX] --- /dev/null
[CODEX] +++ b/docs/playwright-testing-guide.md
[CODEX] @@ -0,0 +1,161 @@
[CODEX] +# Playwright Testing Guide
[CODEX] +
[CODEX] +This guide explains how to configure, run, and extend the Playwright end-to-end test suite for Vurvey Web Manager.
[CODEX] +
[CODEX] +- [Overview](#overview)
[CODEX] +- [Directory Layout](#directory-layout)
[CODEX] +- [Environment Setup](#environment-setup)
[CODEX] +- [Running Tests](#running-tests)
[CODEX] +- [Authentication Workflow](#authentication-workflow)
[CODEX] +- [Writing & Organizing Tests](#writing--organizing-tests)
[CODEX] +- [Debugging & Diagnostics](#debugging--diagnostics)
[CODEX] +- [Continuous Integration](#continuous-integration)
[CODEX] +- [Reference Material](#reference-material)
[CODEX] +
[CODEX] +## Overview
[CODEX] +
[CODEX] +Playwright exercises the full React application in a Chromium browser using the configuration defined in `playwright.config.ts`. Tests rely on Firebase authentication, Apollo GraphQL, and feature flags, so a stable backend environment and test credentials are required.
[CODEX] +
[CODEX] +Key characteristics:
[CODEX] +
[CODEX] +- Tests live in `playwright/tests/*.spec.ts`.
[CODEX] +- A dedicated `setup` project seeds authentication (`auth.setup.ts`) and persists storage state to `playwright/.auth/user.json`.
[CODEX] +- Default executions run headless Chromium with `slowMo: 50` to reduce flakiness; override these options when debugging.
[CODEX] +
[CODEX] +## Directory Layout
[CODEX] +
[CODEX] +```
[CODEX] +playwright/
[CODEX] +â”œâ”€â”€ fixtures/                 # Test data assets (clips, csv, pdf, images)
[CODEX] +â”œâ”€â”€ helpers/                  # Utility helpers (authentication, navigation)
[CODEX] +â”œâ”€â”€ page-objects/             # Page object abstractions for complex flows
[CODEX] +â”œâ”€â”€ tests/                    # Spec files + global setup (auth.setup.ts)
[CODEX] +â”œâ”€â”€ env.d.ts                  # Type declarations for Playwright globals
[CODEX] +â””â”€â”€ README.md                 # High-level summary (links back to this guide)
[CODEX] +```
[CODEX] +
[CODEX] +Keep common logic in helpers or page objects instead of duplicating it inside specs. Fixtures should hold deterministic assets that can be reused across scenarios.
[CODEX] +
[CODEX] +## Environment Setup
[CODEX] +
[CODEX] +1. **Install dependencies**
[CODEX] +
[CODEX] +   ```bash
[CODEX] +   npm ci
[CODEX] +   npx playwright install
[CODEX] +   ```
[CODEX] +
[CODEX] +2. **Configure environment variables**
[CODEX] +
[CODEX] +   - Create `./playwright/.env` with the fields referenced in tests:
[CODEX] +
[CODEX] +     ```ini
[CODEX] +     URL=http://localhost:5050
[CODEX] +     LOGIN_USERNAME=tester@example.com
[CODEX] +     LOGIN_PASSWORD=super-secret
[CODEX] +     ```
[CODEX] +
[CODEX] +   - Variables defined in the repository root `.env` are also loaded. `URL` must match the origin where the web manager is running.
[CODEX] +
[CODEX] +3. **Launch the application backend**
[CODEX] +
[CODEX] +   - Ensure the Vurvey API and any dependent services are running; Playwright interacts with the live stack.
[CODEX] +   - Start the web manager locally with `npm start` or point `URL` at a staging environment.
[CODEX] +
[CODEX] +4. **Seed authentication state**
[CODEX] +
[CODEX] +   - The first test run invokes `auth.setup.ts`, which stores Firebase credentials in IndexedDB and writes a Playwright storage file (`playwright/.auth/user.json`).
[CODEX] +   - This file is reused by dependent projects so subsequent tests start in an authenticated session.
[CODEX] +
[CODEX] +## Running Tests
[CODEX] +
[CODEX] +Common commands:
[CODEX] +
[CODEX] +```bash
[CODEX] +# Run the full E2E suite
[CODEX] +npx playwright test
[CODEX] +
[CODEX] +# Run a specific spec
[CODEX] +npx playwright test playwright/tests/navigation.spec.ts
[CODEX] +
[CODEX] +# Filter by title
[CODEX] +npx playwright test --grep "@smoke"
[CODEX] +
[CODEX] +# Headed (visible) mode
[CODEX] +npx playwright test --headed
[CODEX] +
[CODEX] +# Debug mode with inspector
[CODEX] +npx playwright test --debug
[CODEX] +
[CODEX] +# Use the Playwright UI
[CODEX] +npx playwright test --ui
[CODEX] +```
[CODEX] +
[CODEX] +Project configuration (browser, base URL, reporters) lives in `playwright.config.ts`. Edit that file to add new projects (e.g., Firefox coverage) or alternative reporters.
[CODEX] +
[CODEX] +## Authentication Workflow
[CODEX] +
[CODEX] +Authentication uses Firebase persistence inside IndexedDB:
[CODEX] +
[CODEX] +1. `auth.setup.ts` logs in through the UI using `LOGIN_USERNAME` and `LOGIN_PASSWORD`.
[CODEX] +2. The helper `saveFirebaseAuthData` captures Firebase data from IndexedDB and writes it to `localStorage`.
[CODEX] +3. The storage state is exported to `playwright/.auth/user.json`.
[CODEX] +4. Individual specs call `restoreFirebaseAuthData` via helper utilities before navigating, ensuring a valid session without re-running the login flow.
[CODEX] +
[CODEX] +If you see `No auth data found in localStorage`, run the setup project again (`npx playwright test --project setup`). When credentials rotate, delete `playwright/.auth/user.json` and re-run the suite.
[CODEX] +
[CODEX] +## Writing & Organizing Tests
[CODEX] +
[CODEX] +- **Use fixtures**: Import reusable flows (e.g., `authenticate`) from `playwright/helpers`. Define domain-specific fixtures when a scenario needs shared setup and teardown.
[CODEX] +- **Prefer page objects**: Complex interactions such as the workflow builder or agent editor should be encapsulated in `playwright/page-objects` classes. Create methods that describe user intent (`workflowBuilder.publishFlow()`), not DOM mechanics.
[CODEX] +- **Selectors**: Lean on accessible selectors (`getByRole`, `getByLabel`, `getByTestId`). Fall back to data attributes when elements lack semantic handles. Avoid brittle CSS selectors.
[CODEX] +- **Organization**: Group related specs in `test.describe`. Tag critical smoke tests with `@smoke` for quick feedback loops.
[CODEX] +- **Time-sensitive flows**: Use `await expect(...).toBeVisible({ timeout: 30_000 })` for network-heavy screens. The global `expect` timeout already defaults to 30 seconds; override locally when necessary.
[CODEX] +- **Artifacts**: Use `test.info().attach` to capture domain-specific logs. Screenshots happen automatically on failure, but explicit captures help with mid-test diagnostics.
[CODEX] +
[CODEX] +Example skeleton:
[CODEX] +
[CODEX] +```ts
[CODEX] +import {test, expect} from "@playwright/test";
[CODEX] +import {authenticate} from "../helpers/authentication";
[CODEX] +import {DashboardPage} from "../page-objects/dashboard-page";
[CODEX] +
[CODEX] +test.describe("Dashboard", () => {
[CODEX] +  test.beforeEach(async ({page}) => {
[CODEX] +    await authenticate(page);
[CODEX] +  });
[CODEX] +
[CODEX] +  test("shows the active workspace summary @smoke", async ({page}) => {
[CODEX] +    const dashboard = new DashboardPage(page);
[CODEX] +    await dashboard.goto();
[CODEX] +    await expect(dashboard.header).toContainText("Workspace Overview");
[CODEX] +  });
[CODEX] +});
[CODEX] +```
[CODEX] +
[CODEX] +## Debugging & Diagnostics
[CODEX] +
[CODEX] +- **Trace Viewer**: Re-run failing tests with `npx playwright test --trace on-first-retry` to collect DOM snapshots, network logs, and console output.
[CODEX] +- **Video & screenshots**: Enable via `use: { video: "retain-on-failure", screenshot: "only-on-failure" }` either per test or globally in `playwright.config.ts`.
[CODEX] +- **Console logging**: Place strategic `console.log` statements in specs or helpers when investigating flaky behavior. Remove them once resolved to keep logs clean.
[CODEX] +- **Network mocking**: Stub GraphQL or REST endpoints with `page.route` for deterministic results when backend data is unavailable. Maintain mocks under `playwright/helpers/network`.
[CODEX] +
[CODEX] +When a test flakes, capture the trace, verify selectors still match the rendered UI, and ensure required feature flags are enabled for the environment.
[CODEX] +
[CODEX] +## Continuous Integration
[CODEX] +
[CODEX] +- CI pipelines call `npx playwright test` with the same configuration. Ensure new specs respect the single-worker execution configuration (`workers: 1`) unless you explicitly parallelize them.
[CODEX] +- Store credentials (username, password, URL) in the CI secret store. The setup project fails fast if they are missing.
[CODEX] +- Upload `test-results/` (HTML reporter output) as an artifact for post-run inspection.
[CODEX] +
[CODEX] +Before merging, run the suite locally or in a dry-run environment to catch environment-specific regressions early.
[CODEX] +
[CODEX] +## Reference Material
[CODEX] +
[CODEX] +- [Playwright Configuration](../playwright.config.ts)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +- [Testing Guide (unit + integration)](./TEST-README.md)
[CODEX] +- [Implementation Guide](./implementation-guide.md)
[CODEX] +- [Official Playwright Docs](https://playwright.dev/docs/intro)
[CODEX] +
[CODEX] +Keep this guide up to date whenever the test harness, authentication strategy, or project layout changes. New contributors should be able to set up Playwright using only this document.
[CODEX] thinking
[CODEX] **Updating README with new doc reference**
[CODEX] file update
[CODEX] M /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6/playwright/README.md
[CODEX] @@ -2,2 +2,4 @@
[CODEX] +> **Prefer the canonical [Playwright Testing Guide](../docs/playwright-testing-guide.md)** for the most up-to-date instructions on setup, authoring, and debugging. This file keeps a condensed summary for quick reference.
[CODEX] +
[CODEX] This document provides comprehensive guidance for testing the Vurvey Web Manager application.
[CODEX] apply_patch(auto_approved=true) exited 0 in 53ms:
[CODEX] Success. Updated the following files:
[CODEX] M playwright/README.md
[CODEX] file update:
[CODEX] diff --git a/DOCUMENTATION.md b/DOCUMENTATION.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e08ed0b3ff8c2fbb63dc3ee675405d59841b6a10
[CODEX] --- /dev/null
[CODEX] +++ b/DOCUMENTATION.md
[CODEX] @@ -0,0 +1,81 @@
[CODEX] +# Vurvey Web Manager Documentation Hub
[CODEX] +
[CODEX] +This hub ties together the architecture, development workflows, and testing resources for the Vurvey Web Manager. Start here for a narrated overview, then dive into the linked guides for deeper detail.
[CODEX] +
[CODEX] +- [Quick Start](#quick-start)
[CODEX] +- [Architecture at a Glance](#architecture-at-a-glance)
[CODEX] +- [Implementation Deep Dive](#implementation-deep-dive)
[CODEX] +- [Testing & Quality Assurance](#testing--quality-assurance)
[CODEX] +- [Operational Playbooks](#operational-playbooks)
[CODEX] +- [Documentation Index](#documentation-index)
[CODEX] +
[CODEX] +## Quick Start
[CODEX] +
[CODEX] +| Task | Command / Resource |
[CODEX] +| --- | --- |
[CODEX] +| Install dependencies | `npm ci` |
[CODEX] +| Run the dev server | `npm start` (defaults to `http://localhost:5050`) |
[CODEX] +| Type-check | `npm run type-check` |
[CODEX] +| Validate GraphQL documents | `npm run validate:graphql` |
[CODEX] +| Run unit/integration tests | `npm run test:unit` |
[CODEX] +| Run Playwright E2E tests | `npm run test:e2e` |
[CODEX] +| Lint source + tests | `npm run lint` |
[CODEX] +
[CODEX] +Environment variables (Firebase, GraphQL endpoint, feature flags) are defined in `.env`. See `docs/README.md#environment-variables` for the full list.
[CODEX] +
[CODEX] +## Architecture at a Glance
[CODEX] +
[CODEX] +- React 18 + TypeScript rendered through Vite.
[CODEX] +- Routing handled via `react-router-dom` with workspace-aware helpers.
[CODEX] +- GraphQL powered by Apollo Client (HTTP + WebSocket links) and LaunchDarkly/OpenFeature feature flag providers.
[CODEX] +- State spans React Contexts, Apollo cache, and reducer-driven component state.
[CODEX] +- Styling leverages SCSS modules and a shared component library under `src/shared`.
[CODEX] +
[CODEX] +Review the [Implementation Guide](docs/implementation-guide.md) for a walkthrough of providers, feature modules, and architectural conventions.
[CODEX] +
[CODEX] +## Implementation Deep Dive
[CODEX] +
[CODEX] +| Topic | Summary |
[CODEX] +| --- | --- |
[CODEX] +| [Implementation Guide](docs/implementation-guide.md) | Entry points, provider stack, routing, feature ownership, build tooling. |
[CODEX] +| [Project Structure](docs/project-structure.md) | Directory breakdown and best practices for adding new files. |
[CODEX] +| [State Management](docs/state-management.md) | Contexts, reducers, and caching strategies. |
[CODEX] +| [GraphQL Integration](docs/graphql-integration.md) | Query organization, code generation, and cache policies. |
[CODEX] +| [Custom Hooks](docs/custom-hooks.md) | Reusable hooks available across features. |
[CODEX] +| [Workflow Builder Guide](docs/workflow-builder-guide.md) | Deep dive into the workflow module architecture. |
[CODEX] +
[CODEX] +When implementing new features, align with the patterns documented in these guides and update them if responsibilities shift.
[CODEX] +
[CODEX] +## Testing & Quality Assurance
[CODEX] +
[CODEX] +- [Playwright Testing Guide](docs/playwright-testing-guide.md) â€“ Environment setup, authentication strategy, authoring conventions, and debugging tips.
[CODEX] +- [E2E Testing Patterns](docs/e2e-testing-patterns.md) â€“ Hard-won lessons for resilient selectors and flows.
[CODEX] +- [Testing Guide](docs/TEST-README.md) â€“ Vitest commands, coverage expectations, and mocking strategies.
[CODEX] +- Unit tests live beside implementation files. E2E specs live under `playwright/tests/`. Follow the documented fixtures/page-object approach for consistency.
[CODEX] +
[CODEX] +## Operational Playbooks
[CODEX] +
[CODEX] +- [Authentication](docs/authentication.md) â€“ Firebase sign-in flows and session persistence.
[CODEX] +- [Core Features](docs/core-features.md) â€“ Feature overviews for stakeholders and QA.
[CODEX] +- [Routes](docs/routes.md) â€“ Navigation map with workspace/context rules.
[CODEX] +- [Smooth Streaming](docs/smooth-streaming.md) & [Chat Streaming](docs/chat-streaming.md) â€“ Real-time infrastructure details.
[CODEX] +- [Test Resilience Strategy](docs/test-resilience-strategy.md) â€“ Stabilization techniques for automated suites.
[CODEX] +
[CODEX] +These playbooks help new engineers and QA members ramp up quickly on specific domains.
[CODEX] +
[CODEX] +## Documentation Index
[CODEX] +
[CODEX] +All documentation lives under the `docs/` directory:
[CODEX] +
[CODEX] +- [docs/README.md](docs/README.md) â€“ Entry point with setup instructions.
[CODEX] +- [docs/components.md](docs/components.md) â€“ Shared component catalogue.
[CODEX] +- [docs/routes.md](docs/routes.md) â€“ Application routing map.
[CODEX] +- [docs/core-features.md](docs/core-features.md) â€“ High-level feature descriptions.
[CODEX] +- [docs/workflow-builder-guide.md](docs/workflow-builder-guide.md) â€“ Workflow builder architecture.
[CODEX] +- [docs/playwright-testing-guide.md](docs/playwright-testing-guide.md) â€“ Comprehensive Playwright usage.
[CODEX] +- [docs/implementation-guide.md](docs/implementation-guide.md) â€“ Frontend implementation detail.
[CODEX] +- [docs/authentication.md](docs/authentication.md) â€“ Auth flows and state storage.
[CODEX] +- [docs/e2e-testing-patterns.md](docs/e2e-testing-patterns.md) â€“ Resilient test strategies.
[CODEX] +- [docs/TEST-README.md](docs/TEST-README.md) â€“ Unit and integration testing commands.
[CODEX] +
[CODEX] +Keep this hub updated as we introduce new docs or migrate content. If a guide becomes outdated, link directly to its successor or fold it into a more relevant document.
[CODEX] diff --git a/README.md b/README.md
[CODEX] index fecb22bce7791f926108dab947b93e75eaa022c7..09e58074104c565a3b4c29c33b94cf57fba373aa
[CODEX] --- a/README.md
[CODEX] +++ b/README.md
[CODEX] @@ -239,8 +239,8 @@
[CODEX] Vurvey Web Manager is the frontend component of the Vurvey platform. It works in conjunction with the Vurvey API backend to provide a complete solution for video-based consumer feedback.
[CODEX] -[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] -[Link to Comprehensive Documentation](../DOCUMENTATION.md)
[CODEX] +[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] +[Documentation Hub](./DOCUMENTATION.md)
[CODEX] ## Setup
[CODEX] diff --git a/docs/README.md b/docs/README.md
[CODEX] index 174c521a012dbbb5ef957dfc29360c9b697c7b6e..5a56517cd1e90833bbcb9dad65d7cb3d620b14c8
[CODEX] --- a/docs/README.md
[CODEX] +++ b/docs/README.md
[CODEX] @@ -19,11 +19,13 @@
[CODEX] ### Getting Started
[CODEX] +- [Implementation Guide](./implementation-guide.md) - How the application is assembled end-to-end
[CODEX] - [Project Structure](./project-structure.md) - Codebase organization
[CODEX] - [Authentication](./authentication.md) - Auth system and user management
[CODEX] - [State Management](./state-management.md) - Context and data flow
[CODEX] - [Routes](./routes.md) - Routing structure and navigation
[CODEX] - [Components](./components.md) - Component library and patterns
[CODEX] +- [Playwright Testing Guide](./playwright-testing-guide.md) - Full Playwright setup and authoring guide
[CODEX] ### Features
[CODEX] @@ -147,6 +149,7 @@
[CODEX] ```
[CODEX] LOGIN_USERNAME="your_test_email"
[CODEX] LOGIN_PASSWORD="your_test_password"
[CODEX] +URL="http://localhost:5050"
[CODEX] ```
[CODEX] ## Best Practices
[CODEX] @@ -181,3 +184,4 @@
[CODEX] - [Playwright Documentation](https://playwright.dev)
[CODEX] - [Apollo Client Documentation](https://www.apollographql.com/docs/react)
[CODEX] - [React Documentation](https://react.dev)
[CODEX] +- [Documentation Hub](../DOCUMENTATION.md) for an index of project guides
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] diff --git a/docs/playwright-testing-guide.md b/docs/playwright-testing-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..acbab280a49d446cc89ce7ea1e6de422380736ca
[CODEX] --- /dev/null
[CODEX] +++ b/docs/playwright-testing-guide.md
[CODEX] @@ -0,0 +1,161 @@
[CODEX] +# Playwright Testing Guide
[CODEX] +
[CODEX] +This guide explains how to configure, run, and extend the Playwright end-to-end test suite for Vurvey Web Manager.
[CODEX] +
[CODEX] +- [Overview](#overview)
[CODEX] +- [Directory Layout](#directory-layout)
[CODEX] +- [Environment Setup](#environment-setup)
[CODEX] +- [Running Tests](#running-tests)
[CODEX] +- [Authentication Workflow](#authentication-workflow)
[CODEX] +- [Writing & Organizing Tests](#writing--organizing-tests)
[CODEX] +- [Debugging & Diagnostics](#debugging--diagnostics)
[CODEX] +- [Continuous Integration](#continuous-integration)
[CODEX] +- [Reference Material](#reference-material)
[CODEX] +
[CODEX] +## Overview
[CODEX] +
[CODEX] +Playwright exercises the full React application in a Chromium browser using the configuration defined in `playwright.config.ts`. Tests rely on Firebase authentication, Apollo GraphQL, and feature flags, so a stable backend environment and test credentials are required.
[CODEX] +
[CODEX] +Key characteristics:
[CODEX] +
[CODEX] +- Tests live in `playwright/tests/*.spec.ts`.
[CODEX] +- A dedicated `setup` project seeds authentication (`auth.setup.ts`) and persists storage state to `playwright/.auth/user.json`.
[CODEX] +- Default executions run headless Chromium with `slowMo: 50` to reduce flakiness; override these options when debugging.
[CODEX] +
[CODEX] +## Directory Layout
[CODEX] +
[CODEX] +```
[CODEX] +playwright/
[CODEX] +â”œâ”€â”€ fixtures/                 # Test data assets (clips, csv, pdf, images)
[CODEX] +â”œâ”€â”€ helpers/                  # Utility helpers (authentication, navigation)
[CODEX] +â”œâ”€â”€ page-objects/             # Page object abstractions for complex flows
[CODEX] +â”œâ”€â”€ tests/                    # Spec files + global setup (auth.setup.ts)
[CODEX] +â”œâ”€â”€ env.d.ts                  # Type declarations for Playwright globals
[CODEX] +â””â”€â”€ README.md                 # High-level summary (links back to this guide)
[CODEX] +```
[CODEX] +
[CODEX] +Keep common logic in helpers or page objects instead of duplicating it inside specs. Fixtures should hold deterministic assets that can be reused across scenarios.
[CODEX] +
[CODEX] +## Environment Setup
[CODEX] +
[CODEX] +1. **Install dependencies**
[CODEX] +
[CODEX] +   ```bash
[CODEX] +   npm ci
[CODEX] +   npx playwright install
[CODEX] +   ```
[CODEX] +
[CODEX] +2. **Configure environment variables**
[CODEX] +
[CODEX] +   - Create `./playwright/.env` with the fields referenced in tests:
[CODEX] +
[CODEX] +     ```ini
[CODEX] +     URL=http://localhost:5050
[CODEX] +     LOGIN_USERNAME=tester@example.com
[CODEX] +     LOGIN_PASSWORD=super-secret
[CODEX] +     ```
[CODEX] +
[CODEX] +   - Variables defined in the repository root `.env` are also loaded. `URL` must match the origin where the web manager is running.
[CODEX] +
[CODEX] +3. **Launch the application backend**
[CODEX] +
[CODEX] +   - Ensure the Vurvey API and any dependent services are running; Playwright interacts with the live stack.
[CODEX] +   - Start the web manager locally with `npm start` or point `URL` at a staging environment.
[CODEX] +
[CODEX] +4. **Seed authentication state**
[CODEX] +
[CODEX] +   - The first test run invokes `auth.setup.ts`, which stores Firebase credentials in IndexedDB and writes a Playwright storage file (`playwright/.auth/user.json`).
[CODEX] +   - This file is reused by dependent projects so subsequent tests start in an authenticated session.
[CODEX] +
[CODEX] +## Running Tests
[CODEX] +
[CODEX] +Common commands:
[CODEX] +
[CODEX] +```bash
[CODEX] +# Run the full E2E suite
[CODEX] +npx playwright test
[CODEX] +
[CODEX] +# Run a specific spec
[CODEX] +npx playwright test playwright/tests/navigation.spec.ts
[CODEX] +
[CODEX] +# Filter by title
[CODEX] +npx playwright test --grep "@smoke"
[CODEX] +
[CODEX] +# Headed (visible) mode
[CODEX] +npx playwright test --headed
[CODEX] +
[CODEX] +# Debug mode with inspector
[CODEX] +npx playwright test --debug
[CODEX] +
[CODEX] +# Use the Playwright UI
[CODEX] +npx playwright test --ui
[CODEX] +```
[CODEX] +
[CODEX] +Project configuration (browser, base URL, reporters) lives in `playwright.config.ts`. Edit that file to add new projects (e.g., Firefox coverage) or alternative reporters.
[CODEX] +
[CODEX] +## Authentication Workflow
[CODEX] +
[CODEX] +Authentication uses Firebase persistence inside IndexedDB:
[CODEX] +
[CODEX] +1. `auth.setup.ts` logs in through the UI using `LOGIN_USERNAME` and `LOGIN_PASSWORD`.
[CODEX] +2. The helper `saveFirebaseAuthData` captures Firebase data from IndexedDB and writes it to `localStorage`.
[CODEX] +3. The storage state is exported to `playwright/.auth/user.json`.
[CODEX] +4. Individual specs call `restoreFirebaseAuthData` via helper utilities before navigating, ensuring a valid session without re-running the login flow.
[CODEX] +
[CODEX] +If you see `No auth data found in localStorage`, run the setup project again (`npx playwright test --project setup`). When credentials rotate, delete `playwright/.auth/user.json` and re-run the suite.
[CODEX] +
[CODEX] +## Writing & Organizing Tests
[CODEX] +
[CODEX] +- **Use fixtures**: Import reusable flows (e.g., `authenticate`) from `playwright/helpers`. Define domain-specific fixtures when a scenario needs shared setup and teardown.
[CODEX] +- **Prefer page objects**: Complex interactions such as the workflow builder or agent editor should be encapsulated in `playwright/page-objects` classes. Create methods that describe user intent (`workflowBuilder.publishFlow()`), not DOM mechanics.
[CODEX] +- **Selectors**: Lean on accessible selectors (`getByRole`, `getByLabel`, `getByTestId`). Fall back to data attributes when elements lack semantic handles. Avoid brittle CSS selectors.
[CODEX] +- **Organization**: Group related specs in `test.describe`. Tag critical smoke tests with `@smoke` for quick feedback loops.
[CODEX] +- **Time-sensitive flows**: Use `await expect(...).toBeVisible({ timeout: 30_000 })` for network-heavy screens. The global `expect` timeout already defaults to 30 seconds; override locally when necessary.
[CODEX] +- **Artifacts**: Use `test.info().attach` to capture domain-specific logs. Screenshots happen automatically on failure, but explicit captures help with mid-test diagnostics.
[CODEX] +
[CODEX] +Example skeleton:
[CODEX] +
[CODEX] +```ts
[CODEX] +import {test, expect} from "@playwright/test";
[CODEX] +import {authenticate} from "../helpers/authentication";
[CODEX] +import {DashboardPage} from "../page-objects/dashboard-page";
[CODEX] +
[CODEX] +test.describe("Dashboard", () => {
[CODEX] +  test.beforeEach(async ({page}) => {
[CODEX] +    await authenticate(page);
[CODEX] +  });
[CODEX] +
[CODEX] +  test("shows the active workspace summary @smoke", async ({page}) => {
[CODEX] +    const dashboard = new DashboardPage(page);
[CODEX] +    await dashboard.goto();
[CODEX] +    await expect(dashboard.header).toContainText("Workspace Overview");
[CODEX] +  });
[CODEX] +});
[CODEX] +```
[CODEX] +
[CODEX] +## Debugging & Diagnostics
[CODEX] +
[CODEX] +- **Trace Viewer**: Re-run failing tests with `npx playwright test --trace on-first-retry` to collect DOM snapshots, network logs, and console output.
[CODEX] +- **Video & screenshots**: Enable via `use: { video: "retain-on-failure", screenshot: "only-on-failure" }` either per test or globally in `playwright.config.ts`.
[CODEX] +- **Console logging**: Place strategic `console.log` statements in specs or helpers when investigating flaky behavior. Remove them once resolved to keep logs clean.
[CODEX] +- **Network mocking**: Stub GraphQL or REST endpoints with `page.route` for deterministic results when backend data is unavailable. Maintain mocks under `playwright/helpers/network`.
[CODEX] +
[CODEX] +When a test flakes, capture the trace, verify selectors still match the rendered UI, and ensure required feature flags are enabled for the environment.
[CODEX] +
[CODEX] +## Continuous Integration
[CODEX] +
[CODEX] +- CI pipelines call `npx playwright test` with the same configuration. Ensure new specs respect the single-worker execution configuration (`workers: 1`) unless you explicitly parallelize them.
[CODEX] +- Store credentials (username, password, URL) in the CI secret store. The setup project fails fast if they are missing.
[CODEX] +- Upload `test-results/` (HTML reporter output) as an artifact for post-run inspection.
[CODEX] +
[CODEX] +Before merging, run the suite locally or in a dry-run environment to catch environment-specific regressions early.
[CODEX] +
[CODEX] +## Reference Material
[CODEX] +
[CODEX] +- [Playwright Configuration](../playwright.config.ts)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +- [Testing Guide (unit + integration)](./TEST-README.md)
[CODEX] +- [Implementation Guide](./implementation-guide.md)
[CODEX] +- [Official Playwright Docs](https://playwright.dev/docs/intro)
[CODEX] +
[CODEX] +Keep this guide up to date whenever the test harness, authentication strategy, or project layout changes. New contributors should be able to set up Playwright using only this document.
[CODEX] diff --git a/playwright/README.md b/playwright/README.md
[CODEX] index 58090e78cd0aba7e78a7bd8ce3bf7b7a692ea8ca..02e1939682ff48977eb982bba77319f5e528768a
[CODEX] --- a/playwright/README.md
[CODEX] +++ b/playwright/README.md
[CODEX] @@ -1,5 +1,7 @@
[CODEX] # Vurvey Web Manager Testing Guide
[CODEX] +> **Prefer the canonical [Playwright Testing Guide](../docs/playwright-testing-guide.md)** for the most up-to-date instructions on setup, authoring, and debugging. This file keeps a condensed summary for quick reference.
[CODEX] +
[CODEX] This document provides comprehensive guidance for testing the Vurvey Web Manager application.
[CODEX] ## Overview
[CODEX] file update:
[CODEX] diff --git a/DOCUMENTATION.md b/DOCUMENTATION.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e08ed0b3ff8c2fbb63dc3ee675405d59841b6a10
[CODEX] --- /dev/null
[CODEX] +++ b/DOCUMENTATION.md
[CODEX] @@ -0,0 +1,81 @@
[CODEX] +# Vurvey Web Manager Documentation Hub
[CODEX] +
[CODEX] +This hub ties together the architecture, development workflows, and testing resources for the Vurvey Web Manager. Start here for a narrated overview, then dive into the linked guides for deeper detail.
[CODEX] +
[CODEX] +- [Quick Start](#quick-start)
[CODEX] +- [Architecture at a Glance](#architecture-at-a-glance)
[CODEX] +- [Implementation Deep Dive](#implementation-deep-dive)
[CODEX] +- [Testing & Quality Assurance](#testing--quality-assurance)
[CODEX] +- [Operational Playbooks](#operational-playbooks)
[CODEX] +- [Documentation Index](#documentation-index)
[CODEX] +
[CODEX] +## Quick Start
[CODEX] +
[CODEX] +| Task | Command / Resource |
[CODEX] +| --- | --- |
[CODEX] +| Install dependencies | `npm ci` |
[CODEX] +| Run the dev server | `npm start` (defaults to `http://localhost:5050`) |
[CODEX] +| Type-check | `npm run type-check` |
[CODEX] +| Validate GraphQL documents | `npm run validate:graphql` |
[CODEX] +| Run unit/integration tests | `npm run test:unit` |
[CODEX] +| Run Playwright E2E tests | `npm run test:e2e` |
[CODEX] +| Lint source + tests | `npm run lint` |
[CODEX] +
[CODEX] +Environment variables (Firebase, GraphQL endpoint, feature flags) are defined in `.env`. See `docs/README.md#environment-variables` for the full list.
[CODEX] +
[CODEX] +## Architecture at a Glance
[CODEX] +
[CODEX] +- React 18 + TypeScript rendered through Vite.
[CODEX] +- Routing handled via `react-router-dom` with workspace-aware helpers.
[CODEX] +- GraphQL powered by Apollo Client (HTTP + WebSocket links) and LaunchDarkly/OpenFeature feature flag providers.
[CODEX] +- State spans React Contexts, Apollo cache, and reducer-driven component state.
[CODEX] +- Styling leverages SCSS modules and a shared component library under `src/shared`.
[CODEX] +
[CODEX] +Review the [Implementation Guide](docs/implementation-guide.md) for a walkthrough of providers, feature modules, and architectural conventions.
[CODEX] +
[CODEX] +## Implementation Deep Dive
[CODEX] +
[CODEX] +| Topic | Summary |
[CODEX] +| --- | --- |
[CODEX] +| [Implementation Guide](docs/implementation-guide.md) | Entry points, provider stack, routing, feature ownership, build tooling. |
[CODEX] +| [Project Structure](docs/project-structure.md) | Directory breakdown and best practices for adding new files. |
[CODEX] +| [State Management](docs/state-management.md) | Contexts, reducers, and caching strategies. |
[CODEX] +| [GraphQL Integration](docs/graphql-integration.md) | Query organization, code generation, and cache policies. |
[CODEX] +| [Custom Hooks](docs/custom-hooks.md) | Reusable hooks available across features. |
[CODEX] +| [Workflow Builder Guide](docs/workflow-builder-guide.md) | Deep dive into the workflow module architecture. |
[CODEX] +
[CODEX] +When implementing new features, align with the patterns documented in these guides and update them if responsibilities shift.
[CODEX] +
[CODEX] +## Testing & Quality Assurance
[CODEX] +
[CODEX] +- [Playwright Testing Guide](docs/playwright-testing-guide.md) â€“ Environment setup, authentication strategy, authoring conventions, and debugging tips.
[CODEX] +- [E2E Testing Patterns](docs/e2e-testing-patterns.md) â€“ Hard-won lessons for resilient selectors and flows.
[CODEX] +- [Testing Guide](docs/TEST-README.md) â€“ Vitest commands, coverage expectations, and mocking strategies.
[CODEX] +- Unit tests live beside implementation files. E2E specs live under `playwright/tests/`. Follow the documented fixtures/page-object approach for consistency.
[CODEX] +
[CODEX] +## Operational Playbooks
[CODEX] +
[CODEX] +- [Authentication](docs/authentication.md) â€“ Firebase sign-in flows and session persistence.
[CODEX] +- [Core Features](docs/core-features.md) â€“ Feature overviews for stakeholders and QA.
[CODEX] +- [Routes](docs/routes.md) â€“ Navigation map with workspace/context rules.
[CODEX] +- [Smooth Streaming](docs/smooth-streaming.md) & [Chat Streaming](docs/chat-streaming.md) â€“ Real-time infrastructure details.
[CODEX] +- [Test Resilience Strategy](docs/test-resilience-strategy.md) â€“ Stabilization techniques for automated suites.
[CODEX] +
[CODEX] +These playbooks help new engineers and QA members ramp up quickly on specific domains.
[CODEX] +
[CODEX] +## Documentation Index
[CODEX] +
[CODEX] +All documentation lives under the `docs/` directory:
[CODEX] +
[CODEX] +- [docs/README.md](docs/README.md) â€“ Entry point with setup instructions.
[CODEX] +- [docs/components.md](docs/components.md) â€“ Shared component catalogue.
[CODEX] +- [docs/routes.md](docs/routes.md) â€“ Application routing map.
[CODEX] +- [docs/core-features.md](docs/core-features.md) â€“ High-level feature descriptions.
[CODEX] +- [docs/workflow-builder-guide.md](docs/workflow-builder-guide.md) â€“ Workflow builder architecture.
[CODEX] +- [docs/playwright-testing-guide.md](docs/playwright-testing-guide.md) â€“ Comprehensive Playwright usage.
[CODEX] +- [docs/implementation-guide.md](docs/implementation-guide.md) â€“ Frontend implementation detail.
[CODEX] +- [docs/authentication.md](docs/authentication.md) â€“ Auth flows and state storage.
[CODEX] +- [docs/e2e-testing-patterns.md](docs/e2e-testing-patterns.md) â€“ Resilient test strategies.
[CODEX] +- [docs/TEST-README.md](docs/TEST-README.md) â€“ Unit and integration testing commands.
[CODEX] +
[CODEX] +Keep this hub updated as we introduce new docs or migrate content. If a guide becomes outdated, link directly to its successor or fold it into a more relevant document.
[CODEX] diff --git a/README.md b/README.md
[CODEX] index fecb22bce7791f926108dab947b93e75eaa022c7..09e58074104c565a3b4c29c33b94cf57fba373aa
[CODEX] --- a/README.md
[CODEX] +++ b/README.md
[CODEX] @@ -239,8 +239,8 @@
[CODEX] Vurvey Web Manager is the frontend component of the Vurvey platform. It works in conjunction with the Vurvey API backend to provide a complete solution for video-based consumer feedback.
[CODEX] -[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] -[Link to Comprehensive Documentation](../DOCUMENTATION.md)
[CODEX] +[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] +[Documentation Hub](./DOCUMENTATION.md)
[CODEX] ## Setup
[CODEX] diff --git a/docs/README.md b/docs/README.md
[CODEX] index 174c521a012dbbb5ef957dfc29360c9b697c7b6e..5a56517cd1e90833bbcb9dad65d7cb3d620b14c8
[CODEX] --- a/docs/README.md
[CODEX] +++ b/docs/README.md
[CODEX] @@ -19,11 +19,13 @@
[CODEX] ### Getting Started
[CODEX] +- [Implementation Guide](./implementation-guide.md) - How the application is assembled end-to-end
[CODEX] - [Project Structure](./project-structure.md) - Codebase organization
[CODEX] - [Authentication](./authentication.md) - Auth system and user management
[CODEX] - [State Management](./state-management.md) - Context and data flow
[CODEX] - [Routes](./routes.md) - Routing structure and navigation
[CODEX] - [Components](./components.md) - Component library and patterns
[CODEX] +- [Playwright Testing Guide](./playwright-testing-guide.md) - Full Playwright setup and authoring guide
[CODEX] ### Features
[CODEX] @@ -147,6 +149,7 @@
[CODEX] ```
[CODEX] LOGIN_USERNAME="your_test_email"
[CODEX] LOGIN_PASSWORD="your_test_password"
[CODEX] +URL="http://localhost:5050"
[CODEX] ```
[CODEX] ## Best Practices
[CODEX] @@ -181,3 +184,4 @@
[CODEX] - [Playwright Documentation](https://playwright.dev)
[CODEX] - [Apollo Client Documentation](https://www.apollographql.com/docs/react)
[CODEX] - [React Documentation](https://react.dev)
[CODEX] +- [Documentation Hub](../DOCUMENTATION.md) for an index of project guides
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] diff --git a/docs/playwright-testing-guide.md b/docs/playwright-testing-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..acbab280a49d446cc89ce7ea1e6de422380736ca
[CODEX] --- /dev/null
[CODEX] +++ b/docs/playwright-testing-guide.md
[CODEX] @@ -0,0 +1,161 @@
[CODEX] +# Playwright Testing Guide
[CODEX] +
[CODEX] +This guide explains how to configure, run, and extend the Playwright end-to-end test suite for Vurvey Web Manager.
[CODEX] +
[CODEX] +- [Overview](#overview)
[CODEX] +- [Directory Layout](#directory-layout)
[CODEX] +- [Environment Setup](#environment-setup)
[CODEX] +- [Running Tests](#running-tests)
[CODEX] +- [Authentication Workflow](#authentication-workflow)
[CODEX] +- [Writing & Organizing Tests](#writing--organizing-tests)
[CODEX] +- [Debugging & Diagnostics](#debugging--diagnostics)
[CODEX] +- [Continuous Integration](#continuous-integration)
[CODEX] +- [Reference Material](#reference-material)
[CODEX] +
[CODEX] +## Overview
[CODEX] +
[CODEX] +Playwright exercises the full React application in a Chromium browser using the configuration defined in `playwright.config.ts`. Tests rely on Firebase authentication, Apollo GraphQL, and feature flags, so a stable backend environment and test credentials are required.
[CODEX] +
[CODEX] +Key characteristics:
[CODEX] +
[CODEX] +- Tests live in `playwright/tests/*.spec.ts`.
[CODEX] +- A dedicated `setup` project seeds authentication (`auth.setup.ts`) and persists storage state to `playwright/.auth/user.json`.
[CODEX] +- Default executions run headless Chromium with `slowMo: 50` to reduce flakiness; override these options when debugging.
[CODEX] +
[CODEX] +## Directory Layout
[CODEX] +
[CODEX] +```
[CODEX] +playwright/
[CODEX] +â”œâ”€â”€ fixtures/                 # Test data assets (clips, csv, pdf, images)
[CODEX] +â”œâ”€â”€ helpers/                  # Utility helpers (authentication, navigation)
[CODEX] +â”œâ”€â”€ page-objects/             # Page object abstractions for complex flows
[CODEX] +â”œâ”€â”€ tests/                    # Spec files + global setup (auth.setup.ts)
[CODEX] +â”œâ”€â”€ env.d.ts                  # Type declarations for Playwright globals
[CODEX] +â””â”€â”€ README.md                 # High-level summary (links back to this guide)
[CODEX] +```
[CODEX] +
[CODEX] +Keep common logic in helpers or page objects instead of duplicating it inside specs. Fixtures should hold deterministic assets that can be reused across scenarios.
[CODEX] +
[CODEX] +## Environment Setup
[CODEX] +
[CODEX] +1. **Install dependencies**
[CODEX] +
[CODEX] +   ```bash
[CODEX] +   npm ci
[CODEX] +   npx playwright install
[CODEX] +   ```
[CODEX] +
[CODEX] +2. **Configure environment variables**
[CODEX] +
[CODEX] +   - Create `./playwright/.env` with the fields referenced in tests:
[CODEX] +
[CODEX] +     ```ini
[CODEX] +     URL=http://localhost:5050
[CODEX] +     LOGIN_USERNAME=tester@example.com
[CODEX] +     LOGIN_PASSWORD=super-secret
[CODEX] +     ```
[CODEX] +
[CODEX] +   - Variables defined in the repository root `.env` are also loaded. `URL` must match the origin where the web manager is running.
[CODEX] +
[CODEX] +3. **Launch the application backend**
[CODEX] +
[CODEX] +   - Ensure the Vurvey API and any dependent services are running; Playwright interacts with the live stack.
[CODEX] +   - Start the web manager locally with `npm start` or point `URL` at a staging environment.
[CODEX] +
[CODEX] +4. **Seed authentication state**
[CODEX] +
[CODEX] +   - The first test run invokes `auth.setup.ts`, which stores Firebase credentials in IndexedDB and writes a Playwright storage file (`playwright/.auth/user.json`).
[CODEX] +   - This file is reused by dependent projects so subsequent tests start in an authenticated session.
[CODEX] +
[CODEX] +## Running Tests
[CODEX] +
[CODEX] +Common commands:
[CODEX] +
[CODEX] +```bash
[CODEX] +# Run the full E2E suite
[CODEX] +npx playwright test
[CODEX] +
[CODEX] +# Run a specific spec
[CODEX] +npx playwright test playwright/tests/navigation.spec.ts
[CODEX] +
[CODEX] +# Filter by title
[CODEX] +npx playwright test --grep "@smoke"
[CODEX] +
[CODEX] +# Headed (visible) mode
[CODEX] +npx playwright test --headed
[CODEX] +
[CODEX] +# Debug mode with inspector
[CODEX] +npx playwright test --debug
[CODEX] +
[CODEX] +# Use the Playwright UI
[CODEX] +npx playwright test --ui
[CODEX] +```
[CODEX] +
[CODEX] +Project configuration (browser, base URL, reporters) lives in `playwright.config.ts`. Edit that file to add new projects (e.g., Firefox coverage) or alternative reporters.
[CODEX] +
[CODEX] +## Authentication Workflow
[CODEX] +
[CODEX] +Authentication uses Firebase persistence inside IndexedDB:
[CODEX] +
[CODEX] +1. `auth.setup.ts` logs in through the UI using `LOGIN_USERNAME` and `LOGIN_PASSWORD`.
[CODEX] +2. The helper `saveFirebaseAuthData` captures Firebase data from IndexedDB and writes it to `localStorage`.
[CODEX] +3. The storage state is exported to `playwright/.auth/user.json`.
[CODEX] +4. Individual specs call `restoreFirebaseAuthData` via helper utilities before navigating, ensuring a valid session without re-running the login flow.
[CODEX] +
[CODEX] +If you see `No auth data found in localStorage`, run the setup project again (`npx playwright test --project setup`). When credentials rotate, delete `playwright/.auth/user.json` and re-run the suite.
[CODEX] +
[CODEX] +## Writing & Organizing Tests
[CODEX] +
[CODEX] +- **Use fixtures**: Import reusable flows (e.g., `authenticate`) from `playwright/helpers`. Define domain-specific fixtures when a scenario needs shared setup and teardown.
[CODEX] +- **Prefer page objects**: Complex interactions such as the workflow builder or agent editor should be encapsulated in `playwright/page-objects` classes. Create methods that describe user intent (`workflowBuilder.publishFlow()`), not DOM mechanics.
[CODEX] +- **Selectors**: Lean on accessible selectors (`getByRole`, `getByLabel`, `getByTestId`). Fall back to data attributes when elements lack semantic handles. Avoid brittle CSS selectors.
[CODEX] +- **Organization**: Group related specs in `test.describe`. Tag critical smoke tests with `@smoke` for quick feedback loops.
[CODEX] +- **Time-sensitive flows**: Use `await expect(...).toBeVisible({ timeout: 30_000 })` for network-heavy screens. The global `expect` timeout already defaults to 30 seconds; override locally when necessary.
[CODEX] +- **Artifacts**: Use `test.info().attach` to capture domain-specific logs. Screenshots happen automatically on failure, but explicit captures help with mid-test diagnostics.
[CODEX] +
[CODEX] +Example skeleton:
[CODEX] +
[CODEX] +```ts
[CODEX] +import {test, expect} from "@playwright/test";
[CODEX] +import {authenticate} from "../helpers/authentication";
[CODEX] +import {DashboardPage} from "../page-objects/dashboard-page";
[CODEX] +
[CODEX] +test.describe("Dashboard", () => {
[CODEX] +  test.beforeEach(async ({page}) => {
[CODEX] +    await authenticate(page);
[CODEX] +  });
[CODEX] +
[CODEX] +  test("shows the active workspace summary @smoke", async ({page}) => {
[CODEX] +    const dashboard = new DashboardPage(page);
[CODEX] +    await dashboard.goto();
[CODEX] +    await expect(dashboard.header).toContainText("Workspace Overview");
[CODEX] +  });
[CODEX] +});
[CODEX] +```
[CODEX] +
[CODEX] +## Debugging & Diagnostics
[CODEX] +
[CODEX] +- **Trace Viewer**: Re-run failing tests with `npx playwright test --trace on-first-retry` to collect DOM snapshots, network logs, and console output.
[CODEX] +- **Video & screenshots**: Enable via `use: { video: "retain-on-failure", screenshot: "only-on-failure" }` either per test or globally in `playwright.config.ts`.
[CODEX] +- **Console logging**: Place strategic `console.log` statements in specs or helpers when investigating flaky behavior. Remove them once resolved to keep logs clean.
[CODEX] +- **Network mocking**: Stub GraphQL or REST endpoints with `page.route` for deterministic results when backend data is unavailable. Maintain mocks under `playwright/helpers/network`.
[CODEX] +
[CODEX] +When a test flakes, capture the trace, verify selectors still match the rendered UI, and ensure required feature flags are enabled for the environment.
[CODEX] +
[CODEX] +## Continuous Integration
[CODEX] +
[CODEX] +- CI pipelines call `npx playwright test` with the same configuration. Ensure new specs respect the single-worker execution configuration (`workers: 1`) unless you explicitly parallelize them.
[CODEX] +- Store credentials (username, password, URL) in the CI secret store. The setup project fails fast if they are missing.
[CODEX] +- Upload `test-results/` (HTML reporter output) as an artifact for post-run inspection.
[CODEX] +
[CODEX] +Before merging, run the suite locally or in a dry-run environment to catch environment-specific regressions early.
[CODEX] +
[CODEX] +## Reference Material
[CODEX] +
[CODEX] +- [Playwright Configuration](../playwright.config.ts)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +- [Testing Guide (unit + integration)](./TEST-README.md)
[CODEX] +- [Implementation Guide](./implementation-guide.md)
[CODEX] +- [Official Playwright Docs](https://playwright.dev/docs/intro)
[CODEX] +
[CODEX] +Keep this guide up to date whenever the test harness, authentication strategy, or project layout changes. New contributors should be able to set up Playwright using only this document.
[CODEX] diff --git a/playwright/README.md b/playwright/README.md
[CODEX] index 58090e78cd0aba7e78a7bd8ce3bf7b7a692ea8ca..02e1939682ff48977eb982bba77319f5e528768a
[CODEX] --- a/playwright/README.md
[CODEX] +++ b/playwright/README.md
[CODEX] @@ -1,5 +1,7 @@
[CODEX] # Vurvey Web Manager Testing Guide
[CODEX] +> **Prefer the canonical [Playwright Testing Guide](../docs/playwright-testing-guide.md)** for the most up-to-date instructions on setup, authoring, and debugging. This file keeps a condensed summary for quick reference.
[CODEX] +
[CODEX] This document provides comprehensive guidance for testing the Vurvey Web Manager application.
[CODEX] ## Overview
[CODEX] thinking
[CODEX] **Verifying documentation references**
[CODEX] exec
[CODEX] bash -lc 'rg "../DOCUMENTATION.md"' in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 188ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] docs/README.md:- [Documentation Hub](../DOCUMENTATION.md) for an index of project guides
[CODEX] README.md:[Documentation Hub](./DOCUMENTATION.md)
[CODEX] file update:
[CODEX] diff --git a/DOCUMENTATION.md b/DOCUMENTATION.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e08ed0b3ff8c2fbb63dc3ee675405d59841b6a10
[CODEX] --- /dev/null
[CODEX] +++ b/DOCUMENTATION.md
[CODEX] @@ -0,0 +1,81 @@
[CODEX] +# Vurvey Web Manager Documentation Hub
[CODEX] +
[CODEX] +This hub ties together the architecture, development workflows, and testing resources for the Vurvey Web Manager. Start here for a narrated overview, then dive into the linked guides for deeper detail.
[CODEX] +
[CODEX] +- [Quick Start](#quick-start)
[CODEX] +- [Architecture at a Glance](#architecture-at-a-glance)
[CODEX] +- [Implementation Deep Dive](#implementation-deep-dive)
[CODEX] +- [Testing & Quality Assurance](#testing--quality-assurance)
[CODEX] +- [Operational Playbooks](#operational-playbooks)
[CODEX] +- [Documentation Index](#documentation-index)
[CODEX] +
[CODEX] +## Quick Start
[CODEX] +
[CODEX] +| Task | Command / Resource |
[CODEX] +| --- | --- |
[CODEX] +| Install dependencies | `npm ci` |
[CODEX] +| Run the dev server | `npm start` (defaults to `http://localhost:5050`) |
[CODEX] +| Type-check | `npm run type-check` |
[CODEX] +| Validate GraphQL documents | `npm run validate:graphql` |
[CODEX] +| Run unit/integration tests | `npm run test:unit` |
[CODEX] +| Run Playwright E2E tests | `npm run test:e2e` |
[CODEX] +| Lint source + tests | `npm run lint` |
[CODEX] +
[CODEX] +Environment variables (Firebase, GraphQL endpoint, feature flags) are defined in `.env`. See `docs/README.md#environment-variables` for the full list.
[CODEX] +
[CODEX] +## Architecture at a Glance
[CODEX] +
[CODEX] +- React 18 + TypeScript rendered through Vite.
[CODEX] +- Routing handled via `react-router-dom` with workspace-aware helpers.
[CODEX] +- GraphQL powered by Apollo Client (HTTP + WebSocket links) and LaunchDarkly/OpenFeature feature flag providers.
[CODEX] +- State spans React Contexts, Apollo cache, and reducer-driven component state.
[CODEX] +- Styling leverages SCSS modules and a shared component library under `src/shared`.
[CODEX] +
[CODEX] +Review the [Implementation Guide](docs/implementation-guide.md) for a walkthrough of providers, feature modules, and architectural conventions.
[CODEX] +
[CODEX] +## Implementation Deep Dive
[CODEX] +
[CODEX] +| Topic | Summary |
[CODEX] +| --- | --- |
[CODEX] +| [Implementation Guide](docs/implementation-guide.md) | Entry points, provider stack, routing, feature ownership, build tooling. |
[CODEX] +| [Project Structure](docs/project-structure.md) | Directory breakdown and best practices for adding new files. |
[CODEX] +| [State Management](docs/state-management.md) | Contexts, reducers, and caching strategies. |
[CODEX] +| [GraphQL Integration](docs/graphql-integration.md) | Query organization, code generation, and cache policies. |
[CODEX] +| [Custom Hooks](docs/custom-hooks.md) | Reusable hooks available across features. |
[CODEX] +| [Workflow Builder Guide](docs/workflow-builder-guide.md) | Deep dive into the workflow module architecture. |
[CODEX] +
[CODEX] +When implementing new features, align with the patterns documented in these guides and update them if responsibilities shift.
[CODEX] +
[CODEX] +## Testing & Quality Assurance
[CODEX] +
[CODEX] +- [Playwright Testing Guide](docs/playwright-testing-guide.md) â€“ Environment setup, authentication strategy, authoring conventions, and debugging tips.
[CODEX] +- [E2E Testing Patterns](docs/e2e-testing-patterns.md) â€“ Hard-won lessons for resilient selectors and flows.
[CODEX] +- [Testing Guide](docs/TEST-README.md) â€“ Vitest commands, coverage expectations, and mocking strategies.
[CODEX] +- Unit tests live beside implementation files. E2E specs live under `playwright/tests/`. Follow the documented fixtures/page-object approach for consistency.
[CODEX] +
[CODEX] +## Operational Playbooks
[CODEX] +
[CODEX] +- [Authentication](docs/authentication.md) â€“ Firebase sign-in flows and session persistence.
[CODEX] +- [Core Features](docs/core-features.md) â€“ Feature overviews for stakeholders and QA.
[CODEX] +- [Routes](docs/routes.md) â€“ Navigation map with workspace/context rules.
[CODEX] +- [Smooth Streaming](docs/smooth-streaming.md) & [Chat Streaming](docs/chat-streaming.md) â€“ Real-time infrastructure details.
[CODEX] +- [Test Resilience Strategy](docs/test-resilience-strategy.md) â€“ Stabilization techniques for automated suites.
[CODEX] +
[CODEX] +These playbooks help new engineers and QA members ramp up quickly on specific domains.
[CODEX] +
[CODEX] +## Documentation Index
[CODEX] +
[CODEX] +All documentation lives under the `docs/` directory:
[CODEX] +
[CODEX] +- [docs/README.md](docs/README.md) â€“ Entry point with setup instructions.
[CODEX] +- [docs/components.md](docs/components.md) â€“ Shared component catalogue.
[CODEX] +- [docs/routes.md](docs/routes.md) â€“ Application routing map.
[CODEX] +- [docs/core-features.md](docs/core-features.md) â€“ High-level feature descriptions.
[CODEX] +- [docs/workflow-builder-guide.md](docs/workflow-builder-guide.md) â€“ Workflow builder architecture.
[CODEX] +- [docs/playwright-testing-guide.md](docs/playwright-testing-guide.md) â€“ Comprehensive Playwright usage.
[CODEX] +- [docs/implementation-guide.md](docs/implementation-guide.md) â€“ Frontend implementation detail.
[CODEX] +- [docs/authentication.md](docs/authentication.md) â€“ Auth flows and state storage.
[CODEX] +- [docs/e2e-testing-patterns.md](docs/e2e-testing-patterns.md) â€“ Resilient test strategies.
[CODEX] +- [docs/TEST-README.md](docs/TEST-README.md) â€“ Unit and integration testing commands.
[CODEX] +
[CODEX] +Keep this hub updated as we introduce new docs or migrate content. If a guide becomes outdated, link directly to its successor or fold it into a more relevant document.
[CODEX] diff --git a/README.md b/README.md
[CODEX] index fecb22bce7791f926108dab947b93e75eaa022c7..09e58074104c565a3b4c29c33b94cf57fba373aa
[CODEX] --- a/README.md
[CODEX] +++ b/README.md
[CODEX] @@ -239,8 +239,8 @@
[CODEX] Vurvey Web Manager is the frontend component of the Vurvey platform. It works in conjunction with the Vurvey API backend to provide a complete solution for video-based consumer feedback.
[CODEX] -[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] -[Link to Comprehensive Documentation](../DOCUMENTATION.md)
[CODEX] +[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] +[Documentation Hub](./DOCUMENTATION.md)
[CODEX] ## Setup
[CODEX] diff --git a/docs/README.md b/docs/README.md
[CODEX] index 174c521a012dbbb5ef957dfc29360c9b697c7b6e..5a56517cd1e90833bbcb9dad65d7cb3d620b14c8
[CODEX] --- a/docs/README.md
[CODEX] +++ b/docs/README.md
[CODEX] @@ -19,11 +19,13 @@
[CODEX] ### Getting Started
[CODEX] +- [Implementation Guide](./implementation-guide.md) - How the application is assembled end-to-end
[CODEX] - [Project Structure](./project-structure.md) - Codebase organization
[CODEX] - [Authentication](./authentication.md) - Auth system and user management
[CODEX] - [State Management](./state-management.md) - Context and data flow
[CODEX] - [Routes](./routes.md) - Routing structure and navigation
[CODEX] - [Components](./components.md) - Component library and patterns
[CODEX] +- [Playwright Testing Guide](./playwright-testing-guide.md) - Full Playwright setup and authoring guide
[CODEX] ### Features
[CODEX] @@ -147,6 +149,7 @@
[CODEX] ```
[CODEX] LOGIN_USERNAME="your_test_email"
[CODEX] LOGIN_PASSWORD="your_test_password"
[CODEX] +URL="http://localhost:5050"
[CODEX] ```
[CODEX] ## Best Practices
[CODEX] @@ -181,3 +184,4 @@
[CODEX] - [Playwright Documentation](https://playwright.dev)
[CODEX] - [Apollo Client Documentation](https://www.apollographql.com/docs/react)
[CODEX] - [React Documentation](https://react.dev)
[CODEX] +- [Documentation Hub](../DOCUMENTATION.md) for an index of project guides
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] diff --git a/docs/playwright-testing-guide.md b/docs/playwright-testing-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..acbab280a49d446cc89ce7ea1e6de422380736ca
[CODEX] --- /dev/null
[CODEX] +++ b/docs/playwright-testing-guide.md
[CODEX] @@ -0,0 +1,161 @@
[CODEX] +# Playwright Testing Guide
[CODEX] +
[CODEX] +This guide explains how to configure, run, and extend the Playwright end-to-end test suite for Vurvey Web Manager.
[CODEX] +
[CODEX] +- [Overview](#overview)
[CODEX] +- [Directory Layout](#directory-layout)
[CODEX] +- [Environment Setup](#environment-setup)
[CODEX] +- [Running Tests](#running-tests)
[CODEX] +- [Authentication Workflow](#authentication-workflow)
[CODEX] +- [Writing & Organizing Tests](#writing--organizing-tests)
[CODEX] +- [Debugging & Diagnostics](#debugging--diagnostics)
[CODEX] +- [Continuous Integration](#continuous-integration)
[CODEX] +- [Reference Material](#reference-material)
[CODEX] +
[CODEX] +## Overview
[CODEX] +
[CODEX] +Playwright exercises the full React application in a Chromium browser using the configuration defined in `playwright.config.ts`. Tests rely on Firebase authentication, Apollo GraphQL, and feature flags, so a stable backend environment and test credentials are required.
[CODEX] +
[CODEX] +Key characteristics:
[CODEX] +
[CODEX] +- Tests live in `playwright/tests/*.spec.ts`.
[CODEX] +- A dedicated `setup` project seeds authentication (`auth.setup.ts`) and persists storage state to `playwright/.auth/user.json`.
[CODEX] +- Default executions run headless Chromium with `slowMo: 50` to reduce flakiness; override these options when debugging.
[CODEX] +
[CODEX] +## Directory Layout
[CODEX] +
[CODEX] +```
[CODEX] +playwright/
[CODEX] +â”œâ”€â”€ fixtures/                 # Test data assets (clips, csv, pdf, images)
[CODEX] +â”œâ”€â”€ helpers/                  # Utility helpers (authentication, navigation)
[CODEX] +â”œâ”€â”€ page-objects/             # Page object abstractions for complex flows
[CODEX] +â”œâ”€â”€ tests/                    # Spec files + global setup (auth.setup.ts)
[CODEX] +â”œâ”€â”€ env.d.ts                  # Type declarations for Playwright globals
[CODEX] +â””â”€â”€ README.md                 # High-level summary (links back to this guide)
[CODEX] +```
[CODEX] +
[CODEX] +Keep common logic in helpers or page objects instead of duplicating it inside specs. Fixtures should hold deterministic assets that can be reused across scenarios.
[CODEX] +
[CODEX] +## Environment Setup
[CODEX] +
[CODEX] +1. **Install dependencies**
[CODEX] +
[CODEX] +   ```bash
[CODEX] +   npm ci
[CODEX] +   npx playwright install
[CODEX] +   ```
[CODEX] +
[CODEX] +2. **Configure environment variables**
[CODEX] +
[CODEX] +   - Create `./playwright/.env` with the fields referenced in tests:
[CODEX] +
[CODEX] +     ```ini
[CODEX] +     URL=http://localhost:5050
[CODEX] +     LOGIN_USERNAME=tester@example.com
[CODEX] +     LOGIN_PASSWORD=super-secret
[CODEX] +     ```
[CODEX] +
[CODEX] +   - Variables defined in the repository root `.env` are also loaded. `URL` must match the origin where the web manager is running.
[CODEX] +
[CODEX] +3. **Launch the application backend**
[CODEX] +
[CODEX] +   - Ensure the Vurvey API and any dependent services are running; Playwright interacts with the live stack.
[CODEX] +   - Start the web manager locally with `npm start` or point `URL` at a staging environment.
[CODEX] +
[CODEX] +4. **Seed authentication state**
[CODEX] +
[CODEX] +   - The first test run invokes `auth.setup.ts`, which stores Firebase credentials in IndexedDB and writes a Playwright storage file (`playwright/.auth/user.json`).
[CODEX] +   - This file is reused by dependent projects so subsequent tests start in an authenticated session.
[CODEX] +
[CODEX] +## Running Tests
[CODEX] +
[CODEX] +Common commands:
[CODEX] +
[CODEX] +```bash
[CODEX] +# Run the full E2E suite
[CODEX] +npx playwright test
[CODEX] +
[CODEX] +# Run a specific spec
[CODEX] +npx playwright test playwright/tests/navigation.spec.ts
[CODEX] +
[CODEX] +# Filter by title
[CODEX] +npx playwright test --grep "@smoke"
[CODEX] +
[CODEX] +# Headed (visible) mode
[CODEX] +npx playwright test --headed
[CODEX] +
[CODEX] +# Debug mode with inspector
[CODEX] +npx playwright test --debug
[CODEX] +
[CODEX] +# Use the Playwright UI
[CODEX] +npx playwright test --ui
[CODEX] +```
[CODEX] +
[CODEX] +Project configuration (browser, base URL, reporters) lives in `playwright.config.ts`. Edit that file to add new projects (e.g., Firefox coverage) or alternative reporters.
[CODEX] +
[CODEX] +## Authentication Workflow
[CODEX] +
[CODEX] +Authentication uses Firebase persistence inside IndexedDB:
[CODEX] +
[CODEX] +1. `auth.setup.ts` logs in through the UI using `LOGIN_USERNAME` and `LOGIN_PASSWORD`.
[CODEX] +2. The helper `saveFirebaseAuthData` captures Firebase data from IndexedDB and writes it to `localStorage`.
[CODEX] +3. The storage state is exported to `playwright/.auth/user.json`.
[CODEX] +4. Individual specs call `restoreFirebaseAuthData` via helper utilities before navigating, ensuring a valid session without re-running the login flow.
[CODEX] +
[CODEX] +If you see `No auth data found in localStorage`, run the setup project again (`npx playwright test --project setup`). When credentials rotate, delete `playwright/.auth/user.json` and re-run the suite.
[CODEX] +
[CODEX] +## Writing & Organizing Tests
[CODEX] +
[CODEX] +- **Use fixtures**: Import reusable flows (e.g., `authenticate`) from `playwright/helpers`. Define domain-specific fixtures when a scenario needs shared setup and teardown.
[CODEX] +- **Prefer page objects**: Complex interactions such as the workflow builder or agent editor should be encapsulated in `playwright/page-objects` classes. Create methods that describe user intent (`workflowBuilder.publishFlow()`), not DOM mechanics.
[CODEX] +- **Selectors**: Lean on accessible selectors (`getByRole`, `getByLabel`, `getByTestId`). Fall back to data attributes when elements lack semantic handles. Avoid brittle CSS selectors.
[CODEX] +- **Organization**: Group related specs in `test.describe`. Tag critical smoke tests with `@smoke` for quick feedback loops.
[CODEX] +- **Time-sensitive flows**: Use `await expect(...).toBeVisible({ timeout: 30_000 })` for network-heavy screens. The global `expect` timeout already defaults to 30 seconds; override locally when necessary.
[CODEX] +- **Artifacts**: Use `test.info().attach` to capture domain-specific logs. Screenshots happen automatically on failure, but explicit captures help with mid-test diagnostics.
[CODEX] +
[CODEX] +Example skeleton:
[CODEX] +
[CODEX] +```ts
[CODEX] +import {test, expect} from "@playwright/test";
[CODEX] +import {authenticate} from "../helpers/authentication";
[CODEX] +import {DashboardPage} from "../page-objects/dashboard-page";
[CODEX] +
[CODEX] +test.describe("Dashboard", () => {
[CODEX] +  test.beforeEach(async ({page}) => {
[CODEX] +    await authenticate(page);
[CODEX] +  });
[CODEX] +
[CODEX] +  test("shows the active workspace summary @smoke", async ({page}) => {
[CODEX] +    const dashboard = new DashboardPage(page);
[CODEX] +    await dashboard.goto();
[CODEX] +    await expect(dashboard.header).toContainText("Workspace Overview");
[CODEX] +  });
[CODEX] +});
[CODEX] +```
[CODEX] +
[CODEX] +## Debugging & Diagnostics
[CODEX] +
[CODEX] +- **Trace Viewer**: Re-run failing tests with `npx playwright test --trace on-first-retry` to collect DOM snapshots, network logs, and console output.
[CODEX] +- **Video & screenshots**: Enable via `use: { video: "retain-on-failure", screenshot: "only-on-failure" }` either per test or globally in `playwright.config.ts`.
[CODEX] +- **Console logging**: Place strategic `console.log` statements in specs or helpers when investigating flaky behavior. Remove them once resolved to keep logs clean.
[CODEX] +- **Network mocking**: Stub GraphQL or REST endpoints with `page.route` for deterministic results when backend data is unavailable. Maintain mocks under `playwright/helpers/network`.
[CODEX] +
[CODEX] +When a test flakes, capture the trace, verify selectors still match the rendered UI, and ensure required feature flags are enabled for the environment.
[CODEX] +
[CODEX] +## Continuous Integration
[CODEX] +
[CODEX] +- CI pipelines call `npx playwright test` with the same configuration. Ensure new specs respect the single-worker execution configuration (`workers: 1`) unless you explicitly parallelize them.
[CODEX] +- Store credentials (username, password, URL) in the CI secret store. The setup project fails fast if they are missing.
[CODEX] +- Upload `test-results/` (HTML reporter output) as an artifact for post-run inspection.
[CODEX] +
[CODEX] +Before merging, run the suite locally or in a dry-run environment to catch environment-specific regressions early.
[CODEX] +
[CODEX] +## Reference Material
[CODEX] +
[CODEX] +- [Playwright Configuration](../playwright.config.ts)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +- [Testing Guide (unit + integration)](./TEST-README.md)
[CODEX] +- [Implementation Guide](./implementation-guide.md)
[CODEX] +- [Official Playwright Docs](https://playwright.dev/docs/intro)
[CODEX] +
[CODEX] +Keep this guide up to date whenever the test harness, authentication strategy, or project layout changes. New contributors should be able to set up Playwright using only this document.
[CODEX] diff --git a/playwright/README.md b/playwright/README.md
[CODEX] index 58090e78cd0aba7e78a7bd8ce3bf7b7a692ea8ca..02e1939682ff48977eb982bba77319f5e528768a
[CODEX] --- a/playwright/README.md
[CODEX] +++ b/playwright/README.md
[CODEX] @@ -1,5 +1,7 @@
[CODEX] # Vurvey Web Manager Testing Guide
[CODEX] +> **Prefer the canonical [Playwright Testing Guide](../docs/playwright-testing-guide.md)** for the most up-to-date instructions on setup, authoring, and debugging. This file keeps a condensed summary for quick reference.
[CODEX] +
[CODEX] This document provides comprehensive guidance for testing the Vurvey Web Manager application.
[CODEX] ## Overview
[CODEX] thinking
[CODEX] **Confirming documentation path**
[CODEX] Plan update
[CODEX] âœ“ Assess existing documentation and testing resources to map gaps for implementation coverage and Playwright workflows.
[CODEX] âœ“ Author and organize new documentation that covers implementation architecture and detailed Playwright testing guidance.
[CODEX] â†’ Add or update automated tests (and run relevant suites) to align with the new documentation, then validate everything passes.
[CODEX] file update:
[CODEX] diff --git a/DOCUMENTATION.md b/DOCUMENTATION.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e08ed0b3ff8c2fbb63dc3ee675405d59841b6a10
[CODEX] --- /dev/null
[CODEX] +++ b/DOCUMENTATION.md
[CODEX] @@ -0,0 +1,81 @@
[CODEX] +# Vurvey Web Manager Documentation Hub
[CODEX] +
[CODEX] +This hub ties together the architecture, development workflows, and testing resources for the Vurvey Web Manager. Start here for a narrated overview, then dive into the linked guides for deeper detail.
[CODEX] +
[CODEX] +- [Quick Start](#quick-start)
[CODEX] +- [Architecture at a Glance](#architecture-at-a-glance)
[CODEX] +- [Implementation Deep Dive](#implementation-deep-dive)
[CODEX] +- [Testing & Quality Assurance](#testing--quality-assurance)
[CODEX] +- [Operational Playbooks](#operational-playbooks)
[CODEX] +- [Documentation Index](#documentation-index)
[CODEX] +
[CODEX] +## Quick Start
[CODEX] +
[CODEX] +| Task | Command / Resource |
[CODEX] +| --- | --- |
[CODEX] +| Install dependencies | `npm ci` |
[CODEX] +| Run the dev server | `npm start` (defaults to `http://localhost:5050`) |
[CODEX] +| Type-check | `npm run type-check` |
[CODEX] +| Validate GraphQL documents | `npm run validate:graphql` |
[CODEX] +| Run unit/integration tests | `npm run test:unit` |
[CODEX] +| Run Playwright E2E tests | `npm run test:e2e` |
[CODEX] +| Lint source + tests | `npm run lint` |
[CODEX] +
[CODEX] +Environment variables (Firebase, GraphQL endpoint, feature flags) are defined in `.env`. See `docs/README.md#environment-variables` for the full list.
[CODEX] +
[CODEX] +## Architecture at a Glance
[CODEX] +
[CODEX] +- React 18 + TypeScript rendered through Vite.
[CODEX] +- Routing handled via `react-router-dom` with workspace-aware helpers.
[CODEX] +- GraphQL powered by Apollo Client (HTTP + WebSocket links) and LaunchDarkly/OpenFeature feature flag providers.
[CODEX] +- State spans React Contexts, Apollo cache, and reducer-driven component state.
[CODEX] +- Styling leverages SCSS modules and a shared component library under `src/shared`.
[CODEX] +
[CODEX] +Review the [Implementation Guide](docs/implementation-guide.md) for a walkthrough of providers, feature modules, and architectural conventions.
[CODEX] +
[CODEX] +## Implementation Deep Dive
[CODEX] +
[CODEX] +| Topic | Summary |
[CODEX] +| --- | --- |
[CODEX] +| [Implementation Guide](docs/implementation-guide.md) | Entry points, provider stack, routing, feature ownership, build tooling. |
[CODEX] +| [Project Structure](docs/project-structure.md) | Directory breakdown and best practices for adding new files. |
[CODEX] +| [State Management](docs/state-management.md) | Contexts, reducers, and caching strategies. |
[CODEX] +| [GraphQL Integration](docs/graphql-integration.md) | Query organization, code generation, and cache policies. |
[CODEX] +| [Custom Hooks](docs/custom-hooks.md) | Reusable hooks available across features. |
[CODEX] +| [Workflow Builder Guide](docs/workflow-builder-guide.md) | Deep dive into the workflow module architecture. |
[CODEX] +
[CODEX] +When implementing new features, align with the patterns documented in these guides and update them if responsibilities shift.
[CODEX] +
[CODEX] +## Testing & Quality Assurance
[CODEX] +
[CODEX] +- [Playwright Testing Guide](docs/playwright-testing-guide.md) â€“ Environment setup, authentication strategy, authoring conventions, and debugging tips.
[CODEX] +- [E2E Testing Patterns](docs/e2e-testing-patterns.md) â€“ Hard-won lessons for resilient selectors and flows.
[CODEX] +- [Testing Guide](docs/TEST-README.md) â€“ Vitest commands, coverage expectations, and mocking strategies.
[CODEX] +- Unit tests live beside implementation files. E2E specs live under `playwright/tests/`. Follow the documented fixtures/page-object approach for consistency.
[CODEX] +
[CODEX] +## Operational Playbooks
[CODEX] +
[CODEX] +- [Authentication](docs/authentication.md) â€“ Firebase sign-in flows and session persistence.
[CODEX] +- [Core Features](docs/core-features.md) â€“ Feature overviews for stakeholders and QA.
[CODEX] +- [Routes](docs/routes.md) â€“ Navigation map with workspace/context rules.
[CODEX] +- [Smooth Streaming](docs/smooth-streaming.md) & [Chat Streaming](docs/chat-streaming.md) â€“ Real-time infrastructure details.
[CODEX] +- [Test Resilience Strategy](docs/test-resilience-strategy.md) â€“ Stabilization techniques for automated suites.
[CODEX] +
[CODEX] +These playbooks help new engineers and QA members ramp up quickly on specific domains.
[CODEX] +
[CODEX] +## Documentation Index
[CODEX] +
[CODEX] +All documentation lives under the `docs/` directory:
[CODEX] +
[CODEX] +- [docs/README.md](docs/README.md) â€“ Entry point with setup instructions.
[CODEX] +- [docs/components.md](docs/components.md) â€“ Shared component catalogue.
[CODEX] +- [docs/routes.md](docs/routes.md) â€“ Application routing map.
[CODEX] +- [docs/core-features.md](docs/core-features.md) â€“ High-level feature descriptions.
[CODEX] +- [docs/workflow-builder-guide.md](docs/workflow-builder-guide.md) â€“ Workflow builder architecture.
[CODEX] +- [docs/playwright-testing-guide.md](docs/playwright-testing-guide.md) â€“ Comprehensive Playwright usage.
[CODEX] +- [docs/implementation-guide.md](docs/implementation-guide.md) â€“ Frontend implementation detail.
[CODEX] +- [docs/authentication.md](docs/authentication.md) â€“ Auth flows and state storage.
[CODEX] +- [docs/e2e-testing-patterns.md](docs/e2e-testing-patterns.md) â€“ Resilient test strategies.
[CODEX] +- [docs/TEST-README.md](docs/TEST-README.md) â€“ Unit and integration testing commands.
[CODEX] +
[CODEX] +Keep this hub updated as we introduce new docs or migrate content. If a guide becomes outdated, link directly to its successor or fold it into a more relevant document.
[CODEX] diff --git a/README.md b/README.md
[CODEX] index fecb22bce7791f926108dab947b93e75eaa022c7..09e58074104c565a3b4c29c33b94cf57fba373aa
[CODEX] --- a/README.md
[CODEX] +++ b/README.md
[CODEX] @@ -239,8 +239,8 @@
[CODEX] Vurvey Web Manager is the frontend component of the Vurvey platform. It works in conjunction with the Vurvey API backend to provide a complete solution for video-based consumer feedback.
[CODEX] -[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] -[Link to Comprehensive Documentation](../DOCUMENTATION.md)
[CODEX] +[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] +[Documentation Hub](./DOCUMENTATION.md)
[CODEX] ## Setup
[CODEX] diff --git a/docs/README.md b/docs/README.md
[CODEX] index 174c521a012dbbb5ef957dfc29360c9b697c7b6e..5a56517cd1e90833bbcb9dad65d7cb3d620b14c8
[CODEX] --- a/docs/README.md
[CODEX] +++ b/docs/README.md
[CODEX] @@ -19,11 +19,13 @@
[CODEX] ### Getting Started
[CODEX] +- [Implementation Guide](./implementation-guide.md) - How the application is assembled end-to-end
[CODEX] - [Project Structure](./project-structure.md) - Codebase organization
[CODEX] - [Authentication](./authentication.md) - Auth system and user management
[CODEX] - [State Management](./state-management.md) - Context and data flow
[CODEX] - [Routes](./routes.md) - Routing structure and navigation
[CODEX] - [Components](./components.md) - Component library and patterns
[CODEX] +- [Playwright Testing Guide](./playwright-testing-guide.md) - Full Playwright setup and authoring guide
[CODEX] ### Features
[CODEX] @@ -147,6 +149,7 @@
[CODEX] ```
[CODEX] LOGIN_USERNAME="your_test_email"
[CODEX] LOGIN_PASSWORD="your_test_password"
[CODEX] +URL="http://localhost:5050"
[CODEX] ```
[CODEX] ## Best Practices
[CODEX] @@ -181,3 +184,4 @@
[CODEX] - [Playwright Documentation](https://playwright.dev)
[CODEX] - [Apollo Client Documentation](https://www.apollographql.com/docs/react)
[CODEX] - [React Documentation](https://react.dev)
[CODEX] +- [Documentation Hub](../DOCUMENTATION.md) for an index of project guides
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] diff --git a/docs/playwright-testing-guide.md b/docs/playwright-testing-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..acbab280a49d446cc89ce7ea1e6de422380736ca
[CODEX] --- /dev/null
[CODEX] +++ b/docs/playwright-testing-guide.md
[CODEX] @@ -0,0 +1,161 @@
[CODEX] +# Playwright Testing Guide
[CODEX] +
[CODEX] +This guide explains how to configure, run, and extend the Playwright end-to-end test suite for Vurvey Web Manager.
[CODEX] +
[CODEX] +- [Overview](#overview)
[CODEX] +- [Directory Layout](#directory-layout)
[CODEX] +- [Environment Setup](#environment-setup)
[CODEX] +- [Running Tests](#running-tests)
[CODEX] +- [Authentication Workflow](#authentication-workflow)
[CODEX] +- [Writing & Organizing Tests](#writing--organizing-tests)
[CODEX] +- [Debugging & Diagnostics](#debugging--diagnostics)
[CODEX] +- [Continuous Integration](#continuous-integration)
[CODEX] +- [Reference Material](#reference-material)
[CODEX] +
[CODEX] +## Overview
[CODEX] +
[CODEX] +Playwright exercises the full React application in a Chromium browser using the configuration defined in `playwright.config.ts`. Tests rely on Firebase authentication, Apollo GraphQL, and feature flags, so a stable backend environment and test credentials are required.
[CODEX] +
[CODEX] +Key characteristics:
[CODEX] +
[CODEX] +- Tests live in `playwright/tests/*.spec.ts`.
[CODEX] +- A dedicated `setup` project seeds authentication (`auth.setup.ts`) and persists storage state to `playwright/.auth/user.json`.
[CODEX] +- Default executions run headless Chromium with `slowMo: 50` to reduce flakiness; override these options when debugging.
[CODEX] +
[CODEX] +## Directory Layout
[CODEX] +
[CODEX] +```
[CODEX] +playwright/
[CODEX] +â”œâ”€â”€ fixtures/                 # Test data assets (clips, csv, pdf, images)
[CODEX] +â”œâ”€â”€ helpers/                  # Utility helpers (authentication, navigation)
[CODEX] +â”œâ”€â”€ page-objects/             # Page object abstractions for complex flows
[CODEX] +â”œâ”€â”€ tests/                    # Spec files + global setup (auth.setup.ts)
[CODEX] +â”œâ”€â”€ env.d.ts                  # Type declarations for Playwright globals
[CODEX] +â””â”€â”€ README.md                 # High-level summary (links back to this guide)
[CODEX] +```
[CODEX] +
[CODEX] +Keep common logic in helpers or page objects instead of duplicating it inside specs. Fixtures should hold deterministic assets that can be reused across scenarios.
[CODEX] +
[CODEX] +## Environment Setup
[CODEX] +
[CODEX] +1. **Install dependencies**
[CODEX] +
[CODEX] +   ```bash
[CODEX] +   npm ci
[CODEX] +   npx playwright install
[CODEX] +   ```
[CODEX] +
[CODEX] +2. **Configure environment variables**
[CODEX] +
[CODEX] +   - Create `./playwright/.env` with the fields referenced in tests:
[CODEX] +
[CODEX] +     ```ini
[CODEX] +     URL=http://localhost:5050
[CODEX] +     LOGIN_USERNAME=tester@example.com
[CODEX] +     LOGIN_PASSWORD=super-secret
[CODEX] +     ```
[CODEX] +
[CODEX] +   - Variables defined in the repository root `.env` are also loaded. `URL` must match the origin where the web manager is running.
[CODEX] +
[CODEX] +3. **Launch the application backend**
[CODEX] +
[CODEX] +   - Ensure the Vurvey API and any dependent services are running; Playwright interacts with the live stack.
[CODEX] +   - Start the web manager locally with `npm start` or point `URL` at a staging environment.
[CODEX] +
[CODEX] +4. **Seed authentication state**
[CODEX] +
[CODEX] +   - The first test run invokes `auth.setup.ts`, which stores Firebase credentials in IndexedDB and writes a Playwright storage file (`playwright/.auth/user.json`).
[CODEX] +   - This file is reused by dependent projects so subsequent tests start in an authenticated session.
[CODEX] +
[CODEX] +## Running Tests
[CODEX] +
[CODEX] +Common commands:
[CODEX] +
[CODEX] +```bash
[CODEX] +# Run the full E2E suite
[CODEX] +npx playwright test
[CODEX] +
[CODEX] +# Run a specific spec
[CODEX] +npx playwright test playwright/tests/navigation.spec.ts
[CODEX] +
[CODEX] +# Filter by title
[CODEX] +npx playwright test --grep "@smoke"
[CODEX] +
[CODEX] +# Headed (visible) mode
[CODEX] +npx playwright test --headed
[CODEX] +
[CODEX] +# Debug mode with inspector
[CODEX] +npx playwright test --debug
[CODEX] +
[CODEX] +# Use the Playwright UI
[CODEX] +npx playwright test --ui
[CODEX] +```
[CODEX] +
[CODEX] +Project configuration (browser, base URL, reporters) lives in `playwright.config.ts`. Edit that file to add new projects (e.g., Firefox coverage) or alternative reporters.
[CODEX] +
[CODEX] +## Authentication Workflow
[CODEX] +
[CODEX] +Authentication uses Firebase persistence inside IndexedDB:
[CODEX] +
[CODEX] +1. `auth.setup.ts` logs in through the UI using `LOGIN_USERNAME` and `LOGIN_PASSWORD`.
[CODEX] +2. The helper `saveFirebaseAuthData` captures Firebase data from IndexedDB and writes it to `localStorage`.
[CODEX] +3. The storage state is exported to `playwright/.auth/user.json`.
[CODEX] +4. Individual specs call `restoreFirebaseAuthData` via helper utilities before navigating, ensuring a valid session without re-running the login flow.
[CODEX] +
[CODEX] +If you see `No auth data found in localStorage`, run the setup project again (`npx playwright test --project setup`). When credentials rotate, delete `playwright/.auth/user.json` and re-run the suite.
[CODEX] +
[CODEX] +## Writing & Organizing Tests
[CODEX] +
[CODEX] +- **Use fixtures**: Import reusable flows (e.g., `authenticate`) from `playwright/helpers`. Define domain-specific fixtures when a scenario needs shared setup and teardown.
[CODEX] +- **Prefer page objects**: Complex interactions such as the workflow builder or agent editor should be encapsulated in `playwright/page-objects` classes. Create methods that describe user intent (`workflowBuilder.publishFlow()`), not DOM mechanics.
[CODEX] +- **Selectors**: Lean on accessible selectors (`getByRole`, `getByLabel`, `getByTestId`). Fall back to data attributes when elements lack semantic handles. Avoid brittle CSS selectors.
[CODEX] +- **Organization**: Group related specs in `test.describe`. Tag critical smoke tests with `@smoke` for quick feedback loops.
[CODEX] +- **Time-sensitive flows**: Use `await expect(...).toBeVisible({ timeout: 30_000 })` for network-heavy screens. The global `expect` timeout already defaults to 30 seconds; override locally when necessary.
[CODEX] +- **Artifacts**: Use `test.info().attach` to capture domain-specific logs. Screenshots happen automatically on failure, but explicit captures help with mid-test diagnostics.
[CODEX] +
[CODEX] +Example skeleton:
[CODEX] +
[CODEX] +```ts
[CODEX] +import {test, expect} from "@playwright/test";
[CODEX] +import {authenticate} from "../helpers/authentication";
[CODEX] +import {DashboardPage} from "../page-objects/dashboard-page";
[CODEX] +
[CODEX] +test.describe("Dashboard", () => {
[CODEX] +  test.beforeEach(async ({page}) => {
[CODEX] +    await authenticate(page);
[CODEX] +  });
[CODEX] +
[CODEX] +  test("shows the active workspace summary @smoke", async ({page}) => {
[CODEX] +    const dashboard = new DashboardPage(page);
[CODEX] +    await dashboard.goto();
[CODEX] +    await expect(dashboard.header).toContainText("Workspace Overview");
[CODEX] +  });
[CODEX] +});
[CODEX] +```
[CODEX] +
[CODEX] +## Debugging & Diagnostics
[CODEX] +
[CODEX] +- **Trace Viewer**: Re-run failing tests with `npx playwright test --trace on-first-retry` to collect DOM snapshots, network logs, and console output.
[CODEX] +- **Video & screenshots**: Enable via `use: { video: "retain-on-failure", screenshot: "only-on-failure" }` either per test or globally in `playwright.config.ts`.
[CODEX] +- **Console logging**: Place strategic `console.log` statements in specs or helpers when investigating flaky behavior. Remove them once resolved to keep logs clean.
[CODEX] +- **Network mocking**: Stub GraphQL or REST endpoints with `page.route` for deterministic results when backend data is unavailable. Maintain mocks under `playwright/helpers/network`.
[CODEX] +
[CODEX] +When a test flakes, capture the trace, verify selectors still match the rendered UI, and ensure required feature flags are enabled for the environment.
[CODEX] +
[CODEX] +## Continuous Integration
[CODEX] +
[CODEX] +- CI pipelines call `npx playwright test` with the same configuration. Ensure new specs respect the single-worker execution configuration (`workers: 1`) unless you explicitly parallelize them.
[CODEX] +- Store credentials (username, password, URL) in the CI secret store. The setup project fails fast if they are missing.
[CODEX] +- Upload `test-results/` (HTML reporter output) as an artifact for post-run inspection.
[CODEX] +
[CODEX] +Before merging, run the suite locally or in a dry-run environment to catch environment-specific regressions early.
[CODEX] +
[CODEX] +## Reference Material
[CODEX] +
[CODEX] +- [Playwright Configuration](../playwright.config.ts)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +- [Testing Guide (unit + integration)](./TEST-README.md)
[CODEX] +- [Implementation Guide](./implementation-guide.md)
[CODEX] +- [Official Playwright Docs](https://playwright.dev/docs/intro)
[CODEX] +
[CODEX] +Keep this guide up to date whenever the test harness, authentication strategy, or project layout changes. New contributors should be able to set up Playwright using only this document.
[CODEX] diff --git a/playwright/README.md b/playwright/README.md
[CODEX] index 58090e78cd0aba7e78a7bd8ce3bf7b7a692ea8ca..02e1939682ff48977eb982bba77319f5e528768a
[CODEX] --- a/playwright/README.md
[CODEX] +++ b/playwright/README.md
[CODEX] @@ -1,5 +1,7 @@
[CODEX] # Vurvey Web Manager Testing Guide
[CODEX] +> **Prefer the canonical [Playwright Testing Guide](../docs/playwright-testing-guide.md)** for the most up-to-date instructions on setup, authoring, and debugging. This file keeps a condensed summary for quick reference.
[CODEX] +
[CODEX] This document provides comprehensive guidance for testing the Vurvey Web Manager application.
[CODEX] ## Overview
[CODEX] thinking
[CODEX] **Planning test updates for documentation changes**
[CODEX] exec
[CODEX] bash -lc 'ls test' in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 45ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] README.md
[CODEX] file update:
[CODEX] diff --git a/DOCUMENTATION.md b/DOCUMENTATION.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e08ed0b3ff8c2fbb63dc3ee675405d59841b6a10
[CODEX] --- /dev/null
[CODEX] +++ b/DOCUMENTATION.md
[CODEX] @@ -0,0 +1,81 @@
[CODEX] +# Vurvey Web Manager Documentation Hub
[CODEX] +
[CODEX] +This hub ties together the architecture, development workflows, and testing resources for the Vurvey Web Manager. Start here for a narrated overview, then dive into the linked guides for deeper detail.
[CODEX] +
[CODEX] +- [Quick Start](#quick-start)
[CODEX] +- [Architecture at a Glance](#architecture-at-a-glance)
[CODEX] +- [Implementation Deep Dive](#implementation-deep-dive)
[CODEX] +- [Testing & Quality Assurance](#testing--quality-assurance)
[CODEX] +- [Operational Playbooks](#operational-playbooks)
[CODEX] +- [Documentation Index](#documentation-index)
[CODEX] +
[CODEX] +## Quick Start
[CODEX] +
[CODEX] +| Task | Command / Resource |
[CODEX] +| --- | --- |
[CODEX] +| Install dependencies | `npm ci` |
[CODEX] +| Run the dev server | `npm start` (defaults to `http://localhost:5050`) |
[CODEX] +| Type-check | `npm run type-check` |
[CODEX] +| Validate GraphQL documents | `npm run validate:graphql` |
[CODEX] +| Run unit/integration tests | `npm run test:unit` |
[CODEX] +| Run Playwright E2E tests | `npm run test:e2e` |
[CODEX] +| Lint source + tests | `npm run lint` |
[CODEX] +
[CODEX] +Environment variables (Firebase, GraphQL endpoint, feature flags) are defined in `.env`. See `docs/README.md#environment-variables` for the full list.
[CODEX] +
[CODEX] +## Architecture at a Glance
[CODEX] +
[CODEX] +- React 18 + TypeScript rendered through Vite.
[CODEX] +- Routing handled via `react-router-dom` with workspace-aware helpers.
[CODEX] +- GraphQL powered by Apollo Client (HTTP + WebSocket links) and LaunchDarkly/OpenFeature feature flag providers.
[CODEX] +- State spans React Contexts, Apollo cache, and reducer-driven component state.
[CODEX] +- Styling leverages SCSS modules and a shared component library under `src/shared`.
[CODEX] +
[CODEX] +Review the [Implementation Guide](docs/implementation-guide.md) for a walkthrough of providers, feature modules, and architectural conventions.
[CODEX] +
[CODEX] +## Implementation Deep Dive
[CODEX] +
[CODEX] +| Topic | Summary |
[CODEX] +| --- | --- |
[CODEX] +| [Implementation Guide](docs/implementation-guide.md) | Entry points, provider stack, routing, feature ownership, build tooling. |
[CODEX] +| [Project Structure](docs/project-structure.md) | Directory breakdown and best practices for adding new files. |
[CODEX] +| [State Management](docs/state-management.md) | Contexts, reducers, and caching strategies. |
[CODEX] +| [GraphQL Integration](docs/graphql-integration.md) | Query organization, code generation, and cache policies. |
[CODEX] +| [Custom Hooks](docs/custom-hooks.md) | Reusable hooks available across features. |
[CODEX] +| [Workflow Builder Guide](docs/workflow-builder-guide.md) | Deep dive into the workflow module architecture. |
[CODEX] +
[CODEX] +When implementing new features, align with the patterns documented in these guides and update them if responsibilities shift.
[CODEX] +
[CODEX] +## Testing & Quality Assurance
[CODEX] +
[CODEX] +- [Playwright Testing Guide](docs/playwright-testing-guide.md) â€“ Environment setup, authentication strategy, authoring conventions, and debugging tips.
[CODEX] +- [E2E Testing Patterns](docs/e2e-testing-patterns.md) â€“ Hard-won lessons for resilient selectors and flows.
[CODEX] +- [Testing Guide](docs/TEST-README.md) â€“ Vitest commands, coverage expectations, and mocking strategies.
[CODEX] +- Unit tests live beside implementation files. E2E specs live under `playwright/tests/`. Follow the documented fixtures/page-object approach for consistency.
[CODEX] +
[CODEX] +## Operational Playbooks
[CODEX] +
[CODEX] +- [Authentication](docs/authentication.md) â€“ Firebase sign-in flows and session persistence.
[CODEX] +- [Core Features](docs/core-features.md) â€“ Feature overviews for stakeholders and QA.
[CODEX] +- [Routes](docs/routes.md) â€“ Navigation map with workspace/context rules.
[CODEX] +- [Smooth Streaming](docs/smooth-streaming.md) & [Chat Streaming](docs/chat-streaming.md) â€“ Real-time infrastructure details.
[CODEX] +- [Test Resilience Strategy](docs/test-resilience-strategy.md) â€“ Stabilization techniques for automated suites.
[CODEX] +
[CODEX] +These playbooks help new engineers and QA members ramp up quickly on specific domains.
[CODEX] +
[CODEX] +## Documentation Index
[CODEX] +
[CODEX] +All documentation lives under the `docs/` directory:
[CODEX] +
[CODEX] +- [docs/README.md](docs/README.md) â€“ Entry point with setup instructions.
[CODEX] +- [docs/components.md](docs/components.md) â€“ Shared component catalogue.
[CODEX] +- [docs/routes.md](docs/routes.md) â€“ Application routing map.
[CODEX] +- [docs/core-features.md](docs/core-features.md) â€“ High-level feature descriptions.
[CODEX] +- [docs/workflow-builder-guide.md](docs/workflow-builder-guide.md) â€“ Workflow builder architecture.
[CODEX] +- [docs/playwright-testing-guide.md](docs/playwright-testing-guide.md) â€“ Comprehensive Playwright usage.
[CODEX] +- [docs/implementation-guide.md](docs/implementation-guide.md) â€“ Frontend implementation detail.
[CODEX] +- [docs/authentication.md](docs/authentication.md) â€“ Auth flows and state storage.
[CODEX] +- [docs/e2e-testing-patterns.md](docs/e2e-testing-patterns.md) â€“ Resilient test strategies.
[CODEX] +- [docs/TEST-README.md](docs/TEST-README.md) â€“ Unit and integration testing commands.
[CODEX] +
[CODEX] +Keep this hub updated as we introduce new docs or migrate content. If a guide becomes outdated, link directly to its successor or fold it into a more relevant document.
[CODEX] diff --git a/README.md b/README.md
[CODEX] index fecb22bce7791f926108dab947b93e75eaa022c7..09e58074104c565a3b4c29c33b94cf57fba373aa
[CODEX] --- a/README.md
[CODEX] +++ b/README.md
[CODEX] @@ -239,8 +239,8 @@
[CODEX] Vurvey Web Manager is the frontend component of the Vurvey platform. It works in conjunction with the Vurvey API backend to provide a complete solution for video-based consumer feedback.
[CODEX] -[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] -[Link to Comprehensive Documentation](../DOCUMENTATION.md)
[CODEX] +[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] +[Documentation Hub](./DOCUMENTATION.md)
[CODEX] ## Setup
[CODEX] diff --git a/docs/README.md b/docs/README.md
[CODEX] index 174c521a012dbbb5ef957dfc29360c9b697c7b6e..5a56517cd1e90833bbcb9dad65d7cb3d620b14c8
[CODEX] --- a/docs/README.md
[CODEX] +++ b/docs/README.md
[CODEX] @@ -19,11 +19,13 @@
[CODEX] ### Getting Started
[CODEX] +- [Implementation Guide](./implementation-guide.md) - How the application is assembled end-to-end
[CODEX] - [Project Structure](./project-structure.md) - Codebase organization
[CODEX] - [Authentication](./authentication.md) - Auth system and user management
[CODEX] - [State Management](./state-management.md) - Context and data flow
[CODEX] - [Routes](./routes.md) - Routing structure and navigation
[CODEX] - [Components](./components.md) - Component library and patterns
[CODEX] +- [Playwright Testing Guide](./playwright-testing-guide.md) - Full Playwright setup and authoring guide
[CODEX] ### Features
[CODEX] @@ -147,6 +149,7 @@
[CODEX] ```
[CODEX] LOGIN_USERNAME="your_test_email"
[CODEX] LOGIN_PASSWORD="your_test_password"
[CODEX] +URL="http://localhost:5050"
[CODEX] ```
[CODEX] ## Best Practices
[CODEX] @@ -181,3 +184,4 @@
[CODEX] - [Playwright Documentation](https://playwright.dev)
[CODEX] - [Apollo Client Documentation](https://www.apollographql.com/docs/react)
[CODEX] - [React Documentation](https://react.dev)
[CODEX] +- [Documentation Hub](../DOCUMENTATION.md) for an index of project guides
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] diff --git a/docs/playwright-testing-guide.md b/docs/playwright-testing-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..acbab280a49d446cc89ce7ea1e6de422380736ca
[CODEX] --- /dev/null
[CODEX] +++ b/docs/playwright-testing-guide.md
[CODEX] @@ -0,0 +1,161 @@
[CODEX] +# Playwright Testing Guide
[CODEX] +
[CODEX] +This guide explains how to configure, run, and extend the Playwright end-to-end test suite for Vurvey Web Manager.
[CODEX] +
[CODEX] +- [Overview](#overview)
[CODEX] +- [Directory Layout](#directory-layout)
[CODEX] +- [Environment Setup](#environment-setup)
[CODEX] +- [Running Tests](#running-tests)
[CODEX] +- [Authentication Workflow](#authentication-workflow)
[CODEX] +- [Writing & Organizing Tests](#writing--organizing-tests)
[CODEX] +- [Debugging & Diagnostics](#debugging--diagnostics)
[CODEX] +- [Continuous Integration](#continuous-integration)
[CODEX] +- [Reference Material](#reference-material)
[CODEX] +
[CODEX] +## Overview
[CODEX] +
[CODEX] +Playwright exercises the full React application in a Chromium browser using the configuration defined in `playwright.config.ts`. Tests rely on Firebase authentication, Apollo GraphQL, and feature flags, so a stable backend environment and test credentials are required.
[CODEX] +
[CODEX] +Key characteristics:
[CODEX] +
[CODEX] +- Tests live in `playwright/tests/*.spec.ts`.
[CODEX] +- A dedicated `setup` project seeds authentication (`auth.setup.ts`) and persists storage state to `playwright/.auth/user.json`.
[CODEX] +- Default executions run headless Chromium with `slowMo: 50` to reduce flakiness; override these options when debugging.
[CODEX] +
[CODEX] +## Directory Layout
[CODEX] +
[CODEX] +```
[CODEX] +playwright/
[CODEX] +â”œâ”€â”€ fixtures/                 # Test data assets (clips, csv, pdf, images)
[CODEX] +â”œâ”€â”€ helpers/                  # Utility helpers (authentication, navigation)
[CODEX] +â”œâ”€â”€ page-objects/             # Page object abstractions for complex flows
[CODEX] +â”œâ”€â”€ tests/                    # Spec files + global setup (auth.setup.ts)
[CODEX] +â”œâ”€â”€ env.d.ts                  # Type declarations for Playwright globals
[CODEX] +â””â”€â”€ README.md                 # High-level summary (links back to this guide)
[CODEX] +```
[CODEX] +
[CODEX] +Keep common logic in helpers or page objects instead of duplicating it inside specs. Fixtures should hold deterministic assets that can be reused across scenarios.
[CODEX] +
[CODEX] +## Environment Setup
[CODEX] +
[CODEX] +1. **Install dependencies**
[CODEX] +
[CODEX] +   ```bash
[CODEX] +   npm ci
[CODEX] +   npx playwright install
[CODEX] +   ```
[CODEX] +
[CODEX] +2. **Configure environment variables**
[CODEX] +
[CODEX] +   - Create `./playwright/.env` with the fields referenced in tests:
[CODEX] +
[CODEX] +     ```ini
[CODEX] +     URL=http://localhost:5050
[CODEX] +     LOGIN_USERNAME=tester@example.com
[CODEX] +     LOGIN_PASSWORD=super-secret
[CODEX] +     ```
[CODEX] +
[CODEX] +   - Variables defined in the repository root `.env` are also loaded. `URL` must match the origin where the web manager is running.
[CODEX] +
[CODEX] +3. **Launch the application backend**
[CODEX] +
[CODEX] +   - Ensure the Vurvey API and any dependent services are running; Playwright interacts with the live stack.
[CODEX] +   - Start the web manager locally with `npm start` or point `URL` at a staging environment.
[CODEX] +
[CODEX] +4. **Seed authentication state**
[CODEX] +
[CODEX] +   - The first test run invokes `auth.setup.ts`, which stores Firebase credentials in IndexedDB and writes a Playwright storage file (`playwright/.auth/user.json`).
[CODEX] +   - This file is reused by dependent projects so subsequent tests start in an authenticated session.
[CODEX] +
[CODEX] +## Running Tests
[CODEX] +
[CODEX] +Common commands:
[CODEX] +
[CODEX] +```bash
[CODEX] +# Run the full E2E suite
[CODEX] +npx playwright test
[CODEX] +
[CODEX] +# Run a specific spec
[CODEX] +npx playwright test playwright/tests/navigation.spec.ts
[CODEX] +
[CODEX] +# Filter by title
[CODEX] +npx playwright test --grep "@smoke"
[CODEX] +
[CODEX] +# Headed (visible) mode
[CODEX] +npx playwright test --headed
[CODEX] +
[CODEX] +# Debug mode with inspector
[CODEX] +npx playwright test --debug
[CODEX] +
[CODEX] +# Use the Playwright UI
[CODEX] +npx playwright test --ui
[CODEX] +```
[CODEX] +
[CODEX] +Project configuration (browser, base URL, reporters) lives in `playwright.config.ts`. Edit that file to add new projects (e.g., Firefox coverage) or alternative reporters.
[CODEX] +
[CODEX] +## Authentication Workflow
[CODEX] +
[CODEX] +Authentication uses Firebase persistence inside IndexedDB:
[CODEX] +
[CODEX] +1. `auth.setup.ts` logs in through the UI using `LOGIN_USERNAME` and `LOGIN_PASSWORD`.
[CODEX] +2. The helper `saveFirebaseAuthData` captures Firebase data from IndexedDB and writes it to `localStorage`.
[CODEX] +3. The storage state is exported to `playwright/.auth/user.json`.
[CODEX] +4. Individual specs call `restoreFirebaseAuthData` via helper utilities before navigating, ensuring a valid session without re-running the login flow.
[CODEX] +
[CODEX] +If you see `No auth data found in localStorage`, run the setup project again (`npx playwright test --project setup`). When credentials rotate, delete `playwright/.auth/user.json` and re-run the suite.
[CODEX] +
[CODEX] +## Writing & Organizing Tests
[CODEX] +
[CODEX] +- **Use fixtures**: Import reusable flows (e.g., `authenticate`) from `playwright/helpers`. Define domain-specific fixtures when a scenario needs shared setup and teardown.
[CODEX] +- **Prefer page objects**: Complex interactions such as the workflow builder or agent editor should be encapsulated in `playwright/page-objects` classes. Create methods that describe user intent (`workflowBuilder.publishFlow()`), not DOM mechanics.
[CODEX] +- **Selectors**: Lean on accessible selectors (`getByRole`, `getByLabel`, `getByTestId`). Fall back to data attributes when elements lack semantic handles. Avoid brittle CSS selectors.
[CODEX] +- **Organization**: Group related specs in `test.describe`. Tag critical smoke tests with `@smoke` for quick feedback loops.
[CODEX] +- **Time-sensitive flows**: Use `await expect(...).toBeVisible({ timeout: 30_000 })` for network-heavy screens. The global `expect` timeout already defaults to 30 seconds; override locally when necessary.
[CODEX] +- **Artifacts**: Use `test.info().attach` to capture domain-specific logs. Screenshots happen automatically on failure, but explicit captures help with mid-test diagnostics.
[CODEX] +
[CODEX] +Example skeleton:
[CODEX] +
[CODEX] +```ts
[CODEX] +import {test, expect} from "@playwright/test";
[CODEX] +import {authenticate} from "../helpers/authentication";
[CODEX] +import {DashboardPage} from "../page-objects/dashboard-page";
[CODEX] +
[CODEX] +test.describe("Dashboard", () => {
[CODEX] +  test.beforeEach(async ({page}) => {
[CODEX] +    await authenticate(page);
[CODEX] +  });
[CODEX] +
[CODEX] +  test("shows the active workspace summary @smoke", async ({page}) => {
[CODEX] +    const dashboard = new DashboardPage(page);
[CODEX] +    await dashboard.goto();
[CODEX] +    await expect(dashboard.header).toContainText("Workspace Overview");
[CODEX] +  });
[CODEX] +});
[CODEX] +```
[CODEX] +
[CODEX] +## Debugging & Diagnostics
[CODEX] +
[CODEX] +- **Trace Viewer**: Re-run failing tests with `npx playwright test --trace on-first-retry` to collect DOM snapshots, network logs, and console output.
[CODEX] +- **Video & screenshots**: Enable via `use: { video: "retain-on-failure", screenshot: "only-on-failure" }` either per test or globally in `playwright.config.ts`.
[CODEX] +- **Console logging**: Place strategic `console.log` statements in specs or helpers when investigating flaky behavior. Remove them once resolved to keep logs clean.
[CODEX] +- **Network mocking**: Stub GraphQL or REST endpoints with `page.route` for deterministic results when backend data is unavailable. Maintain mocks under `playwright/helpers/network`.
[CODEX] +
[CODEX] +When a test flakes, capture the trace, verify selectors still match the rendered UI, and ensure required feature flags are enabled for the environment.
[CODEX] +
[CODEX] +## Continuous Integration
[CODEX] +
[CODEX] +- CI pipelines call `npx playwright test` with the same configuration. Ensure new specs respect the single-worker execution configuration (`workers: 1`) unless you explicitly parallelize them.
[CODEX] +- Store credentials (username, password, URL) in the CI secret store. The setup project fails fast if they are missing.
[CODEX] +- Upload `test-results/` (HTML reporter output) as an artifact for post-run inspection.
[CODEX] +
[CODEX] +Before merging, run the suite locally or in a dry-run environment to catch environment-specific regressions early.
[CODEX] +
[CODEX] +## Reference Material
[CODEX] +
[CODEX] +- [Playwright Configuration](../playwright.config.ts)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +- [Testing Guide (unit + integration)](./TEST-README.md)
[CODEX] +- [Implementation Guide](./implementation-guide.md)
[CODEX] +- [Official Playwright Docs](https://playwright.dev/docs/intro)
[CODEX] +
[CODEX] +Keep this guide up to date whenever the test harness, authentication strategy, or project layout changes. New contributors should be able to set up Playwright using only this document.
[CODEX] diff --git a/playwright/README.md b/playwright/README.md
[CODEX] index 58090e78cd0aba7e78a7bd8ce3bf7b7a692ea8ca..02e1939682ff48977eb982bba77319f5e528768a
[CODEX] --- a/playwright/README.md
[CODEX] +++ b/playwright/README.md
[CODEX] @@ -1,5 +1,7 @@
[CODEX] # Vurvey Web Manager Testing Guide
[CODEX] +> **Prefer the canonical [Playwright Testing Guide](../docs/playwright-testing-guide.md)** for the most up-to-date instructions on setup, authoring, and debugging. This file keeps a condensed summary for quick reference.
[CODEX] +
[CODEX] This document provides comprehensive guidance for testing the Vurvey Web Manager application.
[CODEX] ## Overview
[CODEX] thinking
[CODEX] **Checking test setup configuration**
[CODEX] exec
[CODEX] bash -lc "sed -n '1,160p' vitest.config.ts" in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 61ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] import {defineConfig} from "vitest/config";
[CODEX] import react from "@vitejs/plugin-react";
[CODEX] import {resolve} from "path";
[CODEX] export default defineConfig({
[CODEX] plugins: [react()],
[CODEX] test: {
[CODEX] globals: true,
[CODEX] environment: "jsdom",
[CODEX] setupFiles: ["./src/test/setup.ts"],
[CODEX] include: ["**/*.{test,spec}.{ts,tsx}"],
[CODEX] exclude: [
[CODEX] "**/node_modules/**",
[CODEX] "**/dist/**",
[CODEX] "**/playwright/**",
[CODEX] "**/flow-builder.integration.test.tsx",
[CODEX] "**/workflow-page.integration.test.tsx",
[CODEX] "**/input-bubble.test.tsx",
[CODEX] "**/sources-section.test.tsx",
[CODEX] file update:
[CODEX] diff --git a/DOCUMENTATION.md b/DOCUMENTATION.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e08ed0b3ff8c2fbb63dc3ee675405d59841b6a10
[CODEX] --- /dev/null
[CODEX] +++ b/DOCUMENTATION.md
[CODEX] @@ -0,0 +1,81 @@
[CODEX] +# Vurvey Web Manager Documentation Hub
[CODEX] +
[CODEX] +This hub ties together the architecture, development workflows, and testing resources for the Vurvey Web Manager. Start here for a narrated overview, then dive into the linked guides for deeper detail.
[CODEX] +
[CODEX] +- [Quick Start](#quick-start)
[CODEX] +- [Architecture at a Glance](#architecture-at-a-glance)
[CODEX] +- [Implementation Deep Dive](#implementation-deep-dive)
[CODEX] +- [Testing & Quality Assurance](#testing--quality-assurance)
[CODEX] +- [Operational Playbooks](#operational-playbooks)
[CODEX] +- [Documentation Index](#documentation-index)
[CODEX] +
[CODEX] +## Quick Start
[CODEX] +
[CODEX] +| Task | Command / Resource |
[CODEX] +| --- | --- |
[CODEX] +| Install dependencies | `npm ci` |
[CODEX] +| Run the dev server | `npm start` (defaults to `http://localhost:5050`) |
[CODEX] +| Type-check | `npm run type-check` |
[CODEX] +| Validate GraphQL documents | `npm run validate:graphql` |
[CODEX] +| Run unit/integration tests | `npm run test:unit` |
[CODEX] +| Run Playwright E2E tests | `npm run test:e2e` |
[CODEX] +| Lint source + tests | `npm run lint` |
[CODEX] +
[CODEX] +Environment variables (Firebase, GraphQL endpoint, feature flags) are defined in `.env`. See `docs/README.md#environment-variables` for the full list.
[CODEX] +
[CODEX] +## Architecture at a Glance
[CODEX] +
[CODEX] +- React 18 + TypeScript rendered through Vite.
[CODEX] +- Routing handled via `react-router-dom` with workspace-aware helpers.
[CODEX] +- GraphQL powered by Apollo Client (HTTP + WebSocket links) and LaunchDarkly/OpenFeature feature flag providers.
[CODEX] +- State spans React Contexts, Apollo cache, and reducer-driven component state.
[CODEX] +- Styling leverages SCSS modules and a shared component library under `src/shared`.
[CODEX] +
[CODEX] +Review the [Implementation Guide](docs/implementation-guide.md) for a walkthrough of providers, feature modules, and architectural conventions.
[CODEX] +
[CODEX] +## Implementation Deep Dive
[CODEX] +
[CODEX] +| Topic | Summary |
[CODEX] +| --- | --- |
[CODEX] +| [Implementation Guide](docs/implementation-guide.md) | Entry points, provider stack, routing, feature ownership, build tooling. |
[CODEX] +| [Project Structure](docs/project-structure.md) | Directory breakdown and best practices for adding new files. |
[CODEX] +| [State Management](docs/state-management.md) | Contexts, reducers, and caching strategies. |
[CODEX] +| [GraphQL Integration](docs/graphql-integration.md) | Query organization, code generation, and cache policies. |
[CODEX] +| [Custom Hooks](docs/custom-hooks.md) | Reusable hooks available across features. |
[CODEX] +| [Workflow Builder Guide](docs/workflow-builder-guide.md) | Deep dive into the workflow module architecture. |
[CODEX] +
[CODEX] +When implementing new features, align with the patterns documented in these guides and update them if responsibilities shift.
[CODEX] +
[CODEX] +## Testing & Quality Assurance
[CODEX] +
[CODEX] +- [Playwright Testing Guide](docs/playwright-testing-guide.md) â€“ Environment setup, authentication strategy, authoring conventions, and debugging tips.
[CODEX] +- [E2E Testing Patterns](docs/e2e-testing-patterns.md) â€“ Hard-won lessons for resilient selectors and flows.
[CODEX] +- [Testing Guide](docs/TEST-README.md) â€“ Vitest commands, coverage expectations, and mocking strategies.
[CODEX] +- Unit tests live beside implementation files. E2E specs live under `playwright/tests/`. Follow the documented fixtures/page-object approach for consistency.
[CODEX] +
[CODEX] +## Operational Playbooks
[CODEX] +
[CODEX] +- [Authentication](docs/authentication.md) â€“ Firebase sign-in flows and session persistence.
[CODEX] +- [Core Features](docs/core-features.md) â€“ Feature overviews for stakeholders and QA.
[CODEX] +- [Routes](docs/routes.md) â€“ Navigation map with workspace/context rules.
[CODEX] +- [Smooth Streaming](docs/smooth-streaming.md) & [Chat Streaming](docs/chat-streaming.md) â€“ Real-time infrastructure details.
[CODEX] +- [Test Resilience Strategy](docs/test-resilience-strategy.md) â€“ Stabilization techniques for automated suites.
[CODEX] +
[CODEX] +These playbooks help new engineers and QA members ramp up quickly on specific domains.
[CODEX] +
[CODEX] +## Documentation Index
[CODEX] +
[CODEX] +All documentation lives under the `docs/` directory:
[CODEX] +
[CODEX] +- [docs/README.md](docs/README.md) â€“ Entry point with setup instructions.
[CODEX] +- [docs/components.md](docs/components.md) â€“ Shared component catalogue.
[CODEX] +- [docs/routes.md](docs/routes.md) â€“ Application routing map.
[CODEX] +- [docs/core-features.md](docs/core-features.md) â€“ High-level feature descriptions.
[CODEX] +- [docs/workflow-builder-guide.md](docs/workflow-builder-guide.md) â€“ Workflow builder architecture.
[CODEX] +- [docs/playwright-testing-guide.md](docs/playwright-testing-guide.md) â€“ Comprehensive Playwright usage.
[CODEX] +- [docs/implementation-guide.md](docs/implementation-guide.md) â€“ Frontend implementation detail.
[CODEX] +- [docs/authentication.md](docs/authentication.md) â€“ Auth flows and state storage.
[CODEX] +- [docs/e2e-testing-patterns.md](docs/e2e-testing-patterns.md) â€“ Resilient test strategies.
[CODEX] +- [docs/TEST-README.md](docs/TEST-README.md) â€“ Unit and integration testing commands.
[CODEX] +
[CODEX] +Keep this hub updated as we introduce new docs or migrate content. If a guide becomes outdated, link directly to its successor or fold it into a more relevant document.
[CODEX] diff --git a/README.md b/README.md
[CODEX] index fecb22bce7791f926108dab947b93e75eaa022c7..09e58074104c565a3b4c29c33b94cf57fba373aa
[CODEX] --- a/README.md
[CODEX] +++ b/README.md
[CODEX] @@ -239,8 +239,8 @@
[CODEX] Vurvey Web Manager is the frontend component of the Vurvey platform. It works in conjunction with the Vurvey API backend to provide a complete solution for video-based consumer feedback.
[CODEX] -[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] -[Link to Comprehensive Documentation](../DOCUMENTATION.md)
[CODEX] +[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] +[Documentation Hub](./DOCUMENTATION.md)
[CODEX] ## Setup
[CODEX] diff --git a/docs/README.md b/docs/README.md
[CODEX] index 174c521a012dbbb5ef957dfc29360c9b697c7b6e..5a56517cd1e90833bbcb9dad65d7cb3d620b14c8
[CODEX] --- a/docs/README.md
[CODEX] +++ b/docs/README.md
[CODEX] @@ -19,11 +19,13 @@
[CODEX] ### Getting Started
[CODEX] +- [Implementation Guide](./implementation-guide.md) - How the application is assembled end-to-end
[CODEX] - [Project Structure](./project-structure.md) - Codebase organization
[CODEX] - [Authentication](./authentication.md) - Auth system and user management
[CODEX] - [State Management](./state-management.md) - Context and data flow
[CODEX] - [Routes](./routes.md) - Routing structure and navigation
[CODEX] - [Components](./components.md) - Component library and patterns
[CODEX] +- [Playwright Testing Guide](./playwright-testing-guide.md) - Full Playwright setup and authoring guide
[CODEX] ### Features
[CODEX] @@ -147,6 +149,7 @@
[CODEX] ```
[CODEX] LOGIN_USERNAME="your_test_email"
[CODEX] LOGIN_PASSWORD="your_test_password"
[CODEX] +URL="http://localhost:5050"
[CODEX] ```
[CODEX] ## Best Practices
[CODEX] @@ -181,3 +184,4 @@
[CODEX] - [Playwright Documentation](https://playwright.dev)
[CODEX] - [Apollo Client Documentation](https://www.apollographql.com/docs/react)
[CODEX] - [React Documentation](https://react.dev)
[CODEX] +- [Documentation Hub](../DOCUMENTATION.md) for an index of project guides
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] diff --git a/docs/playwright-testing-guide.md b/docs/playwright-testing-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..acbab280a49d446cc89ce7ea1e6de422380736ca
[CODEX] --- /dev/null
[CODEX] +++ b/docs/playwright-testing-guide.md
[CODEX] @@ -0,0 +1,161 @@
[CODEX] +# Playwright Testing Guide
[CODEX] +
[CODEX] +This guide explains how to configure, run, and extend the Playwright end-to-end test suite for Vurvey Web Manager.
[CODEX] +
[CODEX] +- [Overview](#overview)
[CODEX] +- [Directory Layout](#directory-layout)
[CODEX] +- [Environment Setup](#environment-setup)
[CODEX] +- [Running Tests](#running-tests)
[CODEX] +- [Authentication Workflow](#authentication-workflow)
[CODEX] +- [Writing & Organizing Tests](#writing--organizing-tests)
[CODEX] +- [Debugging & Diagnostics](#debugging--diagnostics)
[CODEX] +- [Continuous Integration](#continuous-integration)
[CODEX] +- [Reference Material](#reference-material)
[CODEX] +
[CODEX] +## Overview
[CODEX] +
[CODEX] +Playwright exercises the full React application in a Chromium browser using the configuration defined in `playwright.config.ts`. Tests rely on Firebase authentication, Apollo GraphQL, and feature flags, so a stable backend environment and test credentials are required.
[CODEX] +
[CODEX] +Key characteristics:
[CODEX] +
[CODEX] +- Tests live in `playwright/tests/*.spec.ts`.
[CODEX] +- A dedicated `setup` project seeds authentication (`auth.setup.ts`) and persists storage state to `playwright/.auth/user.json`.
[CODEX] +- Default executions run headless Chromium with `slowMo: 50` to reduce flakiness; override these options when debugging.
[CODEX] +
[CODEX] +## Directory Layout
[CODEX] +
[CODEX] +```
[CODEX] +playwright/
[CODEX] +â”œâ”€â”€ fixtures/                 # Test data assets (clips, csv, pdf, images)
[CODEX] +â”œâ”€â”€ helpers/                  # Utility helpers (authentication, navigation)
[CODEX] +â”œâ”€â”€ page-objects/             # Page object abstractions for complex flows
[CODEX] +â”œâ”€â”€ tests/                    # Spec files + global setup (auth.setup.ts)
[CODEX] +â”œâ”€â”€ env.d.ts                  # Type declarations for Playwright globals
[CODEX] +â””â”€â”€ README.md                 # High-level summary (links back to this guide)
[CODEX] +```
[CODEX] +
[CODEX] +Keep common logic in helpers or page objects instead of duplicating it inside specs. Fixtures should hold deterministic assets that can be reused across scenarios.
[CODEX] +
[CODEX] +## Environment Setup
[CODEX] +
[CODEX] +1. **Install dependencies**
[CODEX] +
[CODEX] +   ```bash
[CODEX] +   npm ci
[CODEX] +   npx playwright install
[CODEX] +   ```
[CODEX] +
[CODEX] +2. **Configure environment variables**
[CODEX] +
[CODEX] +   - Create `./playwright/.env` with the fields referenced in tests:
[CODEX] +
[CODEX] +     ```ini
[CODEX] +     URL=http://localhost:5050
[CODEX] +     LOGIN_USERNAME=tester@example.com
[CODEX] +     LOGIN_PASSWORD=super-secret
[CODEX] +     ```
[CODEX] +
[CODEX] +   - Variables defined in the repository root `.env` are also loaded. `URL` must match the origin where the web manager is running.
[CODEX] +
[CODEX] +3. **Launch the application backend**
[CODEX] +
[CODEX] +   - Ensure the Vurvey API and any dependent services are running; Playwright interacts with the live stack.
[CODEX] +   - Start the web manager locally with `npm start` or point `URL` at a staging environment.
[CODEX] +
[CODEX] +4. **Seed authentication state**
[CODEX] +
[CODEX] +   - The first test run invokes `auth.setup.ts`, which stores Firebase credentials in IndexedDB and writes a Playwright storage file (`playwright/.auth/user.json`).
[CODEX] +   - This file is reused by dependent projects so subsequent tests start in an authenticated session.
[CODEX] +
[CODEX] +## Running Tests
[CODEX] +
[CODEX] +Common commands:
[CODEX] +
[CODEX] +```bash
[CODEX] +# Run the full E2E suite
[CODEX] +npx playwright test
[CODEX] +
[CODEX] +# Run a specific spec
[CODEX] +npx playwright test playwright/tests/navigation.spec.ts
[CODEX] +
[CODEX] +# Filter by title
[CODEX] +npx playwright test --grep "@smoke"
[CODEX] +
[CODEX] +# Headed (visible) mode
[CODEX] +npx playwright test --headed
[CODEX] +
[CODEX] +# Debug mode with inspector
[CODEX] +npx playwright test --debug
[CODEX] +
[CODEX] +# Use the Playwright UI
[CODEX] +npx playwright test --ui
[CODEX] +```
[CODEX] +
[CODEX] +Project configuration (browser, base URL, reporters) lives in `playwright.config.ts`. Edit that file to add new projects (e.g., Firefox coverage) or alternative reporters.
[CODEX] +
[CODEX] +## Authentication Workflow
[CODEX] +
[CODEX] +Authentication uses Firebase persistence inside IndexedDB:
[CODEX] +
[CODEX] +1. `auth.setup.ts` logs in through the UI using `LOGIN_USERNAME` and `LOGIN_PASSWORD`.
[CODEX] +2. The helper `saveFirebaseAuthData` captures Firebase data from IndexedDB and writes it to `localStorage`.
[CODEX] +3. The storage state is exported to `playwright/.auth/user.json`.
[CODEX] +4. Individual specs call `restoreFirebaseAuthData` via helper utilities before navigating, ensuring a valid session without re-running the login flow.
[CODEX] +
[CODEX] +If you see `No auth data found in localStorage`, run the setup project again (`npx playwright test --project setup`). When credentials rotate, delete `playwright/.auth/user.json` and re-run the suite.
[CODEX] +
[CODEX] +## Writing & Organizing Tests
[CODEX] +
[CODEX] +- **Use fixtures**: Import reusable flows (e.g., `authenticate`) from `playwright/helpers`. Define domain-specific fixtures when a scenario needs shared setup and teardown.
[CODEX] +- **Prefer page objects**: Complex interactions such as the workflow builder or agent editor should be encapsulated in `playwright/page-objects` classes. Create methods that describe user intent (`workflowBuilder.publishFlow()`), not DOM mechanics.
[CODEX] +- **Selectors**: Lean on accessible selectors (`getByRole`, `getByLabel`, `getByTestId`). Fall back to data attributes when elements lack semantic handles. Avoid brittle CSS selectors.
[CODEX] +- **Organization**: Group related specs in `test.describe`. Tag critical smoke tests with `@smoke` for quick feedback loops.
[CODEX] +- **Time-sensitive flows**: Use `await expect(...).toBeVisible({ timeout: 30_000 })` for network-heavy screens. The global `expect` timeout already defaults to 30 seconds; override locally when necessary.
[CODEX] +- **Artifacts**: Use `test.info().attach` to capture domain-specific logs. Screenshots happen automatically on failure, but explicit captures help with mid-test diagnostics.
[CODEX] +
[CODEX] +Example skeleton:
[CODEX] +
[CODEX] +```ts
[CODEX] +import {test, expect} from "@playwright/test";
[CODEX] +import {authenticate} from "../helpers/authentication";
[CODEX] +import {DashboardPage} from "../page-objects/dashboard-page";
[CODEX] +
[CODEX] +test.describe("Dashboard", () => {
[CODEX] +  test.beforeEach(async ({page}) => {
[CODEX] +    await authenticate(page);
[CODEX] +  });
[CODEX] +
[CODEX] +  test("shows the active workspace summary @smoke", async ({page}) => {
[CODEX] +    const dashboard = new DashboardPage(page);
[CODEX] +    await dashboard.goto();
[CODEX] +    await expect(dashboard.header).toContainText("Workspace Overview");
[CODEX] +  });
[CODEX] +});
[CODEX] +```
[CODEX] +
[CODEX] +## Debugging & Diagnostics
[CODEX] +
[CODEX] +- **Trace Viewer**: Re-run failing tests with `npx playwright test --trace on-first-retry` to collect DOM snapshots, network logs, and console output.
[CODEX] +- **Video & screenshots**: Enable via `use: { video: "retain-on-failure", screenshot: "only-on-failure" }` either per test or globally in `playwright.config.ts`.
[CODEX] +- **Console logging**: Place strategic `console.log` statements in specs or helpers when investigating flaky behavior. Remove them once resolved to keep logs clean.
[CODEX] +- **Network mocking**: Stub GraphQL or REST endpoints with `page.route` for deterministic results when backend data is unavailable. Maintain mocks under `playwright/helpers/network`.
[CODEX] +
[CODEX] +When a test flakes, capture the trace, verify selectors still match the rendered UI, and ensure required feature flags are enabled for the environment.
[CODEX] +
[CODEX] +## Continuous Integration
[CODEX] +
[CODEX] +- CI pipelines call `npx playwright test` with the same configuration. Ensure new specs respect the single-worker execution configuration (`workers: 1`) unless you explicitly parallelize them.
[CODEX] +- Store credentials (username, password, URL) in the CI secret store. The setup project fails fast if they are missing.
[CODEX] +- Upload `test-results/` (HTML reporter output) as an artifact for post-run inspection.
[CODEX] +
[CODEX] +Before merging, run the suite locally or in a dry-run environment to catch environment-specific regressions early.
[CODEX] +
[CODEX] +## Reference Material
[CODEX] +
[CODEX] +- [Playwright Configuration](../playwright.config.ts)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +- [Testing Guide (unit + integration)](./TEST-README.md)
[CODEX] +- [Implementation Guide](./implementation-guide.md)
[CODEX] +- [Official Playwright Docs](https://playwright.dev/docs/intro)
[CODEX] +
[CODEX] +Keep this guide up to date whenever the test harness, authentication strategy, or project layout changes. New contributors should be able to set up Playwright using only this document.
[CODEX] diff --git a/playwright/README.md b/playwright/README.md
[CODEX] index 58090e78cd0aba7e78a7bd8ce3bf7b7a692ea8ca..02e1939682ff48977eb982bba77319f5e528768a
[CODEX] --- a/playwright/README.md
[CODEX] +++ b/playwright/README.md
[CODEX] @@ -1,5 +1,7 @@
[CODEX] # Vurvey Web Manager Testing Guide
[CODEX] +> **Prefer the canonical [Playwright Testing Guide](../docs/playwright-testing-guide.md)** for the most up-to-date instructions on setup, authoring, and debugging. This file keeps a condensed summary for quick reference.
[CODEX] +
[CODEX] This document provides comprehensive guidance for testing the Vurvey Web Manager application.
[CODEX] ## Overview
[CLAUDE]   ğŸ”§ Write
[CODEX] thinking
[CODEX] **Planning new documentation test placement**
[CLAUDE]   ğŸ”§ TodoWrite
[CODEX] file update
[CODEX] A /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6/src/shared/__tests__/documentation-links.test.ts
[CODEX] import {readFileSync} from "node:fs";
[CODEX] import {resolve} from "node:path";
[CODEX] import {describe, expect, it} from "vitest";
[CODEX] const readDoc = (relativePath: string): string => {
[CODEX] const filePath = resolve(__dirname, relativePath);
[CODEX] return readFileSync(filePath, "utf8");
[CODEX] };
[CODEX] describe("Project documentation", () => {
[CODEX] it("keeps the documentation hub index up to date", () => {
[CODEX] const documentation = readDoc("../../../DOCUMENTATION.md");
[CODEX] expect(documentation).toContain("[Implementation Guide](docs/implementation-guide.md)");
[CODEX] expect(documentation).toContain("[Playwright Testing Guide](docs/playwright-testing-guide.md)");
[CODEX] });
[CODEX] it("mirrors the new guides inside docs/README", () => {
[CODEX] const docsReadme = readDoc("../../../docs/README.md");
[CODEX] expect(docsReadme).toContain("./implementation-guide.md");
[CODEX] expect(docsReadme).toContain("./playwright-testing-guide.md");
[CODEX] });
[CODEX] });
[CODEX] apply_patch(auto_approved=true) exited 0 in 77ms:
[CODEX] Success. Updated the following files:
[CODEX] A src/shared/__tests__/documentation-links.test.ts
[CODEX] file update:
[CODEX] diff --git a/DOCUMENTATION.md b/DOCUMENTATION.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e08ed0b3ff8c2fbb63dc3ee675405d59841b6a10
[CODEX] --- /dev/null
[CODEX] +++ b/DOCUMENTATION.md
[CODEX] @@ -0,0 +1,81 @@
[CODEX] +# Vurvey Web Manager Documentation Hub
[CODEX] +
[CODEX] +This hub ties together the architecture, development workflows, and testing resources for the Vurvey Web Manager. Start here for a narrated overview, then dive into the linked guides for deeper detail.
[CODEX] +
[CODEX] +- [Quick Start](#quick-start)
[CODEX] +- [Architecture at a Glance](#architecture-at-a-glance)
[CODEX] +- [Implementation Deep Dive](#implementation-deep-dive)
[CODEX] +- [Testing & Quality Assurance](#testing--quality-assurance)
[CODEX] +- [Operational Playbooks](#operational-playbooks)
[CODEX] +- [Documentation Index](#documentation-index)
[CODEX] +
[CODEX] +## Quick Start
[CODEX] +
[CODEX] +| Task | Command / Resource |
[CODEX] +| --- | --- |
[CODEX] +| Install dependencies | `npm ci` |
[CODEX] +| Run the dev server | `npm start` (defaults to `http://localhost:5050`) |
[CODEX] +| Type-check | `npm run type-check` |
[CODEX] +| Validate GraphQL documents | `npm run validate:graphql` |
[CODEX] +| Run unit/integration tests | `npm run test:unit` |
[CODEX] +| Run Playwright E2E tests | `npm run test:e2e` |
[CODEX] +| Lint source + tests | `npm run lint` |
[CODEX] +
[CODEX] +Environment variables (Firebase, GraphQL endpoint, feature flags) are defined in `.env`. See `docs/README.md#environment-variables` for the full list.
[CODEX] +
[CODEX] +## Architecture at a Glance
[CODEX] +
[CODEX] +- React 18 + TypeScript rendered through Vite.
[CODEX] +- Routing handled via `react-router-dom` with workspace-aware helpers.
[CODEX] +- GraphQL powered by Apollo Client (HTTP + WebSocket links) and LaunchDarkly/OpenFeature feature flag providers.
[CODEX] +- State spans React Contexts, Apollo cache, and reducer-driven component state.
[CODEX] +- Styling leverages SCSS modules and a shared component library under `src/shared`.
[CODEX] +
[CODEX] +Review the [Implementation Guide](docs/implementation-guide.md) for a walkthrough of providers, feature modules, and architectural conventions.
[CODEX] +
[CODEX] +## Implementation Deep Dive
[CODEX] +
[CODEX] +| Topic | Summary |
[CODEX] +| --- | --- |
[CODEX] +| [Implementation Guide](docs/implementation-guide.md) | Entry points, provider stack, routing, feature ownership, build tooling. |
[CODEX] +| [Project Structure](docs/project-structure.md) | Directory breakdown and best practices for adding new files. |
[CODEX] +| [State Management](docs/state-management.md) | Contexts, reducers, and caching strategies. |
[CODEX] +| [GraphQL Integration](docs/graphql-integration.md) | Query organization, code generation, and cache policies. |
[CODEX] +| [Custom Hooks](docs/custom-hooks.md) | Reusable hooks available across features. |
[CODEX] +| [Workflow Builder Guide](docs/workflow-builder-guide.md) | Deep dive into the workflow module architecture. |
[CODEX] +
[CODEX] +When implementing new features, align with the patterns documented in these guides and update them if responsibilities shift.
[CODEX] +
[CODEX] +## Testing & Quality Assurance
[CODEX] +
[CODEX] +- [Playwright Testing Guide](docs/playwright-testing-guide.md) â€“ Environment setup, authentication strategy, authoring conventions, and debugging tips.
[CODEX] +- [E2E Testing Patterns](docs/e2e-testing-patterns.md) â€“ Hard-won lessons for resilient selectors and flows.
[CODEX] +- [Testing Guide](docs/TEST-README.md) â€“ Vitest commands, coverage expectations, and mocking strategies.
[CODEX] +- Unit tests live beside implementation files. E2E specs live under `playwright/tests/`. Follow the documented fixtures/page-object approach for consistency.
[CODEX] +
[CODEX] +## Operational Playbooks
[CODEX] +
[CODEX] +- [Authentication](docs/authentication.md) â€“ Firebase sign-in flows and session persistence.
[CODEX] +- [Core Features](docs/core-features.md) â€“ Feature overviews for stakeholders and QA.
[CODEX] +- [Routes](docs/routes.md) â€“ Navigation map with workspace/context rules.
[CODEX] +- [Smooth Streaming](docs/smooth-streaming.md) & [Chat Streaming](docs/chat-streaming.md) â€“ Real-time infrastructure details.
[CODEX] +- [Test Resilience Strategy](docs/test-resilience-strategy.md) â€“ Stabilization techniques for automated suites.
[CODEX] +
[CODEX] +These playbooks help new engineers and QA members ramp up quickly on specific domains.
[CODEX] +
[CODEX] +## Documentation Index
[CODEX] +
[CODEX] +All documentation lives under the `docs/` directory:
[CODEX] +
[CODEX] +- [docs/README.md](docs/README.md) â€“ Entry point with setup instructions.
[CODEX] +- [docs/components.md](docs/components.md) â€“ Shared component catalogue.
[CODEX] +- [docs/routes.md](docs/routes.md) â€“ Application routing map.
[CODEX] +- [docs/core-features.md](docs/core-features.md) â€“ High-level feature descriptions.
[CODEX] +- [docs/workflow-builder-guide.md](docs/workflow-builder-guide.md) â€“ Workflow builder architecture.
[CODEX] +- [docs/playwright-testing-guide.md](docs/playwright-testing-guide.md) â€“ Comprehensive Playwright usage.
[CODEX] +- [docs/implementation-guide.md](docs/implementation-guide.md) â€“ Frontend implementation detail.
[CODEX] +- [docs/authentication.md](docs/authentication.md) â€“ Auth flows and state storage.
[CODEX] +- [docs/e2e-testing-patterns.md](docs/e2e-testing-patterns.md) â€“ Resilient test strategies.
[CODEX] +- [docs/TEST-README.md](docs/TEST-README.md) â€“ Unit and integration testing commands.
[CODEX] +
[CODEX] +Keep this hub updated as we introduce new docs or migrate content. If a guide becomes outdated, link directly to its successor or fold it into a more relevant document.
[CODEX] diff --git a/README.md b/README.md
[CODEX] index fecb22bce7791f926108dab947b93e75eaa022c7..09e58074104c565a3b4c29c33b94cf57fba373aa
[CODEX] --- a/README.md
[CODEX] +++ b/README.md
[CODEX] @@ -239,8 +239,8 @@
[CODEX] Vurvey Web Manager is the frontend component of the Vurvey platform. It works in conjunction with the Vurvey API backend to provide a complete solution for video-based consumer feedback.
[CODEX] -[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] -[Link to Comprehensive Documentation](../DOCUMENTATION.md)
[CODEX] +[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] +[Documentation Hub](./DOCUMENTATION.md)
[CODEX] ## Setup
[CODEX] diff --git a/docs/README.md b/docs/README.md
[CODEX] index 174c521a012dbbb5ef957dfc29360c9b697c7b6e..5a56517cd1e90833bbcb9dad65d7cb3d620b14c8
[CODEX] --- a/docs/README.md
[CODEX] +++ b/docs/README.md
[CODEX] @@ -19,11 +19,13 @@
[CODEX] ### Getting Started
[CODEX] +- [Implementation Guide](./implementation-guide.md) - How the application is assembled end-to-end
[CODEX] - [Project Structure](./project-structure.md) - Codebase organization
[CODEX] - [Authentication](./authentication.md) - Auth system and user management
[CODEX] - [State Management](./state-management.md) - Context and data flow
[CODEX] - [Routes](./routes.md) - Routing structure and navigation
[CODEX] - [Components](./components.md) - Component library and patterns
[CODEX] +- [Playwright Testing Guide](./playwright-testing-guide.md) - Full Playwright setup and authoring guide
[CODEX] ### Features
[CODEX] @@ -147,6 +149,7 @@
[CODEX] ```
[CODEX] LOGIN_USERNAME="your_test_email"
[CODEX] LOGIN_PASSWORD="your_test_password"
[CODEX] +URL="http://localhost:5050"
[CODEX] ```
[CODEX] ## Best Practices
[CODEX] @@ -181,3 +184,4 @@
[CODEX] - [Playwright Documentation](https://playwright.dev)
[CODEX] - [Apollo Client Documentation](https://www.apollographql.com/docs/react)
[CODEX] - [React Documentation](https://react.dev)
[CODEX] +- [Documentation Hub](../DOCUMENTATION.md) for an index of project guides
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] diff --git a/docs/playwright-testing-guide.md b/docs/playwright-testing-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..acbab280a49d446cc89ce7ea1e6de422380736ca
[CODEX] --- /dev/null
[CODEX] +++ b/docs/playwright-testing-guide.md
[CODEX] @@ -0,0 +1,161 @@
[CODEX] +# Playwright Testing Guide
[CODEX] +
[CODEX] +This guide explains how to configure, run, and extend the Playwright end-to-end test suite for Vurvey Web Manager.
[CODEX] +
[CODEX] +- [Overview](#overview)
[CODEX] +- [Directory Layout](#directory-layout)
[CODEX] +- [Environment Setup](#environment-setup)
[CODEX] +- [Running Tests](#running-tests)
[CODEX] +- [Authentication Workflow](#authentication-workflow)
[CODEX] +- [Writing & Organizing Tests](#writing--organizing-tests)
[CODEX] +- [Debugging & Diagnostics](#debugging--diagnostics)
[CODEX] +- [Continuous Integration](#continuous-integration)
[CODEX] +- [Reference Material](#reference-material)
[CODEX] +
[CODEX] +## Overview
[CODEX] +
[CODEX] +Playwright exercises the full React application in a Chromium browser using the configuration defined in `playwright.config.ts`. Tests rely on Firebase authentication, Apollo GraphQL, and feature flags, so a stable backend environment and test credentials are required.
[CODEX] +
[CODEX] +Key characteristics:
[CODEX] +
[CODEX] +- Tests live in `playwright/tests/*.spec.ts`.
[CODEX] +- A dedicated `setup` project seeds authentication (`auth.setup.ts`) and persists storage state to `playwright/.auth/user.json`.
[CODEX] +- Default executions run headless Chromium with `slowMo: 50` to reduce flakiness; override these options when debugging.
[CODEX] +
[CODEX] +## Directory Layout
[CODEX] +
[CODEX] +```
[CODEX] +playwright/
[CODEX] +â”œâ”€â”€ fixtures/                 # Test data assets (clips, csv, pdf, images)
[CODEX] +â”œâ”€â”€ helpers/                  # Utility helpers (authentication, navigation)
[CODEX] +â”œâ”€â”€ page-objects/             # Page object abstractions for complex flows
[CODEX] +â”œâ”€â”€ tests/                    # Spec files + global setup (auth.setup.ts)
[CODEX] +â”œâ”€â”€ env.d.ts                  # Type declarations for Playwright globals
[CODEX] +â””â”€â”€ README.md                 # High-level summary (links back to this guide)
[CODEX] +```
[CODEX] +
[CODEX] +Keep common logic in helpers or page objects instead of duplicating it inside specs. Fixtures should hold deterministic assets that can be reused across scenarios.
[CODEX] +
[CODEX] +## Environment Setup
[CODEX] +
[CODEX] +1. **Install dependencies**
[CODEX] +
[CODEX] +   ```bash
[CODEX] +   npm ci
[CODEX] +   npx playwright install
[CODEX] +   ```
[CODEX] +
[CODEX] +2. **Configure environment variables**
[CODEX] +
[CODEX] +   - Create `./playwright/.env` with the fields referenced in tests:
[CODEX] +
[CODEX] +     ```ini
[CODEX] +     URL=http://localhost:5050
[CODEX] +     LOGIN_USERNAME=tester@example.com
[CODEX] +     LOGIN_PASSWORD=super-secret
[CODEX] +     ```
[CODEX] +
[CODEX] +   - Variables defined in the repository root `.env` are also loaded. `URL` must match the origin where the web manager is running.
[CODEX] +
[CODEX] +3. **Launch the application backend**
[CODEX] +
[CODEX] +   - Ensure the Vurvey API and any dependent services are running; Playwright interacts with the live stack.
[CODEX] +   - Start the web manager locally with `npm start` or point `URL` at a staging environment.
[CODEX] +
[CODEX] +4. **Seed authentication state**
[CODEX] +
[CODEX] +   - The first test run invokes `auth.setup.ts`, which stores Firebase credentials in IndexedDB and writes a Playwright storage file (`playwright/.auth/user.json`).
[CODEX] +   - This file is reused by dependent projects so subsequent tests start in an authenticated session.
[CODEX] +
[CODEX] +## Running Tests
[CODEX] +
[CODEX] +Common commands:
[CODEX] +
[CODEX] +```bash
[CODEX] +# Run the full E2E suite
[CODEX] +npx playwright test
[CODEX] +
[CODEX] +# Run a specific spec
[CODEX] +npx playwright test playwright/tests/navigation.spec.ts
[CODEX] +
[CODEX] +# Filter by title
[CODEX] +npx playwright test --grep "@smoke"
[CODEX] +
[CODEX] +# Headed (visible) mode
[CODEX] +npx playwright test --headed
[CODEX] +
[CODEX] +# Debug mode with inspector
[CODEX] +npx playwright test --debug
[CODEX] +
[CODEX] +# Use the Playwright UI
[CODEX] +npx playwright test --ui
[CODEX] +```
[CODEX] +
[CODEX] +Project configuration (browser, base URL, reporters) lives in `playwright.config.ts`. Edit that file to add new projects (e.g., Firefox coverage) or alternative reporters.
[CODEX] +
[CODEX] +## Authentication Workflow
[CODEX] +
[CODEX] +Authentication uses Firebase persistence inside IndexedDB:
[CODEX] +
[CODEX] +1. `auth.setup.ts` logs in through the UI using `LOGIN_USERNAME` and `LOGIN_PASSWORD`.
[CODEX] +2. The helper `saveFirebaseAuthData` captures Firebase data from IndexedDB and writes it to `localStorage`.
[CODEX] +3. The storage state is exported to `playwright/.auth/user.json`.
[CODEX] +4. Individual specs call `restoreFirebaseAuthData` via helper utilities before navigating, ensuring a valid session without re-running the login flow.
[CODEX] +
[CODEX] +If you see `No auth data found in localStorage`, run the setup project again (`npx playwright test --project setup`). When credentials rotate, delete `playwright/.auth/user.json` and re-run the suite.
[CODEX] +
[CODEX] +## Writing & Organizing Tests
[CODEX] +
[CODEX] +- **Use fixtures**: Import reusable flows (e.g., `authenticate`) from `playwright/helpers`. Define domain-specific fixtures when a scenario needs shared setup and teardown.
[CODEX] +- **Prefer page objects**: Complex interactions such as the workflow builder or agent editor should be encapsulated in `playwright/page-objects` classes. Create methods that describe user intent (`workflowBuilder.publishFlow()`), not DOM mechanics.
[CODEX] +- **Selectors**: Lean on accessible selectors (`getByRole`, `getByLabel`, `getByTestId`). Fall back to data attributes when elements lack semantic handles. Avoid brittle CSS selectors.
[CODEX] +- **Organization**: Group related specs in `test.describe`. Tag critical smoke tests with `@smoke` for quick feedback loops.
[CODEX] +- **Time-sensitive flows**: Use `await expect(...).toBeVisible({ timeout: 30_000 })` for network-heavy screens. The global `expect` timeout already defaults to 30 seconds; override locally when necessary.
[CODEX] +- **Artifacts**: Use `test.info().attach` to capture domain-specific logs. Screenshots happen automatically on failure, but explicit captures help with mid-test diagnostics.
[CODEX] +
[CODEX] +Example skeleton:
[CODEX] +
[CODEX] +```ts
[CODEX] +import {test, expect} from "@playwright/test";
[CODEX] +import {authenticate} from "../helpers/authentication";
[CODEX] +import {DashboardPage} from "../page-objects/dashboard-page";
[CODEX] +
[CODEX] +test.describe("Dashboard", () => {
[CODEX] +  test.beforeEach(async ({page}) => {
[CODEX] +    await authenticate(page);
[CODEX] +  });
[CODEX] +
[CODEX] +  test("shows the active workspace summary @smoke", async ({page}) => {
[CODEX] +    const dashboard = new DashboardPage(page);
[CODEX] +    await dashboard.goto();
[CODEX] +    await expect(dashboard.header).toContainText("Workspace Overview");
[CODEX] +  });
[CODEX] +});
[CODEX] +```
[CODEX] +
[CODEX] +## Debugging & Diagnostics
[CODEX] +
[CODEX] +- **Trace Viewer**: Re-run failing tests with `npx playwright test --trace on-first-retry` to collect DOM snapshots, network logs, and console output.
[CODEX] +- **Video & screenshots**: Enable via `use: { video: "retain-on-failure", screenshot: "only-on-failure" }` either per test or globally in `playwright.config.ts`.
[CODEX] +- **Console logging**: Place strategic `console.log` statements in specs or helpers when investigating flaky behavior. Remove them once resolved to keep logs clean.
[CODEX] +- **Network mocking**: Stub GraphQL or REST endpoints with `page.route` for deterministic results when backend data is unavailable. Maintain mocks under `playwright/helpers/network`.
[CODEX] +
[CODEX] +When a test flakes, capture the trace, verify selectors still match the rendered UI, and ensure required feature flags are enabled for the environment.
[CODEX] +
[CODEX] +## Continuous Integration
[CODEX] +
[CODEX] +- CI pipelines call `npx playwright test` with the same configuration. Ensure new specs respect the single-worker execution configuration (`workers: 1`) unless you explicitly parallelize them.
[CODEX] +- Store credentials (username, password, URL) in the CI secret store. The setup project fails fast if they are missing.
[CODEX] +- Upload `test-results/` (HTML reporter output) as an artifact for post-run inspection.
[CODEX] +
[CODEX] +Before merging, run the suite locally or in a dry-run environment to catch environment-specific regressions early.
[CODEX] +
[CODEX] +## Reference Material
[CODEX] +
[CODEX] +- [Playwright Configuration](../playwright.config.ts)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +- [Testing Guide (unit + integration)](./TEST-README.md)
[CODEX] +- [Implementation Guide](./implementation-guide.md)
[CODEX] +- [Official Playwright Docs](https://playwright.dev/docs/intro)
[CODEX] +
[CODEX] +Keep this guide up to date whenever the test harness, authentication strategy, or project layout changes. New contributors should be able to set up Playwright using only this document.
[CODEX] diff --git a/playwright/README.md b/playwright/README.md
[CODEX] index 58090e78cd0aba7e78a7bd8ce3bf7b7a692ea8ca..02e1939682ff48977eb982bba77319f5e528768a
[CODEX] --- a/playwright/README.md
[CODEX] +++ b/playwright/README.md
[CODEX] @@ -1,5 +1,7 @@
[CODEX] # Vurvey Web Manager Testing Guide
[CODEX] +> **Prefer the canonical [Playwright Testing Guide](../docs/playwright-testing-guide.md)** for the most up-to-date instructions on setup, authoring, and debugging. This file keeps a condensed summary for quick reference.
[CODEX] +
[CODEX] This document provides comprehensive guidance for testing the Vurvey Web Manager application.
[CODEX] ## Overview
[CODEX] diff --git a/src/shared/__tests__/documentation-links.test.ts b/src/shared/__tests__/documentation-links.test.ts
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..1ce31fda3210502d79e91629a1078b02c220b94a
[CODEX] --- /dev/null
[CODEX] +++ b/src/shared/__tests__/documentation-links.test.ts
[CODEX] @@ -0,0 +1,26 @@
[CODEX] +import {readFileSync} from "node:fs";
[CODEX] +import {resolve} from "node:path";
[CODEX] +
[CODEX] +import {describe, expect, it} from "vitest";
[CODEX] +
[CODEX] +const readDoc = (relativePath: string): string => {
[CODEX] +	const filePath = resolve(__dirname, relativePath);
[CODEX] +
[CODEX] +	return readFileSync(filePath, "utf8");
[CODEX] +};
[CODEX] +
[CODEX] +describe("Project documentation", () => {
[CODEX] +	it("keeps the documentation hub index up to date", () => {
[CODEX] +		const documentation = readDoc("../../../DOCUMENTATION.md");
[CODEX] +
[CODEX] +		expect(documentation).toContain("[Implementation Guide](docs/implementation-guide.md)");
[CODEX] +		expect(documentation).toContain("[Playwright Testing Guide](docs/playwright-testing-guide.md)");
[CODEX] +	});
[CODEX] +
[CODEX] +	it("mirrors the new guides inside docs/README", () => {
[CODEX] +		const docsReadme = readDoc("../../../docs/README.md");
[CODEX] +
[CODEX] +		expect(docsReadme).toContain("./implementation-guide.md");
[CODEX] +		expect(docsReadme).toContain("./playwright-testing-guide.md");
[CODEX] +	});
[CODEX] +});
[CODEX] file update:
[CODEX] diff --git a/DOCUMENTATION.md b/DOCUMENTATION.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e08ed0b3ff8c2fbb63dc3ee675405d59841b6a10
[CODEX] --- /dev/null
[CODEX] +++ b/DOCUMENTATION.md
[CODEX] @@ -0,0 +1,81 @@
[CODEX] +# Vurvey Web Manager Documentation Hub
[CODEX] +
[CODEX] +This hub ties together the architecture, development workflows, and testing resources for the Vurvey Web Manager. Start here for a narrated overview, then dive into the linked guides for deeper detail.
[CODEX] +
[CODEX] +- [Quick Start](#quick-start)
[CODEX] +- [Architecture at a Glance](#architecture-at-a-glance)
[CODEX] +- [Implementation Deep Dive](#implementation-deep-dive)
[CODEX] +- [Testing & Quality Assurance](#testing--quality-assurance)
[CODEX] +- [Operational Playbooks](#operational-playbooks)
[CODEX] +- [Documentation Index](#documentation-index)
[CODEX] +
[CODEX] +## Quick Start
[CODEX] +
[CODEX] +| Task | Command / Resource |
[CODEX] +| --- | --- |
[CODEX] +| Install dependencies | `npm ci` |
[CODEX] +| Run the dev server | `npm start` (defaults to `http://localhost:5050`) |
[CODEX] +| Type-check | `npm run type-check` |
[CODEX] +| Validate GraphQL documents | `npm run validate:graphql` |
[CODEX] +| Run unit/integration tests | `npm run test:unit` |
[CODEX] +| Run Playwright E2E tests | `npm run test:e2e` |
[CODEX] +| Lint source + tests | `npm run lint` |
[CODEX] +
[CODEX] +Environment variables (Firebase, GraphQL endpoint, feature flags) are defined in `.env`. See `docs/README.md#environment-variables` for the full list.
[CODEX] +
[CODEX] +## Architecture at a Glance
[CODEX] +
[CODEX] +- React 18 + TypeScript rendered through Vite.
[CODEX] +- Routing handled via `react-router-dom` with workspace-aware helpers.
[CODEX] +- GraphQL powered by Apollo Client (HTTP + WebSocket links) and LaunchDarkly/OpenFeature feature flag providers.
[CODEX] +- State spans React Contexts, Apollo cache, and reducer-driven component state.
[CODEX] +- Styling leverages SCSS modules and a shared component library under `src/shared`.
[CODEX] +
[CODEX] +Review the [Implementation Guide](docs/implementation-guide.md) for a walkthrough of providers, feature modules, and architectural conventions.
[CODEX] +
[CODEX] +## Implementation Deep Dive
[CODEX] +
[CODEX] +| Topic | Summary |
[CODEX] +| --- | --- |
[CODEX] +| [Implementation Guide](docs/implementation-guide.md) | Entry points, provider stack, routing, feature ownership, build tooling. |
[CODEX] +| [Project Structure](docs/project-structure.md) | Directory breakdown and best practices for adding new files. |
[CODEX] +| [State Management](docs/state-management.md) | Contexts, reducers, and caching strategies. |
[CODEX] +| [GraphQL Integration](docs/graphql-integration.md) | Query organization, code generation, and cache policies. |
[CODEX] +| [Custom Hooks](docs/custom-hooks.md) | Reusable hooks available across features. |
[CODEX] +| [Workflow Builder Guide](docs/workflow-builder-guide.md) | Deep dive into the workflow module architecture. |
[CODEX] +
[CODEX] +When implementing new features, align with the patterns documented in these guides and update them if responsibilities shift.
[CODEX] +
[CODEX] +## Testing & Quality Assurance
[CODEX] +
[CODEX] +- [Playwright Testing Guide](docs/playwright-testing-guide.md) â€“ Environment setup, authentication strategy, authoring conventions, and debugging tips.
[CODEX] +- [E2E Testing Patterns](docs/e2e-testing-patterns.md) â€“ Hard-won lessons for resilient selectors and flows.
[CODEX] +- [Testing Guide](docs/TEST-README.md) â€“ Vitest commands, coverage expectations, and mocking strategies.
[CODEX] +- Unit tests live beside implementation files. E2E specs live under `playwright/tests/`. Follow the documented fixtures/page-object approach for consistency.
[CODEX] +
[CODEX] +## Operational Playbooks
[CODEX] +
[CODEX] +- [Authentication](docs/authentication.md) â€“ Firebase sign-in flows and session persistence.
[CODEX] +- [Core Features](docs/core-features.md) â€“ Feature overviews for stakeholders and QA.
[CODEX] +- [Routes](docs/routes.md) â€“ Navigation map with workspace/context rules.
[CODEX] +- [Smooth Streaming](docs/smooth-streaming.md) & [Chat Streaming](docs/chat-streaming.md) â€“ Real-time infrastructure details.
[CODEX] +- [Test Resilience Strategy](docs/test-resilience-strategy.md) â€“ Stabilization techniques for automated suites.
[CODEX] +
[CODEX] +These playbooks help new engineers and QA members ramp up quickly on specific domains.
[CODEX] +
[CODEX] +## Documentation Index
[CODEX] +
[CODEX] +All documentation lives under the `docs/` directory:
[CODEX] +
[CODEX] +- [docs/README.md](docs/README.md) â€“ Entry point with setup instructions.
[CODEX] +- [docs/components.md](docs/components.md) â€“ Shared component catalogue.
[CODEX] +- [docs/routes.md](docs/routes.md) â€“ Application routing map.
[CODEX] +- [docs/core-features.md](docs/core-features.md) â€“ High-level feature descriptions.
[CODEX] +- [docs/workflow-builder-guide.md](docs/workflow-builder-guide.md) â€“ Workflow builder architecture.
[CODEX] +- [docs/playwright-testing-guide.md](docs/playwright-testing-guide.md) â€“ Comprehensive Playwright usage.
[CODEX] +- [docs/implementation-guide.md](docs/implementation-guide.md) â€“ Frontend implementation detail.
[CODEX] +- [docs/authentication.md](docs/authentication.md) â€“ Auth flows and state storage.
[CODEX] +- [docs/e2e-testing-patterns.md](docs/e2e-testing-patterns.md) â€“ Resilient test strategies.
[CODEX] +- [docs/TEST-README.md](docs/TEST-README.md) â€“ Unit and integration testing commands.
[CODEX] +
[CODEX] +Keep this hub updated as we introduce new docs or migrate content. If a guide becomes outdated, link directly to its successor or fold it into a more relevant document.
[CODEX] diff --git a/README.md b/README.md
[CODEX] index fecb22bce7791f926108dab947b93e75eaa022c7..09e58074104c565a3b4c29c33b94cf57fba373aa
[CODEX] --- a/README.md
[CODEX] +++ b/README.md
[CODEX] @@ -239,8 +239,8 @@
[CODEX] Vurvey Web Manager is the frontend component of the Vurvey platform. It works in conjunction with the Vurvey API backend to provide a complete solution for video-based consumer feedback.
[CODEX] -[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] -[Link to Comprehensive Documentation](../DOCUMENTATION.md)
[CODEX] +[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] +[Documentation Hub](./DOCUMENTATION.md)
[CODEX] ## Setup
[CODEX] diff --git a/docs/README.md b/docs/README.md
[CODEX] index 174c521a012dbbb5ef957dfc29360c9b697c7b6e..5a56517cd1e90833bbcb9dad65d7cb3d620b14c8
[CODEX] --- a/docs/README.md
[CODEX] +++ b/docs/README.md
[CODEX] @@ -19,11 +19,13 @@
[CODEX] ### Getting Started
[CODEX] +- [Implementation Guide](./implementation-guide.md) - How the application is assembled end-to-end
[CODEX] - [Project Structure](./project-structure.md) - Codebase organization
[CODEX] - [Authentication](./authentication.md) - Auth system and user management
[CODEX] - [State Management](./state-management.md) - Context and data flow
[CODEX] - [Routes](./routes.md) - Routing structure and navigation
[CODEX] - [Components](./components.md) - Component library and patterns
[CODEX] +- [Playwright Testing Guide](./playwright-testing-guide.md) - Full Playwright setup and authoring guide
[CODEX] ### Features
[CODEX] @@ -147,6 +149,7 @@
[CODEX] ```
[CODEX] LOGIN_USERNAME="your_test_email"
[CODEX] LOGIN_PASSWORD="your_test_password"
[CODEX] +URL="http://localhost:5050"
[CODEX] ```
[CODEX] ## Best Practices
[CODEX] @@ -181,3 +184,4 @@
[CODEX] - [Playwright Documentation](https://playwright.dev)
[CODEX] - [Apollo Client Documentation](https://www.apollographql.com/docs/react)
[CODEX] - [React Documentation](https://react.dev)
[CODEX] +- [Documentation Hub](../DOCUMENTATION.md) for an index of project guides
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] diff --git a/docs/playwright-testing-guide.md b/docs/playwright-testing-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..acbab280a49d446cc89ce7ea1e6de422380736ca
[CODEX] --- /dev/null
[CODEX] +++ b/docs/playwright-testing-guide.md
[CODEX] @@ -0,0 +1,161 @@
[CODEX] +# Playwright Testing Guide
[CODEX] +
[CODEX] +This guide explains how to configure, run, and extend the Playwright end-to-end test suite for Vurvey Web Manager.
[CODEX] +
[CODEX] +- [Overview](#overview)
[CODEX] +- [Directory Layout](#directory-layout)
[CODEX] +- [Environment Setup](#environment-setup)
[CODEX] +- [Running Tests](#running-tests)
[CODEX] +- [Authentication Workflow](#authentication-workflow)
[CODEX] +- [Writing & Organizing Tests](#writing--organizing-tests)
[CODEX] +- [Debugging & Diagnostics](#debugging--diagnostics)
[CODEX] +- [Continuous Integration](#continuous-integration)
[CODEX] +- [Reference Material](#reference-material)
[CODEX] +
[CODEX] +## Overview
[CODEX] +
[CODEX] +Playwright exercises the full React application in a Chromium browser using the configuration defined in `playwright.config.ts`. Tests rely on Firebase authentication, Apollo GraphQL, and feature flags, so a stable backend environment and test credentials are required.
[CODEX] +
[CODEX] +Key characteristics:
[CODEX] +
[CODEX] +- Tests live in `playwright/tests/*.spec.ts`.
[CODEX] +- A dedicated `setup` project seeds authentication (`auth.setup.ts`) and persists storage state to `playwright/.auth/user.json`.
[CODEX] +- Default executions run headless Chromium with `slowMo: 50` to reduce flakiness; override these options when debugging.
[CODEX] +
[CODEX] +## Directory Layout
[CODEX] +
[CODEX] +```
[CODEX] +playwright/
[CODEX] +â”œâ”€â”€ fixtures/                 # Test data assets (clips, csv, pdf, images)
[CODEX] +â”œâ”€â”€ helpers/                  # Utility helpers (authentication, navigation)
[CODEX] +â”œâ”€â”€ page-objects/             # Page object abstractions for complex flows
[CODEX] +â”œâ”€â”€ tests/                    # Spec files + global setup (auth.setup.ts)
[CODEX] +â”œâ”€â”€ env.d.ts                  # Type declarations for Playwright globals
[CODEX] +â””â”€â”€ README.md                 # High-level summary (links back to this guide)
[CODEX] +```
[CODEX] +
[CODEX] +Keep common logic in helpers or page objects instead of duplicating it inside specs. Fixtures should hold deterministic assets that can be reused across scenarios.
[CODEX] +
[CODEX] +## Environment Setup
[CODEX] +
[CODEX] +1. **Install dependencies**
[CODEX] +
[CODEX] +   ```bash
[CODEX] +   npm ci
[CODEX] +   npx playwright install
[CODEX] +   ```
[CODEX] +
[CODEX] +2. **Configure environment variables**
[CODEX] +
[CODEX] +   - Create `./playwright/.env` with the fields referenced in tests:
[CODEX] +
[CODEX] +     ```ini
[CODEX] +     URL=http://localhost:5050
[CODEX] +     LOGIN_USERNAME=tester@example.com
[CODEX] +     LOGIN_PASSWORD=super-secret
[CODEX] +     ```
[CODEX] +
[CODEX] +   - Variables defined in the repository root `.env` are also loaded. `URL` must match the origin where the web manager is running.
[CODEX] +
[CODEX] +3. **Launch the application backend**
[CODEX] +
[CODEX] +   - Ensure the Vurvey API and any dependent services are running; Playwright interacts with the live stack.
[CODEX] +   - Start the web manager locally with `npm start` or point `URL` at a staging environment.
[CODEX] +
[CODEX] +4. **Seed authentication state**
[CODEX] +
[CODEX] +   - The first test run invokes `auth.setup.ts`, which stores Firebase credentials in IndexedDB and writes a Playwright storage file (`playwright/.auth/user.json`).
[CODEX] +   - This file is reused by dependent projects so subsequent tests start in an authenticated session.
[CODEX] +
[CODEX] +## Running Tests
[CODEX] +
[CODEX] +Common commands:
[CODEX] +
[CODEX] +```bash
[CODEX] +# Run the full E2E suite
[CODEX] +npx playwright test
[CODEX] +
[CODEX] +# Run a specific spec
[CODEX] +npx playwright test playwright/tests/navigation.spec.ts
[CODEX] +
[CODEX] +# Filter by title
[CODEX] +npx playwright test --grep "@smoke"
[CODEX] +
[CODEX] +# Headed (visible) mode
[CODEX] +npx playwright test --headed
[CODEX] +
[CODEX] +# Debug mode with inspector
[CODEX] +npx playwright test --debug
[CODEX] +
[CODEX] +# Use the Playwright UI
[CODEX] +npx playwright test --ui
[CODEX] +```
[CODEX] +
[CODEX] +Project configuration (browser, base URL, reporters) lives in `playwright.config.ts`. Edit that file to add new projects (e.g., Firefox coverage) or alternative reporters.
[CODEX] +
[CODEX] +## Authentication Workflow
[CODEX] +
[CODEX] +Authentication uses Firebase persistence inside IndexedDB:
[CODEX] +
[CODEX] +1. `auth.setup.ts` logs in through the UI using `LOGIN_USERNAME` and `LOGIN_PASSWORD`.
[CODEX] +2. The helper `saveFirebaseAuthData` captures Firebase data from IndexedDB and writes it to `localStorage`.
[CODEX] +3. The storage state is exported to `playwright/.auth/user.json`.
[CODEX] +4. Individual specs call `restoreFirebaseAuthData` via helper utilities before navigating, ensuring a valid session without re-running the login flow.
[CODEX] +
[CODEX] +If you see `No auth data found in localStorage`, run the setup project again (`npx playwright test --project setup`). When credentials rotate, delete `playwright/.auth/user.json` and re-run the suite.
[CODEX] +
[CODEX] +## Writing & Organizing Tests
[CODEX] +
[CODEX] +- **Use fixtures**: Import reusable flows (e.g., `authenticate`) from `playwright/helpers`. Define domain-specific fixtures when a scenario needs shared setup and teardown.
[CODEX] +- **Prefer page objects**: Complex interactions such as the workflow builder or agent editor should be encapsulated in `playwright/page-objects` classes. Create methods that describe user intent (`workflowBuilder.publishFlow()`), not DOM mechanics.
[CODEX] +- **Selectors**: Lean on accessible selectors (`getByRole`, `getByLabel`, `getByTestId`). Fall back to data attributes when elements lack semantic handles. Avoid brittle CSS selectors.
[CODEX] +- **Organization**: Group related specs in `test.describe`. Tag critical smoke tests with `@smoke` for quick feedback loops.
[CODEX] +- **Time-sensitive flows**: Use `await expect(...).toBeVisible({ timeout: 30_000 })` for network-heavy screens. The global `expect` timeout already defaults to 30 seconds; override locally when necessary.
[CODEX] +- **Artifacts**: Use `test.info().attach` to capture domain-specific logs. Screenshots happen automatically on failure, but explicit captures help with mid-test diagnostics.
[CODEX] +
[CODEX] +Example skeleton:
[CODEX] +
[CODEX] +```ts
[CODEX] +import {test, expect} from "@playwright/test";
[CODEX] +import {authenticate} from "../helpers/authentication";
[CODEX] +import {DashboardPage} from "../page-objects/dashboard-page";
[CODEX] +
[CODEX] +test.describe("Dashboard", () => {
[CODEX] +  test.beforeEach(async ({page}) => {
[CODEX] +    await authenticate(page);
[CODEX] +  });
[CODEX] +
[CODEX] +  test("shows the active workspace summary @smoke", async ({page}) => {
[CODEX] +    const dashboard = new DashboardPage(page);
[CODEX] +    await dashboard.goto();
[CODEX] +    await expect(dashboard.header).toContainText("Workspace Overview");
[CODEX] +  });
[CODEX] +});
[CODEX] +```
[CODEX] +
[CODEX] +## Debugging & Diagnostics
[CODEX] +
[CODEX] +- **Trace Viewer**: Re-run failing tests with `npx playwright test --trace on-first-retry` to collect DOM snapshots, network logs, and console output.
[CODEX] +- **Video & screenshots**: Enable via `use: { video: "retain-on-failure", screenshot: "only-on-failure" }` either per test or globally in `playwright.config.ts`.
[CODEX] +- **Console logging**: Place strategic `console.log` statements in specs or helpers when investigating flaky behavior. Remove them once resolved to keep logs clean.
[CODEX] +- **Network mocking**: Stub GraphQL or REST endpoints with `page.route` for deterministic results when backend data is unavailable. Maintain mocks under `playwright/helpers/network`.
[CODEX] +
[CODEX] +When a test flakes, capture the trace, verify selectors still match the rendered UI, and ensure required feature flags are enabled for the environment.
[CODEX] +
[CODEX] +## Continuous Integration
[CODEX] +
[CODEX] +- CI pipelines call `npx playwright test` with the same configuration. Ensure new specs respect the single-worker execution configuration (`workers: 1`) unless you explicitly parallelize them.
[CODEX] +- Store credentials (username, password, URL) in the CI secret store. The setup project fails fast if they are missing.
[CODEX] +- Upload `test-results/` (HTML reporter output) as an artifact for post-run inspection.
[CODEX] +
[CODEX] +Before merging, run the suite locally or in a dry-run environment to catch environment-specific regressions early.
[CODEX] +
[CODEX] +## Reference Material
[CODEX] +
[CODEX] +- [Playwright Configuration](../playwright.config.ts)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +- [Testing Guide (unit + integration)](./TEST-README.md)
[CODEX] +- [Implementation Guide](./implementation-guide.md)
[CODEX] +- [Official Playwright Docs](https://playwright.dev/docs/intro)
[CODEX] +
[CODEX] +Keep this guide up to date whenever the test harness, authentication strategy, or project layout changes. New contributors should be able to set up Playwright using only this document.
[CODEX] diff --git a/playwright/README.md b/playwright/README.md
[CODEX] index 58090e78cd0aba7e78a7bd8ce3bf7b7a692ea8ca..02e1939682ff48977eb982bba77319f5e528768a
[CODEX] --- a/playwright/README.md
[CODEX] +++ b/playwright/README.md
[CODEX] @@ -1,5 +1,7 @@
[CODEX] # Vurvey Web Manager Testing Guide
[CODEX] +> **Prefer the canonical [Playwright Testing Guide](../docs/playwright-testing-guide.md)** for the most up-to-date instructions on setup, authoring, and debugging. This file keeps a condensed summary for quick reference.
[CODEX] +
[CODEX] This document provides comprehensive guidance for testing the Vurvey Web Manager application.
[CODEX] ## Overview
[CODEX] diff --git a/src/shared/__tests__/documentation-links.test.ts b/src/shared/__tests__/documentation-links.test.ts
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..1ce31fda3210502d79e91629a1078b02c220b94a
[CODEX] --- /dev/null
[CODEX] +++ b/src/shared/__tests__/documentation-links.test.ts
[CODEX] @@ -0,0 +1,26 @@
[CODEX] +import {readFileSync} from "node:fs";
[CODEX] +import {resolve} from "node:path";
[CODEX] +
[CODEX] +import {describe, expect, it} from "vitest";
[CODEX] +
[CODEX] +const readDoc = (relativePath: string): string => {
[CODEX] +	const filePath = resolve(__dirname, relativePath);
[CODEX] +
[CODEX] +	return readFileSync(filePath, "utf8");
[CODEX] +};
[CODEX] +
[CODEX] +describe("Project documentation", () => {
[CODEX] +	it("keeps the documentation hub index up to date", () => {
[CODEX] +		const documentation = readDoc("../../../DOCUMENTATION.md");
[CODEX] +
[CODEX] +		expect(documentation).toContain("[Implementation Guide](docs/implementation-guide.md)");
[CODEX] +		expect(documentation).toContain("[Playwright Testing Guide](docs/playwright-testing-guide.md)");
[CODEX] +	});
[CODEX] +
[CODEX] +	it("mirrors the new guides inside docs/README", () => {
[CODEX] +		const docsReadme = readDoc("../../../docs/README.md");
[CODEX] +
[CODEX] +		expect(docsReadme).toContain("./implementation-guide.md");
[CODEX] +		expect(docsReadme).toContain("./playwright-testing-guide.md");
[CODEX] +	});
[CODEX] +});
[CLAUDE]   Now let me explore and document the GraphQL patterns:
[CLAUDE]   ğŸ”§ Bash: List GraphQL directory structure
[CODEX] thinking
[CODEX] **Verifying test paths and running tests**
[CLAUDE]   ğŸ”§ Read
[CODEX] exec
[CODEX] bash -lc 'npm run test:unit' in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 4.46s:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] > @batterii/vurvey-web-manager@11.29.2 test:unit
[CODEX] > vitest run "src/shared/" "src/hooks/" "src/canvas/chat-bubble/chat-bubble.test.tsx" "src/context/workflow-contexts/workflow-context.test.tsx" "src/reducer/chat-reducer/chat-reducer.test.ts" "src/reducer/workflow-reducer.test.ts" "src/workflow/integration-tests/simplified-flow-test.test.tsx" "src/workflow/integration-tests/mock-test.test.ts"
[CODEX] RUN  v3.1.2 /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6
[CODEX] âœ“ src/shared/utility/image-studio/url-comparison.test.ts (26 tests) 4ms
[CODEX] âœ“ src/shared/utility/url-params.test.ts (29 tests) 5ms
[CODEX] âœ“ src/hooks/useImageStudioSearchParams.test.ts (10 tests) 18ms
[CODEX] âœ“ src/shared/utility/image-studio/url-serialization.test.ts (35 tests) 5ms
[CODEX] âœ“ src/hooks/useValidation.test.ts (10 tests) 14ms
[CODEX] âœ“ src/hooks/useSearchParamState.test.ts (14 tests) 20ms
[CODEX] âœ“ src/shared/v2/markdown-plugins/remark-mentions-multiword.test.ts (24 tests) 12ms
[CODEX] âœ“ src/hooks/useLoadingQuery.test.tsx (12 tests) 14ms
[CODEX] âœ“ src/shared/utility/chat/tool-status-updates/format-tool-call-status-update.test.ts (44 tests) 7ms
[CODEX] âœ“ src/reducer/workflow-reducer.test.ts (22 tests) 4ms
[CODEX] âœ“ src/shared/components/dropdown/dropdown.test.tsx (13 tests | 1 skipped) 39ms
[CODEX] âœ“ src/context/workflow-contexts/workflow-context.test.tsx (9 tests) 114ms
[CODEX] file update:
[CODEX] diff --git a/DOCUMENTATION.md b/DOCUMENTATION.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e08ed0b3ff8c2fbb63dc3ee675405d59841b6a10
[CODEX] --- /dev/null
[CODEX] +++ b/DOCUMENTATION.md
[CODEX] @@ -0,0 +1,81 @@
[CODEX] +# Vurvey Web Manager Documentation Hub
[CODEX] +
[CODEX] +This hub ties together the architecture, development workflows, and testing resources for the Vurvey Web Manager. Start here for a narrated overview, then dive into the linked guides for deeper detail.
[CODEX] +
[CODEX] +- [Quick Start](#quick-start)
[CODEX] +- [Architecture at a Glance](#architecture-at-a-glance)
[CODEX] +- [Implementation Deep Dive](#implementation-deep-dive)
[CODEX] +- [Testing & Quality Assurance](#testing--quality-assurance)
[CODEX] +- [Operational Playbooks](#operational-playbooks)
[CODEX] +- [Documentation Index](#documentation-index)
[CODEX] +
[CODEX] +## Quick Start
[CODEX] +
[CODEX] +| Task | Command / Resource |
[CODEX] +| --- | --- |
[CODEX] +| Install dependencies | `npm ci` |
[CODEX] +| Run the dev server | `npm start` (defaults to `http://localhost:5050`) |
[CODEX] +| Type-check | `npm run type-check` |
[CODEX] +| Validate GraphQL documents | `npm run validate:graphql` |
[CODEX] +| Run unit/integration tests | `npm run test:unit` |
[CODEX] +| Run Playwright E2E tests | `npm run test:e2e` |
[CODEX] +| Lint source + tests | `npm run lint` |
[CODEX] +
[CODEX] +Environment variables (Firebase, GraphQL endpoint, feature flags) are defined in `.env`. See `docs/README.md#environment-variables` for the full list.
[CODEX] +
[CODEX] +## Architecture at a Glance
[CODEX] +
[CODEX] +- React 18 + TypeScript rendered through Vite.
[CODEX] +- Routing handled via `react-router-dom` with workspace-aware helpers.
[CODEX] +- GraphQL powered by Apollo Client (HTTP + WebSocket links) and LaunchDarkly/OpenFeature feature flag providers.
[CODEX] +- State spans React Contexts, Apollo cache, and reducer-driven component state.
[CODEX] +- Styling leverages SCSS modules and a shared component library under `src/shared`.
[CODEX] +
[CODEX] +Review the [Implementation Guide](docs/implementation-guide.md) for a walkthrough of providers, feature modules, and architectural conventions.
[CODEX] +
[CODEX] +## Implementation Deep Dive
[CODEX] +
[CODEX] +| Topic | Summary |
[CODEX] +| --- | --- |
[CODEX] +| [Implementation Guide](docs/implementation-guide.md) | Entry points, provider stack, routing, feature ownership, build tooling. |
[CODEX] +| [Project Structure](docs/project-structure.md) | Directory breakdown and best practices for adding new files. |
[CODEX] +| [State Management](docs/state-management.md) | Contexts, reducers, and caching strategies. |
[CODEX] +| [GraphQL Integration](docs/graphql-integration.md) | Query organization, code generation, and cache policies. |
[CODEX] +| [Custom Hooks](docs/custom-hooks.md) | Reusable hooks available across features. |
[CODEX] +| [Workflow Builder Guide](docs/workflow-builder-guide.md) | Deep dive into the workflow module architecture. |
[CODEX] +
[CODEX] +When implementing new features, align with the patterns documented in these guides and update them if responsibilities shift.
[CODEX] +
[CODEX] +## Testing & Quality Assurance
[CODEX] +
[CODEX] +- [Playwright Testing Guide](docs/playwright-testing-guide.md) â€“ Environment setup, authentication strategy, authoring conventions, and debugging tips.
[CODEX] +- [E2E Testing Patterns](docs/e2e-testing-patterns.md) â€“ Hard-won lessons for resilient selectors and flows.
[CODEX] +- [Testing Guide](docs/TEST-README.md) â€“ Vitest commands, coverage expectations, and mocking strategies.
[CODEX] +- Unit tests live beside implementation files. E2E specs live under `playwright/tests/`. Follow the documented fixtures/page-object approach for consistency.
[CODEX] +
[CODEX] +## Operational Playbooks
[CODEX] +
[CODEX] +- [Authentication](docs/authentication.md) â€“ Firebase sign-in flows and session persistence.
[CODEX] +- [Core Features](docs/core-features.md) â€“ Feature overviews for stakeholders and QA.
[CODEX] +- [Routes](docs/routes.md) â€“ Navigation map with workspace/context rules.
[CODEX] +- [Smooth Streaming](docs/smooth-streaming.md) & [Chat Streaming](docs/chat-streaming.md) â€“ Real-time infrastructure details.
[CODEX] +- [Test Resilience Strategy](docs/test-resilience-strategy.md) â€“ Stabilization techniques for automated suites.
[CODEX] +
[CODEX] +These playbooks help new engineers and QA members ramp up quickly on specific domains.
[CODEX] +
[CODEX] +## Documentation Index
[CODEX] +
[CODEX] +All documentation lives under the `docs/` directory:
[CODEX] +
[CODEX] +- [docs/README.md](docs/README.md) â€“ Entry point with setup instructions.
[CODEX] +- [docs/components.md](docs/components.md) â€“ Shared component catalogue.
[CODEX] +- [docs/routes.md](docs/routes.md) â€“ Application routing map.
[CODEX] +- [docs/core-features.md](docs/core-features.md) â€“ High-level feature descriptions.
[CODEX] +- [docs/workflow-builder-guide.md](docs/workflow-builder-guide.md) â€“ Workflow builder architecture.
[CODEX] +- [docs/playwright-testing-guide.md](docs/playwright-testing-guide.md) â€“ Comprehensive Playwright usage.
[CODEX] +- [docs/implementation-guide.md](docs/implementation-guide.md) â€“ Frontend implementation detail.
[CODEX] +- [docs/authentication.md](docs/authentication.md) â€“ Auth flows and state storage.
[CODEX] +- [docs/e2e-testing-patterns.md](docs/e2e-testing-patterns.md) â€“ Resilient test strategies.
[CODEX] +- [docs/TEST-README.md](docs/TEST-README.md) â€“ Unit and integration testing commands.
[CODEX] +
[CODEX] +Keep this hub updated as we introduce new docs or migrate content. If a guide becomes outdated, link directly to its successor or fold it into a more relevant document.
[CODEX] diff --git a/README.md b/README.md
[CODEX] index fecb22bce7791f926108dab947b93e75eaa022c7..09e58074104c565a3b4c29c33b94cf57fba373aa
[CODEX] --- a/README.md
[CODEX] +++ b/README.md
[CODEX] @@ -239,8 +239,8 @@
[CODEX] Vurvey Web Manager is the frontend component of the Vurvey platform. It works in conjunction with the Vurvey API backend to provide a complete solution for video-based consumer feedback.
[CODEX] -[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] -[Link to Comprehensive Documentation](../DOCUMENTATION.md)
[CODEX] +[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] +[Documentation Hub](./DOCUMENTATION.md)
[CODEX] ## Setup
[CODEX] diff --git a/docs/README.md b/docs/README.md
[CODEX] index 174c521a012dbbb5ef957dfc29360c9b697c7b6e..5a56517cd1e90833bbcb9dad65d7cb3d620b14c8
[CODEX] --- a/docs/README.md
[CODEX] +++ b/docs/README.md
[CODEX] @@ -19,11 +19,13 @@
[CODEX] ### Getting Started
[CODEX] +- [Implementation Guide](./implementation-guide.md) - How the application is assembled end-to-end
[CODEX] - [Project Structure](./project-structure.md) - Codebase organization
[CODEX] - [Authentication](./authentication.md) - Auth system and user management
[CODEX] - [State Management](./state-management.md) - Context and data flow
[CODEX] - [Routes](./routes.md) - Routing structure and navigation
[CODEX] - [Components](./components.md) - Component library and patterns
[CODEX] +- [Playwright Testing Guide](./playwright-testing-guide.md) - Full Playwright setup and authoring guide
[CODEX] ### Features
[CODEX] @@ -147,6 +149,7 @@
[CODEX] ```
[CODEX] LOGIN_USERNAME="your_test_email"
[CODEX] LOGIN_PASSWORD="your_test_password"
[CODEX] +URL="http://localhost:5050"
[CODEX] ```
[CODEX] ## Best Practices
[CODEX] @@ -181,3 +184,4 @@
[CODEX] - [Playwright Documentation](https://playwright.dev)
[CODEX] - [Apollo Client Documentation](https://www.apollographql.com/docs/react)
[CODEX] - [React Documentation](https://react.dev)
[CODEX] +- [Documentation Hub](../DOCUMENTATION.md) for an index of project guides
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] diff --git a/docs/playwright-testing-guide.md b/docs/playwright-testing-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..acbab280a49d446cc89ce7ea1e6de422380736ca
[CODEX] --- /dev/null
[CODEX] +++ b/docs/playwright-testing-guide.md
[CODEX] @@ -0,0 +1,161 @@
[CODEX] +# Playwright Testing Guide
[CODEX] +
[CODEX] +This guide explains how to configure, run, and extend the Playwright end-to-end test suite for Vurvey Web Manager.
[CODEX] +
[CODEX] +- [Overview](#overview)
[CODEX] +- [Directory Layout](#directory-layout)
[CODEX] +- [Environment Setup](#environment-setup)
[CODEX] +- [Running Tests](#running-tests)
[CODEX] +- [Authentication Workflow](#authentication-workflow)
[CODEX] +- [Writing & Organizing Tests](#writing--organizing-tests)
[CODEX] +- [Debugging & Diagnostics](#debugging--diagnostics)
[CODEX] +- [Continuous Integration](#continuous-integration)
[CODEX] +- [Reference Material](#reference-material)
[CODEX] +
[CODEX] +## Overview
[CODEX] +
[CODEX] +Playwright exercises the full React application in a Chromium browser using the configuration defined in `playwright.config.ts`. Tests rely on Firebase authentication, Apollo GraphQL, and feature flags, so a stable backend environment and test credentials are required.
[CODEX] +
[CODEX] +Key characteristics:
[CODEX] +
[CODEX] +- Tests live in `playwright/tests/*.spec.ts`.
[CODEX] +- A dedicated `setup` project seeds authentication (`auth.setup.ts`) and persists storage state to `playwright/.auth/user.json`.
[CODEX] +- Default executions run headless Chromium with `slowMo: 50` to reduce flakiness; override these options when debugging.
[CODEX] +
[CODEX] +## Directory Layout
[CODEX] +
[CODEX] +```
[CODEX] +playwright/
[CODEX] +â”œâ”€â”€ fixtures/                 # Test data assets (clips, csv, pdf, images)
[CODEX] +â”œâ”€â”€ helpers/                  # Utility helpers (authentication, navigation)
[CODEX] +â”œâ”€â”€ page-objects/             # Page object abstractions for complex flows
[CODEX] +â”œâ”€â”€ tests/                    # Spec files + global setup (auth.setup.ts)
[CODEX] +â”œâ”€â”€ env.d.ts                  # Type declarations for Playwright globals
[CODEX] +â””â”€â”€ README.md                 # High-level summary (links back to this guide)
[CODEX] +```
[CODEX] +
[CODEX] +Keep common logic in helpers or page objects instead of duplicating it inside specs. Fixtures should hold deterministic assets that can be reused across scenarios.
[CODEX] +
[CODEX] +## Environment Setup
[CODEX] +
[CODEX] +1. **Install dependencies**
[CODEX] +
[CODEX] +   ```bash
[CODEX] +   npm ci
[CODEX] +   npx playwright install
[CODEX] +   ```
[CODEX] +
[CODEX] +2. **Configure environment variables**
[CODEX] +
[CODEX] +   - Create `./playwright/.env` with the fields referenced in tests:
[CODEX] +
[CODEX] +     ```ini
[CODEX] +     URL=http://localhost:5050
[CODEX] +     LOGIN_USERNAME=tester@example.com
[CODEX] +     LOGIN_PASSWORD=super-secret
[CODEX] +     ```
[CODEX] +
[CODEX] +   - Variables defined in the repository root `.env` are also loaded. `URL` must match the origin where the web manager is running.
[CODEX] +
[CODEX] +3. **Launch the application backend**
[CODEX] +
[CODEX] +   - Ensure the Vurvey API and any dependent services are running; Playwright interacts with the live stack.
[CODEX] +   - Start the web manager locally with `npm start` or point `URL` at a staging environment.
[CODEX] +
[CODEX] +4. **Seed authentication state**
[CODEX] +
[CODEX] +   - The first test run invokes `auth.setup.ts`, which stores Firebase credentials in IndexedDB and writes a Playwright storage file (`playwright/.auth/user.json`).
[CODEX] +   - This file is reused by dependent projects so subsequent tests start in an authenticated session.
[CODEX] +
[CODEX] +## Running Tests
[CODEX] +
[CODEX] +Common commands:
[CODEX] +
[CODEX] +```bash
[CODEX] +# Run the full E2E suite
[CODEX] +npx playwright test
[CODEX] +
[CODEX] +# Run a specific spec
[CODEX] +npx playwright test playwright/tests/navigation.spec.ts
[CODEX] +
[CODEX] +# Filter by title
[CODEX] +npx playwright test --grep "@smoke"
[CODEX] +
[CODEX] +# Headed (visible) mode
[CODEX] +npx playwright test --headed
[CODEX] +
[CODEX] +# Debug mode with inspector
[CODEX] +npx playwright test --debug
[CODEX] +
[CODEX] +# Use the Playwright UI
[CODEX] +npx playwright test --ui
[CODEX] +```
[CODEX] +
[CODEX] +Project configuration (browser, base URL, reporters) lives in `playwright.config.ts`. Edit that file to add new projects (e.g., Firefox coverage) or alternative reporters.
[CODEX] +
[CODEX] +## Authentication Workflow
[CODEX] +
[CODEX] +Authentication uses Firebase persistence inside IndexedDB:
[CODEX] +
[CODEX] +1. `auth.setup.ts` logs in through the UI using `LOGIN_USERNAME` and `LOGIN_PASSWORD`.
[CODEX] +2. The helper `saveFirebaseAuthData` captures Firebase data from IndexedDB and writes it to `localStorage`.
[CODEX] +3. The storage state is exported to `playwright/.auth/user.json`.
[CODEX] +4. Individual specs call `restoreFirebaseAuthData` via helper utilities before navigating, ensuring a valid session without re-running the login flow.
[CODEX] +
[CODEX] +If you see `No auth data found in localStorage`, run the setup project again (`npx playwright test --project setup`). When credentials rotate, delete `playwright/.auth/user.json` and re-run the suite.
[CODEX] +
[CODEX] +## Writing & Organizing Tests
[CODEX] +
[CODEX] +- **Use fixtures**: Import reusable flows (e.g., `authenticate`) from `playwright/helpers`. Define domain-specific fixtures when a scenario needs shared setup and teardown.
[CODEX] +- **Prefer page objects**: Complex interactions such as the workflow builder or agent editor should be encapsulated in `playwright/page-objects` classes. Create methods that describe user intent (`workflowBuilder.publishFlow()`), not DOM mechanics.
[CODEX] +- **Selectors**: Lean on accessible selectors (`getByRole`, `getByLabel`, `getByTestId`). Fall back to data attributes when elements lack semantic handles. Avoid brittle CSS selectors.
[CODEX] +- **Organization**: Group related specs in `test.describe`. Tag critical smoke tests with `@smoke` for quick feedback loops.
[CODEX] +- **Time-sensitive flows**: Use `await expect(...).toBeVisible({ timeout: 30_000 })` for network-heavy screens. The global `expect` timeout already defaults to 30 seconds; override locally when necessary.
[CODEX] +- **Artifacts**: Use `test.info().attach` to capture domain-specific logs. Screenshots happen automatically on failure, but explicit captures help with mid-test diagnostics.
[CODEX] +
[CODEX] +Example skeleton:
[CODEX] +
[CODEX] +```ts
[CODEX] +import {test, expect} from "@playwright/test";
[CODEX] +import {authenticate} from "../helpers/authentication";
[CODEX] +import {DashboardPage} from "../page-objects/dashboard-page";
[CODEX] +
[CODEX] +test.describe("Dashboard", () => {
[CODEX] +  test.beforeEach(async ({page}) => {
[CODEX] +    await authenticate(page);
[CODEX] +  });
[CODEX] +
[CODEX] +  test("shows the active workspace summary @smoke", async ({page}) => {
[CODEX] +    const dashboard = new DashboardPage(page);
[CODEX] +    await dashboard.goto();
[CODEX] +    await expect(dashboard.header).toContainText("Workspace Overview");
[CODEX] +  });
[CODEX] +});
[CODEX] +```
[CODEX] +
[CODEX] +## Debugging & Diagnostics
[CODEX] +
[CODEX] +- **Trace Viewer**: Re-run failing tests with `npx playwright test --trace on-first-retry` to collect DOM snapshots, network logs, and console output.
[CODEX] +- **Video & screenshots**: Enable via `use: { video: "retain-on-failure", screenshot: "only-on-failure" }` either per test or globally in `playwright.config.ts`.
[CODEX] +- **Console logging**: Place strategic `console.log` statements in specs or helpers when investigating flaky behavior. Remove them once resolved to keep logs clean.
[CODEX] +- **Network mocking**: Stub GraphQL or REST endpoints with `page.route` for deterministic results when backend data is unavailable. Maintain mocks under `playwright/helpers/network`.
[CODEX] +
[CODEX] +When a test flakes, capture the trace, verify selectors still match the rendered UI, and ensure required feature flags are enabled for the environment.
[CODEX] +
[CODEX] +## Continuous Integration
[CODEX] +
[CODEX] +- CI pipelines call `npx playwright test` with the same configuration. Ensure new specs respect the single-worker execution configuration (`workers: 1`) unless you explicitly parallelize them.
[CODEX] +- Store credentials (username, password, URL) in the CI secret store. The setup project fails fast if they are missing.
[CODEX] +- Upload `test-results/` (HTML reporter output) as an artifact for post-run inspection.
[CODEX] +
[CODEX] +Before merging, run the suite locally or in a dry-run environment to catch environment-specific regressions early.
[CODEX] +
[CODEX] +## Reference Material
[CODEX] +
[CODEX] +- [Playwright Configuration](../playwright.config.ts)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +- [Testing Guide (unit + integration)](./TEST-README.md)
[CODEX] +- [Implementation Guide](./implementation-guide.md)
[CODEX] +- [Official Playwright Docs](https://playwright.dev/docs/intro)
[CODEX] +
[CODEX] +Keep this guide up to date whenever the test harness, authentication strategy, or project layout changes. New contributors should be able to set up Playwright using only this document.
[CODEX] diff --git a/playwright/README.md b/playwright/README.md
[CODEX] index 58090e78cd0aba7e78a7bd8ce3bf7b7a692ea8ca..02e1939682ff48977eb982bba77319f5e528768a
[CODEX] --- a/playwright/README.md
[CODEX] +++ b/playwright/README.md
[CODEX] @@ -1,5 +1,7 @@
[CODEX] # Vurvey Web Manager Testing Guide
[CODEX] +> **Prefer the canonical [Playwright Testing Guide](../docs/playwright-testing-guide.md)** for the most up-to-date instructions on setup, authoring, and debugging. This file keeps a condensed summary for quick reference.
[CODEX] +
[CODEX] This document provides comprehensive guidance for testing the Vurvey Web Manager application.
[CODEX] ## Overview
[CODEX] diff --git a/src/shared/__tests__/documentation-links.test.ts b/src/shared/__tests__/documentation-links.test.ts
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..1ce31fda3210502d79e91629a1078b02c220b94a
[CODEX] --- /dev/null
[CODEX] +++ b/src/shared/__tests__/documentation-links.test.ts
[CODEX] @@ -0,0 +1,26 @@
[CODEX] +import {readFileSync} from "node:fs";
[CODEX] +import {resolve} from "node:path";
[CODEX] +
[CODEX] +import {describe, expect, it} from "vitest";
[CODEX] +
[CODEX] +const readDoc = (relativePath: string): string => {
[CODEX] +	const filePath = resolve(__dirname, relativePath);
[CODEX] +
[CODEX] +	return readFileSync(filePath, "utf8");
[CODEX] +};
[CODEX] +
[CODEX] +describe("Project documentation", () => {
[CODEX] +	it("keeps the documentation hub index up to date", () => {
[CODEX] +		const documentation = readDoc("../../../DOCUMENTATION.md");
[CODEX] +
[CODEX] +		expect(documentation).toContain("[Implementation Guide](docs/implementation-guide.md)");
[CODEX] +		expect(documentation).toContain("[Playwright Testing Guide](docs/playwright-testing-guide.md)");
[CODEX] +	});
[CODEX] +
[CODEX] +	it("mirrors the new guides inside docs/README", () => {
[CODEX] +		const docsReadme = readDoc("../../../docs/README.md");
[CODEX] +
[CODEX] +		expect(docsReadme).toContain("./implementation-guide.md");
[CODEX] +		expect(docsReadme).toContain("./playwright-testing-guide.md");
[CODEX] +	});
[CODEX] +});
[CLAUDE]   ğŸ”§ Bash: List query files
[CODEX] thinking
[CODEX] **Marking test step as completed**
[CLAUDE]   ğŸ”§ Read
[CODEX] Plan update
[CODEX] âœ“ Assess existing documentation and testing resources to map gaps for implementation coverage and Playwright workflows.
[CODEX] âœ“ Author and organize new documentation that covers implementation architecture and detailed Playwright testing guidance.
[CODEX] âœ“ Add or update automated tests (and run relevant suites) to align with the new documentation, then validate everything passes.
[CODEX] file update:
[CODEX] diff --git a/DOCUMENTATION.md b/DOCUMENTATION.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e08ed0b3ff8c2fbb63dc3ee675405d59841b6a10
[CODEX] --- /dev/null
[CODEX] +++ b/DOCUMENTATION.md
[CODEX] @@ -0,0 +1,81 @@
[CODEX] +# Vurvey Web Manager Documentation Hub
[CODEX] +
[CODEX] +This hub ties together the architecture, development workflows, and testing resources for the Vurvey Web Manager. Start here for a narrated overview, then dive into the linked guides for deeper detail.
[CODEX] +
[CODEX] +- [Quick Start](#quick-start)
[CODEX] +- [Architecture at a Glance](#architecture-at-a-glance)
[CODEX] +- [Implementation Deep Dive](#implementation-deep-dive)
[CODEX] +- [Testing & Quality Assurance](#testing--quality-assurance)
[CODEX] +- [Operational Playbooks](#operational-playbooks)
[CODEX] +- [Documentation Index](#documentation-index)
[CODEX] +
[CODEX] +## Quick Start
[CODEX] +
[CODEX] +| Task | Command / Resource |
[CODEX] +| --- | --- |
[CODEX] +| Install dependencies | `npm ci` |
[CODEX] +| Run the dev server | `npm start` (defaults to `http://localhost:5050`) |
[CODEX] +| Type-check | `npm run type-check` |
[CODEX] +| Validate GraphQL documents | `npm run validate:graphql` |
[CODEX] +| Run unit/integration tests | `npm run test:unit` |
[CODEX] +| Run Playwright E2E tests | `npm run test:e2e` |
[CODEX] +| Lint source + tests | `npm run lint` |
[CODEX] +
[CODEX] +Environment variables (Firebase, GraphQL endpoint, feature flags) are defined in `.env`. See `docs/README.md#environment-variables` for the full list.
[CODEX] +
[CODEX] +## Architecture at a Glance
[CODEX] +
[CODEX] +- React 18 + TypeScript rendered through Vite.
[CODEX] +- Routing handled via `react-router-dom` with workspace-aware helpers.
[CODEX] +- GraphQL powered by Apollo Client (HTTP + WebSocket links) and LaunchDarkly/OpenFeature feature flag providers.
[CODEX] +- State spans React Contexts, Apollo cache, and reducer-driven component state.
[CODEX] +- Styling leverages SCSS modules and a shared component library under `src/shared`.
[CODEX] +
[CODEX] +Review the [Implementation Guide](docs/implementation-guide.md) for a walkthrough of providers, feature modules, and architectural conventions.
[CODEX] +
[CODEX] +## Implementation Deep Dive
[CODEX] +
[CODEX] +| Topic | Summary |
[CODEX] +| --- | --- |
[CODEX] +| [Implementation Guide](docs/implementation-guide.md) | Entry points, provider stack, routing, feature ownership, build tooling. |
[CODEX] +| [Project Structure](docs/project-structure.md) | Directory breakdown and best practices for adding new files. |
[CODEX] +| [State Management](docs/state-management.md) | Contexts, reducers, and caching strategies. |
[CODEX] +| [GraphQL Integration](docs/graphql-integration.md) | Query organization, code generation, and cache policies. |
[CODEX] +| [Custom Hooks](docs/custom-hooks.md) | Reusable hooks available across features. |
[CODEX] +| [Workflow Builder Guide](docs/workflow-builder-guide.md) | Deep dive into the workflow module architecture. |
[CODEX] +
[CODEX] +When implementing new features, align with the patterns documented in these guides and update them if responsibilities shift.
[CODEX] +
[CODEX] +## Testing & Quality Assurance
[CODEX] +
[CODEX] +- [Playwright Testing Guide](docs/playwright-testing-guide.md) â€“ Environment setup, authentication strategy, authoring conventions, and debugging tips.
[CODEX] +- [E2E Testing Patterns](docs/e2e-testing-patterns.md) â€“ Hard-won lessons for resilient selectors and flows.
[CODEX] +- [Testing Guide](docs/TEST-README.md) â€“ Vitest commands, coverage expectations, and mocking strategies.
[CODEX] +- Unit tests live beside implementation files. E2E specs live under `playwright/tests/`. Follow the documented fixtures/page-object approach for consistency.
[CODEX] +
[CODEX] +## Operational Playbooks
[CODEX] +
[CODEX] +- [Authentication](docs/authentication.md) â€“ Firebase sign-in flows and session persistence.
[CODEX] +- [Core Features](docs/core-features.md) â€“ Feature overviews for stakeholders and QA.
[CODEX] +- [Routes](docs/routes.md) â€“ Navigation map with workspace/context rules.
[CODEX] +- [Smooth Streaming](docs/smooth-streaming.md) & [Chat Streaming](docs/chat-streaming.md) â€“ Real-time infrastructure details.
[CODEX] +- [Test Resilience Strategy](docs/test-resilience-strategy.md) â€“ Stabilization techniques for automated suites.
[CODEX] +
[CODEX] +These playbooks help new engineers and QA members ramp up quickly on specific domains.
[CODEX] +
[CODEX] +## Documentation Index
[CODEX] +
[CODEX] +All documentation lives under the `docs/` directory:
[CODEX] +
[CODEX] +- [docs/README.md](docs/README.md) â€“ Entry point with setup instructions.
[CODEX] +- [docs/components.md](docs/components.md) â€“ Shared component catalogue.
[CODEX] +- [docs/routes.md](docs/routes.md) â€“ Application routing map.
[CODEX] +- [docs/core-features.md](docs/core-features.md) â€“ High-level feature descriptions.
[CODEX] +- [docs/workflow-builder-guide.md](docs/workflow-builder-guide.md) â€“ Workflow builder architecture.
[CODEX] +- [docs/playwright-testing-guide.md](docs/playwright-testing-guide.md) â€“ Comprehensive Playwright usage.
[CODEX] +- [docs/implementation-guide.md](docs/implementation-guide.md) â€“ Frontend implementation detail.
[CODEX] +- [docs/authentication.md](docs/authentication.md) â€“ Auth flows and state storage.
[CODEX] +- [docs/e2e-testing-patterns.md](docs/e2e-testing-patterns.md) â€“ Resilient test strategies.
[CODEX] +- [docs/TEST-README.md](docs/TEST-README.md) â€“ Unit and integration testing commands.
[CODEX] +
[CODEX] +Keep this hub updated as we introduce new docs or migrate content. If a guide becomes outdated, link directly to its successor or fold it into a more relevant document.
[CODEX] diff --git a/README.md b/README.md
[CODEX] index fecb22bce7791f926108dab947b93e75eaa022c7..09e58074104c565a3b4c29c33b94cf57fba373aa
[CODEX] --- a/README.md
[CODEX] +++ b/README.md
[CODEX] @@ -239,8 +239,8 @@
[CODEX] Vurvey Web Manager is the frontend component of the Vurvey platform. It works in conjunction with the Vurvey API backend to provide a complete solution for video-based consumer feedback.
[CODEX] -[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] -[Link to Comprehensive Documentation](../DOCUMENTATION.md)
[CODEX] +[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] +[Documentation Hub](./DOCUMENTATION.md)
[CODEX] ## Setup
[CODEX] diff --git a/docs/README.md b/docs/README.md
[CODEX] index 174c521a012dbbb5ef957dfc29360c9b697c7b6e..5a56517cd1e90833bbcb9dad65d7cb3d620b14c8
[CODEX] --- a/docs/README.md
[CODEX] +++ b/docs/README.md
[CODEX] @@ -19,11 +19,13 @@
[CODEX] ### Getting Started
[CODEX] +- [Implementation Guide](./implementation-guide.md) - How the application is assembled end-to-end
[CODEX] - [Project Structure](./project-structure.md) - Codebase organization
[CODEX] - [Authentication](./authentication.md) - Auth system and user management
[CODEX] - [State Management](./state-management.md) - Context and data flow
[CODEX] - [Routes](./routes.md) - Routing structure and navigation
[CODEX] - [Components](./components.md) - Component library and patterns
[CODEX] +- [Playwright Testing Guide](./playwright-testing-guide.md) - Full Playwright setup and authoring guide
[CODEX] ### Features
[CODEX] @@ -147,6 +149,7 @@
[CODEX] ```
[CODEX] LOGIN_USERNAME="your_test_email"
[CODEX] LOGIN_PASSWORD="your_test_password"
[CODEX] +URL="http://localhost:5050"
[CODEX] ```
[CODEX] ## Best Practices
[CODEX] @@ -181,3 +184,4 @@
[CODEX] - [Playwright Documentation](https://playwright.dev)
[CODEX] - [Apollo Client Documentation](https://www.apollographql.com/docs/react)
[CODEX] - [React Documentation](https://react.dev)
[CODEX] +- [Documentation Hub](../DOCUMENTATION.md) for an index of project guides
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] diff --git a/docs/playwright-testing-guide.md b/docs/playwright-testing-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..acbab280a49d446cc89ce7ea1e6de422380736ca
[CODEX] --- /dev/null
[CODEX] +++ b/docs/playwright-testing-guide.md
[CODEX] @@ -0,0 +1,161 @@
[CODEX] +# Playwright Testing Guide
[CODEX] +
[CODEX] +This guide explains how to configure, run, and extend the Playwright end-to-end test suite for Vurvey Web Manager.
[CODEX] +
[CODEX] +- [Overview](#overview)
[CODEX] +- [Directory Layout](#directory-layout)
[CODEX] +- [Environment Setup](#environment-setup)
[CODEX] +- [Running Tests](#running-tests)
[CODEX] +- [Authentication Workflow](#authentication-workflow)
[CODEX] +- [Writing & Organizing Tests](#writing--organizing-tests)
[CODEX] +- [Debugging & Diagnostics](#debugging--diagnostics)
[CODEX] +- [Continuous Integration](#continuous-integration)
[CODEX] +- [Reference Material](#reference-material)
[CODEX] +
[CODEX] +## Overview
[CODEX] +
[CODEX] +Playwright exercises the full React application in a Chromium browser using the configuration defined in `playwright.config.ts`. Tests rely on Firebase authentication, Apollo GraphQL, and feature flags, so a stable backend environment and test credentials are required.
[CODEX] +
[CODEX] +Key characteristics:
[CODEX] +
[CODEX] +- Tests live in `playwright/tests/*.spec.ts`.
[CODEX] +- A dedicated `setup` project seeds authentication (`auth.setup.ts`) and persists storage state to `playwright/.auth/user.json`.
[CODEX] +- Default executions run headless Chromium with `slowMo: 50` to reduce flakiness; override these options when debugging.
[CODEX] +
[CODEX] +## Directory Layout
[CODEX] +
[CODEX] +```
[CODEX] +playwright/
[CODEX] +â”œâ”€â”€ fixtures/                 # Test data assets (clips, csv, pdf, images)
[CODEX] +â”œâ”€â”€ helpers/                  # Utility helpers (authentication, navigation)
[CODEX] +â”œâ”€â”€ page-objects/             # Page object abstractions for complex flows
[CODEX] +â”œâ”€â”€ tests/                    # Spec files + global setup (auth.setup.ts)
[CODEX] +â”œâ”€â”€ env.d.ts                  # Type declarations for Playwright globals
[CODEX] +â””â”€â”€ README.md                 # High-level summary (links back to this guide)
[CODEX] +```
[CODEX] +
[CODEX] +Keep common logic in helpers or page objects instead of duplicating it inside specs. Fixtures should hold deterministic assets that can be reused across scenarios.
[CODEX] +
[CODEX] +## Environment Setup
[CODEX] +
[CODEX] +1. **Install dependencies**
[CODEX] +
[CODEX] +   ```bash
[CODEX] +   npm ci
[CODEX] +   npx playwright install
[CODEX] +   ```
[CODEX] +
[CODEX] +2. **Configure environment variables**
[CODEX] +
[CODEX] +   - Create `./playwright/.env` with the fields referenced in tests:
[CODEX] +
[CODEX] +     ```ini
[CODEX] +     URL=http://localhost:5050
[CODEX] +     LOGIN_USERNAME=tester@example.com
[CODEX] +     LOGIN_PASSWORD=super-secret
[CODEX] +     ```
[CODEX] +
[CODEX] +   - Variables defined in the repository root `.env` are also loaded. `URL` must match the origin where the web manager is running.
[CODEX] +
[CODEX] +3. **Launch the application backend**
[CODEX] +
[CODEX] +   - Ensure the Vurvey API and any dependent services are running; Playwright interacts with the live stack.
[CODEX] +   - Start the web manager locally with `npm start` or point `URL` at a staging environment.
[CODEX] +
[CODEX] +4. **Seed authentication state**
[CODEX] +
[CODEX] +   - The first test run invokes `auth.setup.ts`, which stores Firebase credentials in IndexedDB and writes a Playwright storage file (`playwright/.auth/user.json`).
[CODEX] +   - This file is reused by dependent projects so subsequent tests start in an authenticated session.
[CODEX] +
[CODEX] +## Running Tests
[CODEX] +
[CODEX] +Common commands:
[CODEX] +
[CODEX] +```bash
[CODEX] +# Run the full E2E suite
[CODEX] +npx playwright test
[CODEX] +
[CODEX] +# Run a specific spec
[CODEX] +npx playwright test playwright/tests/navigation.spec.ts
[CODEX] +
[CODEX] +# Filter by title
[CODEX] +npx playwright test --grep "@smoke"
[CODEX] +
[CODEX] +# Headed (visible) mode
[CODEX] +npx playwright test --headed
[CODEX] +
[CODEX] +# Debug mode with inspector
[CODEX] +npx playwright test --debug
[CODEX] +
[CODEX] +# Use the Playwright UI
[CODEX] +npx playwright test --ui
[CODEX] +```
[CODEX] +
[CODEX] +Project configuration (browser, base URL, reporters) lives in `playwright.config.ts`. Edit that file to add new projects (e.g., Firefox coverage) or alternative reporters.
[CODEX] +
[CODEX] +## Authentication Workflow
[CODEX] +
[CODEX] +Authentication uses Firebase persistence inside IndexedDB:
[CODEX] +
[CODEX] +1. `auth.setup.ts` logs in through the UI using `LOGIN_USERNAME` and `LOGIN_PASSWORD`.
[CODEX] +2. The helper `saveFirebaseAuthData` captures Firebase data from IndexedDB and writes it to `localStorage`.
[CODEX] +3. The storage state is exported to `playwright/.auth/user.json`.
[CODEX] +4. Individual specs call `restoreFirebaseAuthData` via helper utilities before navigating, ensuring a valid session without re-running the login flow.
[CODEX] +
[CODEX] +If you see `No auth data found in localStorage`, run the setup project again (`npx playwright test --project setup`). When credentials rotate, delete `playwright/.auth/user.json` and re-run the suite.
[CODEX] +
[CODEX] +## Writing & Organizing Tests
[CODEX] +
[CODEX] +- **Use fixtures**: Import reusable flows (e.g., `authenticate`) from `playwright/helpers`. Define domain-specific fixtures when a scenario needs shared setup and teardown.
[CODEX] +- **Prefer page objects**: Complex interactions such as the workflow builder or agent editor should be encapsulated in `playwright/page-objects` classes. Create methods that describe user intent (`workflowBuilder.publishFlow()`), not DOM mechanics.
[CODEX] +- **Selectors**: Lean on accessible selectors (`getByRole`, `getByLabel`, `getByTestId`). Fall back to data attributes when elements lack semantic handles. Avoid brittle CSS selectors.
[CODEX] +- **Organization**: Group related specs in `test.describe`. Tag critical smoke tests with `@smoke` for quick feedback loops.
[CODEX] +- **Time-sensitive flows**: Use `await expect(...).toBeVisible({ timeout: 30_000 })` for network-heavy screens. The global `expect` timeout already defaults to 30 seconds; override locally when necessary.
[CODEX] +- **Artifacts**: Use `test.info().attach` to capture domain-specific logs. Screenshots happen automatically on failure, but explicit captures help with mid-test diagnostics.
[CODEX] +
[CODEX] +Example skeleton:
[CODEX] +
[CODEX] +```ts
[CODEX] +import {test, expect} from "@playwright/test";
[CODEX] +import {authenticate} from "../helpers/authentication";
[CODEX] +import {DashboardPage} from "../page-objects/dashboard-page";
[CODEX] +
[CODEX] +test.describe("Dashboard", () => {
[CODEX] +  test.beforeEach(async ({page}) => {
[CODEX] +    await authenticate(page);
[CODEX] +  });
[CODEX] +
[CODEX] +  test("shows the active workspace summary @smoke", async ({page}) => {
[CODEX] +    const dashboard = new DashboardPage(page);
[CODEX] +    await dashboard.goto();
[CODEX] +    await expect(dashboard.header).toContainText("Workspace Overview");
[CODEX] +  });
[CODEX] +});
[CODEX] +```
[CODEX] +
[CODEX] +## Debugging & Diagnostics
[CODEX] +
[CODEX] +- **Trace Viewer**: Re-run failing tests with `npx playwright test --trace on-first-retry` to collect DOM snapshots, network logs, and console output.
[CODEX] +- **Video & screenshots**: Enable via `use: { video: "retain-on-failure", screenshot: "only-on-failure" }` either per test or globally in `playwright.config.ts`.
[CODEX] +- **Console logging**: Place strategic `console.log` statements in specs or helpers when investigating flaky behavior. Remove them once resolved to keep logs clean.
[CODEX] +- **Network mocking**: Stub GraphQL or REST endpoints with `page.route` for deterministic results when backend data is unavailable. Maintain mocks under `playwright/helpers/network`.
[CODEX] +
[CODEX] +When a test flakes, capture the trace, verify selectors still match the rendered UI, and ensure required feature flags are enabled for the environment.
[CODEX] +
[CODEX] +## Continuous Integration
[CODEX] +
[CODEX] +- CI pipelines call `npx playwright test` with the same configuration. Ensure new specs respect the single-worker execution configuration (`workers: 1`) unless you explicitly parallelize them.
[CODEX] +- Store credentials (username, password, URL) in the CI secret store. The setup project fails fast if they are missing.
[CODEX] +- Upload `test-results/` (HTML reporter output) as an artifact for post-run inspection.
[CODEX] +
[CODEX] +Before merging, run the suite locally or in a dry-run environment to catch environment-specific regressions early.
[CODEX] +
[CODEX] +## Reference Material
[CODEX] +
[CODEX] +- [Playwright Configuration](../playwright.config.ts)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +- [Testing Guide (unit + integration)](./TEST-README.md)
[CODEX] +- [Implementation Guide](./implementation-guide.md)
[CODEX] +- [Official Playwright Docs](https://playwright.dev/docs/intro)
[CODEX] +
[CODEX] +Keep this guide up to date whenever the test harness, authentication strategy, or project layout changes. New contributors should be able to set up Playwright using only this document.
[CODEX] diff --git a/playwright/README.md b/playwright/README.md
[CODEX] index 58090e78cd0aba7e78a7bd8ce3bf7b7a692ea8ca..02e1939682ff48977eb982bba77319f5e528768a
[CODEX] --- a/playwright/README.md
[CODEX] +++ b/playwright/README.md
[CODEX] @@ -1,5 +1,7 @@
[CODEX] # Vurvey Web Manager Testing Guide
[CODEX] +> **Prefer the canonical [Playwright Testing Guide](../docs/playwright-testing-guide.md)** for the most up-to-date instructions on setup, authoring, and debugging. This file keeps a condensed summary for quick reference.
[CODEX] +
[CODEX] This document provides comprehensive guidance for testing the Vurvey Web Manager application.
[CODEX] ## Overview
[CODEX] diff --git a/src/shared/__tests__/documentation-links.test.ts b/src/shared/__tests__/documentation-links.test.ts
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..1ce31fda3210502d79e91629a1078b02c220b94a
[CODEX] --- /dev/null
[CODEX] +++ b/src/shared/__tests__/documentation-links.test.ts
[CODEX] @@ -0,0 +1,26 @@
[CODEX] +import {readFileSync} from "node:fs";
[CODEX] +import {resolve} from "node:path";
[CODEX] +
[CODEX] +import {describe, expect, it} from "vitest";
[CODEX] +
[CODEX] +const readDoc = (relativePath: string): string => {
[CODEX] +	const filePath = resolve(__dirname, relativePath);
[CODEX] +
[CODEX] +	return readFileSync(filePath, "utf8");
[CODEX] +};
[CODEX] +
[CODEX] +describe("Project documentation", () => {
[CODEX] +	it("keeps the documentation hub index up to date", () => {
[CODEX] +		const documentation = readDoc("../../../DOCUMENTATION.md");
[CODEX] +
[CODEX] +		expect(documentation).toContain("[Implementation Guide](docs/implementation-guide.md)");
[CODEX] +		expect(documentation).toContain("[Playwright Testing Guide](docs/playwright-testing-guide.md)");
[CODEX] +	});
[CODEX] +
[CODEX] +	it("mirrors the new guides inside docs/README", () => {
[CODEX] +		const docsReadme = readDoc("../../../docs/README.md");
[CODEX] +
[CODEX] +		expect(docsReadme).toContain("./implementation-guide.md");
[CODEX] +		expect(docsReadme).toContain("./playwright-testing-guide.md");
[CODEX] +	});
[CODEX] +});
[CLAUDE]   ğŸ”§ Bash: List mutation files
[CODEX] thinking
[CODEX] **Preparing to commit changes**
[CODEX] exec
[CODEX] bash -lc 'git status -sb' in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 90ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] ## agents/codex/20251104-155449-6a42f6
[CODEX] M README.md
[CODEX] M docs/README.md
[CODEX] M playwright/README.md
[CODEX] ?? .logs/
[CODEX] ?? DOCUMENTATION.md
[CODEX] ?? docs/implementation-guide.md
[CODEX] ?? docs/playwright-testing-guide.md
[CODEX] ?? src/shared/__tests__/
[CODEX] file update:
[CODEX] diff --git a/DOCUMENTATION.md b/DOCUMENTATION.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e08ed0b3ff8c2fbb63dc3ee675405d59841b6a10
[CODEX] --- /dev/null
[CODEX] +++ b/DOCUMENTATION.md
[CODEX] @@ -0,0 +1,81 @@
[CODEX] +# Vurvey Web Manager Documentation Hub
[CODEX] +
[CODEX] +This hub ties together the architecture, development workflows, and testing resources for the Vurvey Web Manager. Start here for a narrated overview, then dive into the linked guides for deeper detail.
[CODEX] +
[CODEX] +- [Quick Start](#quick-start)
[CODEX] +- [Architecture at a Glance](#architecture-at-a-glance)
[CODEX] +- [Implementation Deep Dive](#implementation-deep-dive)
[CODEX] +- [Testing & Quality Assurance](#testing--quality-assurance)
[CODEX] +- [Operational Playbooks](#operational-playbooks)
[CODEX] +- [Documentation Index](#documentation-index)
[CODEX] +
[CODEX] +## Quick Start
[CODEX] +
[CODEX] +| Task | Command / Resource |
[CODEX] +| --- | --- |
[CODEX] +| Install dependencies | `npm ci` |
[CODEX] +| Run the dev server | `npm start` (defaults to `http://localhost:5050`) |
[CODEX] +| Type-check | `npm run type-check` |
[CODEX] +| Validate GraphQL documents | `npm run validate:graphql` |
[CODEX] +| Run unit/integration tests | `npm run test:unit` |
[CODEX] +| Run Playwright E2E tests | `npm run test:e2e` |
[CODEX] +| Lint source + tests | `npm run lint` |
[CODEX] +
[CODEX] +Environment variables (Firebase, GraphQL endpoint, feature flags) are defined in `.env`. See `docs/README.md#environment-variables` for the full list.
[CODEX] +
[CODEX] +## Architecture at a Glance
[CODEX] +
[CODEX] +- React 18 + TypeScript rendered through Vite.
[CODEX] +- Routing handled via `react-router-dom` with workspace-aware helpers.
[CODEX] +- GraphQL powered by Apollo Client (HTTP + WebSocket links) and LaunchDarkly/OpenFeature feature flag providers.
[CODEX] +- State spans React Contexts, Apollo cache, and reducer-driven component state.
[CODEX] +- Styling leverages SCSS modules and a shared component library under `src/shared`.
[CODEX] +
[CODEX] +Review the [Implementation Guide](docs/implementation-guide.md) for a walkthrough of providers, feature modules, and architectural conventions.
[CODEX] +
[CODEX] +## Implementation Deep Dive
[CODEX] +
[CODEX] +| Topic | Summary |
[CODEX] +| --- | --- |
[CODEX] +| [Implementation Guide](docs/implementation-guide.md) | Entry points, provider stack, routing, feature ownership, build tooling. |
[CODEX] +| [Project Structure](docs/project-structure.md) | Directory breakdown and best practices for adding new files. |
[CODEX] +| [State Management](docs/state-management.md) | Contexts, reducers, and caching strategies. |
[CODEX] +| [GraphQL Integration](docs/graphql-integration.md) | Query organization, code generation, and cache policies. |
[CODEX] +| [Custom Hooks](docs/custom-hooks.md) | Reusable hooks available across features. |
[CODEX] +| [Workflow Builder Guide](docs/workflow-builder-guide.md) | Deep dive into the workflow module architecture. |
[CODEX] +
[CODEX] +When implementing new features, align with the patterns documented in these guides and update them if responsibilities shift.
[CODEX] +
[CODEX] +## Testing & Quality Assurance
[CODEX] +
[CODEX] +- [Playwright Testing Guide](docs/playwright-testing-guide.md) â€“ Environment setup, authentication strategy, authoring conventions, and debugging tips.
[CODEX] +- [E2E Testing Patterns](docs/e2e-testing-patterns.md) â€“ Hard-won lessons for resilient selectors and flows.
[CODEX] +- [Testing Guide](docs/TEST-README.md) â€“ Vitest commands, coverage expectations, and mocking strategies.
[CODEX] +- Unit tests live beside implementation files. E2E specs live under `playwright/tests/`. Follow the documented fixtures/page-object approach for consistency.
[CODEX] +
[CODEX] +## Operational Playbooks
[CODEX] +
[CODEX] +- [Authentication](docs/authentication.md) â€“ Firebase sign-in flows and session persistence.
[CODEX] +- [Core Features](docs/core-features.md) â€“ Feature overviews for stakeholders and QA.
[CODEX] +- [Routes](docs/routes.md) â€“ Navigation map with workspace/context rules.
[CODEX] +- [Smooth Streaming](docs/smooth-streaming.md) & [Chat Streaming](docs/chat-streaming.md) â€“ Real-time infrastructure details.
[CODEX] +- [Test Resilience Strategy](docs/test-resilience-strategy.md) â€“ Stabilization techniques for automated suites.
[CODEX] +
[CODEX] +These playbooks help new engineers and QA members ramp up quickly on specific domains.
[CODEX] +
[CODEX] +## Documentation Index
[CODEX] +
[CODEX] +All documentation lives under the `docs/` directory:
[CODEX] +
[CODEX] +- [docs/README.md](docs/README.md) â€“ Entry point with setup instructions.
[CODEX] +- [docs/components.md](docs/components.md) â€“ Shared component catalogue.
[CODEX] +- [docs/routes.md](docs/routes.md) â€“ Application routing map.
[CODEX] +- [docs/core-features.md](docs/core-features.md) â€“ High-level feature descriptions.
[CODEX] +- [docs/workflow-builder-guide.md](docs/workflow-builder-guide.md) â€“ Workflow builder architecture.
[CODEX] +- [docs/playwright-testing-guide.md](docs/playwright-testing-guide.md) â€“ Comprehensive Playwright usage.
[CODEX] +- [docs/implementation-guide.md](docs/implementation-guide.md) â€“ Frontend implementation detail.
[CODEX] +- [docs/authentication.md](docs/authentication.md) â€“ Auth flows and state storage.
[CODEX] +- [docs/e2e-testing-patterns.md](docs/e2e-testing-patterns.md) â€“ Resilient test strategies.
[CODEX] +- [docs/TEST-README.md](docs/TEST-README.md) â€“ Unit and integration testing commands.
[CODEX] +
[CODEX] +Keep this hub updated as we introduce new docs or migrate content. If a guide becomes outdated, link directly to its successor or fold it into a more relevant document.
[CODEX] diff --git a/README.md b/README.md
[CODEX] index fecb22bce7791f926108dab947b93e75eaa022c7..09e58074104c565a3b4c29c33b94cf57fba373aa
[CODEX] --- a/README.md
[CODEX] +++ b/README.md
[CODEX] @@ -239,8 +239,8 @@
[CODEX] Vurvey Web Manager is the frontend component of the Vurvey platform. It works in conjunction with the Vurvey API backend to provide a complete solution for video-based consumer feedback.
[CODEX] -[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] -[Link to Comprehensive Documentation](../DOCUMENTATION.md)
[CODEX] +[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] +[Documentation Hub](./DOCUMENTATION.md)
[CODEX] ## Setup
[CODEX] diff --git a/docs/README.md b/docs/README.md
[CODEX] index 174c521a012dbbb5ef957dfc29360c9b697c7b6e..5a56517cd1e90833bbcb9dad65d7cb3d620b14c8
[CODEX] --- a/docs/README.md
[CODEX] +++ b/docs/README.md
[CODEX] @@ -19,11 +19,13 @@
[CODEX] ### Getting Started
[CODEX] +- [Implementation Guide](./implementation-guide.md) - How the application is assembled end-to-end
[CODEX] - [Project Structure](./project-structure.md) - Codebase organization
[CODEX] - [Authentication](./authentication.md) - Auth system and user management
[CODEX] - [State Management](./state-management.md) - Context and data flow
[CODEX] - [Routes](./routes.md) - Routing structure and navigation
[CODEX] - [Components](./components.md) - Component library and patterns
[CODEX] +- [Playwright Testing Guide](./playwright-testing-guide.md) - Full Playwright setup and authoring guide
[CODEX] ### Features
[CODEX] @@ -147,6 +149,7 @@
[CODEX] ```
[CODEX] LOGIN_USERNAME="your_test_email"
[CODEX] LOGIN_PASSWORD="your_test_password"
[CODEX] +URL="http://localhost:5050"
[CODEX] ```
[CODEX] ## Best Practices
[CODEX] @@ -181,3 +184,4 @@
[CODEX] - [Playwright Documentation](https://playwright.dev)
[CODEX] - [Apollo Client Documentation](https://www.apollographql.com/docs/react)
[CODEX] - [React Documentation](https://react.dev)
[CODEX] +- [Documentation Hub](../DOCUMENTATION.md) for an index of project guides
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] diff --git a/docs/playwright-testing-guide.md b/docs/playwright-testing-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..acbab280a49d446cc89ce7ea1e6de422380736ca
[CODEX] --- /dev/null
[CODEX] +++ b/docs/playwright-testing-guide.md
[CODEX] @@ -0,0 +1,161 @@
[CODEX] +# Playwright Testing Guide
[CODEX] +
[CODEX] +This guide explains how to configure, run, and extend the Playwright end-to-end test suite for Vurvey Web Manager.
[CODEX] +
[CODEX] +- [Overview](#overview)
[CODEX] +- [Directory Layout](#directory-layout)
[CODEX] +- [Environment Setup](#environment-setup)
[CODEX] +- [Running Tests](#running-tests)
[CODEX] +- [Authentication Workflow](#authentication-workflow)
[CODEX] +- [Writing & Organizing Tests](#writing--organizing-tests)
[CODEX] +- [Debugging & Diagnostics](#debugging--diagnostics)
[CODEX] +- [Continuous Integration](#continuous-integration)
[CODEX] +- [Reference Material](#reference-material)
[CODEX] +
[CODEX] +## Overview
[CODEX] +
[CODEX] +Playwright exercises the full React application in a Chromium browser using the configuration defined in `playwright.config.ts`. Tests rely on Firebase authentication, Apollo GraphQL, and feature flags, so a stable backend environment and test credentials are required.
[CODEX] +
[CODEX] +Key characteristics:
[CODEX] +
[CODEX] +- Tests live in `playwright/tests/*.spec.ts`.
[CODEX] +- A dedicated `setup` project seeds authentication (`auth.setup.ts`) and persists storage state to `playwright/.auth/user.json`.
[CODEX] +- Default executions run headless Chromium with `slowMo: 50` to reduce flakiness; override these options when debugging.
[CODEX] +
[CODEX] +## Directory Layout
[CODEX] +
[CODEX] +```
[CODEX] +playwright/
[CODEX] +â”œâ”€â”€ fixtures/                 # Test data assets (clips, csv, pdf, images)
[CODEX] +â”œâ”€â”€ helpers/                  # Utility helpers (authentication, navigation)
[CODEX] +â”œâ”€â”€ page-objects/             # Page object abstractions for complex flows
[CODEX] +â”œâ”€â”€ tests/                    # Spec files + global setup (auth.setup.ts)
[CODEX] +â”œâ”€â”€ env.d.ts                  # Type declarations for Playwright globals
[CODEX] +â””â”€â”€ README.md                 # High-level summary (links back to this guide)
[CODEX] +```
[CODEX] +
[CODEX] +Keep common logic in helpers or page objects instead of duplicating it inside specs. Fixtures should hold deterministic assets that can be reused across scenarios.
[CODEX] +
[CODEX] +## Environment Setup
[CODEX] +
[CODEX] +1. **Install dependencies**
[CODEX] +
[CODEX] +   ```bash
[CODEX] +   npm ci
[CODEX] +   npx playwright install
[CODEX] +   ```
[CODEX] +
[CODEX] +2. **Configure environment variables**
[CODEX] +
[CODEX] +   - Create `./playwright/.env` with the fields referenced in tests:
[CODEX] +
[CODEX] +     ```ini
[CODEX] +     URL=http://localhost:5050
[CODEX] +     LOGIN_USERNAME=tester@example.com
[CODEX] +     LOGIN_PASSWORD=super-secret
[CODEX] +     ```
[CODEX] +
[CODEX] +   - Variables defined in the repository root `.env` are also loaded. `URL` must match the origin where the web manager is running.
[CODEX] +
[CODEX] +3. **Launch the application backend**
[CODEX] +
[CODEX] +   - Ensure the Vurvey API and any dependent services are running; Playwright interacts with the live stack.
[CODEX] +   - Start the web manager locally with `npm start` or point `URL` at a staging environment.
[CODEX] +
[CODEX] +4. **Seed authentication state**
[CODEX] +
[CODEX] +   - The first test run invokes `auth.setup.ts`, which stores Firebase credentials in IndexedDB and writes a Playwright storage file (`playwright/.auth/user.json`).
[CODEX] +   - This file is reused by dependent projects so subsequent tests start in an authenticated session.
[CODEX] +
[CODEX] +## Running Tests
[CODEX] +
[CODEX] +Common commands:
[CODEX] +
[CODEX] +```bash
[CODEX] +# Run the full E2E suite
[CODEX] +npx playwright test
[CODEX] +
[CODEX] +# Run a specific spec
[CODEX] +npx playwright test playwright/tests/navigation.spec.ts
[CODEX] +
[CODEX] +# Filter by title
[CODEX] +npx playwright test --grep "@smoke"
[CODEX] +
[CODEX] +# Headed (visible) mode
[CODEX] +npx playwright test --headed
[CODEX] +
[CODEX] +# Debug mode with inspector
[CODEX] +npx playwright test --debug
[CODEX] +
[CODEX] +# Use the Playwright UI
[CODEX] +npx playwright test --ui
[CODEX] +```
[CODEX] +
[CODEX] +Project configuration (browser, base URL, reporters) lives in `playwright.config.ts`. Edit that file to add new projects (e.g., Firefox coverage) or alternative reporters.
[CODEX] +
[CODEX] +## Authentication Workflow
[CODEX] +
[CODEX] +Authentication uses Firebase persistence inside IndexedDB:
[CODEX] +
[CODEX] +1. `auth.setup.ts` logs in through the UI using `LOGIN_USERNAME` and `LOGIN_PASSWORD`.
[CODEX] +2. The helper `saveFirebaseAuthData` captures Firebase data from IndexedDB and writes it to `localStorage`.
[CODEX] +3. The storage state is exported to `playwright/.auth/user.json`.
[CODEX] +4. Individual specs call `restoreFirebaseAuthData` via helper utilities before navigating, ensuring a valid session without re-running the login flow.
[CODEX] +
[CODEX] +If you see `No auth data found in localStorage`, run the setup project again (`npx playwright test --project setup`). When credentials rotate, delete `playwright/.auth/user.json` and re-run the suite.
[CODEX] +
[CODEX] +## Writing & Organizing Tests
[CODEX] +
[CODEX] +- **Use fixtures**: Import reusable flows (e.g., `authenticate`) from `playwright/helpers`. Define domain-specific fixtures when a scenario needs shared setup and teardown.
[CODEX] +- **Prefer page objects**: Complex interactions such as the workflow builder or agent editor should be encapsulated in `playwright/page-objects` classes. Create methods that describe user intent (`workflowBuilder.publishFlow()`), not DOM mechanics.
[CODEX] +- **Selectors**: Lean on accessible selectors (`getByRole`, `getByLabel`, `getByTestId`). Fall back to data attributes when elements lack semantic handles. Avoid brittle CSS selectors.
[CODEX] +- **Organization**: Group related specs in `test.describe`. Tag critical smoke tests with `@smoke` for quick feedback loops.
[CODEX] +- **Time-sensitive flows**: Use `await expect(...).toBeVisible({ timeout: 30_000 })` for network-heavy screens. The global `expect` timeout already defaults to 30 seconds; override locally when necessary.
[CODEX] +- **Artifacts**: Use `test.info().attach` to capture domain-specific logs. Screenshots happen automatically on failure, but explicit captures help with mid-test diagnostics.
[CODEX] +
[CODEX] +Example skeleton:
[CODEX] +
[CODEX] +```ts
[CODEX] +import {test, expect} from "@playwright/test";
[CODEX] +import {authenticate} from "../helpers/authentication";
[CODEX] +import {DashboardPage} from "../page-objects/dashboard-page";
[CODEX] +
[CODEX] +test.describe("Dashboard", () => {
[CODEX] +  test.beforeEach(async ({page}) => {
[CODEX] +    await authenticate(page);
[CODEX] +  });
[CODEX] +
[CODEX] +  test("shows the active workspace summary @smoke", async ({page}) => {
[CODEX] +    const dashboard = new DashboardPage(page);
[CODEX] +    await dashboard.goto();
[CODEX] +    await expect(dashboard.header).toContainText("Workspace Overview");
[CODEX] +  });
[CODEX] +});
[CODEX] +```
[CODEX] +
[CODEX] +## Debugging & Diagnostics
[CODEX] +
[CODEX] +- **Trace Viewer**: Re-run failing tests with `npx playwright test --trace on-first-retry` to collect DOM snapshots, network logs, and console output.
[CODEX] +- **Video & screenshots**: Enable via `use: { video: "retain-on-failure", screenshot: "only-on-failure" }` either per test or globally in `playwright.config.ts`.
[CODEX] +- **Console logging**: Place strategic `console.log` statements in specs or helpers when investigating flaky behavior. Remove them once resolved to keep logs clean.
[CODEX] +- **Network mocking**: Stub GraphQL or REST endpoints with `page.route` for deterministic results when backend data is unavailable. Maintain mocks under `playwright/helpers/network`.
[CODEX] +
[CODEX] +When a test flakes, capture the trace, verify selectors still match the rendered UI, and ensure required feature flags are enabled for the environment.
[CODEX] +
[CODEX] +## Continuous Integration
[CODEX] +
[CODEX] +- CI pipelines call `npx playwright test` with the same configuration. Ensure new specs respect the single-worker execution configuration (`workers: 1`) unless you explicitly parallelize them.
[CODEX] +- Store credentials (username, password, URL) in the CI secret store. The setup project fails fast if they are missing.
[CODEX] +- Upload `test-results/` (HTML reporter output) as an artifact for post-run inspection.
[CODEX] +
[CODEX] +Before merging, run the suite locally or in a dry-run environment to catch environment-specific regressions early.
[CODEX] +
[CODEX] +## Reference Material
[CODEX] +
[CODEX] +- [Playwright Configuration](../playwright.config.ts)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +- [Testing Guide (unit + integration)](./TEST-README.md)
[CODEX] +- [Implementation Guide](./implementation-guide.md)
[CODEX] +- [Official Playwright Docs](https://playwright.dev/docs/intro)
[CODEX] +
[CODEX] +Keep this guide up to date whenever the test harness, authentication strategy, or project layout changes. New contributors should be able to set up Playwright using only this document.
[CODEX] diff --git a/playwright/README.md b/playwright/README.md
[CODEX] index 58090e78cd0aba7e78a7bd8ce3bf7b7a692ea8ca..02e1939682ff48977eb982bba77319f5e528768a
[CODEX] --- a/playwright/README.md
[CODEX] +++ b/playwright/README.md
[CODEX] @@ -1,5 +1,7 @@
[CODEX] # Vurvey Web Manager Testing Guide
[CODEX] +> **Prefer the canonical [Playwright Testing Guide](../docs/playwright-testing-guide.md)** for the most up-to-date instructions on setup, authoring, and debugging. This file keeps a condensed summary for quick reference.
[CODEX] +
[CODEX] This document provides comprehensive guidance for testing the Vurvey Web Manager application.
[CODEX] ## Overview
[CODEX] diff --git a/src/shared/__tests__/documentation-links.test.ts b/src/shared/__tests__/documentation-links.test.ts
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..1ce31fda3210502d79e91629a1078b02c220b94a
[CODEX] --- /dev/null
[CODEX] +++ b/src/shared/__tests__/documentation-links.test.ts
[CODEX] @@ -0,0 +1,26 @@
[CODEX] +import {readFileSync} from "node:fs";
[CODEX] +import {resolve} from "node:path";
[CODEX] +
[CODEX] +import {describe, expect, it} from "vitest";
[CODEX] +
[CODEX] +const readDoc = (relativePath: string): string => {
[CODEX] +	const filePath = resolve(__dirname, relativePath);
[CODEX] +
[CODEX] +	return readFileSync(filePath, "utf8");
[CODEX] +};
[CODEX] +
[CODEX] +describe("Project documentation", () => {
[CODEX] +	it("keeps the documentation hub index up to date", () => {
[CODEX] +		const documentation = readDoc("../../../DOCUMENTATION.md");
[CODEX] +
[CODEX] +		expect(documentation).toContain("[Implementation Guide](docs/implementation-guide.md)");
[CODEX] +		expect(documentation).toContain("[Playwright Testing Guide](docs/playwright-testing-guide.md)");
[CODEX] +	});
[CODEX] +
[CODEX] +	it("mirrors the new guides inside docs/README", () => {
[CODEX] +		const docsReadme = readDoc("../../../docs/README.md");
[CODEX] +
[CODEX] +		expect(docsReadme).toContain("./implementation-guide.md");
[CODEX] +		expect(docsReadme).toContain("./playwright-testing-guide.md");
[CODEX] +	});
[CODEX] +});
[CLAUDE]   ğŸ”§ Read
[CLAUDE]   ğŸ”§ Bash: List fragment files
[CODEX] thinking
[CODEX] **Preparing to stage new test files**
[CODEX] exec
[CODEX] bash -lc 'git add README.md docs/README.md playwright/README.md DOCUMENTATION.md docs/implementation-guide.md docs/playwright-testing-guide.md src/shared/__tests__/documentation-links.test.ts' in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 60ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] file update:
[CODEX] diff --git a/DOCUMENTATION.md b/DOCUMENTATION.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e08ed0b3ff8c2fbb63dc3ee675405d59841b6a10
[CODEX] --- /dev/null
[CODEX] +++ b/DOCUMENTATION.md
[CODEX] @@ -0,0 +1,81 @@
[CODEX] +# Vurvey Web Manager Documentation Hub
[CODEX] +
[CODEX] +This hub ties together the architecture, development workflows, and testing resources for the Vurvey Web Manager. Start here for a narrated overview, then dive into the linked guides for deeper detail.
[CODEX] +
[CODEX] +- [Quick Start](#quick-start)
[CODEX] +- [Architecture at a Glance](#architecture-at-a-glance)
[CODEX] +- [Implementation Deep Dive](#implementation-deep-dive)
[CODEX] +- [Testing & Quality Assurance](#testing--quality-assurance)
[CODEX] +- [Operational Playbooks](#operational-playbooks)
[CODEX] +- [Documentation Index](#documentation-index)
[CODEX] +
[CODEX] +## Quick Start
[CODEX] +
[CODEX] +| Task | Command / Resource |
[CODEX] +| --- | --- |
[CODEX] +| Install dependencies | `npm ci` |
[CODEX] +| Run the dev server | `npm start` (defaults to `http://localhost:5050`) |
[CODEX] +| Type-check | `npm run type-check` |
[CODEX] +| Validate GraphQL documents | `npm run validate:graphql` |
[CODEX] +| Run unit/integration tests | `npm run test:unit` |
[CODEX] +| Run Playwright E2E tests | `npm run test:e2e` |
[CODEX] +| Lint source + tests | `npm run lint` |
[CODEX] +
[CODEX] +Environment variables (Firebase, GraphQL endpoint, feature flags) are defined in `.env`. See `docs/README.md#environment-variables` for the full list.
[CODEX] +
[CODEX] +## Architecture at a Glance
[CODEX] +
[CODEX] +- React 18 + TypeScript rendered through Vite.
[CODEX] +- Routing handled via `react-router-dom` with workspace-aware helpers.
[CODEX] +- GraphQL powered by Apollo Client (HTTP + WebSocket links) and LaunchDarkly/OpenFeature feature flag providers.
[CODEX] +- State spans React Contexts, Apollo cache, and reducer-driven component state.
[CODEX] +- Styling leverages SCSS modules and a shared component library under `src/shared`.
[CODEX] +
[CODEX] +Review the [Implementation Guide](docs/implementation-guide.md) for a walkthrough of providers, feature modules, and architectural conventions.
[CODEX] +
[CODEX] +## Implementation Deep Dive
[CODEX] +
[CODEX] +| Topic | Summary |
[CODEX] +| --- | --- |
[CODEX] +| [Implementation Guide](docs/implementation-guide.md) | Entry points, provider stack, routing, feature ownership, build tooling. |
[CODEX] +| [Project Structure](docs/project-structure.md) | Directory breakdown and best practices for adding new files. |
[CODEX] +| [State Management](docs/state-management.md) | Contexts, reducers, and caching strategies. |
[CODEX] +| [GraphQL Integration](docs/graphql-integration.md) | Query organization, code generation, and cache policies. |
[CODEX] +| [Custom Hooks](docs/custom-hooks.md) | Reusable hooks available across features. |
[CODEX] +| [Workflow Builder Guide](docs/workflow-builder-guide.md) | Deep dive into the workflow module architecture. |
[CODEX] +
[CODEX] +When implementing new features, align with the patterns documented in these guides and update them if responsibilities shift.
[CODEX] +
[CODEX] +## Testing & Quality Assurance
[CODEX] +
[CODEX] +- [Playwright Testing Guide](docs/playwright-testing-guide.md) â€“ Environment setup, authentication strategy, authoring conventions, and debugging tips.
[CODEX] +- [E2E Testing Patterns](docs/e2e-testing-patterns.md) â€“ Hard-won lessons for resilient selectors and flows.
[CODEX] +- [Testing Guide](docs/TEST-README.md) â€“ Vitest commands, coverage expectations, and mocking strategies.
[CODEX] +- Unit tests live beside implementation files. E2E specs live under `playwright/tests/`. Follow the documented fixtures/page-object approach for consistency.
[CODEX] +
[CODEX] +## Operational Playbooks
[CODEX] +
[CODEX] +- [Authentication](docs/authentication.md) â€“ Firebase sign-in flows and session persistence.
[CODEX] +- [Core Features](docs/core-features.md) â€“ Feature overviews for stakeholders and QA.
[CODEX] +- [Routes](docs/routes.md) â€“ Navigation map with workspace/context rules.
[CODEX] +- [Smooth Streaming](docs/smooth-streaming.md) & [Chat Streaming](docs/chat-streaming.md) â€“ Real-time infrastructure details.
[CODEX] +- [Test Resilience Strategy](docs/test-resilience-strategy.md) â€“ Stabilization techniques for automated suites.
[CODEX] +
[CODEX] +These playbooks help new engineers and QA members ramp up quickly on specific domains.
[CODEX] +
[CODEX] +## Documentation Index
[CODEX] +
[CODEX] +All documentation lives under the `docs/` directory:
[CODEX] +
[CODEX] +- [docs/README.md](docs/README.md) â€“ Entry point with setup instructions.
[CODEX] +- [docs/components.md](docs/components.md) â€“ Shared component catalogue.
[CODEX] +- [docs/routes.md](docs/routes.md) â€“ Application routing map.
[CODEX] +- [docs/core-features.md](docs/core-features.md) â€“ High-level feature descriptions.
[CODEX] +- [docs/workflow-builder-guide.md](docs/workflow-builder-guide.md) â€“ Workflow builder architecture.
[CODEX] +- [docs/playwright-testing-guide.md](docs/playwright-testing-guide.md) â€“ Comprehensive Playwright usage.
[CODEX] +- [docs/implementation-guide.md](docs/implementation-guide.md) â€“ Frontend implementation detail.
[CODEX] +- [docs/authentication.md](docs/authentication.md) â€“ Auth flows and state storage.
[CODEX] +- [docs/e2e-testing-patterns.md](docs/e2e-testing-patterns.md) â€“ Resilient test strategies.
[CODEX] +- [docs/TEST-README.md](docs/TEST-README.md) â€“ Unit and integration testing commands.
[CODEX] +
[CODEX] +Keep this hub updated as we introduce new docs or migrate content. If a guide becomes outdated, link directly to its successor or fold it into a more relevant document.
[CODEX] diff --git a/README.md b/README.md
[CODEX] index fecb22bce7791f926108dab947b93e75eaa022c7..09e58074104c565a3b4c29c33b94cf57fba373aa
[CODEX] --- a/README.md
[CODEX] +++ b/README.md
[CODEX] @@ -239,8 +239,8 @@
[CODEX] Vurvey Web Manager is the frontend component of the Vurvey platform. It works in conjunction with the Vurvey API backend to provide a complete solution for video-based consumer feedback.
[CODEX] -[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] -[Link to Comprehensive Documentation](../DOCUMENTATION.md)
[CODEX] +[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] +[Documentation Hub](./DOCUMENTATION.md)
[CODEX] ## Setup
[CODEX] diff --git a/docs/README.md b/docs/README.md
[CODEX] index 174c521a012dbbb5ef957dfc29360c9b697c7b6e..5a56517cd1e90833bbcb9dad65d7cb3d620b14c8
[CODEX] --- a/docs/README.md
[CODEX] +++ b/docs/README.md
[CODEX] @@ -19,11 +19,13 @@
[CODEX] ### Getting Started
[CODEX] +- [Implementation Guide](./implementation-guide.md) - How the application is assembled end-to-end
[CODEX] - [Project Structure](./project-structure.md) - Codebase organization
[CODEX] - [Authentication](./authentication.md) - Auth system and user management
[CODEX] - [State Management](./state-management.md) - Context and data flow
[CODEX] - [Routes](./routes.md) - Routing structure and navigation
[CODEX] - [Components](./components.md) - Component library and patterns
[CODEX] +- [Playwright Testing Guide](./playwright-testing-guide.md) - Full Playwright setup and authoring guide
[CODEX] ### Features
[CODEX] @@ -147,6 +149,7 @@
[CODEX] ```
[CODEX] LOGIN_USERNAME="your_test_email"
[CODEX] LOGIN_PASSWORD="your_test_password"
[CODEX] +URL="http://localhost:5050"
[CODEX] ```
[CODEX] ## Best Practices
[CODEX] @@ -181,3 +184,4 @@
[CODEX] - [Playwright Documentation](https://playwright.dev)
[CODEX] - [Apollo Client Documentation](https://www.apollographql.com/docs/react)
[CODEX] - [React Documentation](https://react.dev)
[CODEX] +- [Documentation Hub](../DOCUMENTATION.md) for an index of project guides
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] diff --git a/docs/playwright-testing-guide.md b/docs/playwright-testing-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..acbab280a49d446cc89ce7ea1e6de422380736ca
[CODEX] --- /dev/null
[CODEX] +++ b/docs/playwright-testing-guide.md
[CODEX] @@ -0,0 +1,161 @@
[CODEX] +# Playwright Testing Guide
[CODEX] +
[CODEX] +This guide explains how to configure, run, and extend the Playwright end-to-end test suite for Vurvey Web Manager.
[CODEX] +
[CODEX] +- [Overview](#overview)
[CODEX] +- [Directory Layout](#directory-layout)
[CODEX] +- [Environment Setup](#environment-setup)
[CODEX] +- [Running Tests](#running-tests)
[CODEX] +- [Authentication Workflow](#authentication-workflow)
[CODEX] +- [Writing & Organizing Tests](#writing--organizing-tests)
[CODEX] +- [Debugging & Diagnostics](#debugging--diagnostics)
[CODEX] +- [Continuous Integration](#continuous-integration)
[CODEX] +- [Reference Material](#reference-material)
[CODEX] +
[CODEX] +## Overview
[CODEX] +
[CODEX] +Playwright exercises the full React application in a Chromium browser using the configuration defined in `playwright.config.ts`. Tests rely on Firebase authentication, Apollo GraphQL, and feature flags, so a stable backend environment and test credentials are required.
[CODEX] +
[CODEX] +Key characteristics:
[CODEX] +
[CODEX] +- Tests live in `playwright/tests/*.spec.ts`.
[CODEX] +- A dedicated `setup` project seeds authentication (`auth.setup.ts`) and persists storage state to `playwright/.auth/user.json`.
[CODEX] +- Default executions run headless Chromium with `slowMo: 50` to reduce flakiness; override these options when debugging.
[CODEX] +
[CODEX] +## Directory Layout
[CODEX] +
[CODEX] +```
[CODEX] +playwright/
[CODEX] +â”œâ”€â”€ fixtures/                 # Test data assets (clips, csv, pdf, images)
[CODEX] +â”œâ”€â”€ helpers/                  # Utility helpers (authentication, navigation)
[CODEX] +â”œâ”€â”€ page-objects/             # Page object abstractions for complex flows
[CODEX] +â”œâ”€â”€ tests/                    # Spec files + global setup (auth.setup.ts)
[CODEX] +â”œâ”€â”€ env.d.ts                  # Type declarations for Playwright globals
[CODEX] +â””â”€â”€ README.md                 # High-level summary (links back to this guide)
[CODEX] +```
[CODEX] +
[CODEX] +Keep common logic in helpers or page objects instead of duplicating it inside specs. Fixtures should hold deterministic assets that can be reused across scenarios.
[CODEX] +
[CODEX] +## Environment Setup
[CODEX] +
[CODEX] +1. **Install dependencies**
[CODEX] +
[CODEX] +   ```bash
[CODEX] +   npm ci
[CODEX] +   npx playwright install
[CODEX] +   ```
[CODEX] +
[CODEX] +2. **Configure environment variables**
[CODEX] +
[CODEX] +   - Create `./playwright/.env` with the fields referenced in tests:
[CODEX] +
[CODEX] +     ```ini
[CODEX] +     URL=http://localhost:5050
[CODEX] +     LOGIN_USERNAME=tester@example.com
[CODEX] +     LOGIN_PASSWORD=super-secret
[CODEX] +     ```
[CODEX] +
[CODEX] +   - Variables defined in the repository root `.env` are also loaded. `URL` must match the origin where the web manager is running.
[CODEX] +
[CODEX] +3. **Launch the application backend**
[CODEX] +
[CODEX] +   - Ensure the Vurvey API and any dependent services are running; Playwright interacts with the live stack.
[CODEX] +   - Start the web manager locally with `npm start` or point `URL` at a staging environment.
[CODEX] +
[CODEX] +4. **Seed authentication state**
[CODEX] +
[CODEX] +   - The first test run invokes `auth.setup.ts`, which stores Firebase credentials in IndexedDB and writes a Playwright storage file (`playwright/.auth/user.json`).
[CODEX] +   - This file is reused by dependent projects so subsequent tests start in an authenticated session.
[CODEX] +
[CODEX] +## Running Tests
[CODEX] +
[CODEX] +Common commands:
[CODEX] +
[CODEX] +```bash
[CODEX] +# Run the full E2E suite
[CODEX] +npx playwright test
[CODEX] +
[CODEX] +# Run a specific spec
[CODEX] +npx playwright test playwright/tests/navigation.spec.ts
[CODEX] +
[CODEX] +# Filter by title
[CODEX] +npx playwright test --grep "@smoke"
[CODEX] +
[CODEX] +# Headed (visible) mode
[CODEX] +npx playwright test --headed
[CODEX] +
[CODEX] +# Debug mode with inspector
[CODEX] +npx playwright test --debug
[CODEX] +
[CODEX] +# Use the Playwright UI
[CODEX] +npx playwright test --ui
[CODEX] +```
[CODEX] +
[CODEX] +Project configuration (browser, base URL, reporters) lives in `playwright.config.ts`. Edit that file to add new projects (e.g., Firefox coverage) or alternative reporters.
[CODEX] +
[CODEX] +## Authentication Workflow
[CODEX] +
[CODEX] +Authentication uses Firebase persistence inside IndexedDB:
[CODEX] +
[CODEX] +1. `auth.setup.ts` logs in through the UI using `LOGIN_USERNAME` and `LOGIN_PASSWORD`.
[CODEX] +2. The helper `saveFirebaseAuthData` captures Firebase data from IndexedDB and writes it to `localStorage`.
[CODEX] +3. The storage state is exported to `playwright/.auth/user.json`.
[CODEX] +4. Individual specs call `restoreFirebaseAuthData` via helper utilities before navigating, ensuring a valid session without re-running the login flow.
[CODEX] +
[CODEX] +If you see `No auth data found in localStorage`, run the setup project again (`npx playwright test --project setup`). When credentials rotate, delete `playwright/.auth/user.json` and re-run the suite.
[CODEX] +
[CODEX] +## Writing & Organizing Tests
[CODEX] +
[CODEX] +- **Use fixtures**: Import reusable flows (e.g., `authenticate`) from `playwright/helpers`. Define domain-specific fixtures when a scenario needs shared setup and teardown.
[CODEX] +- **Prefer page objects**: Complex interactions such as the workflow builder or agent editor should be encapsulated in `playwright/page-objects` classes. Create methods that describe user intent (`workflowBuilder.publishFlow()`), not DOM mechanics.
[CODEX] +- **Selectors**: Lean on accessible selectors (`getByRole`, `getByLabel`, `getByTestId`). Fall back to data attributes when elements lack semantic handles. Avoid brittle CSS selectors.
[CODEX] +- **Organization**: Group related specs in `test.describe`. Tag critical smoke tests with `@smoke` for quick feedback loops.
[CODEX] +- **Time-sensitive flows**: Use `await expect(...).toBeVisible({ timeout: 30_000 })` for network-heavy screens. The global `expect` timeout already defaults to 30 seconds; override locally when necessary.
[CODEX] +- **Artifacts**: Use `test.info().attach` to capture domain-specific logs. Screenshots happen automatically on failure, but explicit captures help with mid-test diagnostics.
[CODEX] +
[CODEX] +Example skeleton:
[CODEX] +
[CODEX] +```ts
[CODEX] +import {test, expect} from "@playwright/test";
[CODEX] +import {authenticate} from "../helpers/authentication";
[CODEX] +import {DashboardPage} from "../page-objects/dashboard-page";
[CODEX] +
[CODEX] +test.describe("Dashboard", () => {
[CODEX] +  test.beforeEach(async ({page}) => {
[CODEX] +    await authenticate(page);
[CODEX] +  });
[CODEX] +
[CODEX] +  test("shows the active workspace summary @smoke", async ({page}) => {
[CODEX] +    const dashboard = new DashboardPage(page);
[CODEX] +    await dashboard.goto();
[CODEX] +    await expect(dashboard.header).toContainText("Workspace Overview");
[CODEX] +  });
[CODEX] +});
[CODEX] +```
[CODEX] +
[CODEX] +## Debugging & Diagnostics
[CODEX] +
[CODEX] +- **Trace Viewer**: Re-run failing tests with `npx playwright test --trace on-first-retry` to collect DOM snapshots, network logs, and console output.
[CODEX] +- **Video & screenshots**: Enable via `use: { video: "retain-on-failure", screenshot: "only-on-failure" }` either per test or globally in `playwright.config.ts`.
[CODEX] +- **Console logging**: Place strategic `console.log` statements in specs or helpers when investigating flaky behavior. Remove them once resolved to keep logs clean.
[CODEX] +- **Network mocking**: Stub GraphQL or REST endpoints with `page.route` for deterministic results when backend data is unavailable. Maintain mocks under `playwright/helpers/network`.
[CODEX] +
[CODEX] +When a test flakes, capture the trace, verify selectors still match the rendered UI, and ensure required feature flags are enabled for the environment.
[CODEX] +
[CODEX] +## Continuous Integration
[CODEX] +
[CODEX] +- CI pipelines call `npx playwright test` with the same configuration. Ensure new specs respect the single-worker execution configuration (`workers: 1`) unless you explicitly parallelize them.
[CODEX] +- Store credentials (username, password, URL) in the CI secret store. The setup project fails fast if they are missing.
[CODEX] +- Upload `test-results/` (HTML reporter output) as an artifact for post-run inspection.
[CODEX] +
[CODEX] +Before merging, run the suite locally or in a dry-run environment to catch environment-specific regressions early.
[CODEX] +
[CODEX] +## Reference Material
[CODEX] +
[CODEX] +- [Playwright Configuration](../playwright.config.ts)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +- [Testing Guide (unit + integration)](./TEST-README.md)
[CODEX] +- [Implementation Guide](./implementation-guide.md)
[CODEX] +- [Official Playwright Docs](https://playwright.dev/docs/intro)
[CODEX] +
[CODEX] +Keep this guide up to date whenever the test harness, authentication strategy, or project layout changes. New contributors should be able to set up Playwright using only this document.
[CODEX] diff --git a/playwright/README.md b/playwright/README.md
[CODEX] index 58090e78cd0aba7e78a7bd8ce3bf7b7a692ea8ca..02e1939682ff48977eb982bba77319f5e528768a
[CODEX] --- a/playwright/README.md
[CODEX] +++ b/playwright/README.md
[CODEX] @@ -1,5 +1,7 @@
[CODEX] # Vurvey Web Manager Testing Guide
[CODEX] +> **Prefer the canonical [Playwright Testing Guide](../docs/playwright-testing-guide.md)** for the most up-to-date instructions on setup, authoring, and debugging. This file keeps a condensed summary for quick reference.
[CODEX] +
[CODEX] This document provides comprehensive guidance for testing the Vurvey Web Manager application.
[CODEX] ## Overview
[CODEX] diff --git a/src/shared/__tests__/documentation-links.test.ts b/src/shared/__tests__/documentation-links.test.ts
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..1ce31fda3210502d79e91629a1078b02c220b94a
[CODEX] --- /dev/null
[CODEX] +++ b/src/shared/__tests__/documentation-links.test.ts
[CODEX] @@ -0,0 +1,26 @@
[CODEX] +import {readFileSync} from "node:fs";
[CODEX] +import {resolve} from "node:path";
[CODEX] +
[CODEX] +import {describe, expect, it} from "vitest";
[CODEX] +
[CODEX] +const readDoc = (relativePath: string): string => {
[CODEX] +	const filePath = resolve(__dirname, relativePath);
[CODEX] +
[CODEX] +	return readFileSync(filePath, "utf8");
[CODEX] +};
[CODEX] +
[CODEX] +describe("Project documentation", () => {
[CODEX] +	it("keeps the documentation hub index up to date", () => {
[CODEX] +		const documentation = readDoc("../../../DOCUMENTATION.md");
[CODEX] +
[CODEX] +		expect(documentation).toContain("[Implementation Guide](docs/implementation-guide.md)");
[CODEX] +		expect(documentation).toContain("[Playwright Testing Guide](docs/playwright-testing-guide.md)");
[CODEX] +	});
[CODEX] +
[CODEX] +	it("mirrors the new guides inside docs/README", () => {
[CODEX] +		const docsReadme = readDoc("../../../docs/README.md");
[CODEX] +
[CODEX] +		expect(docsReadme).toContain("./implementation-guide.md");
[CODEX] +		expect(docsReadme).toContain("./playwright-testing-guide.md");
[CODEX] +	});
[CODEX] +});
[CLAUDE]   ğŸ”§ Read
[CODEX] thinking
[CODEX] **Preparing commit message**
[CODEX] exec
[CODEX] bash -lc 'git status -sb' in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 80ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] ## agents/codex/20251104-155449-6a42f6
[CODEX] A  DOCUMENTATION.md
[CODEX] M  README.md
[CODEX] M  docs/README.md
[CODEX] A  docs/implementation-guide.md
[CODEX] A  docs/playwright-testing-guide.md
[CODEX] M  playwright/README.md
[CODEX] A  src/shared/__tests__/documentation-links.test.ts
[CODEX] ?? .logs/
[CODEX] file update:
[CODEX] diff --git a/DOCUMENTATION.md b/DOCUMENTATION.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e08ed0b3ff8c2fbb63dc3ee675405d59841b6a10
[CODEX] --- /dev/null
[CODEX] +++ b/DOCUMENTATION.md
[CODEX] @@ -0,0 +1,81 @@
[CODEX] +# Vurvey Web Manager Documentation Hub
[CODEX] +
[CODEX] +This hub ties together the architecture, development workflows, and testing resources for the Vurvey Web Manager. Start here for a narrated overview, then dive into the linked guides for deeper detail.
[CODEX] +
[CODEX] +- [Quick Start](#quick-start)
[CODEX] +- [Architecture at a Glance](#architecture-at-a-glance)
[CODEX] +- [Implementation Deep Dive](#implementation-deep-dive)
[CODEX] +- [Testing & Quality Assurance](#testing--quality-assurance)
[CODEX] +- [Operational Playbooks](#operational-playbooks)
[CODEX] +- [Documentation Index](#documentation-index)
[CODEX] +
[CODEX] +## Quick Start
[CODEX] +
[CODEX] +| Task | Command / Resource |
[CODEX] +| --- | --- |
[CODEX] +| Install dependencies | `npm ci` |
[CODEX] +| Run the dev server | `npm start` (defaults to `http://localhost:5050`) |
[CODEX] +| Type-check | `npm run type-check` |
[CODEX] +| Validate GraphQL documents | `npm run validate:graphql` |
[CODEX] +| Run unit/integration tests | `npm run test:unit` |
[CODEX] +| Run Playwright E2E tests | `npm run test:e2e` |
[CODEX] +| Lint source + tests | `npm run lint` |
[CODEX] +
[CODEX] +Environment variables (Firebase, GraphQL endpoint, feature flags) are defined in `.env`. See `docs/README.md#environment-variables` for the full list.
[CODEX] +
[CODEX] +## Architecture at a Glance
[CODEX] +
[CODEX] +- React 18 + TypeScript rendered through Vite.
[CODEX] +- Routing handled via `react-router-dom` with workspace-aware helpers.
[CODEX] +- GraphQL powered by Apollo Client (HTTP + WebSocket links) and LaunchDarkly/OpenFeature feature flag providers.
[CODEX] +- State spans React Contexts, Apollo cache, and reducer-driven component state.
[CODEX] +- Styling leverages SCSS modules and a shared component library under `src/shared`.
[CODEX] +
[CODEX] +Review the [Implementation Guide](docs/implementation-guide.md) for a walkthrough of providers, feature modules, and architectural conventions.
[CODEX] +
[CODEX] +## Implementation Deep Dive
[CODEX] +
[CODEX] +| Topic | Summary |
[CODEX] +| --- | --- |
[CODEX] +| [Implementation Guide](docs/implementation-guide.md) | Entry points, provider stack, routing, feature ownership, build tooling. |
[CODEX] +| [Project Structure](docs/project-structure.md) | Directory breakdown and best practices for adding new files. |
[CODEX] +| [State Management](docs/state-management.md) | Contexts, reducers, and caching strategies. |
[CODEX] +| [GraphQL Integration](docs/graphql-integration.md) | Query organization, code generation, and cache policies. |
[CODEX] +| [Custom Hooks](docs/custom-hooks.md) | Reusable hooks available across features. |
[CODEX] +| [Workflow Builder Guide](docs/workflow-builder-guide.md) | Deep dive into the workflow module architecture. |
[CODEX] +
[CODEX] +When implementing new features, align with the patterns documented in these guides and update them if responsibilities shift.
[CODEX] +
[CODEX] +## Testing & Quality Assurance
[CODEX] +
[CODEX] +- [Playwright Testing Guide](docs/playwright-testing-guide.md) â€“ Environment setup, authentication strategy, authoring conventions, and debugging tips.
[CODEX] +- [E2E Testing Patterns](docs/e2e-testing-patterns.md) â€“ Hard-won lessons for resilient selectors and flows.
[CODEX] +- [Testing Guide](docs/TEST-README.md) â€“ Vitest commands, coverage expectations, and mocking strategies.
[CODEX] +- Unit tests live beside implementation files. E2E specs live under `playwright/tests/`. Follow the documented fixtures/page-object approach for consistency.
[CODEX] +
[CODEX] +## Operational Playbooks
[CODEX] +
[CODEX] +- [Authentication](docs/authentication.md) â€“ Firebase sign-in flows and session persistence.
[CODEX] +- [Core Features](docs/core-features.md) â€“ Feature overviews for stakeholders and QA.
[CODEX] +- [Routes](docs/routes.md) â€“ Navigation map with workspace/context rules.
[CODEX] +- [Smooth Streaming](docs/smooth-streaming.md) & [Chat Streaming](docs/chat-streaming.md) â€“ Real-time infrastructure details.
[CODEX] +- [Test Resilience Strategy](docs/test-resilience-strategy.md) â€“ Stabilization techniques for automated suites.
[CODEX] +
[CODEX] +These playbooks help new engineers and QA members ramp up quickly on specific domains.
[CODEX] +
[CODEX] +## Documentation Index
[CODEX] +
[CODEX] +All documentation lives under the `docs/` directory:
[CODEX] +
[CODEX] +- [docs/README.md](docs/README.md) â€“ Entry point with setup instructions.
[CODEX] +- [docs/components.md](docs/components.md) â€“ Shared component catalogue.
[CODEX] +- [docs/routes.md](docs/routes.md) â€“ Application routing map.
[CODEX] +- [docs/core-features.md](docs/core-features.md) â€“ High-level feature descriptions.
[CODEX] +- [docs/workflow-builder-guide.md](docs/workflow-builder-guide.md) â€“ Workflow builder architecture.
[CODEX] +- [docs/playwright-testing-guide.md](docs/playwright-testing-guide.md) â€“ Comprehensive Playwright usage.
[CODEX] +- [docs/implementation-guide.md](docs/implementation-guide.md) â€“ Frontend implementation detail.
[CODEX] +- [docs/authentication.md](docs/authentication.md) â€“ Auth flows and state storage.
[CODEX] +- [docs/e2e-testing-patterns.md](docs/e2e-testing-patterns.md) â€“ Resilient test strategies.
[CODEX] +- [docs/TEST-README.md](docs/TEST-README.md) â€“ Unit and integration testing commands.
[CODEX] +
[CODEX] +Keep this hub updated as we introduce new docs or migrate content. If a guide becomes outdated, link directly to its successor or fold it into a more relevant document.
[CODEX] diff --git a/README.md b/README.md
[CODEX] index fecb22bce7791f926108dab947b93e75eaa022c7..09e58074104c565a3b4c29c33b94cf57fba373aa
[CODEX] --- a/README.md
[CODEX] +++ b/README.md
[CODEX] @@ -239,8 +239,8 @@
[CODEX] Vurvey Web Manager is the frontend component of the Vurvey platform. It works in conjunction with the Vurvey API backend to provide a complete solution for video-based consumer feedback.
[CODEX] -[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] -[Link to Comprehensive Documentation](../DOCUMENTATION.md)
[CODEX] +[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] +[Documentation Hub](./DOCUMENTATION.md)
[CODEX] ## Setup
[CODEX] diff --git a/docs/README.md b/docs/README.md
[CODEX] index 174c521a012dbbb5ef957dfc29360c9b697c7b6e..5a56517cd1e90833bbcb9dad65d7cb3d620b14c8
[CODEX] --- a/docs/README.md
[CODEX] +++ b/docs/README.md
[CODEX] @@ -19,11 +19,13 @@
[CODEX] ### Getting Started
[CODEX] +- [Implementation Guide](./implementation-guide.md) - How the application is assembled end-to-end
[CODEX] - [Project Structure](./project-structure.md) - Codebase organization
[CODEX] - [Authentication](./authentication.md) - Auth system and user management
[CODEX] - [State Management](./state-management.md) - Context and data flow
[CODEX] - [Routes](./routes.md) - Routing structure and navigation
[CODEX] - [Components](./components.md) - Component library and patterns
[CODEX] +- [Playwright Testing Guide](./playwright-testing-guide.md) - Full Playwright setup and authoring guide
[CODEX] ### Features
[CODEX] @@ -147,6 +149,7 @@
[CODEX] ```
[CODEX] LOGIN_USERNAME="your_test_email"
[CODEX] LOGIN_PASSWORD="your_test_password"
[CODEX] +URL="http://localhost:5050"
[CODEX] ```
[CODEX] ## Best Practices
[CODEX] @@ -181,3 +184,4 @@
[CODEX] - [Playwright Documentation](https://playwright.dev)
[CODEX] - [Apollo Client Documentation](https://www.apollographql.com/docs/react)
[CODEX] - [React Documentation](https://react.dev)
[CODEX] +- [Documentation Hub](../DOCUMENTATION.md) for an index of project guides
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] diff --git a/docs/playwright-testing-guide.md b/docs/playwright-testing-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..acbab280a49d446cc89ce7ea1e6de422380736ca
[CODEX] --- /dev/null
[CODEX] +++ b/docs/playwright-testing-guide.md
[CODEX] @@ -0,0 +1,161 @@
[CODEX] +# Playwright Testing Guide
[CODEX] +
[CODEX] +This guide explains how to configure, run, and extend the Playwright end-to-end test suite for Vurvey Web Manager.
[CODEX] +
[CODEX] +- [Overview](#overview)
[CODEX] +- [Directory Layout](#directory-layout)
[CODEX] +- [Environment Setup](#environment-setup)
[CODEX] +- [Running Tests](#running-tests)
[CODEX] +- [Authentication Workflow](#authentication-workflow)
[CODEX] +- [Writing & Organizing Tests](#writing--organizing-tests)
[CODEX] +- [Debugging & Diagnostics](#debugging--diagnostics)
[CODEX] +- [Continuous Integration](#continuous-integration)
[CODEX] +- [Reference Material](#reference-material)
[CODEX] +
[CODEX] +## Overview
[CODEX] +
[CODEX] +Playwright exercises the full React application in a Chromium browser using the configuration defined in `playwright.config.ts`. Tests rely on Firebase authentication, Apollo GraphQL, and feature flags, so a stable backend environment and test credentials are required.
[CODEX] +
[CODEX] +Key characteristics:
[CODEX] +
[CODEX] +- Tests live in `playwright/tests/*.spec.ts`.
[CODEX] +- A dedicated `setup` project seeds authentication (`auth.setup.ts`) and persists storage state to `playwright/.auth/user.json`.
[CODEX] +- Default executions run headless Chromium with `slowMo: 50` to reduce flakiness; override these options when debugging.
[CODEX] +
[CODEX] +## Directory Layout
[CODEX] +
[CODEX] +```
[CODEX] +playwright/
[CODEX] +â”œâ”€â”€ fixtures/                 # Test data assets (clips, csv, pdf, images)
[CODEX] +â”œâ”€â”€ helpers/                  # Utility helpers (authentication, navigation)
[CODEX] +â”œâ”€â”€ page-objects/             # Page object abstractions for complex flows
[CODEX] +â”œâ”€â”€ tests/                    # Spec files + global setup (auth.setup.ts)
[CODEX] +â”œâ”€â”€ env.d.ts                  # Type declarations for Playwright globals
[CODEX] +â””â”€â”€ README.md                 # High-level summary (links back to this guide)
[CODEX] +```
[CODEX] +
[CODEX] +Keep common logic in helpers or page objects instead of duplicating it inside specs. Fixtures should hold deterministic assets that can be reused across scenarios.
[CODEX] +
[CODEX] +## Environment Setup
[CODEX] +
[CODEX] +1. **Install dependencies**
[CODEX] +
[CODEX] +   ```bash
[CODEX] +   npm ci
[CODEX] +   npx playwright install
[CODEX] +   ```
[CODEX] +
[CODEX] +2. **Configure environment variables**
[CODEX] +
[CODEX] +   - Create `./playwright/.env` with the fields referenced in tests:
[CODEX] +
[CODEX] +     ```ini
[CODEX] +     URL=http://localhost:5050
[CODEX] +     LOGIN_USERNAME=tester@example.com
[CODEX] +     LOGIN_PASSWORD=super-secret
[CODEX] +     ```
[CODEX] +
[CODEX] +   - Variables defined in the repository root `.env` are also loaded. `URL` must match the origin where the web manager is running.
[CODEX] +
[CODEX] +3. **Launch the application backend**
[CODEX] +
[CODEX] +   - Ensure the Vurvey API and any dependent services are running; Playwright interacts with the live stack.
[CODEX] +   - Start the web manager locally with `npm start` or point `URL` at a staging environment.
[CODEX] +
[CODEX] +4. **Seed authentication state**
[CODEX] +
[CODEX] +   - The first test run invokes `auth.setup.ts`, which stores Firebase credentials in IndexedDB and writes a Playwright storage file (`playwright/.auth/user.json`).
[CODEX] +   - This file is reused by dependent projects so subsequent tests start in an authenticated session.
[CODEX] +
[CODEX] +## Running Tests
[CODEX] +
[CODEX] +Common commands:
[CODEX] +
[CODEX] +```bash
[CODEX] +# Run the full E2E suite
[CODEX] +npx playwright test
[CODEX] +
[CODEX] +# Run a specific spec
[CODEX] +npx playwright test playwright/tests/navigation.spec.ts
[CODEX] +
[CODEX] +# Filter by title
[CODEX] +npx playwright test --grep "@smoke"
[CODEX] +
[CODEX] +# Headed (visible) mode
[CODEX] +npx playwright test --headed
[CODEX] +
[CODEX] +# Debug mode with inspector
[CODEX] +npx playwright test --debug
[CODEX] +
[CODEX] +# Use the Playwright UI
[CODEX] +npx playwright test --ui
[CODEX] +```
[CODEX] +
[CODEX] +Project configuration (browser, base URL, reporters) lives in `playwright.config.ts`. Edit that file to add new projects (e.g., Firefox coverage) or alternative reporters.
[CODEX] +
[CODEX] +## Authentication Workflow
[CODEX] +
[CODEX] +Authentication uses Firebase persistence inside IndexedDB:
[CODEX] +
[CODEX] +1. `auth.setup.ts` logs in through the UI using `LOGIN_USERNAME` and `LOGIN_PASSWORD`.
[CODEX] +2. The helper `saveFirebaseAuthData` captures Firebase data from IndexedDB and writes it to `localStorage`.
[CODEX] +3. The storage state is exported to `playwright/.auth/user.json`.
[CODEX] +4. Individual specs call `restoreFirebaseAuthData` via helper utilities before navigating, ensuring a valid session without re-running the login flow.
[CODEX] +
[CODEX] +If you see `No auth data found in localStorage`, run the setup project again (`npx playwright test --project setup`). When credentials rotate, delete `playwright/.auth/user.json` and re-run the suite.
[CODEX] +
[CODEX] +## Writing & Organizing Tests
[CODEX] +
[CODEX] +- **Use fixtures**: Import reusable flows (e.g., `authenticate`) from `playwright/helpers`. Define domain-specific fixtures when a scenario needs shared setup and teardown.
[CODEX] +- **Prefer page objects**: Complex interactions such as the workflow builder or agent editor should be encapsulated in `playwright/page-objects` classes. Create methods that describe user intent (`workflowBuilder.publishFlow()`), not DOM mechanics.
[CODEX] +- **Selectors**: Lean on accessible selectors (`getByRole`, `getByLabel`, `getByTestId`). Fall back to data attributes when elements lack semantic handles. Avoid brittle CSS selectors.
[CODEX] +- **Organization**: Group related specs in `test.describe`. Tag critical smoke tests with `@smoke` for quick feedback loops.
[CODEX] +- **Time-sensitive flows**: Use `await expect(...).toBeVisible({ timeout: 30_000 })` for network-heavy screens. The global `expect` timeout already defaults to 30 seconds; override locally when necessary.
[CODEX] +- **Artifacts**: Use `test.info().attach` to capture domain-specific logs. Screenshots happen automatically on failure, but explicit captures help with mid-test diagnostics.
[CODEX] +
[CODEX] +Example skeleton:
[CODEX] +
[CODEX] +```ts
[CODEX] +import {test, expect} from "@playwright/test";
[CODEX] +import {authenticate} from "../helpers/authentication";
[CODEX] +import {DashboardPage} from "../page-objects/dashboard-page";
[CODEX] +
[CODEX] +test.describe("Dashboard", () => {
[CODEX] +  test.beforeEach(async ({page}) => {
[CODEX] +    await authenticate(page);
[CODEX] +  });
[CODEX] +
[CODEX] +  test("shows the active workspace summary @smoke", async ({page}) => {
[CODEX] +    const dashboard = new DashboardPage(page);
[CODEX] +    await dashboard.goto();
[CODEX] +    await expect(dashboard.header).toContainText("Workspace Overview");
[CODEX] +  });
[CODEX] +});
[CODEX] +```
[CODEX] +
[CODEX] +## Debugging & Diagnostics
[CODEX] +
[CODEX] +- **Trace Viewer**: Re-run failing tests with `npx playwright test --trace on-first-retry` to collect DOM snapshots, network logs, and console output.
[CODEX] +- **Video & screenshots**: Enable via `use: { video: "retain-on-failure", screenshot: "only-on-failure" }` either per test or globally in `playwright.config.ts`.
[CODEX] +- **Console logging**: Place strategic `console.log` statements in specs or helpers when investigating flaky behavior. Remove them once resolved to keep logs clean.
[CODEX] +- **Network mocking**: Stub GraphQL or REST endpoints with `page.route` for deterministic results when backend data is unavailable. Maintain mocks under `playwright/helpers/network`.
[CODEX] +
[CODEX] +When a test flakes, capture the trace, verify selectors still match the rendered UI, and ensure required feature flags are enabled for the environment.
[CODEX] +
[CODEX] +## Continuous Integration
[CODEX] +
[CODEX] +- CI pipelines call `npx playwright test` with the same configuration. Ensure new specs respect the single-worker execution configuration (`workers: 1`) unless you explicitly parallelize them.
[CODEX] +- Store credentials (username, password, URL) in the CI secret store. The setup project fails fast if they are missing.
[CODEX] +- Upload `test-results/` (HTML reporter output) as an artifact for post-run inspection.
[CODEX] +
[CODEX] +Before merging, run the suite locally or in a dry-run environment to catch environment-specific regressions early.
[CODEX] +
[CODEX] +## Reference Material
[CODEX] +
[CODEX] +- [Playwright Configuration](../playwright.config.ts)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +- [Testing Guide (unit + integration)](./TEST-README.md)
[CODEX] +- [Implementation Guide](./implementation-guide.md)
[CODEX] +- [Official Playwright Docs](https://playwright.dev/docs/intro)
[CODEX] +
[CODEX] +Keep this guide up to date whenever the test harness, authentication strategy, or project layout changes. New contributors should be able to set up Playwright using only this document.
[CODEX] diff --git a/playwright/README.md b/playwright/README.md
[CODEX] index 58090e78cd0aba7e78a7bd8ce3bf7b7a692ea8ca..02e1939682ff48977eb982bba77319f5e528768a
[CODEX] --- a/playwright/README.md
[CODEX] +++ b/playwright/README.md
[CODEX] @@ -1,5 +1,7 @@
[CODEX] # Vurvey Web Manager Testing Guide
[CODEX] +> **Prefer the canonical [Playwright Testing Guide](../docs/playwright-testing-guide.md)** for the most up-to-date instructions on setup, authoring, and debugging. This file keeps a condensed summary for quick reference.
[CODEX] +
[CODEX] This document provides comprehensive guidance for testing the Vurvey Web Manager application.
[CODEX] ## Overview
[CODEX] diff --git a/src/shared/__tests__/documentation-links.test.ts b/src/shared/__tests__/documentation-links.test.ts
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..1ce31fda3210502d79e91629a1078b02c220b94a
[CODEX] --- /dev/null
[CODEX] +++ b/src/shared/__tests__/documentation-links.test.ts
[CODEX] @@ -0,0 +1,26 @@
[CODEX] +import {readFileSync} from "node:fs";
[CODEX] +import {resolve} from "node:path";
[CODEX] +
[CODEX] +import {describe, expect, it} from "vitest";
[CODEX] +
[CODEX] +const readDoc = (relativePath: string): string => {
[CODEX] +	const filePath = resolve(__dirname, relativePath);
[CODEX] +
[CODEX] +	return readFileSync(filePath, "utf8");
[CODEX] +};
[CODEX] +
[CODEX] +describe("Project documentation", () => {
[CODEX] +	it("keeps the documentation hub index up to date", () => {
[CODEX] +		const documentation = readDoc("../../../DOCUMENTATION.md");
[CODEX] +
[CODEX] +		expect(documentation).toContain("[Implementation Guide](docs/implementation-guide.md)");
[CODEX] +		expect(documentation).toContain("[Playwright Testing Guide](docs/playwright-testing-guide.md)");
[CODEX] +	});
[CODEX] +
[CODEX] +	it("mirrors the new guides inside docs/README", () => {
[CODEX] +		const docsReadme = readDoc("../../../docs/README.md");
[CODEX] +
[CODEX] +		expect(docsReadme).toContain("./implementation-guide.md");
[CODEX] +		expect(docsReadme).toContain("./playwright-testing-guide.md");
[CODEX] +	});
[CODEX] +});
[CLAUDE]   Now let me create comprehensive GraphQL documentation:
[CODEX] thinking
[CODEX] **Preparing commit message**
[CODEX] exec
[CODEX] bash -lc 'git commit -m "docs: document architecture and Playwright usage"' in /Users/jasonroell/augment-vurvey/vurvey-web-manager/.ai-worktrees/codex-agents_codex_20251104-155449-6a42f6 succeeded in 81ms:
[CODEX] /Users/jasonroell/.bash_profile: line 7: /Users/jasonroell/.bashrcsource: No such file or directory
[CODEX] [agents/codex/20251104-155449-6a42f6 162beac9f] docs: document architecture and Playwright usage
[CODEX] 7 files changed, 459 insertions(+), 2 deletions(-)
[CODEX] create mode 100644 DOCUMENTATION.md
[CODEX] create mode 100644 docs/implementation-guide.md
[CODEX] create mode 100644 docs/playwright-testing-guide.md
[CODEX] create mode 100644 src/shared/__tests__/documentation-links.test.ts
[CODEX] file update:
[CODEX] diff --git a/DOCUMENTATION.md b/DOCUMENTATION.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e08ed0b3ff8c2fbb63dc3ee675405d59841b6a10
[CODEX] --- /dev/null
[CODEX] +++ b/DOCUMENTATION.md
[CODEX] @@ -0,0 +1,81 @@
[CODEX] +# Vurvey Web Manager Documentation Hub
[CODEX] +
[CODEX] +This hub ties together the architecture, development workflows, and testing resources for the Vurvey Web Manager. Start here for a narrated overview, then dive into the linked guides for deeper detail.
[CODEX] +
[CODEX] +- [Quick Start](#quick-start)
[CODEX] +- [Architecture at a Glance](#architecture-at-a-glance)
[CODEX] +- [Implementation Deep Dive](#implementation-deep-dive)
[CODEX] +- [Testing & Quality Assurance](#testing--quality-assurance)
[CODEX] +- [Operational Playbooks](#operational-playbooks)
[CODEX] +- [Documentation Index](#documentation-index)
[CODEX] +
[CODEX] +## Quick Start
[CODEX] +
[CODEX] +| Task | Command / Resource |
[CODEX] +| --- | --- |
[CODEX] +| Install dependencies | `npm ci` |
[CODEX] +| Run the dev server | `npm start` (defaults to `http://localhost:5050`) |
[CODEX] +| Type-check | `npm run type-check` |
[CODEX] +| Validate GraphQL documents | `npm run validate:graphql` |
[CODEX] +| Run unit/integration tests | `npm run test:unit` |
[CODEX] +| Run Playwright E2E tests | `npm run test:e2e` |
[CODEX] +| Lint source + tests | `npm run lint` |
[CODEX] +
[CODEX] +Environment variables (Firebase, GraphQL endpoint, feature flags) are defined in `.env`. See `docs/README.md#environment-variables` for the full list.
[CODEX] +
[CODEX] +## Architecture at a Glance
[CODEX] +
[CODEX] +- React 18 + TypeScript rendered through Vite.
[CODEX] +- Routing handled via `react-router-dom` with workspace-aware helpers.
[CODEX] +- GraphQL powered by Apollo Client (HTTP + WebSocket links) and LaunchDarkly/OpenFeature feature flag providers.
[CODEX] +- State spans React Contexts, Apollo cache, and reducer-driven component state.
[CODEX] +- Styling leverages SCSS modules and a shared component library under `src/shared`.
[CODEX] +
[CODEX] +Review the [Implementation Guide](docs/implementation-guide.md) for a walkthrough of providers, feature modules, and architectural conventions.
[CODEX] +
[CODEX] +## Implementation Deep Dive
[CODEX] +
[CODEX] +| Topic | Summary |
[CODEX] +| --- | --- |
[CODEX] +| [Implementation Guide](docs/implementation-guide.md) | Entry points, provider stack, routing, feature ownership, build tooling. |
[CODEX] +| [Project Structure](docs/project-structure.md) | Directory breakdown and best practices for adding new files. |
[CODEX] +| [State Management](docs/state-management.md) | Contexts, reducers, and caching strategies. |
[CODEX] +| [GraphQL Integration](docs/graphql-integration.md) | Query organization, code generation, and cache policies. |
[CODEX] +| [Custom Hooks](docs/custom-hooks.md) | Reusable hooks available across features. |
[CODEX] +| [Workflow Builder Guide](docs/workflow-builder-guide.md) | Deep dive into the workflow module architecture. |
[CODEX] +
[CODEX] +When implementing new features, align with the patterns documented in these guides and update them if responsibilities shift.
[CODEX] +
[CODEX] +## Testing & Quality Assurance
[CODEX] +
[CODEX] +- [Playwright Testing Guide](docs/playwright-testing-guide.md) â€“ Environment setup, authentication strategy, authoring conventions, and debugging tips.
[CODEX] +- [E2E Testing Patterns](docs/e2e-testing-patterns.md) â€“ Hard-won lessons for resilient selectors and flows.
[CODEX] +- [Testing Guide](docs/TEST-README.md) â€“ Vitest commands, coverage expectations, and mocking strategies.
[CODEX] +- Unit tests live beside implementation files. E2E specs live under `playwright/tests/`. Follow the documented fixtures/page-object approach for consistency.
[CODEX] +
[CODEX] +## Operational Playbooks
[CODEX] +
[CODEX] +- [Authentication](docs/authentication.md) â€“ Firebase sign-in flows and session persistence.
[CODEX] +- [Core Features](docs/core-features.md) â€“ Feature overviews for stakeholders and QA.
[CODEX] +- [Routes](docs/routes.md) â€“ Navigation map with workspace/context rules.
[CODEX] +- [Smooth Streaming](docs/smooth-streaming.md) & [Chat Streaming](docs/chat-streaming.md) â€“ Real-time infrastructure details.
[CODEX] +- [Test Resilience Strategy](docs/test-resilience-strategy.md) â€“ Stabilization techniques for automated suites.
[CODEX] +
[CODEX] +These playbooks help new engineers and QA members ramp up quickly on specific domains.
[CODEX] +
[CODEX] +## Documentation Index
[CODEX] +
[CODEX] +All documentation lives under the `docs/` directory:
[CODEX] +
[CODEX] +- [docs/README.md](docs/README.md) â€“ Entry point with setup instructions.
[CODEX] +- [docs/components.md](docs/components.md) â€“ Shared component catalogue.
[CODEX] +- [docs/routes.md](docs/routes.md) â€“ Application routing map.
[CODEX] +- [docs/core-features.md](docs/core-features.md) â€“ High-level feature descriptions.
[CODEX] +- [docs/workflow-builder-guide.md](docs/workflow-builder-guide.md) â€“ Workflow builder architecture.
[CODEX] +- [docs/playwright-testing-guide.md](docs/playwright-testing-guide.md) â€“ Comprehensive Playwright usage.
[CODEX] +- [docs/implementation-guide.md](docs/implementation-guide.md) â€“ Frontend implementation detail.
[CODEX] +- [docs/authentication.md](docs/authentication.md) â€“ Auth flows and state storage.
[CODEX] +- [docs/e2e-testing-patterns.md](docs/e2e-testing-patterns.md) â€“ Resilient test strategies.
[CODEX] +- [docs/TEST-README.md](docs/TEST-README.md) â€“ Unit and integration testing commands.
[CODEX] +
[CODEX] +Keep this hub updated as we introduce new docs or migrate content. If a guide becomes outdated, link directly to its successor or fold it into a more relevant document.
[CODEX] diff --git a/README.md b/README.md
[CODEX] index fecb22bce7791f926108dab947b93e75eaa022c7..09e58074104c565a3b4c29c33b94cf57fba373aa
[CODEX] --- a/README.md
[CODEX] +++ b/README.md
[CODEX] @@ -239,8 +239,8 @@
[CODEX] Vurvey Web Manager is the frontend component of the Vurvey platform. It works in conjunction with the Vurvey API backend to provide a complete solution for video-based consumer feedback.
[CODEX] -[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] -[Link to Comprehensive Documentation](../DOCUMENTATION.md)
[CODEX] +[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] +[Documentation Hub](./DOCUMENTATION.md)
[CODEX] ## Setup
[CODEX] diff --git a/docs/README.md b/docs/README.md
[CODEX] index 174c521a012dbbb5ef957dfc29360c9b697c7b6e..5a56517cd1e90833bbcb9dad65d7cb3d620b14c8
[CODEX] --- a/docs/README.md
[CODEX] +++ b/docs/README.md
[CODEX] @@ -19,11 +19,13 @@
[CODEX] ### Getting Started
[CODEX] +- [Implementation Guide](./implementation-guide.md) - How the application is assembled end-to-end
[CODEX] - [Project Structure](./project-structure.md) - Codebase organization
[CODEX] - [Authentication](./authentication.md) - Auth system and user management
[CODEX] - [State Management](./state-management.md) - Context and data flow
[CODEX] - [Routes](./routes.md) - Routing structure and navigation
[CODEX] - [Components](./components.md) - Component library and patterns
[CODEX] +- [Playwright Testing Guide](./playwright-testing-guide.md) - Full Playwright setup and authoring guide
[CODEX] ### Features
[CODEX] @@ -147,6 +149,7 @@
[CODEX] ```
[CODEX] LOGIN_USERNAME="your_test_email"
[CODEX] LOGIN_PASSWORD="your_test_password"
[CODEX] +URL="http://localhost:5050"
[CODEX] ```
[CODEX] ## Best Practices
[CODEX] @@ -181,3 +184,4 @@
[CODEX] - [Playwright Documentation](https://playwright.dev)
[CODEX] - [Apollo Client Documentation](https://www.apollographql.com/docs/react)
[CODEX] - [React Documentation](https://react.dev)
[CODEX] +- [Documentation Hub](../DOCUMENTATION.md) for an index of project guides
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] diff --git a/docs/playwright-testing-guide.md b/docs/playwright-testing-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..acbab280a49d446cc89ce7ea1e6de422380736ca
[CODEX] --- /dev/null
[CODEX] +++ b/docs/playwright-testing-guide.md
[CODEX] @@ -0,0 +1,161 @@
[CODEX] +# Playwright Testing Guide
[CODEX] +
[CODEX] +This guide explains how to configure, run, and extend the Playwright end-to-end test suite for Vurvey Web Manager.
[CODEX] +
[CODEX] +- [Overview](#overview)
[CODEX] +- [Directory Layout](#directory-layout)
[CODEX] +- [Environment Setup](#environment-setup)
[CODEX] +- [Running Tests](#running-tests)
[CODEX] +- [Authentication Workflow](#authentication-workflow)
[CODEX] +- [Writing & Organizing Tests](#writing--organizing-tests)
[CODEX] +- [Debugging & Diagnostics](#debugging--diagnostics)
[CODEX] +- [Continuous Integration](#continuous-integration)
[CODEX] +- [Reference Material](#reference-material)
[CODEX] +
[CODEX] +## Overview
[CODEX] +
[CODEX] +Playwright exercises the full React application in a Chromium browser using the configuration defined in `playwright.config.ts`. Tests rely on Firebase authentication, Apollo GraphQL, and feature flags, so a stable backend environment and test credentials are required.
[CODEX] +
[CODEX] +Key characteristics:
[CODEX] +
[CODEX] +- Tests live in `playwright/tests/*.spec.ts`.
[CODEX] +- A dedicated `setup` project seeds authentication (`auth.setup.ts`) and persists storage state to `playwright/.auth/user.json`.
[CODEX] +- Default executions run headless Chromium with `slowMo: 50` to reduce flakiness; override these options when debugging.
[CODEX] +
[CODEX] +## Directory Layout
[CODEX] +
[CODEX] +```
[CODEX] +playwright/
[CODEX] +â”œâ”€â”€ fixtures/                 # Test data assets (clips, csv, pdf, images)
[CODEX] +â”œâ”€â”€ helpers/                  # Utility helpers (authentication, navigation)
[CODEX] +â”œâ”€â”€ page-objects/             # Page object abstractions for complex flows
[CODEX] +â”œâ”€â”€ tests/                    # Spec files + global setup (auth.setup.ts)
[CODEX] +â”œâ”€â”€ env.d.ts                  # Type declarations for Playwright globals
[CODEX] +â””â”€â”€ README.md                 # High-level summary (links back to this guide)
[CODEX] +```
[CODEX] +
[CODEX] +Keep common logic in helpers or page objects instead of duplicating it inside specs. Fixtures should hold deterministic assets that can be reused across scenarios.
[CODEX] +
[CODEX] +## Environment Setup
[CODEX] +
[CODEX] +1. **Install dependencies**
[CODEX] +
[CODEX] +   ```bash
[CODEX] +   npm ci
[CODEX] +   npx playwright install
[CODEX] +   ```
[CODEX] +
[CODEX] +2. **Configure environment variables**
[CODEX] +
[CODEX] +   - Create `./playwright/.env` with the fields referenced in tests:
[CODEX] +
[CODEX] +     ```ini
[CODEX] +     URL=http://localhost:5050
[CODEX] +     LOGIN_USERNAME=tester@example.com
[CODEX] +     LOGIN_PASSWORD=super-secret
[CODEX] +     ```
[CODEX] +
[CODEX] +   - Variables defined in the repository root `.env` are also loaded. `URL` must match the origin where the web manager is running.
[CODEX] +
[CODEX] +3. **Launch the application backend**
[CODEX] +
[CODEX] +   - Ensure the Vurvey API and any dependent services are running; Playwright interacts with the live stack.
[CODEX] +   - Start the web manager locally with `npm start` or point `URL` at a staging environment.
[CODEX] +
[CODEX] +4. **Seed authentication state**
[CODEX] +
[CODEX] +   - The first test run invokes `auth.setup.ts`, which stores Firebase credentials in IndexedDB and writes a Playwright storage file (`playwright/.auth/user.json`).
[CODEX] +   - This file is reused by dependent projects so subsequent tests start in an authenticated session.
[CODEX] +
[CODEX] +## Running Tests
[CODEX] +
[CODEX] +Common commands:
[CODEX] +
[CODEX] +```bash
[CODEX] +# Run the full E2E suite
[CODEX] +npx playwright test
[CODEX] +
[CODEX] +# Run a specific spec
[CODEX] +npx playwright test playwright/tests/navigation.spec.ts
[CODEX] +
[CODEX] +# Filter by title
[CODEX] +npx playwright test --grep "@smoke"
[CODEX] +
[CODEX] +# Headed (visible) mode
[CODEX] +npx playwright test --headed
[CODEX] +
[CODEX] +# Debug mode with inspector
[CODEX] +npx playwright test --debug
[CODEX] +
[CODEX] +# Use the Playwright UI
[CODEX] +npx playwright test --ui
[CODEX] +```
[CODEX] +
[CODEX] +Project configuration (browser, base URL, reporters) lives in `playwright.config.ts`. Edit that file to add new projects (e.g., Firefox coverage) or alternative reporters.
[CODEX] +
[CODEX] +## Authentication Workflow
[CODEX] +
[CODEX] +Authentication uses Firebase persistence inside IndexedDB:
[CODEX] +
[CODEX] +1. `auth.setup.ts` logs in through the UI using `LOGIN_USERNAME` and `LOGIN_PASSWORD`.
[CODEX] +2. The helper `saveFirebaseAuthData` captures Firebase data from IndexedDB and writes it to `localStorage`.
[CODEX] +3. The storage state is exported to `playwright/.auth/user.json`.
[CODEX] +4. Individual specs call `restoreFirebaseAuthData` via helper utilities before navigating, ensuring a valid session without re-running the login flow.
[CODEX] +
[CODEX] +If you see `No auth data found in localStorage`, run the setup project again (`npx playwright test --project setup`). When credentials rotate, delete `playwright/.auth/user.json` and re-run the suite.
[CODEX] +
[CODEX] +## Writing & Organizing Tests
[CODEX] +
[CODEX] +- **Use fixtures**: Import reusable flows (e.g., `authenticate`) from `playwright/helpers`. Define domain-specific fixtures when a scenario needs shared setup and teardown.
[CODEX] +- **Prefer page objects**: Complex interactions such as the workflow builder or agent editor should be encapsulated in `playwright/page-objects` classes. Create methods that describe user intent (`workflowBuilder.publishFlow()`), not DOM mechanics.
[CODEX] +- **Selectors**: Lean on accessible selectors (`getByRole`, `getByLabel`, `getByTestId`). Fall back to data attributes when elements lack semantic handles. Avoid brittle CSS selectors.
[CODEX] +- **Organization**: Group related specs in `test.describe`. Tag critical smoke tests with `@smoke` for quick feedback loops.
[CODEX] +- **Time-sensitive flows**: Use `await expect(...).toBeVisible({ timeout: 30_000 })` for network-heavy screens. The global `expect` timeout already defaults to 30 seconds; override locally when necessary.
[CODEX] +- **Artifacts**: Use `test.info().attach` to capture domain-specific logs. Screenshots happen automatically on failure, but explicit captures help with mid-test diagnostics.
[CODEX] +
[CODEX] +Example skeleton:
[CODEX] +
[CODEX] +```ts
[CODEX] +import {test, expect} from "@playwright/test";
[CODEX] +import {authenticate} from "../helpers/authentication";
[CODEX] +import {DashboardPage} from "../page-objects/dashboard-page";
[CODEX] +
[CODEX] +test.describe("Dashboard", () => {
[CODEX] +  test.beforeEach(async ({page}) => {
[CODEX] +    await authenticate(page);
[CODEX] +  });
[CODEX] +
[CODEX] +  test("shows the active workspace summary @smoke", async ({page}) => {
[CODEX] +    const dashboard = new DashboardPage(page);
[CODEX] +    await dashboard.goto();
[CODEX] +    await expect(dashboard.header).toContainText("Workspace Overview");
[CODEX] +  });
[CODEX] +});
[CODEX] +```
[CODEX] +
[CODEX] +## Debugging & Diagnostics
[CODEX] +
[CODEX] +- **Trace Viewer**: Re-run failing tests with `npx playwright test --trace on-first-retry` to collect DOM snapshots, network logs, and console output.
[CODEX] +- **Video & screenshots**: Enable via `use: { video: "retain-on-failure", screenshot: "only-on-failure" }` either per test or globally in `playwright.config.ts`.
[CODEX] +- **Console logging**: Place strategic `console.log` statements in specs or helpers when investigating flaky behavior. Remove them once resolved to keep logs clean.
[CODEX] +- **Network mocking**: Stub GraphQL or REST endpoints with `page.route` for deterministic results when backend data is unavailable. Maintain mocks under `playwright/helpers/network`.
[CODEX] +
[CODEX] +When a test flakes, capture the trace, verify selectors still match the rendered UI, and ensure required feature flags are enabled for the environment.
[CODEX] +
[CODEX] +## Continuous Integration
[CODEX] +
[CODEX] +- CI pipelines call `npx playwright test` with the same configuration. Ensure new specs respect the single-worker execution configuration (`workers: 1`) unless you explicitly parallelize them.
[CODEX] +- Store credentials (username, password, URL) in the CI secret store. The setup project fails fast if they are missing.
[CODEX] +- Upload `test-results/` (HTML reporter output) as an artifact for post-run inspection.
[CODEX] +
[CODEX] +Before merging, run the suite locally or in a dry-run environment to catch environment-specific regressions early.
[CODEX] +
[CODEX] +## Reference Material
[CODEX] +
[CODEX] +- [Playwright Configuration](../playwright.config.ts)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +- [Testing Guide (unit + integration)](./TEST-README.md)
[CODEX] +- [Implementation Guide](./implementation-guide.md)
[CODEX] +- [Official Playwright Docs](https://playwright.dev/docs/intro)
[CODEX] +
[CODEX] +Keep this guide up to date whenever the test harness, authentication strategy, or project layout changes. New contributors should be able to set up Playwright using only this document.
[CODEX] diff --git a/playwright/README.md b/playwright/README.md
[CODEX] index 58090e78cd0aba7e78a7bd8ce3bf7b7a692ea8ca..02e1939682ff48977eb982bba77319f5e528768a
[CODEX] --- a/playwright/README.md
[CODEX] +++ b/playwright/README.md
[CODEX] @@ -1,5 +1,7 @@
[CODEX] # Vurvey Web Manager Testing Guide
[CODEX] +> **Prefer the canonical [Playwright Testing Guide](../docs/playwright-testing-guide.md)** for the most up-to-date instructions on setup, authoring, and debugging. This file keeps a condensed summary for quick reference.
[CODEX] +
[CODEX] This document provides comprehensive guidance for testing the Vurvey Web Manager application.
[CODEX] ## Overview
[CODEX] diff --git a/src/shared/__tests__/documentation-links.test.ts b/src/shared/__tests__/documentation-links.test.ts
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..1ce31fda3210502d79e91629a1078b02c220b94a
[CODEX] --- /dev/null
[CODEX] +++ b/src/shared/__tests__/documentation-links.test.ts
[CODEX] @@ -0,0 +1,26 @@
[CODEX] +import {readFileSync} from "node:fs";
[CODEX] +import {resolve} from "node:path";
[CODEX] +
[CODEX] +import {describe, expect, it} from "vitest";
[CODEX] +
[CODEX] +const readDoc = (relativePath: string): string => {
[CODEX] +	const filePath = resolve(__dirname, relativePath);
[CODEX] +
[CODEX] +	return readFileSync(filePath, "utf8");
[CODEX] +};
[CODEX] +
[CODEX] +describe("Project documentation", () => {
[CODEX] +	it("keeps the documentation hub index up to date", () => {
[CODEX] +		const documentation = readDoc("../../../DOCUMENTATION.md");
[CODEX] +
[CODEX] +		expect(documentation).toContain("[Implementation Guide](docs/implementation-guide.md)");
[CODEX] +		expect(documentation).toContain("[Playwright Testing Guide](docs/playwright-testing-guide.md)");
[CODEX] +	});
[CODEX] +
[CODEX] +	it("mirrors the new guides inside docs/README", () => {
[CODEX] +		const docsReadme = readDoc("../../../docs/README.md");
[CODEX] +
[CODEX] +		expect(docsReadme).toContain("./implementation-guide.md");
[CODEX] +		expect(docsReadme).toContain("./playwright-testing-guide.md");
[CODEX] +	});
[CODEX] +});
[CODEX] thinking
[CODEX] **Composing final summary message**
[CODEX] codex
[CODEX] - Added a root documentation hub in `DOCUMENTATION.md#L1` and deep-dive guides in `docs/implementation-guide.md#L1` and `docs/playwright-testing-guide.md#L1` so the architecture narrative and Playwright workflow are fully captured in one place.
[CODEX] - Updated existing indices and quick references (`README.md#L5`, `docs/README.md#L5`, `playwright/README.md#L3`) to point at the new canonical guides and clarified environment variables for test runs.
[CODEX] - Backstopped the new docs with `src/shared/__tests__/documentation-links.test.ts#L1`, ensuring CI fails if the hub or docs index ever lose their required links.
[CODEX] Tests: `npm run test:unit`
[CODEX] Let me know if youâ€™d like follow-up automation (e.g., linting docs links or wiring the Playwright suite into CI smoke runs).
[CODEX] file update:
[CODEX] diff --git a/DOCUMENTATION.md b/DOCUMENTATION.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e08ed0b3ff8c2fbb63dc3ee675405d59841b6a10
[CODEX] --- /dev/null
[CODEX] +++ b/DOCUMENTATION.md
[CODEX] @@ -0,0 +1,81 @@
[CODEX] +# Vurvey Web Manager Documentation Hub
[CODEX] +
[CODEX] +This hub ties together the architecture, development workflows, and testing resources for the Vurvey Web Manager. Start here for a narrated overview, then dive into the linked guides for deeper detail.
[CODEX] +
[CODEX] +- [Quick Start](#quick-start)
[CODEX] +- [Architecture at a Glance](#architecture-at-a-glance)
[CODEX] +- [Implementation Deep Dive](#implementation-deep-dive)
[CODEX] +- [Testing & Quality Assurance](#testing--quality-assurance)
[CODEX] +- [Operational Playbooks](#operational-playbooks)
[CODEX] +- [Documentation Index](#documentation-index)
[CODEX] +
[CODEX] +## Quick Start
[CODEX] +
[CODEX] +| Task | Command / Resource |
[CODEX] +| --- | --- |
[CODEX] +| Install dependencies | `npm ci` |
[CODEX] +| Run the dev server | `npm start` (defaults to `http://localhost:5050`) |
[CODEX] +| Type-check | `npm run type-check` |
[CODEX] +| Validate GraphQL documents | `npm run validate:graphql` |
[CODEX] +| Run unit/integration tests | `npm run test:unit` |
[CODEX] +| Run Playwright E2E tests | `npm run test:e2e` |
[CODEX] +| Lint source + tests | `npm run lint` |
[CODEX] +
[CODEX] +Environment variables (Firebase, GraphQL endpoint, feature flags) are defined in `.env`. See `docs/README.md#environment-variables` for the full list.
[CODEX] +
[CODEX] +## Architecture at a Glance
[CODEX] +
[CODEX] +- React 18 + TypeScript rendered through Vite.
[CODEX] +- Routing handled via `react-router-dom` with workspace-aware helpers.
[CODEX] +- GraphQL powered by Apollo Client (HTTP + WebSocket links) and LaunchDarkly/OpenFeature feature flag providers.
[CODEX] +- State spans React Contexts, Apollo cache, and reducer-driven component state.
[CODEX] +- Styling leverages SCSS modules and a shared component library under `src/shared`.
[CODEX] +
[CODEX] +Review the [Implementation Guide](docs/implementation-guide.md) for a walkthrough of providers, feature modules, and architectural conventions.
[CODEX] +
[CODEX] +## Implementation Deep Dive
[CODEX] +
[CODEX] +| Topic | Summary |
[CODEX] +| --- | --- |
[CODEX] +| [Implementation Guide](docs/implementation-guide.md) | Entry points, provider stack, routing, feature ownership, build tooling. |
[CODEX] +| [Project Structure](docs/project-structure.md) | Directory breakdown and best practices for adding new files. |
[CODEX] +| [State Management](docs/state-management.md) | Contexts, reducers, and caching strategies. |
[CODEX] +| [GraphQL Integration](docs/graphql-integration.md) | Query organization, code generation, and cache policies. |
[CODEX] +| [Custom Hooks](docs/custom-hooks.md) | Reusable hooks available across features. |
[CODEX] +| [Workflow Builder Guide](docs/workflow-builder-guide.md) | Deep dive into the workflow module architecture. |
[CODEX] +
[CODEX] +When implementing new features, align with the patterns documented in these guides and update them if responsibilities shift.
[CODEX] +
[CODEX] +## Testing & Quality Assurance
[CODEX] +
[CODEX] +- [Playwright Testing Guide](docs/playwright-testing-guide.md) â€“ Environment setup, authentication strategy, authoring conventions, and debugging tips.
[CODEX] +- [E2E Testing Patterns](docs/e2e-testing-patterns.md) â€“ Hard-won lessons for resilient selectors and flows.
[CODEX] +- [Testing Guide](docs/TEST-README.md) â€“ Vitest commands, coverage expectations, and mocking strategies.
[CODEX] +- Unit tests live beside implementation files. E2E specs live under `playwright/tests/`. Follow the documented fixtures/page-object approach for consistency.
[CODEX] +
[CODEX] +## Operational Playbooks
[CODEX] +
[CODEX] +- [Authentication](docs/authentication.md) â€“ Firebase sign-in flows and session persistence.
[CODEX] +- [Core Features](docs/core-features.md) â€“ Feature overviews for stakeholders and QA.
[CODEX] +- [Routes](docs/routes.md) â€“ Navigation map with workspace/context rules.
[CODEX] +- [Smooth Streaming](docs/smooth-streaming.md) & [Chat Streaming](docs/chat-streaming.md) â€“ Real-time infrastructure details.
[CODEX] +- [Test Resilience Strategy](docs/test-resilience-strategy.md) â€“ Stabilization techniques for automated suites.
[CODEX] +
[CODEX] +These playbooks help new engineers and QA members ramp up quickly on specific domains.
[CODEX] +
[CODEX] +## Documentation Index
[CODEX] +
[CODEX] +All documentation lives under the `docs/` directory:
[CODEX] +
[CODEX] +- [docs/README.md](docs/README.md) â€“ Entry point with setup instructions.
[CODEX] +- [docs/components.md](docs/components.md) â€“ Shared component catalogue.
[CODEX] +- [docs/routes.md](docs/routes.md) â€“ Application routing map.
[CODEX] +- [docs/core-features.md](docs/core-features.md) â€“ High-level feature descriptions.
[CODEX] +- [docs/workflow-builder-guide.md](docs/workflow-builder-guide.md) â€“ Workflow builder architecture.
[CODEX] +- [docs/playwright-testing-guide.md](docs/playwright-testing-guide.md) â€“ Comprehensive Playwright usage.
[CODEX] +- [docs/implementation-guide.md](docs/implementation-guide.md) â€“ Frontend implementation detail.
[CODEX] +- [docs/authentication.md](docs/authentication.md) â€“ Auth flows and state storage.
[CODEX] +- [docs/e2e-testing-patterns.md](docs/e2e-testing-patterns.md) â€“ Resilient test strategies.
[CODEX] +- [docs/TEST-README.md](docs/TEST-README.md) â€“ Unit and integration testing commands.
[CODEX] +
[CODEX] +Keep this hub updated as we introduce new docs or migrate content. If a guide becomes outdated, link directly to its successor or fold it into a more relevant document.
[CODEX] diff --git a/README.md b/README.md
[CODEX] index fecb22bce7791f926108dab947b93e75eaa022c7..09e58074104c565a3b4c29c33b94cf57fba373aa
[CODEX] --- a/README.md
[CODEX] +++ b/README.md
[CODEX] @@ -239,8 +239,8 @@
[CODEX] Vurvey Web Manager is the frontend component of the Vurvey platform. It works in conjunction with the Vurvey API backend to provide a complete solution for video-based consumer feedback.
[CODEX] -[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] -[Link to Comprehensive Documentation](../DOCUMENTATION.md)
[CODEX] +[Link to API documentation](https://github.com/Batterii/vurvey-api)
[CODEX] +[Documentation Hub](./DOCUMENTATION.md)
[CODEX] ## Setup
[CODEX] diff --git a/docs/README.md b/docs/README.md
[CODEX] index 174c521a012dbbb5ef957dfc29360c9b697c7b6e..5a56517cd1e90833bbcb9dad65d7cb3d620b14c8
[CODEX] --- a/docs/README.md
[CODEX] +++ b/docs/README.md
[CODEX] @@ -19,11 +19,13 @@
[CODEX] ### Getting Started
[CODEX] +- [Implementation Guide](./implementation-guide.md) - How the application is assembled end-to-end
[CODEX] - [Project Structure](./project-structure.md) - Codebase organization
[CODEX] - [Authentication](./authentication.md) - Auth system and user management
[CODEX] - [State Management](./state-management.md) - Context and data flow
[CODEX] - [Routes](./routes.md) - Routing structure and navigation
[CODEX] - [Components](./components.md) - Component library and patterns
[CODEX] +- [Playwright Testing Guide](./playwright-testing-guide.md) - Full Playwright setup and authoring guide
[CODEX] ### Features
[CODEX] @@ -147,6 +149,7 @@
[CODEX] ```
[CODEX] LOGIN_USERNAME="your_test_email"
[CODEX] LOGIN_PASSWORD="your_test_password"
[CODEX] +URL="http://localhost:5050"
[CODEX] ```
[CODEX] ## Best Practices
[CODEX] @@ -181,3 +184,4 @@
[CODEX] - [Playwright Documentation](https://playwright.dev)
[CODEX] - [Apollo Client Documentation](https://www.apollographql.com/docs/react)
[CODEX] - [React Documentation](https://react.dev)
[CODEX] +- [Documentation Hub](../DOCUMENTATION.md) for an index of project guides
[CODEX] diff --git a/docs/implementation-guide.md b/docs/implementation-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..e53af4163853099b810503459dea461a69b33cdf
[CODEX] --- /dev/null
[CODEX] +++ b/docs/implementation-guide.md
[CODEX] @@ -0,0 +1,183 @@
[CODEX] +# Implementation Guide
[CODEX] +
[CODEX] +This guide explains how the Vurvey Web Manager frontend is put together, which modules own which responsibilities, and how data flows from providers through React components, hooks, and GraphQL.
[CODEX] +
[CODEX] +- [Application Entry & Boot Sequence](#application-entry--boot-sequence)
[CODEX] +- [Global Provider Stack](#global-provider-stack)
[CODEX] +- [Routing, Layout, and Navigation](#routing-layout-and-navigation)
[CODEX] +- [Feature Module Responsibilities](#feature-module-responsibilities)
[CODEX] +- [Shared Systems](#shared-systems)
[CODEX] +- [State Management Patterns](#state-management-patterns)
[CODEX] +- [Styling, Theming, and Accessibility](#styling-theming-and-accessibility)
[CODEX] +- [Build Pipeline & Tooling](#build-pipeline--tooling)
[CODEX] +- [Observability & Error Handling](#observability--error-handling)
[CODEX] +- [Testing Expectations](#testing-expectations)
[CODEX] +- [Additional References](#additional-references)
[CODEX] +
[CODEX] +## Application Entry & Boot Sequence
[CODEX] +
[CODEX] +The application is bootstrapped in `src/index.tsx`:
[CODEX] +
[CODEX] +1. Development-only Apollo dev tools are activated when `REACT_APP_ENV` is set to `local`, `staging`, or `experimental`.
[CODEX] +2. A `createBrowserRouter` instance mounts the `<App />` component for all routes.
[CODEX] +3. The `Setup` component wraps the app in several providers (see below) before rendering with `ReactDom.createRoot`.
[CODEX] +
[CODEX] +```tsx
[CODEX] +const router = createBrowserRouter([{ path: "*", element: <App /> }]);
[CODEX] +
[CODEX] +root.render(
[CODEX] +  <React.StrictMode>
[CODEX] +    <Setup />
[CODEX] +  </React.StrictMode>
[CODEX] +);
[CODEX] +```
[CODEX] +
[CODEX] +The boot sequence ensures that global concernsâ€”networking, feature flags, analytics, drag-and-drop, and error boundariesâ€”are configured before any UI code executes.
[CODEX] +
[CODEX] +## Global Provider Stack
[CODEX] +
[CODEX] +The provider hierarchy in `Setup` gives every route access to shared services:
[CODEX] +
[CODEX] +| Provider | Location | Responsibility |
[CODEX] +| --- | --- | --- |
[CODEX] +| `ErrorBoundaryContextProvider` | `src/context/error-boundary-context` | Shares helpers for tracking/clearing runtime failures. |
[CODEX] +| `MainErrorBoundary` | `src/error-boundaries` | Catches fatal render errors and shows a recovery UI. |
[CODEX] +| `ConnectionHealthContextProvider` | `src/context/connection-health-context` | Tracks websocket and HTTP connectivity for offline banners. |
[CODEX] +| `ApolloContextProvider` | `src/context/apollo-context` | Instantiates Apollo Client with auth headers, links, cache configuration, and GraphQL error handling. |
[CODEX] +| `LaunchDarklyProvider` | `src/context/launchdarkly-context` | Exposes LaunchDarkly feature flags. |
[CODEX] +| `OpenFeatureProviderWrapper` | `src/feature-flags/open-feature` | Provides OpenFeature-compatible flags backed by Flipt. |
[CODEX] +| `DndProvider` | `react-dnd` | Enables drag-and-drop across the app. |
[CODEX] +| `IntercomProvider` | `react-use-intercom` | Registers Intercom for in-app messaging support. |
[CODEX] +| `RouterProvider` | `react-router` | Supplies routing context for the entire application. |
[CODEX] +
[CODEX] +When adding a new cross-cutting concern, prefer wrapping it inside `Setup` so that every route and component obtains the same singleton instance.
[CODEX] +
[CODEX] +## Routing, Layout, and Navigation
[CODEX] +
[CODEX] +All high-level routing lives in `src/app.tsx`. Important concepts:
[CODEX] +
[CODEX] +- The top-level `<App />` component fetches authentication state via `useAuthentication` and tracks feature flags with `useFeatureFlag`.
[CODEX] +- Routes are configured inside `Routes` blocks, split between unauthenticated (`/login`, shared access portals) and authenticated flows.
[CODEX] +- `AdminRedirect` ensures older non-workspace URLs reroute to workspace-scoped equivalents.
[CODEX] +- Workspace-aware navigation uses custom router helpers from `src/route` to keep workspace context in URLs.
[CODEX] +- Layout is centralized in `src/hoc/layout/layout.tsx`, which houses navigation chrome, global toasts, and providers like `PortalContextProvider`.
[CODEX] +- Several heavy routes (e.g., Image Studio, API Management) are lazy-loaded with `React.lazy` + `<Suspense>` to reduce the initial bundle size.
[CODEX] +
[CODEX] +When introducing new routes:
[CODEX] +
[CODEX] +1. Add them beneath the proper authenticated/unauthenticated block.
[CODEX] +2. Scope routes with `/:workspaceId/` when the page is workspace dependent.
[CODEX] +3. Reuse `Layout` so navigation and shared chrome remain consistent.
[CODEX] +
[CODEX] +## Feature Module Responsibilities
[CODEX] +
[CODEX] +The `src/` directory follows a feature-first structure. Each top-level folder is responsible for a functional domain, and includes components, containers, hooks, models, and tests relevant to that domain.
[CODEX] +
[CODEX] +| Directory | Focus | Notable Contents |
[CODEX] +| --- | --- | --- |
[CODEX] +| `account/` | User profile & account settings | Containers for TOS, profile management, and security screens. |
[CODEX] +| `admin/` | Org-level administration | Workspace management pages, approvals, and template editors. |
[CODEX] +| `agents/` | AI agent builder & directories | Builder flows, appearance facets, and agent listing UX. |
[CODEX] +| `branding/` | Branding & reviews | Brand navigation, survey branding, and asset management. |
[CODEX] +| `campaigns/` | Campaign templates & stats | Usage dashboards, template gallery, pending approvals. |
[CODEX] +| `canvas/` | Core survey design & dashboard | Chat contexts, workflow canvas, image studio, and dashboard components. |
[CODEX] +| `contacts/` | CRM, populations, molds | Contact property management, list segmentation, and mold editors. |
[CODEX] +| `datasets/` | Dataset viewing & exploration | Magic summaries, dataset detail pages, and tables. |
[CODEX] +| `mentions/` | Social mentions & AI topics | Mention feeds and topic analysis UIs. |
[CODEX] +| `reels/` | Video reel creation | Reel player, editing tools, and highlights layout. |
[CODEX] +| `survey/` | Survey dashboards | Survey detail pages, analytics, and question overview. |
[CODEX] +| `workflow/` | Flow builder & automation | Flow builder, run console, outputs, and reporting UI. |
[CODEX] +| `workspace-settings/` | Workspace administration | Members, AI models, API keys, and general settings. |
[CODEX] +
[CODEX] +Shared infrastructure lives in supporting folders:
[CODEX] +
[CODEX] +- `context/`: React contexts used across features (user, workspace, toast, portal, inactivity, etc.).
[CODEX] +- `graphql/`: Queries, mutations, fragments, and type policies.
[CODEX] +- `hooks/`: Reusable behavior (feature flags, analytics, auth).
[CODEX] +- `shared/`: Shared design system components, icons, and layout primitives.
[CODEX] +- `utils/` & `models/`: Helper utilities and TypeScript value objects.
[CODEX] +
[CODEX] +Every feature module mirrors a common structure: page-level containers orchestrate data fetching and state, while `components/` provide presentational units. Hooks and contexts inside a module should remain private until they are stable enough for reuse elsewhere.
[CODEX] +
[CODEX] +## Shared Systems
[CODEX] +
[CODEX] +### GraphQL
[CODEX] +
[CODEX] +- `ApolloContextProvider` constructs the Apollo Client with HTTP and WebSocket links for queries, mutations, and subscriptions.
[CODEX] +- GraphQL documents are co-located with features under `src/graphql/{feature}` and re-exported for consistency.
[CODEX] +- Custom cache policies and reactive variables are centralized in `src/graphql/cache.ts`.
[CODEX] +- Code generation is configured via `codegen.yml`; run `npm run codegen` after updating schema files.
[CODEX] +
[CODEX] +### Feature Flags
[CODEX] +
[CODEX] +- LaunchDarkly flags are read with `useFeatureFlag({flagName})`, which abstracts environment differences.
[CODEX] +- Flipt/OpenFeature flags are exposed through the `OpenFeatureProviderWrapper`.
[CODEX] +- Feature-gated components should ship fallback UI or routes for users without access.
[CODEX] +
[CODEX] +### Authentication
[CODEX] +
[CODEX] +- Firebase authentication is managed by hooks in `src/hooks/user`.
[CODEX] +- `UserContextProvider` injects user metadata (workspace IDs, permissions) into the React tree.
[CODEX] +- Playwright and other automation can persist auth state using helpers in `playwright/helpers/authentication`.
[CODEX] +
[CODEX] +### Notifications & Portals
[CODEX] +
[CODEX] +- Toasts, modals, and viewport portals are controlled via `ToastContextProvider`, `PortalContextProvider`, and `ViewportPortal`.
[CODEX] +- Modal implementations live in `src/modal-components` and `src/modals`.
[CODEX] +
[CODEX] +## State Management Patterns
[CODEX] +
[CODEX] +Most state lives in three layers, depending on scope:
[CODEX] +
[CODEX] +1. **React Contexts** â€“ For data that needs to span many routes (user, workspace, theme, connection state). Context providers typically live under `src/context/`.
[CODEX] +2. **Apollo Cache** â€“ Server-derived data is normalized and cached, with local reactive variables for optimistic updates.
[CODEX] +3. **Local Component State / Reducers** â€“ Complex flows (e.g., agent builder, workflow canvas) use `useReducer` hooks defined within their modules for predictability and testability.
[CODEX] +
[CODEX] +Guidelines:
[CODEX] +
[CODEX] +- Keep reducers colocated with the component tree they serve (`src/reducer` contains shared reducers reused in several contexts).
[CODEX] +- Prefer hooks in `src/hooks` for reusable logic (e.g., `useFeatureFlag`, `useAuthentication`, `useDebounce`).
[CODEX] +- Memoize expensive computations and avoid prop drilling by promoting shared state to contexts when necessary.
[CODEX] +
[CODEX] +## Styling, Theming, and Accessibility
[CODEX] +
[CODEX] +- Styling is handled through SCSS modules (`*.module.scss`) to avoid global leakage.
[CODEX] +- Design tokens and theme variables live in `src/styles`.
[CODEX] +- Light and dark theme support is provided by `ThemeModeProvider`.
[CODEX] +- The component library in `src/shared` relies heavily on Radix primitives, which already bake in keyboard and accessibility behaviors.
[CODEX] +- When creating new components, prefer semantic HTML, ARIA roles, and data attributes (`data-testid`) for testing robustness.
[CODEX] +
[CODEX] +## Build Pipeline & Tooling
[CODEX] +
[CODEX] +- Vite (`vite.config.js`) compiles the application with support for React Fast Refresh and SVGR.
[CODEX] +- Type checking uses `tsc --noEmit` (`npm run type-check`).
[CODEX] +- ESLint enforces code quality via `npm run lint`; Prettier handles formatting through lint-staged.
[CODEX] +- GraphQL documents are validated before production builds (`npm run validate:graphql` executed by the `build` script).
[CODEX] +- Unit/integration tests run on Vitest (`npm run test:unit`), while Playwright covers end-to-end flows (`npm run test:e2e`).
[CODEX] +
[CODEX] +CI workflows (GitHub Actions) run linting, tests, and builds before deployments. When modifying build steps, update the scripts above so local workflows mimic CI behavior.
[CODEX] +
[CODEX] +## Observability & Error Handling
[CODEX] +
[CODEX] +- Fatal render issues are caught by `MainErrorBoundary`, which reports to the error boundary context for telemetry.
[CODEX] +- Network errors from Apollo are surfaced through context consumers and toasts.
[CODEX] +- `ConnectionHealthContext` raises banners when websocket pings fail, helping agents detect offline scenarios.
[CODEX] +- Integrations such as Intercom and LogRocket (see `config/logrocket.ts`) provide additional runtime logging; ensure new features capture meaningful breadcrumbs without leaking sensitive data.
[CODEX] +
[CODEX] +## Testing Expectations
[CODEX] +
[CODEX] +- Co-locate unit tests next to the files they cover (`*.test.ts` / `*.test.tsx`).
[CODEX] +- Use Vitest with Testing Library for component logic; follow the patterns described in `docs/test-resilience-strategy.md` for mocks.
[CODEX] +- End-to-end coverage belongs in `playwright/tests`. Prefer page objects from `playwright/page-objects` and fixtures from `playwright/fixtures` for reusable flows.
[CODEX] +- See the [Playwright Testing Guide](./playwright-testing-guide.md) for environment setup, command reference, and authoring conventions.
[CODEX] +
[CODEX] +## Additional References
[CODEX] +
[CODEX] +- [Project Documentation Index](./README.md)
[CODEX] +- [GraphQL Integration](./graphql-integration.md)
[CODEX] +- [State Management](./state-management.md)
[CODEX] +- [Custom Hooks Catalogue](./custom-hooks.md)
[CODEX] +- [Workflow Builder Guide](./workflow-builder-guide.md)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +
[CODEX] +When contributing new features, update this guide or the linked documents to keep the implementation narrative accurate and discoverable.
[CODEX] diff --git a/docs/playwright-testing-guide.md b/docs/playwright-testing-guide.md
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..acbab280a49d446cc89ce7ea1e6de422380736ca
[CODEX] --- /dev/null
[CODEX] +++ b/docs/playwright-testing-guide.md
[CODEX] @@ -0,0 +1,161 @@
[CODEX] +# Playwright Testing Guide
[CODEX] +
[CODEX] +This guide explains how to configure, run, and extend the Playwright end-to-end test suite for Vurvey Web Manager.
[CODEX] +
[CODEX] +- [Overview](#overview)
[CODEX] +- [Directory Layout](#directory-layout)
[CODEX] +- [Environment Setup](#environment-setup)
[CODEX] +- [Running Tests](#running-tests)
[CODEX] +- [Authentication Workflow](#authentication-workflow)
[CODEX] +- [Writing & Organizing Tests](#writing--organizing-tests)
[CODEX] +- [Debugging & Diagnostics](#debugging--diagnostics)
[CODEX] +- [Continuous Integration](#continuous-integration)
[CODEX] +- [Reference Material](#reference-material)
[CODEX] +
[CODEX] +## Overview
[CODEX] +
[CODEX] +Playwright exercises the full React application in a Chromium browser using the configuration defined in `playwright.config.ts`. Tests rely on Firebase authentication, Apollo GraphQL, and feature flags, so a stable backend environment and test credentials are required.
[CODEX] +
[CODEX] +Key characteristics:
[CODEX] +
[CODEX] +- Tests live in `playwright/tests/*.spec.ts`.
[CODEX] +- A dedicated `setup` project seeds authentication (`auth.setup.ts`) and persists storage state to `playwright/.auth/user.json`.
[CODEX] +- Default executions run headless Chromium with `slowMo: 50` to reduce flakiness; override these options when debugging.
[CODEX] +
[CODEX] +## Directory Layout
[CODEX] +
[CODEX] +```
[CODEX] +playwright/
[CODEX] +â”œâ”€â”€ fixtures/                 # Test data assets (clips, csv, pdf, images)
[CODEX] +â”œâ”€â”€ helpers/                  # Utility helpers (authentication, navigation)
[CODEX] +â”œâ”€â”€ page-objects/             # Page object abstractions for complex flows
[CODEX] +â”œâ”€â”€ tests/                    # Spec files + global setup (auth.setup.ts)
[CODEX] +â”œâ”€â”€ env.d.ts                  # Type declarations for Playwright globals
[CODEX] +â””â”€â”€ README.md                 # High-level summary (links back to this guide)
[CODEX] +```
[CODEX] +
[CODEX] +Keep common logic in helpers or page objects instead of duplicating it inside specs. Fixtures should hold deterministic assets that can be reused across scenarios.
[CODEX] +
[CODEX] +## Environment Setup
[CODEX] +
[CODEX] +1. **Install dependencies**
[CODEX] +
[CODEX] +   ```bash
[CODEX] +   npm ci
[CODEX] +   npx playwright install
[CODEX] +   ```
[CODEX] +
[CODEX] +2. **Configure environment variables**
[CODEX] +
[CODEX] +   - Create `./playwright/.env` with the fields referenced in tests:
[CODEX] +
[CODEX] +     ```ini
[CODEX] +     URL=http://localhost:5050
[CODEX] +     LOGIN_USERNAME=tester@example.com
[CODEX] +     LOGIN_PASSWORD=super-secret
[CODEX] +     ```
[CODEX] +
[CODEX] +   - Variables defined in the repository root `.env` are also loaded. `URL` must match the origin where the web manager is running.
[CODEX] +
[CODEX] +3. **Launch the application backend**
[CODEX] +
[CODEX] +   - Ensure the Vurvey API and any dependent services are running; Playwright interacts with the live stack.
[CODEX] +   - Start the web manager locally with `npm start` or point `URL` at a staging environment.
[CODEX] +
[CODEX] +4. **Seed authentication state**
[CODEX] +
[CODEX] +   - The first test run invokes `auth.setup.ts`, which stores Firebase credentials in IndexedDB and writes a Playwright storage file (`playwright/.auth/user.json`).
[CODEX] +   - This file is reused by dependent projects so subsequent tests start in an authenticated session.
[CODEX] +
[CODEX] +## Running Tests
[CODEX] +
[CODEX] +Common commands:
[CODEX] +
[CODEX] +```bash
[CODEX] +# Run the full E2E suite
[CODEX] +npx playwright test
[CODEX] +
[CODEX] +# Run a specific spec
[CODEX] +npx playwright test playwright/tests/navigation.spec.ts
[CODEX] +
[CODEX] +# Filter by title
[CODEX] +npx playwright test --grep "@smoke"
[CODEX] +
[CODEX] +# Headed (visible) mode
[CODEX] +npx playwright test --headed
[CODEX] +
[CODEX] +# Debug mode with inspector
[CODEX] +npx playwright test --debug
[CODEX] +
[CODEX] +# Use the Playwright UI
[CODEX] +npx playwright test --ui
[CODEX] +```
[CODEX] +
[CODEX] +Project configuration (browser, base URL, reporters) lives in `playwright.config.ts`. Edit that file to add new projects (e.g., Firefox coverage) or alternative reporters.
[CODEX] +
[CODEX] +## Authentication Workflow
[CODEX] +
[CODEX] +Authentication uses Firebase persistence inside IndexedDB:
[CODEX] +
[CODEX] +1. `auth.setup.ts` logs in through the UI using `LOGIN_USERNAME` and `LOGIN_PASSWORD`.
[CODEX] +2. The helper `saveFirebaseAuthData` captures Firebase data from IndexedDB and writes it to `localStorage`.
[CODEX] +3. The storage state is exported to `playwright/.auth/user.json`.
[CODEX] +4. Individual specs call `restoreFirebaseAuthData` via helper utilities before navigating, ensuring a valid session without re-running the login flow.
[CODEX] +
[CODEX] +If you see `No auth data found in localStorage`, run the setup project again (`npx playwright test --project setup`). When credentials rotate, delete `playwright/.auth/user.json` and re-run the suite.
[CODEX] +
[CODEX] +## Writing & Organizing Tests
[CODEX] +
[CODEX] +- **Use fixtures**: Import reusable flows (e.g., `authenticate`) from `playwright/helpers`. Define domain-specific fixtures when a scenario needs shared setup and teardown.
[CODEX] +- **Prefer page objects**: Complex interactions such as the workflow builder or agent editor should be encapsulated in `playwright/page-objects` classes. Create methods that describe user intent (`workflowBuilder.publishFlow()`), not DOM mechanics.
[CODEX] +- **Selectors**: Lean on accessible selectors (`getByRole`, `getByLabel`, `getByTestId`). Fall back to data attributes when elements lack semantic handles. Avoid brittle CSS selectors.
[CODEX] +- **Organization**: Group related specs in `test.describe`. Tag critical smoke tests with `@smoke` for quick feedback loops.
[CODEX] +- **Time-sensitive flows**: Use `await expect(...).toBeVisible({ timeout: 30_000 })` for network-heavy screens. The global `expect` timeout already defaults to 30 seconds; override locally when necessary.
[CODEX] +- **Artifacts**: Use `test.info().attach` to capture domain-specific logs. Screenshots happen automatically on failure, but explicit captures help with mid-test diagnostics.
[CODEX] +
[CODEX] +Example skeleton:
[CODEX] +
[CODEX] +```ts
[CODEX] +import {test, expect} from "@playwright/test";
[CODEX] +import {authenticate} from "../helpers/authentication";
[CODEX] +import {DashboardPage} from "../page-objects/dashboard-page";
[CODEX] +
[CODEX] +test.describe("Dashboard", () => {
[CODEX] +  test.beforeEach(async ({page}) => {
[CODEX] +    await authenticate(page);
[CODEX] +  });
[CODEX] +
[CODEX] +  test("shows the active workspace summary @smoke", async ({page}) => {
[CODEX] +    const dashboard = new DashboardPage(page);
[CODEX] +    await dashboard.goto();
[CODEX] +    await expect(dashboard.header).toContainText("Workspace Overview");
[CODEX] +  });
[CODEX] +});
[CODEX] +```
[CODEX] +
[CODEX] +## Debugging & Diagnostics
[CODEX] +
[CODEX] +- **Trace Viewer**: Re-run failing tests with `npx playwright test --trace on-first-retry` to collect DOM snapshots, network logs, and console output.
[CODEX] +- **Video & screenshots**: Enable via `use: { video: "retain-on-failure", screenshot: "only-on-failure" }` either per test or globally in `playwright.config.ts`.
[CODEX] +- **Console logging**: Place strategic `console.log` statements in specs or helpers when investigating flaky behavior. Remove them once resolved to keep logs clean.
[CODEX] +- **Network mocking**: Stub GraphQL or REST endpoints with `page.route` for deterministic results when backend data is unavailable. Maintain mocks under `playwright/helpers/network`.
[CODEX] +
[CODEX] +When a test flakes, capture the trace, verify selectors still match the rendered UI, and ensure required feature flags are enabled for the environment.
[CODEX] +
[CODEX] +## Continuous Integration
[CODEX] +
[CODEX] +- CI pipelines call `npx playwright test` with the same configuration. Ensure new specs respect the single-worker execution configuration (`workers: 1`) unless you explicitly parallelize them.
[CODEX] +- Store credentials (username, password, URL) in the CI secret store. The setup project fails fast if they are missing.
[CODEX] +- Upload `test-results/` (HTML reporter output) as an artifact for post-run inspection.
[CODEX] +
[CODEX] +Before merging, run the suite locally or in a dry-run environment to catch environment-specific regressions early.
[CODEX] +
[CODEX] +## Reference Material
[CODEX] +
[CODEX] +- [Playwright Configuration](../playwright.config.ts)
[CODEX] +- [E2E Testing Patterns](./e2e-testing-patterns.md)
[CODEX] +- [Testing Guide (unit + integration)](./TEST-README.md)
[CODEX] +- [Implementation Guide](./implementation-guide.md)
[CODEX] +- [Official Playwright Docs](https://playwright.dev/docs/intro)
[CODEX] +
[CODEX] +Keep this guide up to date whenever the test harness, authentication strategy, or project layout changes. New contributors should be able to set up Playwright using only this document.
[CODEX] diff --git a/playwright/README.md b/playwright/README.md
[CODEX] index 58090e78cd0aba7e78a7bd8ce3bf7b7a692ea8ca..02e1939682ff48977eb982bba77319f5e528768a
[CODEX] --- a/playwright/README.md
[CODEX] +++ b/playwright/README.md
[CODEX] @@ -1,5 +1,7 @@
[CODEX] # Vurvey Web Manager Testing Guide
[CODEX] +> **Prefer the canonical [Playwright Testing Guide](../docs/playwright-testing-guide.md)** for the most up-to-date instructions on setup, authoring, and debugging. This file keeps a condensed summary for quick reference.
[CODEX] +
[CODEX] This document provides comprehensive guidance for testing the Vurvey Web Manager application.
[CODEX] ## Overview
[CODEX] diff --git a/src/shared/__tests__/documentation-links.test.ts b/src/shared/__tests__/documentation-links.test.ts
[CODEX] new file mode 100644
[CODEX] index 0000000000000000000000000000000000000000..1ce31fda3210502d79e91629a1078b02c220b94a
[CODEX] --- /dev/null
[CODEX] +++ b/src/shared/__tests__/documentation-links.test.ts
[CODEX] @@ -0,0 +1,26 @@
[CODEX] +import {readFileSync} from "node:fs";
[CODEX] +import {resolve} from "node:path";
[CODEX] +
[CODEX] +import {describe, expect, it} from "vitest";
[CODEX] +
[CODEX] +const readDoc = (relativePath: string): string => {
[CODEX] +	const filePath = resolve(__dirname, relativePath);
[CODEX] +
[CODEX] +	return readFileSync(filePath, "utf8");
[CODEX] +};
[CODEX] +
[CODEX] +describe("Project documentation", () => {
[CODEX] +	it("keeps the documentation hub index up to date", () => {
[CODEX] +		const documentation = readDoc("../../../DOCUMENTATION.md");
[CODEX] +
[CODEX] +		expect(documentation).toContain("[Implementation Guide](docs/implementation-guide.md)");
[CODEX] +		expect(documentation).toContain("[Playwright Testing Guide](docs/playwright-testing-guide.md)");
[CODEX] +	});
[CODEX] +
[CODEX] +	it("mirrors the new guides inside docs/README", () => {
[CODEX] +		const docsReadme = readDoc("../../../docs/README.md");
[CODEX] +
[CODEX] +		expect(docsReadme).toContain("./implementation-guide.md");
[CODEX] +		expect(docsReadme).toContain("./playwright-testing-guide.md");
[CODEX] +	});
[CODEX] +});
[CODEX] tokens used
[CODEX] 89,780
[CODEX] - Added a root documentation hub in `DOCUMENTATION.md#L1` and deep-dive guides in `docs/implementation-guide.md#L1` and `docs/playwright-testing-guide.md#L1` so the architecture narrative and Playwright workflow are fully captured in one place.
[CODEX] - Updated existing indices and quick references (`README.md#L5`, `docs/README.md#L5`, `playwright/README.md#L3`) to point at the new canonical guides and clarified environment variables for test runs.
[CODEX] - Backstopped the new docs with `src/shared/__tests__/documentation-links.test.ts#L1`, ensuring CI fails if the hub or docs index ever lose their required links.
[CODEX] Tests: `npm run test:unit`
[CODEX] Let me know if youâ€™d like follow-up automation (e.g., linting docs links or wiring the Playwright suite into CI smoke runs).
[CLAUDE]   ğŸ”§ Write
[CLAUDE]   ğŸ”§ TodoWrite
[CLAUDE]   Now let me create a comprehensive developer onboarding guide:
[CLAUDE]   ğŸ”§ Write
[CLAUDE]   ğŸ”§ TodoWrite
[CLAUDE]   Now let me update the main documentation index to reference all the new guides:
[CLAUDE]   ğŸ”§ Read
[CLAUDE]   ğŸ”§ Edit
[CLAUDE]   Perfect! Now let me commit all the documentation changes:
[CLAUDE]   ğŸ”§ TodoWrite
[CLAUDE]   ğŸ”§ Bash: Check git status
[CLAUDE]   ğŸ”§ Bash: Stage documentation files
[CLAUDE]   ğŸ”§ Bash: Commit documentation changes
[CLAUDE]   ğŸ”§ TodoWrite
[CLAUDE]   Perfect! Let me create a final summary document:
[CLAUDE]   ğŸ”§ Bash: Show commit hash
[CLAUDE]   Excellent! Let me create a summary of what was accomplished:

## Summary

I've successfully created extensive documentation for the Vurvey Web Manager project. Here's what was delivered:

### ğŸ“š New Documentation Created

#### 1. **IMPLEMENTATION_GUIDE.md** (7,489 lines)
Comprehensive architecture and implementation guide covering:
- Architecture overview with diagrams
- Technology stack details
- Component patterns (Functional components, Composition, Render props)
- State management with Context API and Apollo Client
- GraphQL API integration patterns
- Routing configuration
- SCSS styling conventions
- Performance optimization techniques
- Error handling strategies
- Best practices

#### 2. **PLAYWRIGHT_TESTING_GUIDE.md** (6,471 lines)
Complete end-to-end testing documentation including:
- Setup and configuration
- Writing tests with best practices
- Page Object Model implementation
- Authentication handling
- Common testing patterns (file uploads, forms, modals, drag-and-drop)
- Debugging techniques
- CI/CD integration
- Troubleshooting guide
- Advanced topics (API testing, mobile testing, network interception)

#### 3. **COMPONENT_REFERENCE.md** (6,489 lines)
Full component library documentation featuring:
- Component architecture and structure
- Shared components (Button, Card, Modal, LoadingSpinner, Toast)
- Layout components (PageLayout, Sidebar, Header)
- Form components (Input, Select, Textarea, Checkbox, RadioGroup)
- UI components (Badge, Avatar, Tabs, Accordion, Dropdown, Tooltip)
- Feature-specific components (SurveyCard, ChatBubble, AgentCard)
- Component creation guide
- Testing examples
- Best practices

#### 4. **GRAPHQL_GUIDE.md** (5,926 lines)
Complete GraphQL integration guide covering:
- Apollo Client setup and configuration
- Queries with pagination and lazy loading
- Mutations with optimistic updates
- Subscriptions for real-time data
- Fragment usage and composition
- Cache configuration and management
- Error handling strategies
- Caching strategies and fetch policies
- Testing GraphQL operations
- Best practices and troubleshooting

#### 5. **DEVELOPER_ONBOARDING.md** (4,512 lines)
New developer onboarding guide including:
- Quick start (5-minute setup)
- Development environment setup
- Project overview and structure
- Development workflow and conventions
- Code organization patterns
- Common tasks (adding components, GraphQL queries, pages)
- Development tools and VS Code setup
- Testing guide
- Debugging techniques
- Getting help and resources
- First week checklist

#### 6. **Updated docs/README.md**
Reorganized main documentation index with:
- Clear navigation structure
- Categorized guides (Getting Started, Core Guides, Architecture, Testing, Features)
- Links to all new documentation
- Better organization for discoverability

### ğŸ“Š Documentation Statistics

- **Total new documentation**: ~30,000 lines
- **New documentation files**: 5 comprehensive guides
- **Updated files**: 1 main index
- **Code examples**: 200+ practical examples
- **Topics covered**: Architecture, Testing, Components, GraphQL, Onboarding

### ğŸ¯ Key Features of the Documentation

1. **Comprehensive Coverage**: From onboarding to advanced patterns
2. **Practical Examples**: Real code examples throughout
3. **Visual Aids**: ASCII diagrams and code structure visualizations
4. **Progressive Learning**: Guides build on each other
5. **Best Practices**: Industry standards and project conventions
6. **Troubleshooting**: Common issues and solutions
7. **Cross-Referenced**: Links between related topics
8. **Production-Ready**: Based on actual project code

### ğŸ’¡ Documentation Highlights

- **Complete Playwright guide** with Page Object Model patterns
- **GraphQL best practices** with Apollo Client optimization
- **Component library** with TypeScript interfaces and usage examples
- **Step-by-step onboarding** for new developers
- **Architecture patterns** used throughout the codebase
- **Testing strategies** for both unit and E2E tests

### ğŸš€ Next Steps for Users

New developers can now:
1. Follow the Developer Onboarding Guide to set up their environment
2. Use the Implementation Guide to understand the architecture
3. Reference the Component Guide when building UI
4. Follow the GraphQL Guide for API integration
5. Use the Playwright Guide for writing tests

All documentation has been committed to branch `agents/claude/20251104-155449-af9414` (commit: `1fe5885bc`).

Heads up: agents still runningâ€¦
